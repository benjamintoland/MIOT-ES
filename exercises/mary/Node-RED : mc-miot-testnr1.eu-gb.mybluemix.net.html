<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<title>Node-RED : mc-miot-testnr1.eu-gb.mybluemix.net</title>
<link rel="icon" type="image/png" href="https://mc-miot-testnr1.eu-gb.mybluemix.net/red/favicon.ico">
<link rel="mask-icon" href="https://mc-miot-testnr1.eu-gb.mybluemix.net/red/red/images/node-red-icon-black.svg" color="#8f0000">
<link href="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/bootstrap.css" rel="stylesheet" media="screen">
<link href="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/jquery-ui-1.css" rel="stylesheet" media="screen">
<link rel="stylesheet" href="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/font-awesome.css">
<link rel="stylesheet" href="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/vendor.css">
<link rel="stylesheet" href="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/style.css">

<style id="ace_editor.css">.ace_editor {position: relative;overflow: hidden;font: 12px/normal 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;direction: ltr;text-align: left;}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;min-width: 100%;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: '';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;text-indent: -1em;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: inherit;color: inherit;z-index: 1000;opacity: 1;text-indent: 0;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;}.ace_text-layer {font: inherit !important;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_smooth-blinking .ace_cursor {-webkit-transition: opacity 0.18s;transition: opacity 0.18s;}.ace_editor.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;}.ace_line .ace_fold {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.1));background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {-webkit-transition: opacity 0.4s ease 0.05s;transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {-webkit-transition: opacity 0.05s ease 0.05s;transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}
/*# sourceURL=ace/css/ace_editor.css */</style><style id="ace-tm">.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}
/*# sourceURL=ace/css/ace-tm */</style><style>    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }</style><style>.ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}</style><style>.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);}.ace_editor.ace_autocomplete .ace_line-hover {    position: absolute;    z-index: 2;}.ace_editor.ace_autocomplete .ace_scroller {   background: none;   border: none;   box-shadow: none;}.ace_rightAlignedText {    color: gray;    display: inline-block;    position: absolute;    right: 4px;    text-align: right;    z-index: -1;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #000;    text-shadow: 0 0 0.01em;}.ace_editor.ace_autocomplete {    width: 280px;    z-index: 200000;    background: #fbfbfb;    color: #444;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;}</style></head>
<body spellcheck="false">
<div id="header">
    <span class="logo"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/node-red.png" title="0.16.0"> <span>Node-RED</span></span>
    <ul class="header-toolbar hide" style="display: block;"><li><span class="deploy-button-group button-group"><a id="btn-deploy" class="deploy-button disabled" href="#"><span class="deploy-button-content"><img id="btn-deploy-icon" src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/deploy-full-o.png"> <span>Deploy</span></span><span class="deploy-button-spinner hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg"></span></a><a id="btn-deploy-options" data-toggle="dropdown" class="deploy-button" href="#"><i class="fa fa-caret-down"></i></a><ul id="btn-deploy-options-submenu" class="dropdown-menu pull-right"><li><a id="deploymenu-item-full" tabindex="-1" href="#" class="active"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/deploy-full.png"> <span class="menu-label-container"><span class="menu-label">Full</span><span class="menu-sublabel">Deploys everything in the workspace</span></span></a></li><li><a id="deploymenu-item-flow" tabindex="-1" href="#"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/deploy-flows.png"> <span class="menu-label-container"><span class="menu-label">Modified Flows</span><span class="menu-sublabel">Only deploys flows that contain changed nodes</span></span></a></li><li><a id="deploymenu-item-node" tabindex="-1" href="#"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/deploy-nodes.png"> <span class="menu-label-container"><span class="menu-label">Modified Nodes</span><span class="menu-sublabel">Only deploys nodes that have changed</span></span></a></li></ul></span></li>
        <li><a id="btn-sidemenu" class="button" data-toggle="dropdown" href="#"><i class="fa fa-bars"></i></a><ul id="btn-sidemenu-submenu" class="dropdown-menu pull-right"><li class="dropdown-submenu pull-left"><a id="menu-item-view-menu" tabindex="-1" href="#"><span class="menu-label">View</span></a><ul id="menu-item-view-menu-submenu" class="dropdown-menu"><li><a id="menu-item-view-show-grid" tabindex="-1" href="#"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><span class="menu-label">Show grid</span></a></li><li><a id="menu-item-view-snap-grid" tabindex="-1" href="#"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><span class="menu-label">Snap to grid</span></a></li><li><a id="menu-item-status" tabindex="-1" href="#" class="active"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><span class="menu-label">Show node status</span></a></li><li class="divider"></li><li><a id="menu-item-sidebar" tabindex="-1" href="#" class="active"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><span class="menu-label">Show sidebar</span></a></li><li class="menu-group-sidebar-tabs"><a id="menu-item-view-menu-debug" tabindex="-1" href="#"><span class="menu-label">Debug messages</span></a></li></ul></li><li class="divider"></li><li class="dropdown-submenu pull-left"><a id="menu-item-import" tabindex="-1" href="#"><span class="menu-label">Import</span></a><ul id="menu-item-import-submenu" class="dropdown-menu"><li><a id="menu-item-import-clipboard" tabindex="-1" href="#"><span class="menu-label">Clipboard</span></a></li><li class="dropdown-submenu pull-left"><a id="menu-item-import-library" tabindex="-1" href="#"><span class="menu-label">Library</span></a><ul id="menu-item-import-library-submenu" class="dropdown-menu"></ul></li></ul></li><li class="dropdown-submenu pull-left disabled"><a id="menu-item-export" tabindex="-1" href="#"><span class="menu-label">Export</span></a><ul id="menu-item-export-submenu" class="dropdown-menu"><li class="disabled"><a id="menu-item-export-clipboard" tabindex="-1" href="#"><span class="menu-label">Clipboard</span></a></li><li class="disabled"><a id="menu-item-export-library" tabindex="-1" href="#"><span class="menu-label">Library</span></a></li></ul></li><li class="divider"></li><li><a id="menu-item-search" tabindex="-1" href="#"><span class="menu-label">Search flows</span></a></li><li class="divider"></li><li><a id="menu-item-config-nodes" tabindex="-1" href="#"><span class="menu-label">Configuration nodes</span></a></li><li class="dropdown-submenu pull-left"><a id="menu-item-workspace" tabindex="-1" href="#"><span class="menu-label">Flows</span></a><ul id="menu-item-workspace-submenu" class="dropdown-menu"><li><a id="menu-item-workspace-add" tabindex="-1" href="#"><span class="menu-label">Add</span></a></li><li><a id="menu-item-workspace-edit" tabindex="-1" href="#"><span class="menu-label">Rename</span></a></li><li class="disabled"><a id="menu-item-workspace-delete" tabindex="-1" href="#"><span class="menu-label">Delete</span></a></li></ul></li><li class="dropdown-submenu pull-left"><a id="menu-item-subflow" tabindex="-1" href="#"><span class="menu-label">Subflows</span></a><ul id="menu-item-subflow-submenu" class="dropdown-menu"><li><a id="menu-item-subflow-create" tabindex="-1" href="#"><span class="menu-label">Create Subflow</span></a></li><li class="disabled"><a id="menu-item-subflow-convert" tabindex="-1" href="#"><span class="menu-label">Selection to Subflow</span></a></li></ul></li><li class="divider"></li><li><a id="menu-item-edit-palette" tabindex="-1" href="#"><span class="menu-label">Manage palette</span></a></li><li class="divider"></li><li><a id="menu-item-keyboard-shortcuts" tabindex="-1" href="#"><span class="menu-label">Keyboard shortcuts</span></a></li><li><a id="menu-item-show-tips" tabindex="-1" href="#" class="active"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><span class="menu-label">Show tips</span></a></li><li><a id="menu-item-help" tabindex="-1" href="http://nodered.org/docs" target="_blank"><span class="menu-label">Node-RED website</span></a></li><li><a id="menu-item-node-red-version" tabindex="-1" href="#"><span class="menu-label">v0.16.0</span></a></li></ul></li>
    </ul>
    <div id="header-shade" class="hide"></div>
</div>
<div id="main-container" class="hide" style="display: block;">
    <div id="workspace">
        <div class="red-ui-tabs red-ui-tabs-add red-ui-tabs-scrollable"><div class="red-ui-tabs-scroll-container"><ul id="workspace-tabs" style="width: 777px;"><li class="red-ui-tab active ui-draggable" style="width: 759px;"><a href="#f5c4e19a.9ea79" class="red-ui-tab-label" title="Flow 1"><span class="bidiAware" dir="">Flow 1</span></a></li></ul></div><div class="red-ui-tab-button"><a href="#"><i class="fa fa-plus"></i></a></div><div class="red-ui-tab-button red-ui-tab-scroll red-ui-tab-scroll-left"><a href="#" style="display:none;"><i class="fa fa-caret-left"></i></a></div><div class="red-ui-tab-button red-ui-tab-scroll red-ui-tab-scroll-right"><a href="#" style="display:none;"><i class="fa fa-caret-right"></i></a></div></div>
        <div id="chart" tabindex="1" class="ui-droppable" style="margin-top: 0px;"><svg width="5000" height="5000" pointer-events="all" style="cursor: crosshair;"><g><g transform="scale(1)"><rect width="5000" height="5000" fill="#fff"></rect><g style="visibility: hidden;"><line class="horizontal" x1="0" x2="5000" y1="0" y2="0" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="20" y2="20" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="40" y2="40" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="60" y2="60" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="80" y2="80" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="100" y2="100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="120" y2="120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="140" y2="140" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="160" y2="160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="180.00000000000003" y2="180.00000000000003" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="200" y2="200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="220.00000000000003" y2="220.00000000000003" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="240" y2="240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="260" y2="260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="280" y2="280" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="300" y2="300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="320" y2="320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="340" y2="340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="360.00000000000006" y2="360.00000000000006" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="380" y2="380" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="400" y2="400" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="420" y2="420" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="440.00000000000006" y2="440.00000000000006" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="460" y2="460" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="480" y2="480" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="500" y2="500" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="520" y2="520" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="540" y2="540" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="560" y2="560" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="580" y2="580" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="600" y2="600" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="620" y2="620" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="640" y2="640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="660" y2="660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="680" y2="680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="700.0000000000001" y2="700.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="720.0000000000001" y2="720.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="740.0000000000001" y2="740.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="760" y2="760" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="780" y2="780" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="800" y2="800" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="820" y2="820" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="840" y2="840" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="860.0000000000001" y2="860.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="880.0000000000001" y2="880.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="900.0000000000001" y2="900.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="920" y2="920" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="940" y2="940" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="960" y2="960" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="980" y2="980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1000" y2="1000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1020.0000000000001" y2="1020.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1040" y2="1040" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1060" y2="1060" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1080" y2="1080" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1100" y2="1100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1120" y2="1120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1140" y2="1140" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1160" y2="1160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1180" y2="1180" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1200" y2="1200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1220" y2="1220" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1240" y2="1240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1260" y2="1260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1280" y2="1280" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1300" y2="1300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1320" y2="1320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1340" y2="1340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1360" y2="1360" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1380.0000000000002" y2="1380.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1400.0000000000002" y2="1400.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1420.0000000000002" y2="1420.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1440.0000000000002" y2="1440.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1460.0000000000002" y2="1460.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1480.0000000000002" y2="1480.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1500" y2="1500" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1520" y2="1520" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1540" y2="1540" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1560" y2="1560" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1580" y2="1580" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1600" y2="1600" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1620" y2="1620" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1640" y2="1640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1660" y2="1660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1680" y2="1680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1700.0000000000002" y2="1700.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1720.0000000000002" y2="1720.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1740.0000000000002" y2="1740.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1760.0000000000002" y2="1760.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1780.0000000000002" y2="1780.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1800.0000000000002" y2="1800.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1820" y2="1820" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1840" y2="1840" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1860" y2="1860" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1880" y2="1880" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1900" y2="1900" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1920" y2="1920" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1940" y2="1940" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1960" y2="1960" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="1980" y2="1980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2000" y2="2000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2020.0000000000002" y2="2020.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2040.0000000000002" y2="2040.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2060" y2="2060" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2080" y2="2080" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2100" y2="2100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2120" y2="2120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2140.0000000000005" y2="2140.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2160" y2="2160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2180" y2="2180" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2200" y2="2200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2220" y2="2220" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2240" y2="2240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2260" y2="2260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2280" y2="2280" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2300" y2="2300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2320" y2="2320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2340" y2="2340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2360" y2="2360" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2380" y2="2380" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2400" y2="2400" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2420" y2="2420" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2440" y2="2440" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2460.0000000000005" y2="2460.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2480" y2="2480" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2500" y2="2500" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2520" y2="2520" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2540" y2="2540" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2560" y2="2560" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2580" y2="2580" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2600" y2="2600" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2620" y2="2620" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2640" y2="2640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2660" y2="2660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2680" y2="2680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2700" y2="2700" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2720" y2="2720" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2740" y2="2740" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2760.0000000000005" y2="2760.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2780.0000000000005" y2="2780.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2800.0000000000005" y2="2800.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2820.0000000000005" y2="2820.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2840.0000000000005" y2="2840.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2860.0000000000005" y2="2860.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2880.0000000000005" y2="2880.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2900.0000000000005" y2="2900.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2920.0000000000005" y2="2920.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2940.0000000000005" y2="2940.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2960.0000000000005" y2="2960.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="2980" y2="2980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3000" y2="3000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3020" y2="3020" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3040" y2="3040" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3060" y2="3060" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3080" y2="3080" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3100" y2="3100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3120" y2="3120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3140" y2="3140" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3160" y2="3160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3180" y2="3180" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3200" y2="3200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3220" y2="3220" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3240" y2="3240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3260" y2="3260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3280" y2="3280" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3300" y2="3300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3320" y2="3320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3340" y2="3340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3360" y2="3360" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3380" y2="3380" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3400.0000000000005" y2="3400.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3420.0000000000005" y2="3420.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3440.0000000000005" y2="3440.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3460.0000000000005" y2="3460.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3480.0000000000005" y2="3480.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3500.0000000000005" y2="3500.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3520.0000000000005" y2="3520.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3540.0000000000005" y2="3540.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3560.0000000000005" y2="3560.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3580.0000000000005" y2="3580.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3600.0000000000005" y2="3600.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3620.0000000000005" y2="3620.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3640" y2="3640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3660" y2="3660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3680" y2="3680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3700" y2="3700" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3720" y2="3720" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3740" y2="3740" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3760" y2="3760" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3780" y2="3780" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3800" y2="3800" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3820" y2="3820" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3840" y2="3840" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3860" y2="3860" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3880" y2="3880" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3900" y2="3900" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3920" y2="3920" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3940" y2="3940" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3960" y2="3960" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="3980" y2="3980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4000" y2="4000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4020.0000000000005" y2="4020.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4040.0000000000005" y2="4040.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4060.0000000000005" y2="4060.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4080.0000000000005" y2="4080.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4100" y2="4100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4120" y2="4120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4140" y2="4140" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4160" y2="4160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4180" y2="4180" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4200" y2="4200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4220" y2="4220" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4240" y2="4240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4260" y2="4260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4280.000000000001" y2="4280.000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4300" y2="4300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4320" y2="4320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4340" y2="4340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4360" y2="4360" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4380" y2="4380" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4400" y2="4400" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4420" y2="4420" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4440" y2="4440" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4460" y2="4460" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4480" y2="4480" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4500" y2="4500" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4520" y2="4520" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4540" y2="4540" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4560" y2="4560" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4580" y2="4580" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4600" y2="4600" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4620" y2="4620" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4640" y2="4640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4660" y2="4660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4680" y2="4680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4700" y2="4700" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4720" y2="4720" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4740" y2="4740" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4760" y2="4760" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4780" y2="4780" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4800" y2="4800" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4820" y2="4820" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4840" y2="4840" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4860" y2="4860" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4880" y2="4880" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4900.000000000001" y2="4900.000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4920.000000000001" y2="4920.000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4940.000000000001" y2="4940.000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4960" y2="4960" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="4980" y2="4980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="horizontal" x1="0" x2="5000" y1="5000" y2="5000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="0" x2="0" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="20" x2="20" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="40" x2="40" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="60" x2="60" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="80" x2="80" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="100" x2="100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="120" x2="120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="140" x2="140" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="160" x2="160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="180.00000000000003" x2="180.00000000000003" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="200" x2="200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="220.00000000000003" x2="220.00000000000003" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="240" x2="240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="260" x2="260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="280" x2="280" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="300" x2="300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="320" x2="320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="340" x2="340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="360.00000000000006" x2="360.00000000000006" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="380" x2="380" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="400" x2="400" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="420" x2="420" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="440.00000000000006" x2="440.00000000000006" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="460" x2="460" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="480" x2="480" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="500" x2="500" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="520" x2="520" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="540" x2="540" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="560" x2="560" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="580" x2="580" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="600" x2="600" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="620" x2="620" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="640" x2="640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="660" x2="660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="680" x2="680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="700.0000000000001" x2="700.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="720.0000000000001" x2="720.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="740.0000000000001" x2="740.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="760" x2="760" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="780" x2="780" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="800" x2="800" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="820" x2="820" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="840" x2="840" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="860.0000000000001" x2="860.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="880.0000000000001" x2="880.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="900.0000000000001" x2="900.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="920" x2="920" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="940" x2="940" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="960" x2="960" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="980" x2="980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1000" x2="1000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1020.0000000000001" x2="1020.0000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1040" x2="1040" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1060" x2="1060" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1080" x2="1080" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1100" x2="1100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1120" x2="1120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1140" x2="1140" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1160" x2="1160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1180" x2="1180" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1200" x2="1200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1220" x2="1220" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1240" x2="1240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1260" x2="1260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1280" x2="1280" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1300" x2="1300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1320" x2="1320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1340" x2="1340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1360" x2="1360" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1380.0000000000002" x2="1380.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1400.0000000000002" x2="1400.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1420.0000000000002" x2="1420.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1440.0000000000002" x2="1440.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1460.0000000000002" x2="1460.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1480.0000000000002" x2="1480.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1500" x2="1500" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1520" x2="1520" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1540" x2="1540" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1560" x2="1560" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1580" x2="1580" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1600" x2="1600" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1620" x2="1620" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1640" x2="1640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1660" x2="1660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1680" x2="1680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1700.0000000000002" x2="1700.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1720.0000000000002" x2="1720.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1740.0000000000002" x2="1740.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1760.0000000000002" x2="1760.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1780.0000000000002" x2="1780.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1800.0000000000002" x2="1800.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1820" x2="1820" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1840" x2="1840" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1860" x2="1860" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1880" x2="1880" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1900" x2="1900" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1920" x2="1920" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1940" x2="1940" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1960" x2="1960" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="1980" x2="1980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2000" x2="2000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2020.0000000000002" x2="2020.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2040.0000000000002" x2="2040.0000000000002" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2060" x2="2060" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2080" x2="2080" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2100" x2="2100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2120" x2="2120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2140.0000000000005" x2="2140.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2160" x2="2160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2180" x2="2180" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2200" x2="2200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2220" x2="2220" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2240" x2="2240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2260" x2="2260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2280" x2="2280" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2300" x2="2300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2320" x2="2320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2340" x2="2340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2360" x2="2360" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2380" x2="2380" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2400" x2="2400" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2420" x2="2420" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2440" x2="2440" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2460.0000000000005" x2="2460.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2480" x2="2480" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2500" x2="2500" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2520" x2="2520" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2540" x2="2540" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2560" x2="2560" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2580" x2="2580" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2600" x2="2600" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2620" x2="2620" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2640" x2="2640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2660" x2="2660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2680" x2="2680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2700" x2="2700" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2720" x2="2720" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2740" x2="2740" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2760.0000000000005" x2="2760.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2780.0000000000005" x2="2780.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2800.0000000000005" x2="2800.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2820.0000000000005" x2="2820.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2840.0000000000005" x2="2840.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2860.0000000000005" x2="2860.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2880.0000000000005" x2="2880.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2900.0000000000005" x2="2900.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2920.0000000000005" x2="2920.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2940.0000000000005" x2="2940.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2960.0000000000005" x2="2960.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="2980" x2="2980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3000" x2="3000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3020" x2="3020" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3040" x2="3040" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3060" x2="3060" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3080" x2="3080" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3100" x2="3100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3120" x2="3120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3140" x2="3140" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3160" x2="3160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3180" x2="3180" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3200" x2="3200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3220" x2="3220" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3240" x2="3240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3260" x2="3260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3280" x2="3280" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3300" x2="3300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3320" x2="3320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3340" x2="3340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3360" x2="3360" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3380" x2="3380" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3400.0000000000005" x2="3400.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3420.0000000000005" x2="3420.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3440.0000000000005" x2="3440.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3460.0000000000005" x2="3460.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3480.0000000000005" x2="3480.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3500.0000000000005" x2="3500.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3520.0000000000005" x2="3520.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3540.0000000000005" x2="3540.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3560.0000000000005" x2="3560.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3580.0000000000005" x2="3580.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3600.0000000000005" x2="3600.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3620.0000000000005" x2="3620.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3640" x2="3640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3660" x2="3660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3680" x2="3680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3700" x2="3700" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3720" x2="3720" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3740" x2="3740" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3760" x2="3760" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3780" x2="3780" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3800" x2="3800" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3820" x2="3820" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3840" x2="3840" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3860" x2="3860" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3880" x2="3880" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3900" x2="3900" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3920" x2="3920" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3940" x2="3940" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3960" x2="3960" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="3980" x2="3980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4000" x2="4000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4020.0000000000005" x2="4020.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4040.0000000000005" x2="4040.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4060.0000000000005" x2="4060.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4080.0000000000005" x2="4080.0000000000005" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4100" x2="4100" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4120" x2="4120" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4140" x2="4140" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4160" x2="4160" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4180" x2="4180" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4200" x2="4200" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4220" x2="4220" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4240" x2="4240" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4260" x2="4260" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4280.000000000001" x2="4280.000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4300" x2="4300" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4320" x2="4320" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4340" x2="4340" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4360" x2="4360" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4380" x2="4380" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4400" x2="4400" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4420" x2="4420" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4440" x2="4440" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4460" x2="4460" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4480" x2="4480" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4500" x2="4500" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4520" x2="4520" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4540" x2="4540" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4560" x2="4560" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4580" x2="4580" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4600" x2="4600" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4620" x2="4620" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4640" x2="4640" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4660" x2="4660" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4680" x2="4680" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4700" x2="4700" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4720" x2="4720" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4740" x2="4740" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4760" x2="4760" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4780" x2="4780" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4800" x2="4800" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4820" x2="4820" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4840" x2="4840" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4860" x2="4860" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4880" x2="4880" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4900.000000000001" x2="4900.000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4920.000000000001" x2="4920.000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4940.000000000001" x2="4940.000000000001" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4960" x2="4960" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="4980" x2="4980" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line><line class="vertical" y1="0" y2="5000" x1="5000" x2="5000" fill="none" shape-rendering="crispEdges" stroke="#eee" stroke-width="1px"></line></g><g></g><g class="link"><path class="link_background link_path" d="M 315 483 C 390 483 705 570 780 570"></path><path class="link_outline link_path" d="M 315 483 C 390 483 705 570 780 570"></path><path class="link_line link_path" d="M 315 483 C 390 483 705 570 780 570"></path></g><g class="link"><path class="link_background link_path" d="M 315 483 C 390 483 406 632 481 632"></path><path class="link_outline link_path" d="M 315 483 C 390 483 406 632 481 632"></path><path class="link_line link_path" d="M 315 483 C 390 483 406 632 481 632"></path></g><g class="link"><path class="link_background link_path" d="M 316 588 C 391 588 406 632 481 632"></path><path class="link_outline link_path" d="M 316 588 C 391 588 406 632 481 632"></path><path class="link_line link_path" d="M 316 588 C 391 588 406 632 481 632"></path></g><g class="link"><path class="link_background link_path" d="M 316 588 C 391 588 705 570 780 570"></path><path class="link_outline link_path" d="M 316 588 C 391 588 705 570 780 570"></path><path class="link_line link_path" d="M 316 588 C 391 588 705 570 780 570"></path></g><g class="link"><path class="link_background link_path" d="M 294 347 C 369 347 329 351 404 351"></path><path class="link_outline link_path" d="M 294 347 C 369 347 329 351 404 351"></path><path class="link_line link_path" d="M 294 347 C 369 347 329 351 404 351"></path></g><g class="link"><path class="link_background link_path" d="M 294 347 C 369 347 308 283 383 283"></path><path class="link_outline link_path" d="M 294 347 C 369 347 308 283 383 283"></path><path class="link_line link_path" d="M 294 347 C 369 347 308 283 383 283"></path></g><g class="link"><path class="link_background link_path" d="M 544 351 C 619 351 705 570 780 570"></path><path class="link_outline link_path" d="M 544 351 C 619 351 705 570 780 570"></path><path class="link_line link_path" d="M 544 351 C 619 351 705 570 780 570"></path></g><g class="link"><path class="link_background link_path" d="M 544 351 C 619 351 651 332 726 332"></path><path class="link_outline link_path" d="M 544 351 C 619 351 651 332 726 332"></path><path class="link_line link_path" d="M 544 351 C 619 351 651 332 726 332"></path></g><g class="node nodegroup" id="15de3862.717cf8" transform="translate(780,555)"><rect class="node" rx="5" ry="5" fill="rgb(0, 155, 255)" width="120" height="30"></rect><g class="node_icon_group node_icon_group_right" x="0" y="0" style="pointer-events: none;" transform="translate(90,0)"><rect x="0" y="0" class="node_icon_shade" width="30" stroke="none" fill="#000" fill-opacity="0.05" height="30"></rect><image xlink:href="icons/iotcloud-icon.png" class="node_icon" x="0" width="30" height="30" y="0"></image><path d="M 0 1 l 0 28" class="node_icon_shade_border" stroke-opacity="0.1" stroke="#000" stroke-width="1"></path></g><text class="node_label node_label_right node_label_italic" x="82" dy=".35em" text-anchor="end" y="14">IBM IoT</text><g class="node_status_group" style="display: inline;" transform="translate(3,33)"><rect class="node_status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3" style="display: inline; fill: rgb(85, 170, 136); stroke: rgb(85, 170, 136);"></rect><text class="node_status_label" x="20" y="9">connected</text></g><image class="node_error hidden" xlink:href="icons/node-error.png" x="110" y="-6" width="10" height="9"></image><image class="node_changed hidden" xlink:href="icons/node-changed.png" x="110" y="-6" width="10" height="10"></image><g class="port_input" transform="translate(-5,10)"><rect class="port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="node nodegroup" id="3c1266cc.9daf0a" transform="translate(215,468)"><g transform="translate(-25,2)" class="node_button node_left_button" opacity="1"><rect rx="5" ry="5" width="32" height="26" fill="#eee"></rect><rect class="node_button_button" x="5" y="4" rx="4" ry="4" width="16" height="18" fill="#a6bbcf" cursor="pointer"></rect></g><rect class="node" rx="5" ry="5" fill="#a6bbcf" width="100" height="30"></rect><g class="node_icon_group" x="0" y="0" style="pointer-events: none;"><rect x="0" y="0" class="node_icon_shade" width="30" stroke="none" fill="#000" fill-opacity="0.05" height="30"></rect><image xlink:href="icons/inject.png" class="node_icon" x="5" width="20" height="30" y="0"></image><path d="M 30 1 l 0 28" class="node_icon_shade_border" stroke-opacity="0.1" stroke="#000" stroke-width="1"></path></g><text class="node_label " x="38" dy=".35em" text-anchor="start" y="14">0</text><g class="node_status_group" style="display: none;"><rect class="node_status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="node_status_label" x="20" y="9"></text></g><image class="node_error hidden" xlink:href="icons/node-error.png" x="90" y="-6" width="10" height="9"></image><image class="node_changed hidden" xlink:href="icons/node-changed.png" x="90" y="-6" width="10" height="10"></image><g class="port_output" transform="translate(95,10)"><rect class="port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="node nodegroup" id="fbbec4e5.850368" transform="translate(481,617)"><g transform="translate(106,2)" class="node_button node_right_button" opacity="1"><rect rx="5" ry="5" width="32" height="26" fill="#eee" fill-opacity="0.2"></rect><rect class="node_button_button" x="11" y="4" rx="4" ry="4" width="16" height="18" fill="#87a980" cursor="pointer" fill-opacity="0.2"></rect></g><rect class="node" rx="5" ry="5" fill="#87a980" width="120" height="30"></rect><g class="node_icon_group node_icon_group_right" x="0" y="0" style="pointer-events: none;" transform="translate(90,0)"><rect x="0" y="0" class="node_icon_shade" width="30" stroke="none" fill="#000" fill-opacity="0.05" height="30"></rect><image xlink:href="icons/debug.png" class="node_icon" x="5" width="20" height="30" y="0"></image><path d="M 0 1 l 0 28" class="node_icon_shade_border" stroke-opacity="0.1" stroke="#000" stroke-width="1"></path></g><text class="node_label node_label_right node_label_italic" x="82" dy=".35em" text-anchor="end" y="14">outdebug</text><g class="node_status_group" style="display: none;"><rect class="node_status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="node_status_label" x="20" y="9"></text></g><image class="node_error hidden" xlink:href="icons/node-error.png" x="110" y="-6" width="10" height="9"></image><image class="node_changed hidden" xlink:href="icons/node-changed.png" x="110" y="-6" width="10" height="10"></image><g class="port_input" transform="translate(-5,10)"><rect class="port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="node nodegroup" id="f6c91c3b.fa2ae" transform="translate(216,573)"><g transform="translate(-25,2)" class="node_button node_left_button" opacity="1"><rect rx="5" ry="5" width="32" height="26" fill="#eee"></rect><rect class="node_button_button" x="5" y="4" rx="4" ry="4" width="16" height="18" fill="#a6bbcf" cursor="pointer"></rect></g><rect class="node" rx="5" ry="5" fill="#a6bbcf" width="100" height="30"></rect><g class="node_icon_group" x="0" y="0" style="pointer-events: none;"><rect x="0" y="0" class="node_icon_shade" width="30" stroke="none" fill="#000" fill-opacity="0.05" height="30"></rect><image xlink:href="icons/inject.png" class="node_icon" x="5" width="20" height="30" y="0"></image><path d="M 30 1 l 0 28" class="node_icon_shade_border" stroke-opacity="0.1" stroke="#000" stroke-width="1"></path></g><text class="node_label " x="38" dy=".35em" text-anchor="start" y="14">1</text><g class="node_status_group" style="display: none;"><rect class="node_status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="node_status_label" x="20" y="9"></text></g><image class="node_error hidden" xlink:href="icons/node-error.png" x="90" y="-6" width="10" height="9"></image><image class="node_changed hidden" xlink:href="icons/node-changed.png" x="90" y="-6" width="10" height="10"></image><g class="port_output" transform="translate(95,10)"><rect class="port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="node nodegroup" id="47d116f8.6c04c8" transform="translate(194,332)"><rect class="node" rx="5" ry="5" fill="#c7e9c0" width="100" height="30"></rect><g class="node_icon_group" x="0" y="0" style="pointer-events: none;"><rect x="0" y="0" class="node_icon_shade" width="30" stroke="none" fill="#000" fill-opacity="0.05" height="30"></rect><image xlink:href="icons/envelope.png" class="node_icon" x="5" width="20" height="30" y="0"></image><path d="M 30 1 l 0 28" class="node_icon_shade_border" stroke-opacity="0.1" stroke="#000" stroke-width="1"></path></g><text class="node_label node_label_italic" x="38" dy=".35em" text-anchor="start" y="14">email</text><g class="node_status_group" style="display: inline;" transform="translate(3,33)"><rect class="node_status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3" style="display: none; fill: rgb(83, 163, 243); stroke: rgb(83, 163, 243);"></rect><text class="node_status_label" x="20" y="9"></text></g><image class="node_error hidden" xlink:href="icons/node-error.png" x="90" y="-6" width="10" height="9"></image><image class="node_changed hidden" xlink:href="icons/node-changed.png" x="90" y="-6" width="10" height="10"></image><g class="port_output" transform="translate(95,10)"><rect class="port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="node nodegroup" id="395071e7.de713e" transform="translate(404,336)"><rect class="node" rx="5" ry="5" fill="#fdd0a2" width="140" height="30"></rect><g class="node_icon_group" x="0" y="0" style="pointer-events: none;"><rect x="0" y="0" class="node_icon_shade" width="30" stroke="none" fill="#000" fill-opacity="0.05" height="30"></rect><image xlink:href="icons/function.png" class="node_icon" x="5" width="20" height="30" y="0"></image><path d="M 30 1 l 0 28" class="node_icon_shade_border" stroke-opacity="0.1" stroke="#000" stroke-width="1"></path></g><text class="node_label" x="38" dy=".35em" text-anchor="start" y="14">email on/off?</text><g class="node_status_group" style="display: inline;" transform="translate(3,33)"><rect class="node_status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3" style="display: none;"></rect><text class="node_status_label" x="20" y="9"></text></g><image class="node_error hidden" xlink:href="icons/node-error.png" x="130" y="-6" width="10" height="9"></image><image class="node_changed hidden" xlink:href="icons/node-changed.png" x="130" y="-6" width="10" height="10"></image><g class="port_input" transform="translate(-5,10)"><rect class="port" rx="3" ry="3" width="10" height="10"></rect></g><g class="port_output" transform="translate(135,10)"><rect class="port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="node nodegroup" id="1564b34c.73ad3d" transform="translate(383,268)"><g transform="translate(134,2)" class="node_button node_right_button" opacity="1"><rect rx="5" ry="5" width="32" height="26" fill="#eee" fill-opacity="1"></rect><rect class="node_button_button" x="11" y="4" rx="4" ry="4" width="16" height="18" fill="#87a980" cursor="pointer" fill-opacity="1"></rect></g><rect class="node" rx="5" ry="5" fill="#87a980" width="140" height="30"></rect><g class="node_icon_group node_icon_group_right" x="0" y="0" style="pointer-events: none;" transform="translate(110,0)"><rect x="0" y="0" class="node_icon_shade" width="30" stroke="none" fill="#000" fill-opacity="0.05" height="30"></rect><image xlink:href="icons/debug.png" class="node_icon" x="5" width="20" height="30" y="0"></image><path d="M 0 1 l 0 28" class="node_icon_shade_border" stroke-opacity="0.1" stroke="#000" stroke-width="1"></path></g><text class="node_label node_label_right node_label_italic" x="102" dy=".35em" text-anchor="end" y="14">email value</text><g class="node_status_group" style="display: none;"><rect class="node_status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="node_status_label" x="20" y="9"></text></g><image class="node_error hidden" xlink:href="icons/node-error.png" x="130" y="-6" width="10" height="9"></image><image class="node_changed hidden" xlink:href="icons/node-changed.png" x="130" y="-6" width="10" height="10"></image><g class="port_input" transform="translate(-5,10)"><rect class="port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="node nodegroup" id="45253206.f0d31c" transform="translate(726,317)"><g transform="translate(134,2)" class="node_button node_right_button" opacity="1"><rect rx="5" ry="5" width="32" height="26" fill="#eee" fill-opacity="1"></rect><rect class="node_button_button" x="11" y="4" rx="4" ry="4" width="16" height="18" fill="#87a980" cursor="pointer" fill-opacity="1"></rect></g><rect class="node" rx="5" ry="5" fill="#87a980" width="140" height="30"></rect><g class="node_icon_group node_icon_group_right" x="0" y="0" style="pointer-events: none;" transform="translate(110,0)"><rect x="0" y="0" class="node_icon_shade" width="30" stroke="none" fill="#000" fill-opacity="0.05" height="30"></rect><image xlink:href="icons/debug.png" class="node_icon" x="5" width="20" height="30" y="0"></image><path d="M 0 1 l 0 28" class="node_icon_shade_border" stroke-opacity="0.1" stroke="#000" stroke-width="1"></path></g><text class="node_label node_label_right node_label_italic" x="102" dy=".35em" text-anchor="end" y="14">sent to bbb</text><g class="node_status_group" style="display: none;"><rect class="node_status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="node_status_label" x="20" y="9"></text></g><image class="node_error hidden" xlink:href="icons/node-error.png" x="130" y="-6" width="10" height="9"></image><image class="node_changed hidden" xlink:href="icons/node-changed.png" x="130" y="-6" width="10" height="10"></image><g class="port_input" transform="translate(-5,10)"><rect class="port" rx="3" ry="3" width="10" height="10"></rect></g></g></g></g></svg></div>
        <div id="workspace-toolbar" style="display: none;"></div>
        <div id="workspace-footer">
            <a class="workspace-footer-button" id="btn-zoom-out" href="#"><i class="fa fa-minus"></i></a>
            <a class="workspace-footer-button" id="btn-zoom-zero" href="#"><i class="fa fa-circle-o"></i></a>
            <a class="workspace-footer-button" id="btn-zoom-in" href="#"><i class="fa fa-plus"></i></a>
        </div>
        <div id="editor-shade" class="hide"></div>
    </div>
    <div id="editor-stack"></div>
    <div id="palette">
        <img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner hide" style="display: none;">
        <div id="palette-search" class="palette-search">
            <div class="red-ui-searchBox-container"><i class="fa fa-search"></i><input data-i18n="[placeholder]palette.filter" placeholder="filter nodes" type="text"><a href="#"><i class="fa fa-times"></i></a><span class="red-ui-searchBox-resultCount hide"></span></div>
        </div>
        <div id="palette-editor">
            <div class="editor-tray-header"><div class="editor-tray-titlebar"><ul class="editor-tray-breadcrumbs"><li data-i18n="palette.editor.title">Manage palette</li></ul></div><div class="editor-tray-toolbar"><button id="palette-editor-close" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only primary" role="button" aria-disabled="false" data-i18n="common.label.done">Done</button></div></div>
            <div class="red-ui-tabs"><div><ul id="palette-editor-tabs"><li class="red-ui-tab active" style="width: 110px;"><a href="#nodes" class="red-ui-tab-label" style="" title="Nodes"><span class="bidiAware" dir="">Nodes</span></a></li><li class="red-ui-tab" style=""><a href="#install" class="red-ui-tab-label" style="padding-left: 0px;" title="Install"><span class="bidiAware" dir="">Install</span></a></li></ul></div></div>
        <div class="palette-editor-tab" style="display: block;"><div class="palette-search"><div class="red-ui-searchBox-container"><i class="fa fa-search"></i><input data-i18n="[placeholder]palette.filter" placeholder="filter nodes" type="text"><a href="#"><i class="fa fa-times"></i></a><span class="red-ui-searchBox-resultCount hide"></span></div></div><div class="red-ui-editableList" style="top: 35px; left: 0px; bottom: 0px; right: 0px; position: absolute;"><div style="top: 0px; left: 0px; bottom: 0px; right: 0px; position: absolute; overflow-y: scroll;" class="red-ui-editableList-container"><ol id="palette-module-list" style="position: static; top: auto; bottom: auto; left: auto; right: auto; height: auto;" class="red-ui-editableList-list"><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.16.0</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>34 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small disabled">in use</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(228, 145, 145) none repeat scroll 0% 0%; border: 1px solid rgb(182, 116, 116);"></span><span class="palette-module-type-node">catch</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(226, 217, 110) none repeat scroll 0% 0%; border: 1px solid rgb(180, 173, 88);"></span><span class="palette-module-type-node">change</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%; border: 1px solid rgb(204, 204, 204);"></span><span class="palette-module-type-node">comment</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(222, 189, 92) none repeat scroll 0% 0%; border: 1px solid rgb(177, 151, 73);"></span><span class="palette-module-type-node">csv</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small disabled">in use</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(135, 169, 128) none repeat scroll 0% 0%; border: 1px solid rgb(135, 169, 128);"></span><span class="palette-module-type-node">debug</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(230, 224, 248) none repeat scroll 0% 0%; border: 1px solid rgb(184, 179, 198);"></span><span class="palette-module-type-node">delay</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small disabled">in use</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(253, 208, 162) none repeat scroll 0% 0%; border: 1px solid rgb(202, 166, 129);"></span><span class="palette-module-type-node">function</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(222, 189, 92) none repeat scroll 0% 0%; border: 1px solid rgb(177, 151, 73);"></span><span class="palette-module-type-node">html</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(231, 231, 174) none repeat scroll 0% 0%; border: 1px solid rgb(184, 184, 139);"></span><span class="palette-module-type-node">http in</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(231, 231, 174) none repeat scroll 0% 0%; border: 1px solid rgb(184, 184, 139);"></span><span class="palette-module-type-node">http response</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(231, 231, 174) none repeat scroll 0% 0%; border: 1px solid rgb(184, 184, 139);"></span><span class="palette-module-type-node">http request</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small disabled">in use</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(166, 187, 207) none repeat scroll 0% 0%; border: 1px solid rgb(132, 149, 165);"></span><span class="palette-module-type-node">inject</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(222, 189, 92) none repeat scroll 0% 0%; border: 1px solid rgb(177, 151, 73);"></span><span class="palette-module-type-node">json</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(221, 221, 221) none repeat scroll 0% 0%; border: 1px solid rgb(176, 176, 176);"></span><span class="palette-module-type-node">link in</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(221, 221, 221) none repeat scroll 0% 0%; border: 1px solid rgb(176, 176, 176);"></span><span class="palette-module-type-node">link out</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(216, 191, 216) none repeat scroll 0% 0%; border: 1px solid rgb(172, 152, 172);"></span><span class="palette-module-type-node">mqtt in</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(216, 191, 216) none repeat scroll 0% 0%; border: 1px solid rgb(172, 152, 172);"></span><span class="palette-module-type-node">mqtt out</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(238, 238, 238) none repeat scroll 0% 0%; border: 1px dashed rgb(153, 153, 153);"></span><span class="palette-module-type-node">mqtt-broker</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(226, 217, 110) none repeat scroll 0% 0%; border: 1px solid rgb(180, 173, 88);"></span><span class="palette-module-type-node">range</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(230, 224, 248) none repeat scroll 0% 0%; border: 1px solid rgb(184, 179, 198);"></span><span class="palette-module-type-node">sentiment</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(226, 217, 110) none repeat scroll 0% 0%; border: 1px solid rgb(180, 173, 88);"></span><span class="palette-module-type-node">split</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(226, 217, 110) none repeat scroll 0% 0%; border: 1px solid rgb(180, 173, 88);"></span><span class="palette-module-type-node">join</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(192, 237, 192) none repeat scroll 0% 0%; border: 1px solid rgb(153, 189, 153);"></span><span class="palette-module-type-node">status</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(226, 217, 110) none repeat scroll 0% 0%; border: 1px solid rgb(180, 173, 88);"></span><span class="palette-module-type-node">switch</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(243, 181, 103) none repeat scroll 0% 0%; border: 1px solid rgb(194, 144, 82);"></span><span class="palette-module-type-node">template</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(238, 238, 238) none repeat scroll 0% 0%; border: 1px dashed rgb(153, 153, 153);"></span><span class="palette-module-type-node">tls-config</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(230, 224, 248) none repeat scroll 0% 0%; border: 1px solid rgb(184, 179, 198);"></span><span class="palette-module-type-node">trigger</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(255, 240, 240) none repeat scroll 0% 0%; border: 1px solid rgb(204, 192, 192);"></span><span class="palette-module-type-node">unknown</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(215, 215, 160) none repeat scroll 0% 0%; border: 1px solid rgb(172, 172, 128);"></span><span class="palette-module-type-node">websocket in</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(215, 215, 160) none repeat scroll 0% 0%; border: 1px solid rgb(172, 172, 128);"></span><span class="palette-module-type-node">websocket out</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(238, 238, 238) none repeat scroll 0% 0%; border: 1px dashed rgb(153, 153, 153);"></span><span class="palette-module-type-node">websocket-listener</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(238, 238, 238) none repeat scroll 0% 0%; border: 1px dashed rgb(153, 153, 153);"></span><span class="palette-module-type-node">websocket-client</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(222, 189, 92) none repeat scroll 0% 0%; border: 1px solid rgb(177, 151, 73);"></span><span class="palette-module-type-node">xml</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(222, 189, 92) none repeat scroll 0% 0%; border: 1px solid rgb(177, 151, 73);"></span><span class="palette-module-type-node">yaml</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-bluemix-nodes</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>1.1.9</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>14 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%; border: 1px solid rgb(204, 204, 204);"></span><span class="palette-module-type-node">business-rules</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(218, 196, 180) none repeat scroll 0% 0%; border: 1px solid rgb(174, 156, 144);"></span><span class="palette-module-type-node">mongodb</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(218, 196, 180) none repeat scroll 0% 0%; border: 1px solid rgb(174, 156, 144);"></span><span class="palette-module-type-node">mongodb out</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(218, 196, 180) none repeat scroll 0% 0%; border: 1px solid rgb(174, 156, 144);"></span><span class="palette-module-type-node">mongodb in</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(109, 167, 209) none repeat scroll 0% 0%; border: 1px solid rgb(109, 167, 209);"></span><span class="palette-module-type-node">mqlight in</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(109, 167, 209) none repeat scroll 0% 0%; border: 1px solid rgb(109, 167, 209);"></span><span class="palette-module-type-node">mqlight out</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(192, 222, 237) none repeat scroll 0% 0%; border: 1px solid rgb(153, 177, 189);"></span><span class="palette-module-type-node">predictive_analytics</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: Silver none repeat scroll 0% 0%; border: 1px solid rgb(153, 153, 153);"></span><span class="palette-module-type-node">tcp in</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: Silver none repeat scroll 0% 0%; border: 1px solid rgb(153, 153, 153);"></span><span class="palette-module-type-node">tcp out</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: Silver none repeat scroll 0% 0%; border: 1px solid rgb(153, 153, 153);"></span><span class="palette-module-type-node">tcp request</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(255, 89, 95) none repeat scroll 0% 0%; border: 1px solid rgb(255, 89, 95);"></span><span class="palette-module-type-node">twilio out</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(238, 238, 238) none repeat scroll 0% 0%; border: 1px dashed rgb(153, 153, 153);"></span><span class="palette-module-type-node">twilio-api</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: Silver none repeat scroll 0% 0%; border: 1px solid rgb(153, 153, 153);"></span><span class="palette-module-type-node">udp out</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(192, 222, 237) none repeat scroll 0% 0%; border: 1px solid rgb(153, 177, 189);"></span><span class="palette-module-type-node">weather_insights</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-contrib-bluemix-hdfs</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.2.5</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>2 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(115, 185, 221) none repeat scroll 0% 0%; border: 1px solid rgb(92, 148, 176);"></span><span class="palette-module-type-node">ibm hdfs in</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(115, 185, 221) none repeat scroll 0% 0%; border: 1px solid rgb(92, 148, 176);"></span><span class="palette-module-type-node">ibm hdfs</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-contrib-ibmpush</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.2.4</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>1 node</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(115, 185, 221) none repeat scroll 0% 0%; border: 1px solid rgb(92, 148, 176);"></span><span class="palette-module-type-node">ibmpush</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-contrib-scx-ibmiotapp</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.0.43</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>3 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small disabled">in use</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small disabled">in use</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(0, 155, 255) none repeat scroll 0% 0%; border: 1px solid rgb(0, 155, 255);"></span><span class="palette-module-type-node">ibmiot</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(0, 155, 255) none repeat scroll 0% 0%; border: 1px solid rgb(0, 155, 255);"></span><span class="palette-module-type-node">ibmiot out</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(0, 155, 255) none repeat scroll 0% 0%; border: 1px solid rgb(0, 155, 255);"></span><span class="palette-module-type-node">ibmiot in</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-node-cf-cloudant</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.2.17</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>3 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(114, 199, 231) none repeat scroll 0% 0%; border: 1px solid rgb(91, 159, 184);"></span><span class="palette-module-type-node">cloudant</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(114, 199, 231) none repeat scroll 0% 0%; border: 1px solid rgb(91, 159, 184);"></span><span class="palette-module-type-node">cloudant out</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(114, 199, 231) none repeat scroll 0% 0%; border: 1px solid rgb(91, 159, 184);"></span><span class="palette-module-type-node">cloudant in</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-node-email</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.1.15</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>2 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small disabled">in use</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small disabled">in use</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(199, 233, 192) none repeat scroll 0% 0%; border: 1px solid rgb(159, 186, 153);"></span><span class="palette-module-type-node">e-mail</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(199, 233, 192) none repeat scroll 0% 0%; border: 1px solid rgb(159, 186, 153);"></span><span class="palette-module-type-node">e-mail in</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-node-feedparser</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.1.7</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>1 node</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(192, 222, 237) none repeat scroll 0% 0%; border: 1px solid rgb(153, 177, 189);"></span><span class="palette-module-type-node">feedparse</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-node-openwhisk</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.3.2</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>3 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(238, 238, 238) none repeat scroll 0% 0%; border: 1px dashed rgb(153, 153, 153);"></span><span class="palette-module-type-node">openwhisk-service</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(108, 159, 195) none repeat scroll 0% 0%; border: 1px solid rgb(108, 159, 195);"></span><span class="palette-module-type-node">openwhisk-trigger</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(108, 159, 195) none repeat scroll 0% 0%; border: 1px solid rgb(108, 159, 195);"></span><span class="palette-module-type-node">openwhisk-action</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-node-rbe</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.1.6</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>1 node</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(226, 217, 110) none repeat scroll 0% 0%; border: 1px solid rgb(180, 173, 88);"></span><span class="palette-module-type-node">rbe</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-node-twitter</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.1.9</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>3 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(238, 238, 238) none repeat scroll 0% 0%; border: 1px dashed rgb(153, 153, 153);"></span><span class="palette-module-type-node">twitter-credentials</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(192, 222, 237) none repeat scroll 0% 0%; border: 1px solid rgb(153, 177, 189);"></span><span class="palette-module-type-node">twitter in</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(192, 222, 237) none repeat scroll 0% 0%; border: 1px solid rgb(153, 177, 189);"></span><span class="palette-module-type-node">twitter out</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-node-watson</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.4.35</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>48 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(0, 162, 255) none repeat scroll 0% 0%; border: 1px solid rgb(0, 162, 255);"></span><span class="palette-module-type-node">alchemy-feature-extract</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(0, 162, 255) none repeat scroll 0% 0%; border: 1px solid rgb(0, 162, 255);"></span><span class="palette-module-type-node">alchemy-date-extraction</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(255, 255, 128) none repeat scroll 0% 0%; border: 1px solid rgb(204, 204, 102);"></span><span class="palette-module-type-node">news</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(0, 162, 255) none repeat scroll 0% 0%; border: 1px solid rgb(0, 162, 255);"></span><span class="palette-module-type-node">alchemy-image-analysis</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(238, 238, 238) none repeat scroll 0% 0%; border: 1px dashed rgb(153, 153, 153);"></span><span class="palette-module-type-node">watson-concept-insights-corpus</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-concept-insights-upload-document</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-concept-insights-search</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-concept-insights-search-concepts</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-concept-insights-related-concepts</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(84, 149, 230) none repeat scroll 0% 0%; border: 1px solid rgb(84, 149, 230);"></span><span class="palette-module-type-node">watson-conversation-v1</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(84, 149, 230) none repeat scroll 0% 0%; border: 1px solid rgb(84, 149, 230);"></span><span class="palette-module-type-node">watson-conversation-v1-experimental</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(99, 158, 230) none repeat scroll 0% 0%; border: 1px solid rgb(99, 158, 230);"></span><span class="palette-module-type-node">service-dialog</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(230, 140, 80) none repeat scroll 0% 0%; border: 1px solid rgb(184, 112, 64);"></span><span class="palette-module-type-node">watson-discovery-v1</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(84, 149, 230) none repeat scroll 0% 0%; border: 1px solid rgb(84, 149, 230);"></span><span class="palette-module-type-node">watson-discovery</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(200, 140, 80) none repeat scroll 0% 0%; border: 1px solid rgb(200, 140, 80);"></span><span class="palette-module-type-node">watson-discovery-v1-query-builder</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(99, 158, 230) none repeat scroll 0% 0%; border: 1px solid rgb(99, 158, 230);"></span><span class="palette-module-type-node">convert</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(140, 198, 63) none repeat scroll 0% 0%; border: 1px solid rgb(112, 158, 50);"></span><span class="palette-module-type-node">watson-language-identification</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(84, 149, 230) none repeat scroll 0% 0%; border: 1px solid rgb(84, 149, 230);"></span><span class="palette-module-type-node">watson-translator-util</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(130, 170, 64) none repeat scroll 0% 0%; border: 1px solid rgb(130, 170, 64);"></span><span class="palette-module-type-node">watson-translate-util</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(140, 198, 63) none repeat scroll 0% 0%; border: 1px solid rgb(112, 158, 50);"></span><span class="palette-module-type-node">watson-translate</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(84, 149, 230) none repeat scroll 0% 0%; border: 1px solid rgb(84, 149, 230);"></span><span class="palette-module-type-node">watson-language-translator-identify</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(84, 149, 230) none repeat scroll 0% 0%; border: 1px solid rgb(84, 149, 230);"></span><span class="palette-module-type-node">watson-translator-util</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(84, 149, 230) none repeat scroll 0% 0%; border: 1px solid rgb(84, 149, 230);"></span><span class="palette-module-type-node">watson-translator</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(140, 198, 63) none repeat scroll 0% 0%; border: 1px solid rgb(112, 158, 50);"></span><span class="palette-module-type-node">watson-natural-language-classifier</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(140, 198, 63) none repeat scroll 0% 0%; border: 1px solid rgb(112, 158, 50);"></span><span class="palette-module-type-node">watson-personality-insights</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(0, 150, 200) none repeat scroll 0% 0%; border: 1px solid rgb(0, 150, 200);"></span><span class="palette-module-type-node">watson-personality-insights-v3</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(185, 120, 252) none repeat scroll 0% 0%; border: 1px solid rgb(185, 120, 252);"></span><span class="palette-module-type-node">watson-relationship-extraction</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(238, 238, 238) none repeat scroll 0% 0%; border: 1px dashed rgb(153, 153, 153);"></span><span class="palette-module-type-node">watson-retrieve-rank-credentials</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-retrieve-rank-create-cluster</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-retrieve-rank-cluster-settings</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-retrieve-rank-upload-solr-configuration</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-retrieve-rank-solr-configuration-settings</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-retrieve-rank-solr-collection</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-retrieve-rank-create-ranker</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-retrieve-rank-ranker-settings</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(85, 150, 230) none repeat scroll 0% 0%; border: 1px solid rgb(85, 150, 230);"></span><span class="palette-module-type-node">watson-retrieve-rank-search-and-rank</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(228, 189, 255) none repeat scroll 0% 0%; border: 1px solid rgb(182, 151, 204);"></span><span class="palette-module-type-node">similarity-search-v3</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(228, 189, 255) none repeat scroll 0% 0%; border: 1px solid rgb(182, 151, 204);"></span><span class="palette-module-type-node">similarity-search-util-v3</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(140, 198, 63) none repeat scroll 0% 0%; border: 1px solid rgb(112, 158, 50);"></span><span class="palette-module-type-node">watson-speech-to-text</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(140, 198, 63) none repeat scroll 0% 0%; border: 1px solid rgb(112, 158, 50);"></span><span class="palette-module-type-node">watson-text-to-speech</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(84, 149, 230) none repeat scroll 0% 0%; border: 1px solid rgb(84, 149, 230);"></span><span class="palette-module-type-node">watson-tone-analyzer-v3</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(84, 149, 230) none repeat scroll 0% 0%; border: 1px solid rgb(84, 149, 230);"></span><span class="palette-module-type-node">watson-tone-analyzer</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(32, 178, 239) none repeat scroll 0% 0%; border: 1px solid rgb(32, 178, 239);"></span><span class="palette-module-type-node">watson-tradeoff-analytics</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(32, 178, 239) none repeat scroll 0% 0%; border: 1px solid rgb(32, 178, 239);"></span><span class="palette-module-type-node">watson-visual-recognition</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(255, 255, 128) none repeat scroll 0% 0%; border: 1px solid rgb(204, 204, 102);"></span><span class="palette-module-type-node">watson-visual-util</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(255, 255, 128) none repeat scroll 0% 0%; border: 1px solid rgb(204, 204, 102);"></span><span class="palette-module-type-node">watson-visual-training</span></div></div><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(228, 189, 255) none repeat scroll 0% 0%; border: 1px solid rgb(182, 151, 204);"></span><span class="palette-module-type-node">visual-recognition-v3</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(228, 189, 255) none repeat scroll 0% 0%; border: 1px solid rgb(182, 151, 204);"></span><span class="palette-module-type-node">visual-recognition-util-v3</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li><li><div class="red-ui-editableList-item-content"><div class="palette-module-header"><div class="palette-module-meta palette-module-name"><i class="fa fa-cube"></i><span>node-red-nodes-cf-sqldb-dashdb</span></div><div class="palette-module-meta palette-module-version"><i class="fa fa-tag"></i><span>0.2.22</span></div><div class="palette-module-meta"><a href="#" class="editor-button editor-button-small palette-module-set-button"><i class="fa fa-angle-right palette-module-node-chevron"></i> <span>3 nodes</span></a><div class="palette-module-button-group"><a href="#" class="editor-button editor-button-small" style="display: none;">update to __version__</a><a href="#" class="editor-button editor-button-small" style="display: none;">remove</a><a href="#" class="editor-button editor-button-small">disable all</a></div></div></div><div class="palette-module-content"><div class="palette-module-set"><div class="palette-module-set-button-group"><a href="#" class="editor-button editor-button-small">disable</a></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(114, 199, 231) none repeat scroll 0% 0%; border: 1px solid rgb(91, 159, 184);"></span><span class="palette-module-type-node">dashDB</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(153, 204, 153) none repeat scroll 0% 0%; border: 1px solid rgb(122, 163, 122);"></span><span class="palette-module-type-node">dashDB out</span></div><div class="palette-module-type"><span class="palette-module-type-swatch" style="background: rgb(153, 204, 153) none repeat scroll 0% 0%; border: 1px solid rgb(122, 163, 122);"></span><span class="palette-module-type-node">dashDB in</span></div></div></div><div class="palette-module-shade hide"><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></li></ol></div></div></div><div class="palette-editor-tab hide"><div class="palette-editor-toolbar"><span>sort: </span><span class="button-group"><a href="#" class="sidebar-header-button-toggle selected" data-i18n="palette.editor.sortAZ">a-z</a><a href="#" class="sidebar-header-button-toggle" data-i18n="palette.editor.sortRecent">recent</a></span><span><a href="#" class="sidebar-header-button"><i class="fa fa-refresh"></i></a></span></div><div class="palette-search"><div class="red-ui-searchBox-container"><i class="fa fa-search"></i><input data-i18n="[placeholder]palette.search" placeholder="search modules" type="text"><a href="#"><i class="fa fa-times"></i></a><span class="red-ui-searchBox-resultCount hide"></span></div></div><div class="red-ui-editableList" style="top: 78px; left: 0px; bottom: 0px; right: 0px; position: absolute;"><div style="top: 0px; left: 0px; bottom: 0px; right: 0px; position: absolute; overflow-y: scroll;" class="red-ui-editableList-container"><ol style="position: static; top: auto; bottom: auto; left: auto; right: auto; height: auto;" class="red-ui-editableList-list"></ol></div></div><div id="palette-module-install-shade" class="palette-module-shade hide"><div class="palette-module-shade-status"></div><img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg" class="palette-spinner"></div></div></div>
        <div id="palette-container" class="palette-scroll"><div id="palette-container-subflows" class="palette-category palette-close hide"><div id="palette-header-subflows" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>subflows</span></div><div class="palette-content" id="palette-base-category-subflows"><div id="palette-subflows-input"></div><div id="palette-subflows-output"></div><div id="palette-subflows-function"></div></div></div><div id="palette-container-input" class="palette-category palette-close hide palette-open" style="display: block;"><div id="palette-header-input" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>input</span></div><div class="palette-content" id="palette-base-category-input" style=""><div id="palette-input-input"></div><div id="palette-input-output"></div><div id="palette-input-function"></div><div id="palette-input"><div id="palette_node_inject" class="palette_node ui-draggable" style="background-color: rgb(166, 187, 207); height: 28px;"><div class="palette_label" dir="">inject</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/inject.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_catch" class="palette_node ui-draggable" style="background-color: rgb(228, 145, 145); height: 28px;"><div class="palette_label" dir="">catch</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/alert.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_status" class="palette_node ui-draggable" style="background-color: rgb(192, 237, 192); height: 28px;"><div class="palette_label" dir="">status</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/alert.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_link_in" class="palette_node ui-draggable" style="background-color: rgb(221, 221, 221); height: 28px;"><div class="palette_label" dir="">link</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/link-out.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_mqtt_in" class="palette_node ui-draggable" style="background-color: rgb(216, 191, 216); height: 28px;"><div class="palette_label" dir="">mqtt</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/bridge.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_http_in" class="palette_node ui-draggable" style="background-color: rgb(231, 231, 174); height: 28px;"><div class="palette_label" dir="">http</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/white-globe.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_websocket_in" class="palette_node ui-draggable" style="background-color: rgb(215, 215, 160); height: 28px;"><div class="palette_label" dir="">websocket</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/white-globe.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_tcp_in" class="palette_node ui-draggable" style="background-color: Silver; height: 28px;"><div class="palette_label" dir="">tcp</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/bridge-dash.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_mqlight_in" class="palette_node ui-draggable" style="background-color: rgb(109, 167, 209); height: 28px;"><div class="palette_label" dir="">mqlight</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/mqlightin.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_ibmiot_in" class="palette_node ui-draggable" style="background-color: rgb(0, 155, 255); height: 28px;"><div class="palette_label" dir="">ibmiot</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/iotcloud-icon.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div></div></div></div><div id="palette-container-output" class="palette-category palette-close hide palette-open" style="display: block;"><div id="palette-header-output" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>output</span></div><div class="palette-content" id="palette-base-category-output" style=""><div id="palette-output-input"></div><div id="palette-output-output"></div><div id="palette-output-function"></div><div id="palette-output"><div id="palette_node_debug" class="palette_node ui-draggable" style="background-color: rgb(135, 169, 128); height: 28px;"><div class="palette_label palette_label_right" dir="">debug</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/debug.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_link_out" class="palette_node ui-draggable" style="background-color: rgb(221, 221, 221); height: 28px;"><div class="palette_label palette_label_right" dir="">link</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/link-out.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_mqtt_out" class="palette_node ui-draggable" style="background-color: rgb(216, 191, 216); height: 28px;"><div class="palette_label palette_label_right" dir="">mqtt</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/bridge.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_http_response" class="palette_node ui-draggable" style="background-color: rgb(231, 231, 174); height: 28px;"><div class="palette_label palette_label_right" dir="">http response</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/white-globe.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_websocket_out" class="palette_node ui-draggable" style="background-color: rgb(215, 215, 160); height: 28px;"><div class="palette_label palette_label_right" dir="">websocket</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/white-globe.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_tcp_out" class="palette_node ui-draggable" style="background-color: Silver; height: 28px;"><div class="palette_label palette_label_right" dir="">tcp</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/bridge-dash.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_udp_out" class="palette_node ui-draggable" style="background-color: Silver; height: 28px;"><div class="palette_label palette_label_right" dir="">udp</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/bridge-dash.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_mqlight_out" class="palette_node ui-draggable" style="background-color: rgb(109, 167, 209); height: 28px;"><div class="palette_label palette_label_right" dir="">mqlight</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/mqlightin.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_twilio_out" class="palette_node ui-draggable" style="background-color: rgb(255, 89, 95); height: 28px;"><div class="palette_label palette_label_right" dir="">twilio</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/twilio.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_ibmpush" class="palette_node ui-draggable" style="background-color: rgb(115, 185, 221); height: 28px;"><div class="palette_label palette_label_right" dir="">ibmpush</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/ibmpush-icon.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_ibmiot_out" class="palette_node ui-draggable" style="background-color: rgb(0, 155, 255); height: 28px;"><div class="palette_label palette_label_right" dir="">ibmiot</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/iotcloud-icon.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_openwhisk-trigger" class="palette_node ui-draggable" style="background-color: rgb(108, 159, 195); height: 28px;"><div class="palette_label palette_label_right" dir="">OpenWhisk</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/openwhisk.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div></div></div></div><div id="palette-container-function" class="palette-category palette-close hide palette-open" style="display: block;"><div id="palette-header-function" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>function</span></div><div class="palette-content" id="palette-base-category-function" style=""><div id="palette-function-input"></div><div id="palette-function-output"></div><div id="palette-function-function"></div><div id="palette-function"><div id="palette_node_function" class="palette_node ui-draggable" style="background-color: rgb(253, 208, 162); height: 28px;"><div class="palette_label" dir="">function</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/function.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_template" class="palette_node ui-draggable" style="background-color: rgb(243, 181, 103); height: 28px;"><div class="palette_label" dir="">template</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/template.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_delay" class="palette_node ui-draggable" style="background-color: rgb(230, 224, 248); height: 28px;"><div class="palette_label" dir="">delay</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/timer.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_trigger" class="palette_node ui-draggable" style="background-color: rgb(230, 224, 248); height: 28px;"><div class="palette_label" dir="">trigger</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/trigger.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_comment" class="palette_node ui-draggable" style="background-color: rgb(255, 255, 255); height: 28px;"><div class="palette_label" dir="">comment</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/comment.png)"></div></div></div><div id="palette_node_http_request" class="palette_node ui-draggable" style="background-color: rgb(231, 231, 174); height: 28px;"><div class="palette_label" dir="">http request</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/white-globe.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_switch" class="palette_node ui-draggable" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="palette_label" dir="">switch</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/switch.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_change" class="palette_node ui-draggable" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="palette_label" dir="">change</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/swap.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_range" class="palette_node ui-draggable" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="palette_label" dir="">range</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/range.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_split" class="palette_node ui-draggable" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="palette_label" dir="">split</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/split.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_join" class="palette_node ui-draggable" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="palette_label" dir="">join</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/join.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_csv" class="palette_node ui-draggable" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="palette_label" dir="">csv</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/parser-csv.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_html" class="palette_node ui-draggable" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="palette_label" dir="">html</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/parser-html.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_json" class="palette_node ui-draggable" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="palette_label" dir="">json</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/parser-json.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_xml" class="palette_node ui-draggable" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="palette_label" dir="">xml</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/parser-xml.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_yaml" class="palette_node ui-draggable" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="palette_label" dir="">yaml</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/parser-yaml.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_rbe" class="palette_node ui-draggable" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="palette_label" dir="">rbe</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/rbe.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_tcp_request" class="palette_node ui-draggable" style="background-color: Silver; height: 28px;"><div class="palette_label" dir="">tcp request</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/bridge-dash.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_openwhisk-action" class="palette_node ui-draggable" style="background-color: rgb(108, 159, 195); height: 28px;"><div class="palette_label" dir="">OpenWhisk</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/openwhisk.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div></div></div></div><div id="palette-container-social" class="palette-category palette-close hide" style="display: block;"><div id="palette-header-social" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>social</span></div><div class="palette-content" id="palette-base-category-social"><div id="palette-social-input"><div id="palette_node_e-mail_in" class="palette_node ui-draggable" style="background-color: rgb(199, 233, 192); height: 28px;"><div class="palette_label" dir="">e mail</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/envelope.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div><div id="palette_node_twitter_in" class="palette_node ui-draggable" style="background-color: rgb(192, 222, 237); height: 28px;"><div class="palette_label" dir="">twitter</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/twitter.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div></div><div id="palette-social-output"><div id="palette_node_e-mail" class="palette_node ui-draggable" style="background-color: rgb(199, 233, 192); height: 28px;"><div class="palette_label palette_label_right" dir="">e mail</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/envelope.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_twitter_out" class="palette_node ui-draggable" style="background-color: rgb(192, 222, 237); height: 28px;"><div class="palette_label palette_label_right" dir="">twitter</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/twitter.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div></div><div id="palette-social-function"></div></div></div><div id="palette-container-mobile" class="palette-category palette-close hide"><div id="palette-header-mobile" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>mobile</span></div><div class="palette-content" id="palette-base-category-mobile"><div id="palette-mobile-input"></div><div id="palette-mobile-output"></div><div id="palette-mobile-function"></div></div></div><div id="palette-container-storage" class="palette-category palette-close hide" style="display: block;"><div id="palette-header-storage" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>storage</span></div><div class="palette-content" id="palette-base-category-storage"><div id="palette-storage-input"><div id="palette_node_mongodb_in" class="palette_node ui-draggable" style="background-color: rgb(218, 196, 180); height: 28px;"><div class="palette_label" dir="">mongodb</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/mongodb.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_ibm_hdfs in" class="palette_node ui-draggable" style="background-color: rgb(115, 185, 221); height: 28px;"><div class="palette_label" dir="">ibm hdfs</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/ibmhdfs_icon.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_ibm_hdfs" class="palette_node ui-draggable" style="background-color: rgb(115, 185, 221); height: 28px;"><div class="palette_label palette_label_right" dir="">ibm hdfs</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/ibmhdfs_icon.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_cloudant_in" class="palette_node ui-draggable" style="background-color: rgb(114, 199, 231); height: 28px;"><div class="palette_label" dir="">cloudant</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/cloudant.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_dashDB_in" class="palette_node ui-draggable" style="background-color: rgb(153, 204, 153); height: 28px;"><div class="palette_label" dir="">dashDB</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/dashDB.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div></div><div id="palette-storage-output"><div id="palette_node_mongodb_out" class="palette_node ui-draggable" style="background-color: rgb(218, 196, 180); height: 28px;"><div class="palette_label palette_label_right" dir="">mongodb</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/mongodb.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_cloudant_out" class="palette_node ui-draggable" style="background-color: rgb(114, 199, 231); height: 28px;"><div class="palette_label palette_label_right" dir="">cloudant</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/cloudant.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_dashDB_out" class="palette_node ui-draggable" style="background-color: rgb(153, 204, 153); height: 28px;"><div class="palette_label palette_label_right" dir="">dashDB</div><div class="palette_icon_container palette_icon_container_right"><div class="palette_icon" style="background-image: url(icons/dashDB.png)"></div></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div></div><div id="palette-storage-function"></div></div></div><div id="palette-container-analysis" class="palette-category palette-close hide" style="display: block;"><div id="palette-header-analysis" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>analysis</span></div><div class="palette-content" id="palette-base-category-analysis"><div id="palette-analysis-input"></div><div id="palette-analysis-output"></div><div id="palette-analysis-function"><div id="palette_node_sentiment" class="palette_node ui-draggable" style="background-color: rgb(230, 224, 248); height: 28px;"><div class="palette_label" dir="">sentiment</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/arrow-in.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div></div><div id="palette-analysis"><div id="palette_node_predictive_analytics" class="palette_node ui-draggable" style="background-color: rgb(192, 222, 237); height: 48px;"><div class="palette_label" dir="">predictive<br>analytics</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/spss.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div></div></div></div><div id="palette-container-advanced" class="palette-category palette-close hide" style="display: block;"><div id="palette-header-advanced" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>advanced</span></div><div class="palette-content" id="palette-base-category-advanced"><div id="palette-advanced-input"><div id="palette_node_feedparse" class="palette_node ui-draggable" style="background-color: rgb(192, 222, 237); height: 28px;"><div class="palette_label" dir="">feedparse</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/feed.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div></div></div><div id="palette-advanced-output"></div><div id="palette-advanced-function"></div></div></div><div id="palette-container-weather" class="palette-category palette-close hide palette-open" style="display: block;"><div id="palette-header-weather" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>weather</span></div><div class="palette-content" id="palette-base-category-weather" style=""><div id="palette-weather-input"></div><div id="palette-weather-output"></div><div id="palette-weather-function"></div><div id="palette-weather"><div id="palette_node_weather_insights" class="palette_node ui-draggable" style="background-color: rgb(192, 222, 237); height: 48px;"><div class="palette_label" dir="">weather<br>insights</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/weather.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div></div></div></div><div id="palette-container-Smarter_Process" class="palette-category palette-close hide palette-open" style="display: block;"><div id="palette-header-Smarter_Process" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>Smarter_Process</span></div><div class="palette-content" id="palette-base-category-Smarter_Process" style=""><div id="palette-Smarter_Process-input"></div><div id="palette-Smarter_Process-output"></div><div id="palette-Smarter_Process-function"></div><div id="palette-Smarter_Process"><div id="palette_node_business-rules" class="palette_node ui-draggable" style="background-color: rgb(255, 255, 255); height: 48px;"><div class="palette_label" dir="">business<br>rules</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/businessrules-icon25x25.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div></div></div></div><div id="palette-container-IBM_Watson" class="palette-category palette-close hide palette-open" style="display: block;"><div id="palette-header-IBM_Watson" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>IBM_Watson</span></div><div class="palette-content" id="palette-base-category-IBM_Watson" style=""><div id="palette-IBM_Watson-input"></div><div id="palette-IBM_Watson-output"></div><div id="palette-IBM_Watson-function"></div><div id="palette-IBM_Watson"><div id="palette_node_watson-conversation-v1" class="palette_node ui-draggable" style="background-color: rgb(84, 149, 230); height: 28px;"><div class="palette_label" dir="">conversation</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/conversation-v1-25x25.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_watson-discovery-v1" class="palette_node ui-draggable" style="background-color: rgb(230, 140, 80); height: 28px;"><div class="palette_label" dir="">discovery</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/discovery.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_watson-discovery-v1-query-builder" class="palette_node ui-draggable" style="background-color: rgb(200, 140, 80); height: 48px;"><div class="palette_label" dir="">discovery<br>query builder</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/discovery.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_convert" class="palette_node ui-draggable" style="background-color: rgb(99, 158, 230); height: 28px;"><div class="palette_label" dir="">convert</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/DocumentConversion.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_alchemy-date-extraction" class="palette_node ui-draggable" style="background-color: rgb(0, 162, 255); height: 48px;"><div class="palette_label" dir="">Date<br>Extraction</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/alchemy.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_alchemy-feature-extract" class="palette_node ui-draggable" style="background-color: rgb(0, 162, 255); height: 48px;"><div class="palette_label" dir="">Feature<br>Extract</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/alchemy.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-translator" class="palette_node ui-draggable" style="background-color: rgb(84, 149, 230); height: 48px;"><div class="palette_label" dir="">language<br>translator</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/LanguageTranslator25x25.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-language-translator-identify" class="palette_node ui-draggable" style="background-color: rgb(84, 149, 230); height: 48px;"><div class="palette_label" dir="">language<br>identify</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/LanguageTranslator25x25.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-translator-util" class="palette_node ui-draggable" style="background-color: rgb(84, 149, 230); height: 48px;"><div class="palette_label" dir="">language<br>translator util</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/languageid.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-natural-language-classifier" class="palette_node ui-draggable" style="background-color: rgb(140, 198, 63); height: 68px;"><div class="palette_label" dir="">natural<br>language<br>classifier</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/NLClassifier.png)"></div></div><div class="palette_port palette_port_output" style="top: 29px;"></div><div class="palette_port palette_port_input" style="top: 29px;"></div></div><div id="palette_node_news" class="palette_node ui-draggable" style="background-color: rgb(255, 255, 128); height: 28px;"><div class="palette_label" dir="">news</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/news2.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_watson-personality-insights-v3" class="palette_node ui-draggable" style="background-color: rgb(0, 150, 200); height: 48px;"><div class="palette_label" dir="">personality<br>insights</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/personality_insights.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-retrieve-rank-create-cluster" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 68px;"><div class="palette_label" dir="">retrieve and<br>rank create<br>cluster</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/RetrieveRank.png)"></div></div><div class="palette_port palette_port_output" style="top: 29px;"></div><div class="palette_port palette_port_input" style="top: 29px;"></div></div><div id="palette_node_watson-retrieve-rank-cluster-settings" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 68px;"><div class="palette_label" dir="">retrieve and<br>rank cluster<br>settings</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/RetrieveRank.png)"></div></div><div class="palette_port palette_port_output" style="top: 29px;"></div><div class="palette_port palette_port_input" style="top: 29px;"></div></div><div id="palette_node_watson-retrieve-rank-upload-solr-configuration" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 88px;"><div class="palette_label" dir="">retrieve and<br>rank upload<br>solr<br>configuration</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/RetrieveRank.png)"></div></div><div class="palette_port palette_port_output" style="top: 39px;"></div><div class="palette_port palette_port_input" style="top: 39px;"></div></div><div id="palette_node_watson-retrieve-rank-solr-configuration-settings" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 88px;"><div class="palette_label" dir="">retrieve and<br>rank solr<br>configuration<br>settings</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/RetrieveRank.png)"></div></div><div class="palette_port palette_port_output" style="top: 39px;"></div><div class="palette_port palette_port_input" style="top: 39px;"></div></div><div id="palette_node_watson-retrieve-rank-solr-collection" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 68px;"><div class="palette_label" dir="">retrieve and<br>rank solr<br>collection</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/RetrieveRank.png)"></div></div><div class="palette_port palette_port_output" style="top: 29px;"></div><div class="palette_port palette_port_input" style="top: 29px;"></div></div><div id="palette_node_watson-retrieve-rank-create-ranker" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 68px;"><div class="palette_label" dir="">retrieve and<br>rank create<br>ranker</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/RetrieveRank.png)"></div></div><div class="palette_port palette_port_output" style="top: 29px;"></div><div class="palette_port palette_port_input" style="top: 29px;"></div></div><div id="palette_node_watson-retrieve-rank-ranker-settings" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 68px;"><div class="palette_label" dir="">retrieve and<br>rank ranker<br>settings</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/RetrieveRank.png)"></div></div><div class="palette_port palette_port_output" style="top: 29px;"></div><div class="palette_port palette_port_input" style="top: 29px;"></div></div><div id="palette_node_watson-retrieve-rank-search-and-rank" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 68px;"><div class="palette_label" dir="">retrieve and<br>rank search<br>and rank</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/RetrieveRank.png)"></div></div><div class="palette_port palette_port_output" style="top: 29px;"></div><div class="palette_port palette_port_input" style="top: 29px;"></div></div><div id="palette_node_watson-speech-to-text" class="palette_node ui-draggable" style="background-color: rgb(140, 198, 63); height: 48px;"><div class="palette_label" dir="">speech to<br>text</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/speech_to_text.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-text-to-speech" class="palette_node ui-draggable" style="background-color: rgb(140, 198, 63); height: 48px;"><div class="palette_label" dir="">text to<br>speech</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/text_to_speech.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-tone-analyzer-v3" class="palette_node ui-draggable" style="background-color: rgb(84, 149, 230); height: 48px;"><div class="palette_label" dir="">tone analyzer<br>v3</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/tone_analyzer.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-tradeoff-analytics" class="palette_node ui-draggable" style="background-color: rgb(32, 178, 239); height: 48px;"><div class="palette_label" dir="">tradeoff<br>analytics</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/tradeoff_analytics.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_visual-recognition-v3" class="palette_node ui-draggable" style="background-color: rgb(228, 189, 255); height: 48px;"><div class="palette_label" dir="">visual<br>recognition</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/VR-v3-pink.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_visual-recognition-util-v3" class="palette_node ui-draggable" style="background-color: rgb(228, 189, 255); height: 68px;"><div class="palette_label" dir="">visual<br>recognition<br>util</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/VR-v3-pink.png)"></div></div><div class="palette_port palette_port_output" style="top: 29px;"></div><div class="palette_port palette_port_input" style="top: 29px;"></div></div><div id="palette_node_similarity-search-v3" class="palette_node ui-draggable" style="background-color: rgb(228, 189, 255); height: 48px;"><div class="palette_label" dir="">similarity<br>search</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/VR-v3-pink.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_similarity-search-util-v3" class="palette_node ui-draggable" style="background-color: rgb(228, 189, 255); height: 48px;"><div class="palette_label" dir="">similarity<br>search util</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/VR-v3-pink.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div></div></div></div><div id="palette-container-Watson_Deprecated" class="palette-category palette-close hide palette-open" style="display: block;"><div id="palette-header-Watson_Deprecated" class="palette-header"><i class="expanded fa fa-angle-down"></i><span>Watson_Deprecated</span></div><div class="palette-content" id="palette-base-category-Watson_Deprecated" style=""><div id="palette-Watson_Deprecated-input"></div><div id="palette-Watson_Deprecated-output"></div><div id="palette-Watson_Deprecated-function"></div><div id="palette-Watson_Deprecated"><div id="palette_node_watson-conversation-v1-experimental" class="palette_node ui-draggable" style="background-color: rgb(84, 149, 230); height: 28px;"><div class="palette_label" dir="">conversation</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/conversation-v1-25x25.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_watson-discovery" class="palette_node ui-draggable" style="background-color: rgb(84, 149, 230); height: 28px;"><div class="palette_label" dir="">discovery</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/discovery.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_watson-concept-insights-upload-document" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 88px;"><div class="palette_label" dir="">concept<br>insights<br>upload<br>document</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/ConceptInsights.png)"></div></div><div class="palette_port palette_port_input" style="top: 39px;"></div></div><div id="palette_node_watson-concept-insights-search" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 68px;"><div class="palette_label" dir="">concept<br>insights<br>search</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/ConceptInsights.png)"></div></div><div class="palette_port palette_port_output" style="top: 29px;"></div><div class="palette_port palette_port_input" style="top: 29px;"></div></div><div id="palette_node_watson-concept-insights-search-concepts" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 88px;"><div class="palette_label" dir="">concept<br>insights<br>search<br>concepts</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/ConceptInsights.png)"></div></div><div class="palette_port palette_port_output" style="top: 39px;"></div><div class="palette_port palette_port_input" style="top: 39px;"></div></div><div id="palette_node_watson-concept-insights-related-concepts" class="palette_node ui-draggable" style="background-color: rgb(85, 150, 230); height: 88px;"><div class="palette_label" dir="">concept<br>insights<br>related<br>concepts</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/ConceptInsights.png)"></div></div><div class="palette_port palette_port_output" style="top: 39px;"></div><div class="palette_port palette_port_input" style="top: 39px;"></div></div><div id="palette_node_service-dialog" class="palette_node ui-draggable" style="background-color: rgb(99, 158, 230); height: 28px;"><div class="palette_label" dir="">Dialog</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/dialog-icon25x25.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_watson-language-identification" class="palette_node ui-draggable" style="background-color: rgb(140, 198, 63); height: 48px;"><div class="palette_label" dir="">language<br>identification</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/languageid.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-translate" class="palette_node ui-draggable" style="background-color: rgb(140, 198, 63); height: 48px;"><div class="palette_label" dir="">language<br>translation</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/languageid.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-translate-util" class="palette_node ui-draggable" style="background-color: rgb(130, 170, 64); height: 48px;"><div class="palette_label" dir="">language<br>translation util</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/languageid.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-personality-insights" class="palette_node ui-draggable" style="background-color: rgb(140, 198, 63); height: 48px;"><div class="palette_label" dir="">personality<br>insights</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/personality_insights.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-relationship-extraction" class="palette_node ui-draggable" style="background-color: rgb(185, 120, 252); height: 48px;"><div class="palette_label" dir="">relationship<br>extraction</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/relationship_extraction.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-tone-analyzer" class="palette_node ui-draggable" style="background-color: rgb(84, 149, 230); height: 28px;"><div class="palette_label" dir="">tone analyzer</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/tone_analyzer.png)"></div></div><div class="palette_port palette_port_output" style="top: 9px;"></div><div class="palette_port palette_port_input" style="top: 9px;"></div></div><div id="palette_node_watson-visual-recognition" class="palette_node ui-draggable" style="background-color: rgb(32, 178, 239); height: 48px;"><div class="palette_label" dir="">visual<br>recognition</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/visual_recognition.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-visual-util" class="palette_node ui-draggable" style="background-color: rgb(255, 255, 128); height: 48px;"><div class="palette_label" dir="">watson visual<br>util</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/visual2.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_watson-visual-training" class="palette_node ui-draggable" style="background-color: rgb(255, 255, 128); height: 48px;"><div class="palette_label" dir="">watson visual<br>training</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/visual2.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div><div id="palette_node_alchemy-image-analysis" class="palette_node ui-draggable" style="background-color: rgb(0, 162, 255); height: 48px;"><div class="palette_label" dir="">Image<br>Analysis</div><div class="palette_icon_container"><div class="palette_icon" style="background-image: url(icons/alchemy.png)"></div></div><div class="palette_port palette_port_output" style="top: 19px;"></div><div class="palette_port palette_port_input" style="top: 19px;"></div></div></div></div></div></div>
        <div id="palette-footer">
            <a class="palette-button" id="palette-collapse-all" href="#"><i class="fa fa-angle-double-up"></i></a>
            <a class="palette-button" id="palette-expand-all" href="#"><i class="fa fa-angle-double-down"></i></a>
        </div>
        <div id="palette-shade" class="hide"></div>
    </div><!-- /palette -->
    <div id="sidebar">
        <div class="red-ui-tabs"><div><ul id="sidebar-tabs"><li class="red-ui-tab active" style="width: 46.1661%;"><a href="#info" class="red-ui-tab-label" style="" title="info"><span class="bidiAware" dir="">info</span></a></li><li class="red-ui-tab" style="width: 46.1661%;"><a href="#debug" class="red-ui-tab-label" title="debug"><span class="bidiAware" dir="">debug</span></a></li></ul></div></div>
        <div id="sidebar-content"><div style="height: 100%; display: block;"><div style="padding-top: 4px; padding-left: 4px; padding-right: 4px;" class="sidebar-node-info"><div class="node-info-tip hide" style="display: block;"><span class="help-key-block"><span class="help-key">ctrl-space</span></span> will toggle the view of this sidebar</div></div></div><div style="height: 100%; display: none;"><div class="sidebar-node-config"><div class="button-group sidebar-header"><a class="sidebar-header-button-toggle selected" id="workspace-config-node-filter-all" href="#"><span data-i18n="sidebar.config.filterAll">all</span></a><a class="sidebar-header-button-toggle" id="workspace-config-node-filter-unused" href="#"><span data-i18n="sidebar.config.filterUnused">unused</span></a> </div><div><div class="palette-category workspace-config-node-category" id="workspace-config-node-category-global"><div class="workspace-config-node-tray-header palette-header"><i class="fa fa-angle-down expanded"></i><span class="config-node-label" data-i18n="sidebar.config.global">On all flows</span><span class="config-node-filter-info" style="display: none;"></span></div><ul class="palette-content config-node-list" style="display: block;"><li class="config_node_type">ibmiot</li><li class="palette_node config_node palette_node_id_c5ded2df-6d3e3"><div class="palette_label">nodered</div><div class="palette_icon_container  palette_icon_container_right">1</div></li></ul></div></div><div><div class="palette-category workspace-config-node-category" id="workspace-config-node-category-f5c4e19a-9ea79"><div class="workspace-config-node-tray-header palette-header"><i class="fa fa-angle-down"></i><span class="config-node-label">Flow 1</span><span class="config-node-filter-info" style="display: none;"></span></div><ul class="palette-content config-node-list" style="display: none;"><li class="config_node_none" data-i18n="sidebar.config.none">none</li></ul></div></div><div></div></div><div class="sidebar-shade hide"></div></div><div style="height: 100%; display: none;"><div style="position: relative; height: 100%;"><div class="sidebar-header"><span class="button-group"><a id="debug-tab-filter" class="sidebar-header-button" href="#"><i class="fa fa-filter"></i></a></span><span class="button-group"><a id="debug-tab-clear" title="clear log" class="sidebar-header-button" href="#"><i class="fa fa-trash"></i></a></span></div><div class="debug-content debug-content-list"></div><div class="debug-content  debug-content-table hide"></div><div class="debug-filter-box hide"><div class="debug-filter-row"><span class="button-group"><a class="sidebar-header-button-toggle selected" id="debug-tab-filter-all" href="#"><span data-i18n="node-red:debug.sidebar.filterAll">all flows</span></a><a class="sidebar-header-button-toggle" id="debug-tab-filter-current" href="#"><span data-i18n="node-red:debug.sidebar.filterCurrent">current flow</span></a> </span></div></div></div></div></div>
        <div id="sidebar-footer"><div style="display: none;"><a class="sidebar-footer-button" id="workspace-config-node-collapse-all" href="#"><i class="fa fa-angle-double-up"></i></a> <a class="sidebar-footer-button" id="workspace-config-node-expand-all" href="#"><i class="fa fa-angle-double-down"></i></a></div><div style="display: none;"><span class="button-group"><a id="debug-tab-open" title="open in new window" class="sidebar-footer-button" href="#"><i class="fa fa-desktop"></i></a></span> </div></div>
        <div id="sidebar-shade" class="hide"></div>
    </div>

    <div id="sidebar-separator" class="ui-draggable"></div>

</div>

<div id="notifications"></div>
<div id="dropTarget"><div data-i18n="[append]workspace.dropFlowHere"><br><i class="fa fa-download"></i>Drop the flow here</div></div>



<div id="node-dialog-library-save-confirm" class="hide">
    <form class="form-horizontal">
        <div style="text-align: center; padding-top: 30px;" id="node-dialog-library-save-content">
        </div>
    </form>
</div>

<div id="node-dialog-library-save" class="hide">
    <form class="form-horizontal">
        <div class="form-row">
            <label for="node-dialog-library-save-folder" data-i18n="[append]library.folder"><i class="fa fa-folder-open"></i> Folder</label>
            <input id="node-dialog-library-save-folder" data-i18n="[placeholder]library.folderPlaceholder" placeholder="a/b" type="text">
        </div>
        <div class="form-row">
            <label for="node-dialog-library-save-filename" data-i18n="[append]library.filename"><i class="fa fa-file"></i> Filename</label>
            <input id="node-dialog-library-save-filename" data-i18n="[placeholder]library.filenamePlaceholder" placeholder="file" type="text">
        </div>
    </form>
</div>

<div id="node-dialog-library-lookup" class="hide">
    <form class="form-horizontal">
        <div class="form-row">
            <ul id="node-dialog-library-breadcrumbs" class="breadcrumb">
                <li class="active"><a href="#" data-i18n="[append]library.breadcrumb">Library</a></li>
            </ul>
        </div>
        <div class="form-row">
            <div style="vertical-align: top; display: inline-block; height: 100%; width: 30%; padding-right: 20px;">
                <div id="node-select-library" style="border: 1px solid #999; width: 100%; height: 100%; overflow:scroll;"><ul></ul></div>
            </div>
            <div style="vertical-align: top; display: inline-block;width: 65%; height: 100%;">
                <div style="height: 100%; width: 95%;" class="node-text-editor" id="node-select-library-text"></div>
            </div>
        </div>
    </form>
</div>
<script type="text/x-red" data-template-name="subflow">
    <div class="form-row">
        <label for="node-input-name" data-i18n="[append]editor:common.label.name"><i class="fa fa-tag"></i> </label>
        <input type="text" id="node-input-name">
    </div>
</script>

<script type="text/x-red" data-template-name="subflow-template">
    <div class="form-row">
        <label for="subflow-input-name" data-i18n="common.label.name"></label><input type="text" id="subflow-input-name">
    </div>
    <div class="form-row" style="margin-bottom: 0px;">
        <label for="subflow-input-info" data-i18n="subflow.info"></label>
        <a href="https://help.github.com/articles/markdown-basics/" style="font-size: 0.8em; float: right;" data-i18n="[html]subflow.format"></a>
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px;" class="node-text-editor" id="subflow-input-info-editor"></div>
    </div>
    <div class="form-row form-tips" id="subflow-dialog-user-count"></div>
</script>

<script type="text/x-red" data-template-name="_expression">
    <div class="form-row node-text-editor-row">
        <div style="height: 200px;min-height: 150px;" class="node-text-editor" id="node-input-expression"></div>
    </div>
    <div class="form-row">
        <label for="node-input-expression-func" data-i18n="expressionEditor.functions"></label>
        <select id="node-input-expression-func"></select>
        <button id="node-input-expression-func-insert" class="editor-button" data-i18n="expressionEditor.insert"></button>
        <div style="min-height: 200px;" id="node-input-expression-help"></div>
    </div>
</script>


<script src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/vendor.js"></script>
<script src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/jsonata.js"></script>
<script src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/ace.js"></script>
<script src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/ext-language_tools.js"></script>
<script src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/red.js"></script>
<script src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/main.js"></script>



<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" style="display: none; position: absolute;" tabindex="-1" role="dialog" aria-describedby="palette-module-install-confirm" aria-labelledby="ui-id-1"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-1" class="ui-dialog-title">palette.editor.confirm.title</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="palette-module-install-confirm" class="hide ui-dialog-content ui-widget-content" style="display: block;"><form class="form-horizontal"><div id="palette-module-install-confirm-body" class="node-dialog-confirm-row"></div></form></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Cancel</span></button><button type="button" class="primary palette-module-install-confirm-button-install ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Open node information</span></button><button type="button" class="primary palette-module-install-confirm-button-install ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Install</span></button><button type="button" class="primary palette-module-install-confirm-button-remove ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Remove</span></button></div></div><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;"></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable" style="display: none;" tabindex="-1" role="dialog" aria-describedby="library-dialog" aria-labelledby="ui-id-2"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-2" class="ui-dialog-title">Export nodes to library</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="library-dialog" class="hide ui-dialog-content ui-widget-content" style="display: block;"><form class="dialog-form form-horizontal"><div class="form-row"><label for="node-input-library-filename" data-i18n="[append]editor:library.filename"><i class="fa fa-file"></i> Filename</label><input id="node-input-library-filename" data-i18n="[placeholder]editor:library.fullFilenamePlaceholder" placeholder="a/b/file" type="text"><input style="display: none;" type="text"></div></form></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" id="library-dialog-cancel" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Cancel</span></button><button type="button" id="library-dialog-ok" class="primary ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Export</span></button></div></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable" style="display: none;" tabindex="-1" role="dialog" aria-describedby="clipboard-dialog" aria-labelledby="ui-id-3"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-3" class="ui-dialog-title">&nbsp;</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="clipboard-dialog" class="hide node-red-dialog ui-dialog-content ui-widget-content" style="display: block;"><form class="dialog-form form-horizontal"></form></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" id="clipboard-dialog-cancel" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Cancel</span></button><button type="button" id="clipboard-dialog-close" class="primary ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Close</span></button><button type="button" id="clipboard-dialog-copy" class="primary ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Export to clipboard</span></button><button type="button" id="clipboard-dialog-ok" class="primary ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Import</span></button></div></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" style="display: none; position: absolute;" tabindex="-1" role="dialog" aria-describedby="node-dialog-view-diff" aria-labelledby="ui-id-4"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-4" class="ui-dialog-title">Review differences</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="node-dialog-view-diff" class="hide ui-dialog-content ui-widget-content" style="display: block;"><div class="node-diff-toolbar"><span><span id="node-diff-toolbar-resolved-conflicts"></span></span> </div><div id="node-dialog-view-diff-headers"></div><div class="red-ui-editableList" style="top: 80px; left: 10px; bottom: 10px; right: 10px; position: absolute;"><div style="top: 0px; left: 0px; bottom: 0px; right: 0px; position: absolute; overflow-y: scroll;" class="red-ui-editableList-container"><ol id="node-dialog-view-diff-diff" class="red-ui-editableList-list" style="top: auto; left: auto; bottom: auto; right: auto; position: static; height: auto;"></ol></div></div></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Cancel</span></button><button type="button" id="node-diff-view-diff-merge" class="primary disabled ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Merge changes</span></button></div></div><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;"></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-front ui-dialog-buttons ui-draggable ui-resizable" style="display: none; position: absolute;" tabindex="-1" role="dialog" aria-describedby="node-dialog-confirm-deploy" aria-labelledby="ui-id-5"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span id="ui-id-5" class="ui-dialog-title">Confirm deploy</span><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button></div><div id="node-dialog-confirm-deploy" class="hide ui-dialog-content ui-widget-content" style="display: block;">
    <form class="form-horizontal">
        <div id="node-dialog-confirm-deploy-config" class="node-dialog-confirm-row" data-i18n="[prepend]deploy.confirm.improperlyConfigured;[append]deploy.confirm.confirm">The workspace contains some nodes that are not properly configured:
            <ul id="node-dialog-confirm-deploy-invalid-list"></ul>
        Are you sure you want to deploy?</div>
        <div id="node-dialog-confirm-deploy-unknown" class="node-dialog-confirm-row" data-i18n="[prepend]deploy.confirm.unknown;[append]deploy.confirm.confirm">The workspace contains some unknown node types:
            <ul id="node-dialog-confirm-deploy-unknown-list"></ul>
        Are you sure you want to deploy?</div>
        <div id="node-dialog-confirm-deploy-conflict" class="node-dialog-confirm-row">
            <div style="margin-left: 40px; margin-bottom: 10px;">
                <span data-i18n="deploy.confirm.conflict">The server is running a more recent set of flows.</span>
            </div>
            <div id="node-dialog-confirm-deploy-conflict-checking" class="node-dialog-confirm-conflict-row">
                <img src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/spin.svg"><div data-i18n="deploy.confirm.conflictChecking">Checking to see if the changes can be merged automatically</div>
            </div>
            <div id="node-dialog-confirm-deploy-conflict-auto-merge" class="node-dialog-confirm-conflict-row">
                <i style="color: #3a3;" class="fa fa-check"></i><div data-i18n="deploy.confirm.conflictAutoMerge">The changes include no conflicts and can be merged automatically.</div>
            </div>
            <div id="node-dialog-confirm-deploy-conflict-manual-merge" class="node-dialog-confirm-conflict-row">
                <i style="color: #999;" class="fa fa-exclamation"></i><div data-i18n="deploy.confirm.conflictManualMerge">The changes include conflicts that must be resolved before they can be deployed.</div>
            </div>
        </div>
    </form>
</div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div style="height:0; vertical-align: middle; display:inline-block; margin-top: 13px; float:left;"><input style="vertical-align:top;" id="node-dialog-confirm-deploy-hide" type="checkbox"><label style="display:inline;" for="node-dialog-confirm-deploy-hide"> do not warn about this again</label><input id="node-dialog-confirm-deploy-type" type="hidden"></div><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Cancel</span></button><button type="button" id="node-dialog-confirm-deploy-review" class="primary disabled ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Review differences</span></button><button type="button" id="node-dialog-confirm-deploy-merge" class="primary disabled ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Merge changes</span></button><button type="button" id="node-dialog-confirm-deploy-deploy" class="primary ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Confirm deploy</span></button></div></div><div class="ui-resizable-handle ui-resizable-n" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-e" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-s" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-w" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-sw" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-ne" style="z-index: 90;"></div><div class="ui-resizable-handle ui-resizable-nw" style="z-index: 90;"></div></div><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="sentiment">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('sentiment',{
        category: 'analysis-function',
        color:"#E6E0F8",
        defaults: {
            name: {value:""},
        },
        inputs:1,
        outputs:1,
        icon: "arrow-in.png",
        label: function() {
            return this.name||"sentiment";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
<script type="text/x-red" data-help-name="sentiment">
    <p>Analyses the <code>msg.payload</code> and adds a <code>msg.sentiment</code> object
    that contains the resulting AFINN-111 sentiment score as <code>msg.sentiment.score</code>.</p>
    <p>A score greater than zero is positive and less than zero is negative.</p>
    <p>The score typically ranges from -5 to +5, but can go higher and lower.</p>
    <p>An object of word score overrides can be supplied as <code>msg.overrides</code>.</p>
    <p>See <a href="https://github.com/thisandagain/sentiment/blob/master/README.md" target="_blank">the Sentiment docs here</a>.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="inject">
    <div class="form-row">
        <label for="node-input-payload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
        <input type="text" id="node-input-payload" style="width:70%">
        <input type="hidden" id="node-input-payloadType">
    </div>

    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
        <input type="text" id="node-input-topic">
    </div>

    <div class="form-row">
        <label for=""><i class="fa fa-repeat"></i> <span data-i18n="inject.label.repeat"></span></label>
        <select id="inject-time-type-select">
            <option value="none" data-i18n="inject.none"></option>
            <option value="interval" data-i18n="inject.interval"></option>
            <option value="interval-time" data-i18n="inject.interval-time"></option>
            <option value="time" data-i18n="inject.time"></option>
        </select>
        <input type="hidden" id="node-input-repeat">
        <input type="hidden" id="node-input-crontab">
    </div>

    <div class="form-row inject-time-row hidden" id="inject-time-row-interval">
        <span data-i18n="inject.every"></span>
        <input id="inject-time-interval-count" class="inject-time-count" value="1"></input>
        <select style="width: 100px" id="inject-time-interval-units">
            <option value="s" data-i18n="inject.seconds"></option>
            <option value="m" data-i18n="inject.minutes"></option>
            <option value="h" data-i18n="inject.hours"></option>
        </select><br/>
    </div>

    <div class="form-row inject-time-row hidden" id="inject-time-row-interval-time">
        <span data-i18n="inject.every"></span> <select style="width:90px" id="inject-time-interval-time-units" class="inject-time-int-count" value="1">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="10">10</option>
            <option value="12">12</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="30">30</option>
            <option value="0">60</option>
        </select> <span data-i18n="inject.minutes"></span><br/>
        <span data-i18n="inject.between"></span> <select id="inject-time-interval-time-start" class="inject-time-times"></select>
        <span data-i18n="inject.and"></span> <select id="inject-time-interval-time-end" class="inject-time-times"></select><br/>
        <div id="inject-time-interval-time-days" class="inject-time-days">
            <div style="display: inline-block; vertical-align: top;margin-right:5px;" data-i18n="inject.on">on</div>
            <div style="display:inline-block;">
                <div>
                    <label><input type='checkbox' checked value='1'/> <span data-i18n="inject.days.0"></span></label>
                    <label><input type='checkbox' checked value='2'/> <span data-i18n="inject.days.1"></span></label>
                    <label><input type='checkbox' checked value='3'/> <span data-i18n="inject.days.2"></span></label>
                </div>
                <div>
                    <label><input type='checkbox' checked value='4'/> <span data-i18n="inject.days.3"></span></label>
                    <label><input type='checkbox' checked value='5'/> <span data-i18n="inject.days.4"></span></label>
                    <label><input type='checkbox' checked value='6'/> <span data-i18n="inject.days.5"></span></label>
                </div>
                <div>
                    <label><input type='checkbox' checked value='0'/> <span data-i18n="inject.days.6"></span></label>
                </div>
            </div>
        </div>
    </div>

    <div class="form-row inject-time-row hidden" id="inject-time-row-time">
        <span data-i18n="inject.at"></span> <input id="inject-time-time" value="12:00"></input><br/>
        <div id="inject-time-time-days" class="inject-time-days">
            <div style="display: inline-block; vertical-align: top;margin-right: 5px;">on </div>
            <div style="display:inline-block;">
                <div>
                    <label><input type='checkbox' checked value='1'/> <span data-i18n="inject.days.0"></span></label>
                    <label><input type='checkbox' checked value='2'/> <span data-i18n="inject.days.1"></span></label>
                    <label><input type='checkbox' checked value='3'/> <span data-i18n="inject.days.2"></span></label>
                </div>
                <div>
                    <label><input type='checkbox' checked value='4'/> <span data-i18n="inject.days.3"></span></label>
                    <label><input type='checkbox' checked value='5'/> <span data-i18n="inject.days.4"></span></label>
                    <label><input type='checkbox' checked value='6'/> <span data-i18n="inject.days.5"></span></label>
                </div>
                <div>
                    <label><input type='checkbox' checked value='0'/> <span data-i18n="inject.days.6"></span></label>
                </div>
            </div>
        </div>
    </div>

    <div class="form-row" id="node-once">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-once" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-once" style="width: 70%;" data-i18n="inject.onstart"></label>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>

    <div class="form-tips" data-i18n="[html]inject.tip"></div>
</script>
<style>
    .inject-time-row {
        padding-left: 110px;
    }
    .inject-time-row select {
        margin: 3px 0;
    }
    .inject-time-days label {
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        vertical-align: top;
        width: 100px;
    }
     .inject-time-days input {
         width: auto;
     }
    .inject-time-times {
        width: 90px;
    }
    #inject-time-time {
        width: 75px;
    }
    .inject-time-count {
        width: 40px !important;
    }
</style>


<script type="text/javascript">
    RED.nodes.registerType('inject',{
        category: 'input',
        color:"#a6bbcf",
        defaults: {
            name: {value:""},
            topic: {value:""},
            payload: {value:"", validate: RED.validators.typedInput("payloadType")},
            payloadType: {value:"date"},
            repeat: {value:""},
            crontab: {value:""},
            once: {value:false}
        },
        inputs:0,
        outputs:1,
        icon: "inject.png",
        label: function() {
            var suffix = "";
            // if fire once then add small indication
            if (this.once) {
                suffix = " ";
            }
            // but replace with repeat one if set to repeat
            if (this.repeat || this.crontab) {
                suffix = " ";
            }
            if (this.name) {
                return this.name+suffix;
            } else if (this.payloadType === "string" ||
                    this.payloadType === "str" ||
                    this.payloadType === "num" ||
                    this.payloadType === "bool" ||
                    this.payloadType === "json") {
                if ((this.topic !== "") && ((this.topic.length + this.payload.length) <= 32)) {
                    return this.topic + ":" + this.payload+suffix;
                } else if (this.payload.length > 0 && this.payload.length < 24) {
                    return this.payload+suffix;
                } else {
                    return this._("inject.inject")+suffix;
                }
            } else if (this.payloadType === 'date') {
                if ((this.topic !== "") && (this.topic.length <= 16)) {
                    return this.topic + ":" + this._("inject.timestamp")+suffix;
                } else {
                    return this._("inject.timestamp")+suffix;
                }
            } else if (this.payloadType === 'flow' && this.payload.length < 19) {
                return 'flow.'+this.payload+suffix;
            } else if (this.payloadType === 'global' && this.payload.length < 17) {
                return 'global.'+this.payload+suffix;
            } else {
                return this._("inject.inject")+suffix;
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.payloadType == null) {
                if (this.payload == "") {
                    this.payloadType = "date";
                } else {
                    this.payloadType = "str";
                }
            } else if (this.payloadType === 'string' || this.payloadType === 'none') {
                this.payloadType = "str";
            }
            $("#node-input-payloadType").val(this.payloadType);

            $("#node-input-payload").typedInput({
                default: 'str',
                typeField: $("#node-input-payloadType"),
                types:['flow','global','str','num','bool','json','date']
            });

            $("#inject-time-type-select").change(function() {
                $("#node-input-crontab").val('');
                var id = $("#inject-time-type-select").val();
                $(".inject-time-row").hide();
                $("#inject-time-row-"+id).show();
                if ((id == "none") || (id == "interval")) {
                    $("#node-once").show();
                }
                else {
                    $("#node-once").hide();
                    $("#node-input-once").prop('checked', false);
                }
            });

            $(".inject-time-times").each(function() {
                for (var i=0;i<24;i++) {
                    var l = (i<10?"0":"")+i+":00";
                    $(this).append($("<option></option>").val(i).text(l));
                }
            });
            $("<option></option>").val(24).text("00:00").appendTo("#inject-time-interval-time-end");
            $("#inject-time-interval-time-start").change(function() {
                var start = Number($("#inject-time-interval-time-start").val());
                var end = Number($("#inject-time-interval-time-end").val());
                $("#inject-time-interval-time-end option").remove();
                for (var i=start+1;i<25;i++) {
                    var l = (i<10?"0":"")+i+":00";
                    if (i==24) {
                        l = "00:00";
                    }
                    var opt = $("<option></option>").val(i).text(l).appendTo("#inject-time-interval-time-end");
                    if (i === end) {
                        opt.attr("selected","selected");
                    }
                }
            });

            $(".inject-time-count").spinner({
                //max:60,
                min:1
            });

            $.widget( "ui.injecttimespinner", $.ui.spinner, {
                options: {
                    // seconds
                    step: 60 * 1000,
                    // hours
                    page: 60
                },
                _parse: function( value ) {
                    if ( typeof value === "string" ) {
                        // already a timestamp
                        if ( Number( value ) == value ) {
                            return Number( value );
                        }
                        var p = value.split(":");
                        var offset = new Date().getTimezoneOffset();
                        return ((Number(p[0])*60)+Number(p[1])+offset)*60*1000;
                    }
                    return value;
                },
                _format: function( value ) {
                    var d = new Date(value);
                    var h = d.getHours();
                    var m = d.getMinutes();
                    return ((h < 10)?"0":"")+h+":"+((m < 10)?"0":"")+m;
                }
            });

            $("#inject-time-time").injecttimespinner();

            var repeattype = "none";
            if (this.repeat != "" && this.repeat != 0) {
                repeattype = "interval";
                var r = "s";
                var c = this.repeat;
                if (this.repeat % 60 === 0) { r = "m"; c = c/60; }
                if (this.repeat % 1440 === 0) { r = "h"; c = c/60; }
                $("#inject-time-interval-count").val(c);
                $("#inject-time-interval-units").val(r);
                $("#inject-time-interval-days").prop("disabled","disabled");
            } else if (this.crontab) {
                var cronparts = this.crontab.split(" ");
                var days = cronparts[4];
                if (!isNaN(cronparts[0]) && !isNaN(cronparts[1])) {
                    repeattype = "time";
                    // Fixed time
                    var time = cronparts[1]+":"+cronparts[0];
                    $("#inject-time-time").val(time);
                    $("#inject-time-type-select").val("s");
                    if (days == "*") {
                        $("#inject-time-time-days input[type=checkbox]").prop("checked",true);
                    } else {
                        $("#inject-time-time-days input[type=checkbox]").removeAttr("checked");
                        days.split(",").forEach(function(v) {
                            $("#inject-time-time-days [value=" + v + "]").prop("checked", true);
                        });
                    }
                } else {
                    repeattype = "interval-time";
                    // interval - time period
                    var minutes = cronparts[0].slice(2);
                    if (minutes === "") { minutes = "0"; }
                    $("#inject-time-interval-time-units").val(minutes);
                    if (days == "*") {
                        $("#inject-time-interval-time-days input[type=checkbox]").prop("checked",true);
                    } else {
                        $("#inject-time-interval-time-days input[type=checkbox]").removeAttr("checked");
                        days.split(",").forEach(function(v) {
                            $("#inject-time-interval-time-days [value=" + v + "]").prop("checked", true);
                        });
                    }
                    var time = cronparts[1];
                    var timeparts = time.split(",");
                    var start;
                    var end;
                    if (timeparts.length == 1) {
                        // 0 or 0-10
                        var hours = timeparts[0].split("-");
                        if (hours.length == 1) {
                            if (hours[0] === "") {
                                start = "0";
                                end = "0";
                            }
                            else {
                                start = hours[0];
                                end = Number(hours[0])+1;
                            }
                        } else {
                            start = hours[0];
                            end = Number(hours[1])+1;
                        }
                    } else {
                        // 23,0 or 17-23,0-10 or 23,0-2 or 17-23,0
                        var startparts = timeparts[0].split("-");
                        start = startparts[0];

                        var endparts = timeparts[1].split("-");
                        if (endparts.length == 1) {
                            end = Number(endparts[0])+1;
                        } else {
                            end = Number(endparts[1])+1;
                        }
                    }
                    $("#inject-time-interval-time-end").val(end);
                    $("#inject-time-interval-time-start").val(start);

                }
            } else {
                $("#inject-time-type-select").val("none");
            }

            $(".inject-time-row").hide();
            $("#inject-time-type-select").val(repeattype);
            $("#inject-time-row-"+repeattype).show();

            $("#node-input-payload").typedInput('type',this.payloadType);

            $("#inject-time-type-select").change();
            $("#inject-time-interval-time-start").change();

        },
        oneditsave: function() {
            var repeat = "";
            var crontab = "";
            var type = $("#inject-time-type-select").val();
            if (type == "none") {
                // nothing
            } else if (type == "interval") {
                var count = $("#inject-time-interval-count").val();
                var units = $("#inject-time-interval-units").val();
                if (units == "s") {
                    repeat = count;
                } else {
                    if (units == "m") {
                        //crontab = "*/"+count+" * * * "+days;
                        repeat = count * 60;
                    } else if (units == "h") {
                        //crontab = "0 */"+count+" * * "+days;
                        repeat = count * 60 * 60;
                    }
                }
            } else if (type == "interval-time") {
                repeat = "";
                var count = $("#inject-time-interval-time-units").val();
                var startTime = Number($("#inject-time-interval-time-start").val());
                var endTime = Number($("#inject-time-interval-time-end").val());
                var days = $('#inject-time-interval-time-days  input[type=checkbox]:checked').map(function(_, el) {
                    return $(el).val()
                }).get();
                if (days.length == 0) {
                    crontab = "";
                } else {
                    if (days.length == 7) {
                        days="*";
                    } else {
                        days = days.join(",");
                    }
                    var timerange = "";
                    if (endTime == 0) {
                        timerange = startTime+"-23";
                    } else if (startTime+1 < endTime) {
                        timerange = startTime+"-"+(endTime-1);
                    } else if (startTime+1 == endTime) {
                        timerange = startTime;
                    } else {
                        var startpart = "";
                        var endpart = "";
                        if (startTime == 23) {
                            startpart = "23";
                        } else {
                            startpart = startTime+"-23";
                        }
                        if (endTime == 1) {
                            endpart = "0";
                        } else {
                            endpart = "0-"+(endTime-1);
                        }
                        timerange = startpart+","+endpart;
                    }
                    if (count === "0") {
                        crontab = count+" "+timerange+" * * "+days;
                    } else {
                        crontab = "*/"+count+" "+timerange+" * * "+days;
                    }
                }
            } else if (type == "time") {
                var time = $("#inject-time-time").val();
                var days = $('#inject-time-time-days  input[type=checkbox]:checked').map(function(_, el) {
                    return $(el).val()
                }).get();
                if (days.length == 0) {
                    crontab = "";
                } else {
                    if (days.length == 7) {
                        days="*";
                    } else {
                        days = days.join(",");
                    }
                    var parts = time.split(":");
                    repeat = "";
                    crontab = parts[1]+" "+parts[0]+" * * "+days;
                }
            }

            $("#node-input-repeat").val(repeat);
            $("#node-input-crontab").val(crontab);
        },
        button: {
            onclick: function() {
                var label = (this.name||this.payload).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
                if (this.payloadType === "date") { label = this._("inject.timestamp"); }
                if (this.payloadType === "none") { label = this._("inject.blank"); }
                var node = this;
                $.ajax({
                    url: "inject/"+this.id,
                    type:"POST",
                    success: function(resp) {
                        RED.notify(node._("inject.success",{label:label}),"success");
                    },
                    error: function(jqXHR,textStatus,errorThrown) {
                        if (jqXHR.status == 404) {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.not-deployed")}),"error");
                        } else if (jqXHR.status == 500) {
                            RED.notify(node._("common.notification.error",{message:node._("inject.errors.failed")}),"error");
                        } else if (jqXHR.status == 0) {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.no-response")}),"error");
                        } else {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.unexpected",{status:jqXHR.status,message:textStatus})}),"error");
                        }
                    }
                });
            }
        }
    });

</script>
<script type="text/x-red" data-help-name="inject">
    <p>Pressing the button on the left side of the node allows a message on a topic
       to be injected into the flow.</p>
    <p>The payload defaults to the current time in millisecs since 1970, but can
       also be set to various other javascript types.</p>
    <p>The repeat function allows the payload to be sent on the required schedule.</p>
    <p>The <i>Inject once at start</i> option actually waits a short interval before firing
       to give other nodes a chance to instantiate properly.</p>
    <p>The <i>Flow</i> and <i>Global</i> options allow one to inject a flow or global
        context value.
    </p>
    <p><b>Note: </b>"Interval between times" and "at a specific time" uses cron.
       This means that 20 minutes will be at the next hour, 20 minutes past and
       40 minutes past - not in 20 minutes time. If you want every 20 minutes
       from now - use the "interval" option.</p>
    <p><b>Note: </b>all string input is escaped. To add a carriage return to a string
    you should use a following function.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="catch">
    <div class="form-row">
        <label style="width: auto" for="node-input-scope" data-i18n="catch.label.source"></label>
        <select id="node-input-scope-select">
            <option value="all" data-i18n="catch.scope.all"></option>
            <option value="target" data-i18n="catch.scope.selected"></options>
        </select>
    </div>
    <div class="form-row node-input-target-row" style="display: none;">
        <div id="node-input-catch-target-container-div" style="min-height: 100px;position: relative;   box-sizing: border-box; border-radius: 2px; height: 180px;  border: 1px solid #ccc;overflow:hidden; ">
            <div style="box-sizing: border-box; line-height: 20px; font-size: 0.8em; border-bottom: 1px solid #ddd; height: 20px;">
              <input type="checkbox" data-i18n="[title]catch.label.selectAll" id="node-input-target-node-checkbox-all" style="width: 30px; margin: 0 2px 1px 2px;">
              <div style="display: inline-block;"><a id="node-input-target-sort-label" href="#" data-i18n="[title]catch.label.sortByLabel"><span data-i18n="catch.label.node"></span> <i class="node-input-catch-sort-label-a fa fa-caret-down"></i><i class="node-input-catch-sort-label-d fa fa-caret-up"></i></a></div>
              <div style="position: absolute; right: 10px; width: 50px; display: inline-block; text-align: right;"><a id="node-input-target-sort-type" href="#" data-i18n="[title]catch.label.sortByType"><i class="node-input-catch-sort-sublabel-a fa fa-caret-down"></i><i class="node-input-catch-sort-sublabel-d fa fa-caret-up"></i> <span data-i18n="catch.label.type"></span></a></div>
            </div>
            <div style="background: #fbfbfb; box-sizing: border-box; position:absolute; top:20px;bottom:0;left:0px;right:0px; overflow-y: scroll; overflow-x: hidden;">
                <ul id="node-input-catch-target-container" style=" list-style-type:none; margin: 0;"></ul>
            </div>
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<style>
#node-input-catch-target-container {
    position: relative;
}
#node-input-catch-target-container li {
    padding: 2px 5px;
    background: none;
    font-size: 0.8em;
    margin:0;
    white-space: nowrap;
}
#node-input-catch-target-container li label {
    margin-bottom: 0;
    width: 100%;
}
#node-input-catch-target-container li label input {
    vertical-align: top;
    width:15px;
    margin-right: 10px;
}
#node-input-catch-target-container li:hover,
#node-input-catch-target-container li:hover .node-input-target-node-sublabel {
    background: #f0f0f0;
}
.node-input-target-node-sublabel {
    position:absolute;
    right: 0px;
    padding-right: 10px;
    padding-left: 10px;
    font-size: 0.8em;
    background: #fbfbfb;
}
</style>
<script type="text/javascript">
    RED.nodes.registerType('catch',{
        category: 'input',
        color:"#e49191",
        defaults: {
            name: {value:""},
            scope: {value:null}
        },
        inputs:0,
        outputs:1,
        icon: "alert.png",
        label: function() {
            return this.name||(this.scope?this._("catch.catchNodes",{number:this.scope.length}):this._("catch.catch"));
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var nodeList = $("#node-input-catch-target-container");
            var node = this;
            this.resize = function() {
                var rows = $("#dialog-form>div:not(.node-input-target-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.size();i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-input-target-row");
                height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
                $("#node-input-catch-target-container-div").css("height",height+"px");
            }

            function createNodeList() {
                var scope = node.scope || [];
                nodeList.empty();

                var candidateNodes = RED.nodes.filterNodes({z:node.z});
                var allChecked = true;

                candidateNodes.forEach(function(n) {
                    if (n.id === node.id) {
                        return;
                    }
                    var isChecked = scope.indexOf(n.id) !== -1;

                    allChecked = allChecked && isChecked;

                    var container = $('<li></li>',{class:"node-input-target-node"});
                    var row = $('<label></label>',{for:"node-input-target-node-"+n.id}).appendTo(container);
                    $('<input>',{type:"checkbox",class:"node-input-target-node-checkbox",id:"node-input-target-node-"+n.id})
                        .data('node-id',n.id)
                        .prop('checked', isChecked)
                        .appendTo(row);
                    container.on('mouseover',function(e) {
                        n.highlighted = true;
                        n.dirty = true;
                        RED.view.redraw();
                    });
                    container.on('mouseout',function(e) {
                        n.highlighted = false;
                        n.dirty = true;
                        RED.view.redraw();
                    });
                    var labelSpan = $('<span>');
                    var nodeDef = RED.nodes.getType(n.type);
                    var label;
                    var sublabel;
                    if (nodeDef) {
                        var l = nodeDef.label;
                        label = (typeof l === "function" ? l.call(n) : l)||"";
                        sublabel = n.type;
                        if (sublabel.indexOf("subflow:") === 0) {
                            var subflowId = sublabel.substring(8);
                            var subflow = RED.nodes.subflow(subflowId);
                            sublabel = "subflow : "+subflow.name;
                        }
                    }
                    if (!nodeDef || !label) {
                        label = n.type;
                    }
                    $('<span>',{class:"node-input-target-node-label",style:"white-space:nowrap"}).text(label).appendTo(row);
                    if (sublabel) {
                        $('<span>',{class:"node-input-target-node-sublabel"}).text(sublabel).appendTo(row);
                    }

                    container.appendTo(nodeList);
                });

                $(".node-input-target-node-checkbox").change(function() {
                    if (!this.checked) {
                        $("#node-input-target-node-checkbox-all").prop('checked',false);
                    }
                });

                $("#node-input-target-node-checkbox-all").prop('checked',allChecked);

                sortNodeList('label');
            }

            function sortNodeList(sortOn) {
                var currentSort = nodeList.data('currentSort');
                var currentSortOrder = nodeList.data('currentSortOrder');

                if (!currentSort) {
                    currentSort = sortOn;
                    currentSortOrder = 'a';
                } else {
                    if (currentSort === sortOn) {
                        currentSortOrder = (currentSortOrder === 'a'?'d':'a');
                    } else {
                        currentSortOrder = 'a';
                    }
                    currentSort = sortOn;
                }
                nodeList.data('currentSort',currentSort);
                nodeList.data('currentSortOrder',currentSortOrder);

                $("#node-input-catch-target-container-div .fa").hide();
                $(".node-input-catch-sort-"+currentSort+"-"+currentSortOrder).show();


                var items = nodeList.find("li").get();
                items.sort(function(a,b) {
                    var labelA = $(a).find(".node-input-target-node-"+currentSort).text().toLowerCase();
                    var labelB = $(b).find(".node-input-target-node-"+currentSort).text().toLowerCase();
                    if (labelA < labelB) { return currentSortOrder==='a'?-1:1; }
                    if (labelA > labelB) { return currentSortOrder==='a'?1:-1; }
                    return 0;
                });
                $.each(items, function(i, li){
                    nodeList.append(li);
                });
            }
            $("#node-input-target-sort-label").click(function(e) {
                e.preventDefault();
                sortNodeList('label');
            });

            $("#node-input-target-sort-type").click(function(e) {
                e.preventDefault();
                sortNodeList('sublabel')
            });
            $("#node-input-target-node-checkbox-all").change(function() {
                $(".node-input-target-node-checkbox").prop('checked',this.checked);
            })



            $("#node-input-scope-select").change(function(e) {
                var scope = $(this).val();
                if (scope === "target") {
                    createNodeList();
                    $(".node-input-target-row").show();
                } else {
                    $(".node-input-target-row").hide();
                }
                node.resize();
            });
            if (this.scope == null) {
                $("#node-input-scope-select").val("all");
            } else {
                $("#node-input-scope-select").val("target");
            }
            $("#node-input-scope-select").change();
        },
        oneditsave: function() {
            var scope = $("#node-input-scope-select").val();
            if (scope === 'all') {
                this.scope = null;
            } else {
                var node = this;
                node.scope = [];
                $(".node-input-target-node-checkbox").each(function(n) {
                    if ($(this).prop("checked")) {
                        node.scope.push($(this).data('node-id'));
                    }
                })
            }
        },
        oneditresize: function(size) {
            this.resize();
        }
    });
</script>
<script type="text/x-red" data-help-name="catch">
    <p>Catch errors thrown by nodes on the same tab.</p>
    <p>If a node throws a error whilst handling a message, the flow will typically
       halt. This node can be used to catch those errors and handle them with a
       dedicated flow.</p>
    <p>The node will catch errors thrown by any node on the same tab. If there
       are multiple catch nodes on a tab, they will all get triggered.</p>
    <p>If an error is thrown within a subflow, the error will get handled by any
       catch nodes within the subflow. If none exists, the error is propagated
       up to the tab the subflow instance is on.</p>
    <p>The message sent by this node will be the original message if the node that
       threw the error provided it. The message will have an <code>error</code>
       property with the following attributes:
       <ul>
        <li><code>message</code> : the error message</li>
        <li><code>source.id</code> : the id of the node that threw the error</li>
        <li><code>source.type</code> : the type of the node that threw the error</li>
        <li><code>source.name</code> : the name, if set, of the node that threw the error</li>
       </ul>
   </p>
   <p>If the message already had a <code>error</code> property, it is copied to <code>_error</code>.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="status">
    <div class="form-row">
        <label style="width: auto" for="node-input-scope" data-i18n="status.label.source"></label>
        <select id="node-input-scope-select">
            <option value="all" data-i18n="status.scope.all"></option>
            <option value="target" data-i18n="status.scope.selected"></options>
        </select>
    </div>
    <div class="form-row node-input-target-row" style="display: none;">
        <div id="node-input-status-target-container-div" style=" min-height: 100px;position: relative;   box-sizing: border-box; border-radius: 2px; height: 180px;  border: 1px solid #ccc;overflow:hidden; ">
            <div style="box-sizing: border-box; line-height: 20px; font-size: 0.8em; border-bottom: 1px solid #ddd; height: 20px;">
              <input type="checkbox" data-i18n="[title]status.label.selectAll" id="node-input-target-node-checkbox-all" style="width: 30px; margin: 0 2px 1px 2px;">
              <div style="display: inline-block;"><a id="node-input-target-sort-label" href="#" data-i18n="[title]status.label.sortByLabel"><span data-i18n="status.label.node"></span> <i class="node-input-status-sort-label-a fa fa-caret-down"></i><i class="node-input-status-sort-label-d fa fa-caret-up"></i></a></div>
              <div style="position: absolute; right: 10px; width: 50px; display: inline-block; text-align: right;"><a id="node-input-target-sort-type" href="#" data-i18n="[title]status.label.sortByType"><i class="node-input-status-sort-sublabel-a fa fa-caret-down"></i><i class="node-input-status-sort-sublabel-d fa fa-caret-up"></i> <span data-i18n="status.label.type"></span></a></div>
            </div>
            <div style="background: #fbfbfb; box-sizing: border-box; position:absolute; top:20px;bottom:0;left:0px;right:0px; overflow-y: scroll; overflow-x: hidden;">
                <ul id="node-input-status-target-container" style=" list-style-type:none; margin: 0;"></ul>
            </div>
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<style>
#node-input-status-target-container {
    position: relative;
}
#node-input-status-target-container li {
    padding: 2px 5px;
    background: none;
    font-size: 0.8em;
    margin:0;
    white-space: nowrap;
}
#node-input-status-target-container li label {
    margin-bottom: 0;
    width: 100%;
}
#node-input-status-target-container li label input {
    vertical-align: top;
    width:15px;
    margin-right: 10px;
}
#node-input-status-target-container li:hover,
#node-input-status-target-container li:hover .node-input-target-node-sublabel {
    background: #f0f0f0;
}
.node-input-target-node-sublabel {
    position:absolute;
    right: 0px;
    padding-right: 10px;
    padding-left: 10px;
    font-size: 0.8em;
    background: #fbfbfb;
}
</style>
<script type="text/javascript">
    RED.nodes.registerType('status',{
        category: 'input',
        color:"#c0edc0",
        defaults: {
            name: {value:""},
            scope: {value:null}
        },
        inputs:0,
        outputs:1,
        icon: "alert.png",
        label: function() {
            return this.name||(this.scope?this._("status.statusNodes",{number:this.scope.length}):this._("status.status"));
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var nodeList = $("#node-input-status-target-container");
            var node = this;
            this.resize = function() {
                var rows = $("#dialog-form>div:not(.node-input-target-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.size();i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-input-target-row");
                height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
                $("#node-input-status-target-container-div").css("height",height+"px");
            }

            function createNodeList() {
                var scope = node.scope || [];
                nodeList.empty();

                var candidateNodes = RED.nodes.filterNodes({z:node.z});
                var allChecked = true;

                candidateNodes.forEach(function(n) {
                    if (n.id === node.id) {
                        return;
                    }
                    var isChecked = scope.indexOf(n.id) !== -1;

                    allChecked = allChecked && isChecked;

                    var container = $('<li></li>',{class:"node-input-target-node"});
                    var row = $('<label></label>',{for:"node-input-target-node-"+n.id}).appendTo(container);
                    $('<input>',{type:"checkbox",class:"node-input-target-node-checkbox",id:"node-input-target-node-"+n.id})
                        .data('node-id',n.id)
                        .prop('checked', isChecked)
                        .appendTo(row);
                    container.on('mouseover',function(e) {
                        n.highlighted = true;
                        n.dirty = true;
                        RED.view.redraw();
                    });
                    container.on('mouseout',function(e) {
                        n.highlighted = false;
                        n.dirty = true;
                        RED.view.redraw();
                    });
                    var labelSpan = $('<span>');
                    var nodeDef = RED.nodes.getType(n.type);
                    var label;
                    var sublabel;
                    if (nodeDef) {
                        var l = nodeDef.label;
                        label = (typeof l === "function" ? l.call(n) : l)||"";
                        sublabel = n.type;
                        if (sublabel.indexOf("subflow:") === 0) {
                            var subflowId = sublabel.substring(8);
                            var subflow = RED.nodes.subflow(subflowId);
                            sublabel = "subflow : "+subflow.name;
                        }
                    }
                    if (!nodeDef || !label) {
                        label = n.type;
                    }
                    $('<span>',{class:"node-input-target-node-label",style:"white-space:nowrap"}).text(label).appendTo(row);
                    if (sublabel) {
                        $('<span>',{class:"node-input-target-node-sublabel"}).text(sublabel).appendTo(row);
                    }

                    container.appendTo(nodeList);
                });

                $(".node-input-target-node-checkbox").change(function() {
                    if (!this.checked) {
                        $("#node-input-target-node-checkbox-all").prop('checked',false);
                    }
                });

                $("#node-input-target-node-checkbox-all").prop('checked',allChecked);

                sortNodeList('label');
            }

            function sortNodeList(sortOn) {
                var currentSort = nodeList.data('currentSort');
                var currentSortOrder = nodeList.data('currentSortOrder');

                if (!currentSort) {
                    currentSort = sortOn;
                    currentSortOrder = 'a';
                } else {
                    if (currentSort === sortOn) {
                        currentSortOrder = (currentSortOrder === 'a'?'d':'a');
                    } else {
                        currentSortOrder = 'a';
                    }
                    currentSort = sortOn;
                }
                nodeList.data('currentSort',currentSort);
                nodeList.data('currentSortOrder',currentSortOrder);

                $("#node-input-status-target-container-div .fa").hide();
                $(".node-input-status-sort-"+currentSort+"-"+currentSortOrder).show();


                var items = nodeList.find("li").get();
                items.sort(function(a,b) {
                    var labelA = $(a).find(".node-input-target-node-"+currentSort).text().toLowerCase();
                    var labelB = $(b).find(".node-input-target-node-"+currentSort).text().toLowerCase();
                    if (labelA < labelB) { return currentSortOrder==='a'?-1:1; }
                    if (labelA > labelB) { return currentSortOrder==='a'?1:-1; }
                    return 0;
                });
                $.each(items, function(i, li){
                    nodeList.append(li);
                });
            }
            $("#node-input-target-sort-label").click(function(e) {
                e.preventDefault();
                sortNodeList('label');
            });

            $("#node-input-target-sort-type").click(function(e) {
                e.preventDefault();
                sortNodeList('sublabel')
            });
            $("#node-input-target-node-checkbox-all").change(function() {
                $(".node-input-target-node-checkbox").prop('checked',this.checked);
            })

            $("#node-input-scope-select").change(function(e) {
                var scope = $(this).val();
                if (scope === "target") {
                    createNodeList();
                    $(".node-input-target-row").show();
                } else {
                    $(".node-input-target-row").hide();
                }
                node.resize();
            });
            if (this.scope == null) {
                $("#node-input-scope-select").val("all");
            } else {
                $("#node-input-scope-select").val("target");
            }
            $("#node-input-scope-select").change();
        },
        oneditsave: function() {
            var scope = $("#node-input-scope-select").val();
            if (scope === 'all') {
                this.scope = null;
            } else {
                var node = this;
                node.scope = [];
                $(".node-input-target-node-checkbox").each(function(n) {
                    if ($(this).prop("checked")) {
                        node.scope.push($(this).data('node-id'));
                    }
                })

            }
        },
        oneditresize: function(size) {
            this.resize();
        }
    });
</script>
<script type="text/x-red" data-help-name="status">
    <p>Send status messages from other nodes on the same tab.</p>
    <p>The message sent by this node will have a <code>status</code> property
    with the following attributes:
        <ul>
            <li><code>text</code> : the status text</li>
            <li><code>source.type</code> : the type of the node that reported status</li>
            <li><code>source.id</code> : the id of the node that reported status</li>
            <li><code>source.name</code> : the name, if set, of the node that reported status</li>

        </ul>
   </p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="debug">
    <div class="form-row">
        <label for="node-input-typed-complete"><i class="fa fa-list"></i> <span data-i18n="debug.output"></span></label>
        <input id="node-input-typed-complete" type="text" style="width: 70%">
        <input id="node-input-complete" type="hidden">
    </div>
    <div class="form-row">
        <label for="node-input-console"><i class="fa fa-random"></i> <span data-i18n="debug.to"></span></label>
        <select type="text" id="node-input-console" style="display: inline-block; width: 250px; vertical-align: top;">
            <option value="false" data-i18n="debug.debtab"></option>
            <option value="true" data-i18n="debug.tabcon"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>


<script src="Node-RED%20:%20mc-miot-testnr1.eu-gb.mybluemix.net_files/debug-utils.js"></script>

<script type="text/javascript">
(function() {
    var subWindow = null;
    RED.nodes.registerType('debug',{
        category: 'output',
        defaults: {
            name: {value:""},
            active: {value:true},
            console: {value:"false"},
            complete: {value:"false", required:true}
        },
        label: function() {
            var suffix = "";
            if (this.console === true || this.console === "true") { suffix = " "; }
            if (this.complete === true || this.complete === "true") {
                return (this.name||"msg") + suffix;
            } else {
                return (this.name || "msg." + ((!this.complete || this.complete === "false") ? "payload" : this.complete)) + suffix;
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        color:"#87a980",
        inputs:1,
        outputs:0,
        icon: "debug.png",
        align: "right",
        button: {
            toggle: "active",
            onclick: function() {
                var label = this.name||"debug";
                var node = this;
                $.ajax({
                    url: "debug/"+this.id+"/"+(this.active?"enable":"disable"),
                    type: "POST",
                    success: function(resp, textStatus, xhr) {
                        if (xhr.status == 200) {
                            RED.notify(node._("debug.notification.activated",{label:label}),"success");
                        } else if (xhr.status == 201) {
                            RED.notify(node._("debug.notification.deactivated",{label:label}),"success");
                        }
                    },
                    error: function(jqXHR,textStatus,errorThrown) {
                        if (jqXHR.status == 404) {
                            RED.notify(node._("common.notification.error", {message: node._("common.notification.errors.not-deployed")}),"error");
                        } else if (jqXHR.status == 0) {
                            RED.notify(node._("common.notification.error", {message: node._("common.notification.errors.no-response")}),"error");
                        } else {
                            RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.unexpected",{status:err.status,message:err.response})}),"error");
                        }
                    }
                });
            }
        },
        onpaletteadd: function() {

            var options = {
                messageMouseEnter: function(sourceId) {
                    if (sourceId) {
                        var n = RED.nodes.node(sourceId);
                        if (n) {
                            n.highlighted = true;
                            n.dirty = true;
                        }
                        RED.view.redraw();
                    }
                },
                messageMouseLeave: function(sourceId) {
                    if (sourceId) {
                        var n = RED.nodes.node(sourceId);
                        if (n) {
                            n.highlighted = false;
                            n.dirty = true;
                        }
                        RED.view.redraw();
                    }
                },
                messageSourceClick: function(sourceId) {
                    RED.view.reveal(sourceId);
                },
                clear: function() {
                    RED.nodes.eachNode(function(node) {
                        node.highlighted = false;
                        node.dirty = true;
                    });
                    RED.view.redraw();
                }
            }

            var uiComponents = RED.debug.init(options);

            RED.sidebar.addTab({
                id: "debug",
                label: this._("debug.sidebar.label"),
                name: this._("debug.sidebar.name"),
                content: uiComponents.content,
                toolbar: uiComponents.footer,
                enableOnEdit: true
            });
            RED.actions.add("core:show-debug-tab",function() { RED.sidebar.show('debug')});

            var that = this;
            RED._debug = function(msg) {
                that.handleDebugMessage("",{
                    name:"debug",
                    msg:msg
                });
            }

            this.refreshMessageList = function() {
                RED.debug.refreshMessageList(RED.workspaces.active());
                if (subWindow) {
                    try {
                        subWindow.postMessage({event:"workspaceChange",activeWorkspace:RED.workspaces.active()},"*")
                    } catch(err) {
                        console.log(err);
                    }
                }
            }

            this.handleDebugMessage = function(t,o) {
                var sourceNode = RED.nodes.node(o.id) || RED.nodes.node(o.z);
                if (sourceNode) {
                    o._source = {id:sourceNode.id,z:sourceNode.z};

                }
                RED.debug.handleDebugMessage(o);
                if (subWindow) {
                    try {
                        subWindow.postMessage({event:"message",msg:o},"*")
                    } catch(err) {
                        console.log(err);
                    }
                }
            };
            RED.comms.subscribe("debug",this.handleDebugMessage);

            RED.events.on("workspace:change", this.refreshMessageList);

            $("#debug-tab-open").click(function(e) {
                e.preventDefault();
                subWindow = window.open(document.location.toString().replace(/[?#].*$/,"")+"debug/view/view.html"+document.location.search,"nodeREDDebugView","menubar=no,location=no,toolbar=no,chrome,height=500,width=600");
                subWindow.onload = function() {
                    subWindow.postMessage({event:"workspaceChange",activeWorkspace:RED.workspaces.active()},"*");
                }
            });

            $(window).unload(function() {
                if (subWindow) {
                    try {
                        subWindow.close()
                    } catch(err) {
                        console.log(err);
                    }
                }
            });

            this.handleWindowMessage = function(evt) {
                var msg = evt.data;
                if (msg.event === "mouseEnter") {
                    options.messageMouseEnter(msg.id);
                } else if (msg.event === "mouseLeave") {
                    options.messageMouseLeave(msg.id);
                } else if (msg.event === "mouseClick") {
                    options.messageSourceClick(msg.id);
                } else if (msg.event === "clear") {
                    options.clear();
                }
            }
            window.addEventListener('message',this.handleWindowMessage);
        },
        onpaletteremove: function() {
            RED.comms.unsubscribe("debug",this.handleDebugMessage);
            RED.sidebar.removeTab("debug");
            RED.events.off("workspace:change", this.refreshMessageList);
            window.removeEventListener("message",this.handleWindowMessage);
            RED.actions.remove("core:show-debug");

            delete RED._debug;
        },
        oneditprepare: function() {
            $("#node-input-typed-complete").typedInput({types:['msg', {value:"full",label:RED._("node-red:debug.msgobj"),hasValue:false}]});
            if (this.complete === "true" || this.complete === true) {
                // show complete message object
                $("#node-input-typed-complete").typedInput('type','full');
            } else {
                var property = (!this.complete||(this.complete === "false")) ? "payload" : this.complete+"";
                $("#node-input-typed-complete").typedInput('type','msg');
                $("#node-input-typed-complete").typedInput('value',property);
            }
            $("#node-input-typed-complete").on('change',function() {
                if ($("#node-input-typed-complete").typedInput('type') === 'msg'
                    &&
                    $("#node-input-typed-complete").typedInput('value') === ''
                ) {
                    $("#node-input-typed-complete").typedInput('value','payload');
                }
            });
        },
        oneditsave: function() {
            var type = $("#node-input-typed-complete").typedInput('type');
            if (type === 'full') {
                $("#node-input-complete").val("true");
            } else {
                $("#node-input-complete").val($("#node-input-typed-complete").typedInput('value'));
            }
        }

    });
})();
</script>
<script type="text/x-red" data-help-name="debug">
    <p>The Debug node can be connected to the output of any node. It can be used to display the output of any message
    property in the debug tab of the sidebar. The default is to display <code>msg.payload</code>.</p>
    <p>Each message will also display the timestamp, <code>msg.topic</code> and the type of property chosen to output.</p>
    <p>The sidebar can be accessed under the options drop-down in the top right corner.</p>
    <p>The button to the right of the node will toggle its output on and off so you can de-clutter the debug window.</p>
    <p>If the payload is an object or buffer it will be stringified first for display and indicate that by saying "(Object)" or "(Buffer)".</p>
    <p>Selecting any particular message will highlight (in red) the debug node that reported it. This is useful if you wire up multiple debug nodes.</p>
    <p>Optionally can show the complete <code>msg</code> object, and send messages to the console log ().</p>
    <p>In addition any calls to node.warn or node.error will appear here.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="link in">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row node-input-link-row"></div>
</script>
<script type="text/x-red" data-template-name="link out">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row node-input-link-row"></div>
</script>


<style>
#node-input-link-container {
    position: relative;
}
#node-input-link-container li {
    padding: 2px 5px;
    background: none;
    font-size: 0.8em;
    margin:0;
    white-space: nowrap;
}
#node-input-link-container li label {
    margin-bottom: 0;
    width: 100%;
}
#node-input-link-container li label input {
    vertical-align: top;
    width:15px;
    margin-right: 10px;
}
#node-input-link-container li:hover,
#node-input-link-container li:hover .node-input-target-node-sublabel {
    background: #f0f0f0;
}
.node-input-link-node-sublabel {
    position:absolute;
    right: 0px;
    padding-right: 10px;
    padding-left: 10px;
    font-size: 0.8em;
}
</style>

<script type="text/javascript">
(function() {

    function sortNodeList(nodeList,sortOn,sortOnSecond) {
        var currentSort = nodeList.data('currentSort');
        var currentSortOrder = nodeList.data('currentSortOrder');

        if (!currentSort) {
            currentSort = sortOn;
            currentSortOrder = 'a';
        } else {
            if (currentSort === sortOn) {
                currentSortOrder = (currentSortOrder === 'a'?'d':'a');
            } else {
                currentSortOrder = 'a';
            }
            currentSort = sortOn;
        }
        nodeList.data('currentSort',currentSort);
        nodeList.data('currentSortOrder',currentSortOrder);

        $("#node-input-link-container-div .fa").hide();
        $(".node-input-link-sort-"+currentSort+"-"+currentSortOrder).show();


        var items = nodeList.find("li").get();
        items.sort(function(a,b) {
            var labelA = $(a).find(".node-input-link-node-"+currentSort).text().toLowerCase();
            var labelB = $(b).find(".node-input-link-node-"+currentSort).text().toLowerCase();
            if (labelA < labelB) { return currentSortOrder==='a'?-1:1; }
            if (labelA > labelB) { return currentSortOrder==='a'?1:-1; }

            if (sortOnSecond) {
                labelA = $(a).find(".node-input-link-node-"+sortOnSecond).text().toLowerCase();
                labelB = $(b).find(".node-input-link-node-"+sortOnSecond).text().toLowerCase();
                if (labelA < labelB) { return currentSortOrder==='a'?-1:1; }
                if (labelA > labelB) { return currentSortOrder==='a'?1:-1; }
            }
            return 0;
        });
        $.each(items, function(i, li){
            nodeList.append(li);
        });
    }
    function onEditPrepare(node,targetType) {
        if (!node.links) {
            node.links = [];
        }
        node.oldLinks = [];

        $('<div id="node-input-link-container-div" style="min-height: 100px;position: relative;   box-sizing: border-box; border-radius: 2px; height: 180px;  border: 1px solid #ccc;overflow:hidden; ">'+
            '    <div style="box-sizing: border-box; line-height: 20px; font-size: 0.8em; border-bottom: 1px solid #ddd; height: 20px;">'+
            '        <div style="display: inline-block;margin-left: 5px;"><a id="node-input-link-sort-label" href="#" data-i18n="[title]link.label.sortByLabel"><span data-i18n="link.label.node">name</span> <i class="node-input-link-sort-label-a fa fa-caret-down"></i><i class="node-input-link-sort-label-d fa fa-caret-up"></i></a></div>'+
            '        <div style="position: absolute; right: 10px; width: 50px; display: inline-block; text-align: right;"><a id="node-input-link-sort-type" href="#" data-i18n="[title]link.label.sortByFlow"><i class="node-input-link-sort-sublabel-a fa fa-caret-down"></i><i class="node-input-link-sort-sublabel-d fa fa-caret-up"></i> <span data-i18n="link.label.type">flow</span></a></div>'+
            '    </div>'+
            '    <div style="background: #fbfbfb; box-sizing: border-box; position:absolute; top:20px;bottom:0;left:0px;right:0px; overflow-y: scroll; overflow-x: hidden;">'+
            '        <ul id="node-input-link-container" style=" list-style-type:none; margin: 0;"></ul>'+
            '    </div>'+
            '</div>').appendTo('.node-input-link-row');

        var nodeList = $("#node-input-link-container");
        var candidateNodes = RED.nodes.filterNodes({type:targetType});
        var inSubflow = (RED.nodes.subflow(node.z) != null);
        candidateNodes.forEach(function(n) {
            if (inSubflow) {
                if (n.z !== node.z) {
                    return;
                }
            } else {
                if (RED.nodes.subflow(n.z)!=null) {
                    return;
                }
            }
            var isChecked = false;

            isChecked = (node.links.indexOf(n.id) !== -1) || (n.links||[]).indexOf(node.id) !== -1;

            if (isChecked) {
                node.oldLinks.push(n.id);
            }

            var container = $('<li></li>',{class:"node-input-link-node"});
            var row = $('<label></label>',{for:"node-input-link-node-"+n.id}).appendTo(container);
            $('<input>',{type:"checkbox",class:"node-input-link-node-checkbox",id:"node-input-link-node-"+n.id})
                .data('node-id',n.id)
                .prop('checked', isChecked)
                .appendTo(row);
            container.on('mouseover',function(e) {
                n.highlighted = true;
                n.dirty = true;
                RED.view.redraw();
            });
            container.on('mouseout',function(e) {
                n.highlighted = false;
                n.dirty = true;
                RED.view.redraw();
            });
            var labelSpan = $('<span>');
            var label = n.name||n.id;
            var sublabel;
            var tab = RED.nodes.workspace(n.z);
            if (tab) {
                sublabel = tab.label||tab.id;
            } else {
                tab = RED.nodes.subflow(n.z);
                sublabel = "subflow : "+tab.name;
            }
            $('<span>',{class:"node-input-link-node-label",style:"white-space:nowrap"}).text(label).appendTo(row);
            if (sublabel) {
                $('<span>',{class:"node-input-link-node-sublabel"}).text(sublabel).appendTo(row);
            }
            container.appendTo(nodeList);
        });

        sortNodeList(nodeList,'sublabel','label');

        $("#node-input-link-sort-label").click(function(e) {
            e.preventDefault();
            sortNodeList(nodeList,'label');
        });

        $("#node-input-link-sort-type").click(function(e) {
            e.preventDefault();
            sortNodeList(nodeList,'sublabel');
        });
    }

    function resizeNodeList() {
        var rows = $("#dialog-form>div:not(.node-input-link-row)");
        var height = $("#dialog-form").height();
        for (var i=0;i<rows.size();i++) {
            height -= $(rows[i]).outerHeight(true);
        }
        var editorRow = $("#dialog-form>div.node-input-link-row");
        height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
        $("#node-input-link-container-div").css("height",height+"px");
    }

    function onEditSave(node) {
        node.links = [];
        $(".node-input-link-node-checkbox").each(function(n) {
            if ($(this).prop("checked")) {
                node.links.push($(this).data('node-id'));
            }
        })
        node.oldLinks.sort();
        node.links.sort();
        var nodeMap = {};
        var length = Math.max(node.oldLinks.length,node.links.length);
        for (var i=0;i<length;i++) {
            if (i<node.oldLinks.length) {
                nodeMap[node.oldLinks[i]] = nodeMap[node.oldLinks[i]]||{};
                nodeMap[node.oldLinks[i]].old = true;
            }
            if (i<node.links.length) {
                nodeMap[node.links[i]] = nodeMap[node.links[i]]||{};
                nodeMap[node.links[i]].new = true;
            }
        }
        var n;
        for (var id in nodeMap) {
            if (nodeMap.hasOwnProperty(id)) {
                n = RED.nodes.node(id);
                if (n) {
                    if (nodeMap[id].old && !nodeMap[id].new) {
                        // Removed id
                        i = n.links.indexOf(node.id);
                        if (i > -1) {
                            n.links.splice(i,1);
                        }
                    } else if (!nodeMap[id].old && nodeMap[id].new){
                        // Added id
                        i = n.links.indexOf(id);
                        if (i === -1) {
                            n.links.push(node.id);
                        }
                    }
                }
            }
        }
    }

    function onAdd() {
        for (var i=0;i<this.links.length;i++) {
            var n = RED.nodes.node(this.links[i]);
            if (n.links.indexOf(this.id) === -1) {
                n.links.push(this.id);
            }
        }
    }

    RED.nodes.registerType('link in',{
        category: 'input',
        color:"#ddd",//"#87D8CF",
        defaults: {
            name: {value:""},
            links: { value: [] }
        },
        inputs:0,
        outputs:1,
        icon: "link-out.png",
        label: function() {
            return this.name||this._("link.linkIn");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            onEditPrepare(this,"link out");
        },
        oneditsave: function() {
            onEditSave(this);
        },
        onadd: onAdd,
        oneditresize: resizeNodeList
    });

    RED.nodes.registerType('link out',{
        category: 'output',
        color:"#ddd",//"#87D8CF",
        defaults: {
            name: {value:""},
            links: { value: []}
        },
        align:"right",
        inputs:1,
        outputs:0,
        icon: "link-out.png",
        label: function() {
            return this.name||this._("link.linkOut");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            onEditPrepare(this,"link in");
        },
        oneditsave: function() {
            onEditSave(this);
        },
        onadd: onAdd,
        oneditresize: resizeNodeList
    });
})();
</script>
<script type="text/x-red" data-help-name="link in">
    <p>Create virtual wires between flows.</p>
    <p>The node can be connected to any <b>link out</b> node that exists on any tab.
       Once connected, they behave as if they were wired together.</p>
    <p>The wires between link nodes are only displayed when a link node is selected.
       If there are any wires to other tabs, a virtual node is show that can be clicked
       on to jump to the appropriate tab.</p>
    <p>Links cannot be created going into, or out of, a subflow.</p>
</script><script type="text/x-red" data-help-name="link out">
    <p>Create virtual wires between flows.</p>
    <p>The node can be connected to any <b>link in</b> node that exists on any tab.
       Once connected, they behave as if they were wired together.</p>
    <p>The wires between link nodes are only displayed when a link node is selected.
       If there are any wires to other tabs, a virtual node is show that can be clicked
       on to jump to the appropriate tab.</p>
    <p>Links cannot be created going into, or out of, a subflow.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="function">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row" style="margin-bottom: 0px;">
        <label for="node-input-func"><i class="fa fa-wrench"></i> <span data-i18n="function.label.function"></span></label>
        <input type="hidden" id="node-input-func" autofocus="autofocus">
        <input type="hidden" id="node-input-noerr">
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-func-editor" ></div>
    </div>
    <div class="form-row">
        <label for="node-input-outputs"><i class="fa fa-random"></i> <span data-i18n="function.label.outputs"></span></label>
        <input id="node-input-outputs" style="width: 60px;" value="1">
    </div>
    <div class="form-tips"><span data-i18n="function.tip"></span></div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('function',{
        color:"#fdd0a2",
        category: 'function',
        defaults: {
            name: {value:""},
            func: {value:"\nreturn msg;"},
            outputs: {value:1},
            noerr: {value:0,required:true,validate:function(v){ return ((!v) || (v === 0)) ? true : false; }}
        },
        inputs:1,
        outputs:1,
        icon: "function.png",
        label: function() {
            return this.name;
        },
        oneditprepare: function() {
            var that = this;
            $( "#node-input-outputs" ).spinner({
                min:1
            });

            this.editor = RED.editor.createEditor({
                id: 'node-input-func-editor',
                mode: 'ace/mode/javascript',
                value: $("#node-input-func").val(),
                globals: {
                    msg:true,
                    context:true,
                    RED: true,
                    util: true,
                    flow: true,
                    global: true,
                    console: true,
                    Buffer: true,
                    setTimeout: true,
                    clearTimeout: true,
                    setInterval: true,
                    clearInterval: true
                }
            });

            RED.library.create({
                url:"functions", // where to get the data from
                type:"function", // the type of object the library is for
                editor:this.editor, // the field name the main text body goes to
                mode:"ace/mode/javascript",
                fields:['name','outputs']
            });
            this.editor.focus();
        },
        oneditsave: function() {
            var annot = this.editor.getSession().getAnnotations();
            this.noerr = 0;
            $("#node-input-noerr").val(0);
            for (var k=0; k < annot.length; k++) {
                //console.log(annot[k].type,":",annot[k].text, "on line", annot[k].row);
                if (annot[k].type === "error") {
                    $("#node-input-noerr").val(annot.length);
                    this.noerr = annot.length;
                }
            }
            $("#node-input-func").val(this.editor.getValue());
            delete this.editor;
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-text-editor-row)");
            var height = $("#dialog-form").height();
            for (var i=0;i<rows.size();i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-text-editor-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            $(".node-text-editor").css("height",height+"px");
            this.editor.resize();
        }
    });
</script>
<script type="text/x-red" data-help-name="function">
    <p>A function block where you can write code to do more interesting things.</p>
    <p>The message is passed in as a JavaScript object called <code>msg</code>.</p>
    <p>By convention it will have a <code>msg.payload</code> property containing
       the body of the message.</p>
    <h4>Logging and Error Handling</h4>
    <p>To log any information, or report an error, the following functions are available:</p>
        <ul>
            <li><code>node.log("Log")</code></li>
            <li><code>node.warn("Warning")</code></li>
            <li><code>node.error("Error")</code></li>
        </ul>
    </p>
    <p>The Catch node can also be used to handle errors. To invoke a Catch node,
    pass <code>msg</code> as a second argument to <code>node.error</code>:</p>
    <pre>node.error("Error",msg)</pre>
    <h4>Sending messages</h4>
    <p>The function can either return the messages it wants to pass on to the next nodes
    in the flow, or can call <code>node.send(messages)</code>.</p>
    <p>It can return/send:</p>
    <ul>
      <li>a single message object - passed to nodes connected to the first output</li>
      <li>an array of message objects - passed to nodes connected to the corresponding outputs</li>
    </ul>
    <p>If any element of the array is itself an array of messages, multiple
          messages are sent to the corresponding output.</p>
    <p>If null is returned, either by itself or as an element of the array, no
          message is passed on.</p>
    <p>See the <a target="_blank" href="http://nodered.org/docs/writing-functions.html">online documentation</a> for more help.</p>

</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="template">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-field"><i class="fa fa-edit"></i> <span data-i18n="template.label.property"></span></label>
        <input type="text" id="node-input-field" placeholder="payload" style="width:250px;">
        <input type="hidden" id="node-input-fieldType">
    </div>
    <div class="form-row" style="position: relative; margin-bottom: 0px;">
        <label for="node-input-template"><i class="fa fa-file-code-o"></i> <span data-i18n="template.label.template"></span></label>
        <input type="hidden" id="node-input-template" autofocus="autofocus">
        <div style="position: absolute; right:0;display:inline-block; text-align: right; font-size: 0.8em;">
            <span data-i18n="template.label.format"></span>:
            <select id="node-input-format" style="width:110px; font-size: 10px !important;  height: 24px; padding:0;">
                <option value="handlebars">mustache</option>
                <option value="html">HTML</option>
                <option value="json">JSON</option>
                <option value="javascript">Javascript</option>
                <option value="css">CSS</option>
                <option value="markdown">Markdown</option>
                <option value="yaml">YAML</option>
                <option value="text">none</option>
            </select>
        </div>
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-template-editor" ></div>
    </div>
    <div class="form-row">
        <label for="node-input-syntax"><i class="fa fa-code"></i> <span data-i18n="template.label.syntax"></span></label>
        <select id="node-input-syntax" style="width:180px;">
            <option value="mustache" data-i18n="template.label.mustache"></option>
            <option value="plain" data-i18n="template.label.plain"></option>
        </select>
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('template',{
        color:"rgb(243, 181, 103)",
        category: 'function',
        defaults: {
            name: {value:""},
            field: {value:"payload", validate: RED.validators.typedInput("fieldType")},
            fieldType: {value:"msg"},
            format: {value:"handlebars"},
            syntax: {value:"mustache"},
            template: {value:"This is the payload: {{payload}} !"},
        },
        inputs:1,
        outputs:1,
        icon: "template.png",
        label: function() {
            return this.name;
        },
        oneditprepare: function() {
            var that = this;
            if (!this.fieldType) {
                this.fieldType = 'msg';
            }
            if (!this.syntax) {
                this.syntax = 'mustache';
                $("#node-input-syntax").val(this.syntax);
            }
            $("#node-input-field").typedInput({
                default: 'msg',
                types: ['msg','flow','global'],
                typeField: $("#node-input-fieldType")
            });

            this.editor = RED.editor.createEditor({
                id: 'node-input-template-editor',
                mode: 'ace/mode/html',
                value: $("#node-input-template").val()
            });
            RED.library.create({
                url:"functions", // where to get the data from
                type:"function", // the type of object the library is for
                editor:that.editor, // the field name the main text body goes to
                fields:['name','outputs']
            });
            this.editor.focus();

            $("#node-input-format").change(function() {
                var mod = "ace/mode/"+$("#node-input-format").val();
                that.editor.getSession().setMode({
                   path: mod,
                   v: Date.now()
                })
            });
        },
        oneditsave: function() {
            $("#node-input-template").val(this.editor.getValue())
            delete this.editor;
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-text-editor-row)");
            var height = $("#dialog-form").height();
            for (var i=0;i<rows.size();i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-text-editor-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            $(".node-text-editor").css("height",height+"px");
            this.editor.resize();
        }
    });
</script>
<script type="text/x-red" data-help-name="template">
    <p>Sets a property based on the provided template.</p>
    <p>By default this uses the <i><a href="http://mustache.github.io/mustache.5.html" target="_blank">mustache</a></i>
    format, but this can be switched off if required.</p>
    <p>For example, when a template of:
    <pre>Hello {{name}}. Today is {{date}}</pre>
    <p>receives a message containing:
    <pre>{
  name: "Fred",
  date: "Monday"
  payload: ...
}</pre>
    <p>The resulting property will be:
    <pre>Hello Fred. Today is Monday</pre>
    <p>It is possible to use property from flow context or global context. Just use <code>{{flow.name}}</code> or <code>{{global.name}}</code>.
    <p>By default, mustache will escape any HTML entities in the values it substitutes.
       To prevent this, use <code>{{{triple}}}</code> braces.
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="delay">

    <div class="form-row">
        <label for="node-input-pauseType"><i class="fa fa-tasks"></i> <span data-i18n="delay.action"></span></label>
        <select id="node-input-pauseType" style="width:270px !important">
            <option value="delay" data-i18n="delay.delaymsg"></option>
            <option value="random" data-i18n="delay.randomdelay"></option>
            <option value="rate" data-i18n="delay.limitrate"></option>
            <option value="queue" data-i18n="delay.fairqueue"></option>
            <option value="timed" data-i18n="delay.timedqueue"></option>
        </select>
    </div>
    <div id="delay-details" class="form-row">
        <label for="node-input-timeout"><i class="fa fa-clock-o"></i> <span data-i18n="delay.for"></span></label>
        <input type="text" id="node-input-timeout" placeholder="Time" style="text-align:end; width:50px !important">
        <select id="node-input-timeoutUnits" style="width:200px !important">
          <option value="milliseconds" data-i18n="delay.milisecs"></option>
          <option value="seconds" data-i18n="delay.secs"></option>
          <option value="minutes" data-i18n="delay.mins"></option>
          <option value="hours" data-i18n="delay.hours"></option>
          <option value="days" data-i18n="delay.days"></option>
        </select>
    </div>

    <div id="rate-details" class="form-row">
        <label for="node-input-rate"><i class="fa fa-clock-o"></i> <span data-i18n="delay.rate"></span></label>
        <input type="text" id="node-input-rate" placeholder="1" style="text-align:end; width:30px !important">
        <label for="node-input-rateUnits"><span data-i18n="delay.msgper"></span></label>
        <input type="text" id="node-input-nbRateUnits" placeholder="1" style="text-align:end; width:30px !important">
        <select id="node-input-rateUnits" style="width:110px !important">
          <option value="second" data-i18n="delay.label.units.second.singular"></option>
          <option value="minute" data-i18n="delay.label.units.minute.singular"></option>
          <option value="hour" data-i18n="delay.label.units.hour.singular"></option>
          <option value="day" data-i18n="delay.label.units.day.singular"></option>
        </select>
        <br/>
        <div id="node-input-dr"><input style="margin: 20px 0 20px 100px; width: 30px;" type="checkbox" id="node-input-drop"><label style="width: 250px;" for="node-input-drop"><span data-i18n="delay.dropmsg"></span></label></div>
    </div>


    <div id="random-details" class="form-row">
        <label for="node-input-randomFirst"><i class="fa fa-clock-o"></i> <span data-i18n="delay.between"></span></label>
        <input type="text" id="node-input-randomFirst" placeholder="" style="text-align:end; width:30px !important">
        &nbsp;&nbsp;&amp;&nbsp;&nbsp;
        <input type="text" id="node-input-randomLast" placeholder="" style="text-align:end; width:30px !important">
        <select id="node-input-randomUnits" style="width:140px !important">
          <option value="milliseconds" data-i18n="delay.milisecs"></option>
          <option value="seconds" data-i18n="delay.secs"></option>
          <option value="minutes" data-i18n="delay.mins"></option>
          <option value="hours" data-i18n="delay.hours"></option>
          <option value="days" data-i18n="delay.days"></option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>

</script>



<script type="text/javascript">
    RED.nodes.registerType('delay',{
        category: 'function',
        color:"#E6E0F8",
        defaults: {
            name: {value:""},
            pauseType: {value:"delay", required:true},
            timeout: {value:"5", required:true, validate:RED.validators.number()},
            timeoutUnits: {value:"seconds"},
            rate: {value:"1", required:true, validate:RED.validators.number()},
            nbRateUnits: {value:"1", required:false, validate:RED.validators.regex(/\d+|/)},
            rateUnits: {value: "second"},
            randomFirst: {value:"1", required:true, validate:RED.validators.number()},
            randomLast: {value:"5", required:true, validate:RED.validators.number()},
            randomUnits: {value: "seconds"},
            drop: {value:false}
        },
        inputs:1,
        outputs:1,
        icon: "timer.png",
        label: function() {
            if (this.pauseType == "delay") {
              var units = this.timeoutUnits ? this.timeoutUnits.charAt(0) : "s";
              if (this.timeoutUnits == "milliseconds") { units = "ms"; }
              return this.name||this._("delay.label.delay")+" "+this.timeout+" "+units;
            } else if (this.pauseType == "rate") {
              var units = this.rateUnits ? (this.nbRateUnits > 1 ? this.nbRateUnits : '') + this.rateUnits.charAt(0) : "s";
              return this.name||this._("delay.label.limit")+" "+this.rate+" msg/"+units;
            } else if (this.pauseType == "random") {
              return this.name || this._("delay.label.random");
            }
            else if (this.pauseType == "timed") {
                var units = '';
                if (this.nbRateUnits > 1) {
                    units = this.nbRateUnits + ' ' + this._("delay.label.units." + this.rateUnits + ".plural");
                } else {
                    units = this._("delay.label.units." + this.rateUnits + ".singular");
                }
                return this.name || this.rate + " " + this._("delay.label.timed") + ' ' + units;
            }
            else {
                var units = this.rateUnits ? (this.nbRateUnits > 1 ? this.nbRateUnits : '') + this.rateUnits.charAt(0) : "s";
                return this.name || this._("delay.label.queue")+" "+this.rate+" msg/"+units;
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
          var node = this;
          $( "#node-input-timeout" ).spinner({min:1});
          $( "#node-input-rate" ).spinner({min:1});
          $( "#node-input-nbRateUnits" ).spinner({min:1});

          $( "#node-input-randomFirst" ).spinner({min:0});
          $( "#node-input-randomLast" ).spinner({min:1});

          $('.ui-spinner-button').click(function() {
              $(this).siblings('input').change();
          });

          $( "#node-input-nbRateUnits" ).on('change keyup', function() {
            var $this = $(this);
            var val = parseInt($this.val());
            var type = "singular";
            if(val > 1) {
                type = "plural";
            }
            if($this.attr("data-type") == type) {
                return;
            }
            $this.attr("data-type", type);
            $("#node-input-rateUnits option").each(function () {
                var $option = $(this);
                var key = "delay.label.units." + $option.val() + "." + type;
                $option.attr('data-i18n', 'node-red:' + key);
                $option.html(node._(key));
            })
          });



          if (this.pauseType == "delay") {
            $("#delay-details").show();
            $("#rate-details").hide();
            $("#random-details").hide();
            $("#node-input-dr").hide();
          } else if (this.pauseType == "rate") {
            $("#delay-details").hide();
            $("#rate-details").show();
            $("#random-details").hide();
            $("#node-input-dr").show();
          } else if (this.pauseType == "random") {
            $("#delay-details").hide();
            $("#rate-details").hide();
            $("#random-details").show();
            $("#node-input-dr").hide();
          } else if (this.pauseType == "queue") {
            $("#delay-details").hide();
            $("#rate-details").show();
            $("#random-details").hide();
            $("#node-input-dr").hide();
          } else if (this.pauseType == "timed") {
            $("#delay-details").hide();
            $("#rate-details").show();
            $("#random-details").hide();
            $("#node-input-dr").hide();
          }

          if (!this.timeoutUnits) {
            $("#node-input-timeoutUnits option").filter(function() {
              return $(this).val() == 'seconds';
            }).attr('selected', true);
          }

          if (!this.randomUnits) {
            $("#node-input-randomUnits option").filter(function() {
               return $(this).val() == 'seconds';
            }).attr('selected', true);
          }

          $("#node-input-pauseType").on("change",function() {
            if (this.value == "delay") {
              $("#delay-details").show();
              $("#rate-details").hide();
              $("#random-details").hide();
              $("#node-input-dr").hide();
            } else if (this.value == "rate") {
              $("#delay-details").hide();
              $("#rate-details").show();
              $("#random-details").hide();
              $("#node-input-dr").show();
              } else if (this.value == "random") {
              $("#delay-details").hide();
              $("#rate-details").hide();
              $("#random-details").show();
              $("#node-input-dr").hide();
            } else if (this.value == "queue") {
              $("#delay-details").hide();
              $("#rate-details").show();
              $("#random-details").hide();
              $("#node-input-dr").hide();
            } else if (this.value == "timed") {
              $("#delay-details").hide();
              $("#rate-details").show();
              $("#random-details").hide();
              $("#node-input-dr").hide();
            }
          });
        }
    });
</script>
<script type="text/x-red" data-help-name="delay">
    <p>Introduces a delay into a flow or rate limits messages.</p>
    <p>The default delay is 5 seconds and rate limit of 1 msg/second, but both can be configured.</p>
    <p>When set to rate limit messages, they are spread across the configured time period. It can
    also be set to discard any intermediate messages that arrive.</p>
    <p>The "topic based fair queue" adds messages to a release queue tagged by their <code>msg.topic</code> property.
    At each "tick", derived from the rate, the next "topic" is released.
    Any messages arriving on the same topic before release replace those in that position in the queue.
    So each "topic" gets a turn - but the most recent value is always the one sent.</p>
    <p>The "timed release queue" adds messages to an array based on their <code>msg.topic</code> property.
    At each "tick", all the latest messages are released. Any new messages arriving before release will
    replace those of the same topic.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="trigger">
    <div class="form-row">
        <label data-i18n="trigger.send" for="node-input-op1"></label>
        <input type="hidden" id="node-input-op1type">
        <input style="width: 70%" type="text" id="node-input-op1">
    </div>
    <div class="form-row">
        <label data-i18n="trigger.then"></label>
        <select id="node-then-type" style="width:70%;">
            <option value="block" data-i18n="trigger.wait-reset"></option>
            <option value="wait" data-i18n="trigger.wait-for"></option>
        </select>
    </div>
    <div class="form-row node-type-wait">
        <label></label>
        <input type="text" id="node-input-duration" style="text-align:end; width:70px !important">
        <select id="node-input-units" style="width:140px !important">
            <option value="ms" data-i18n="trigger.duration.ms"></option>
            <option value="s" data-i18n="trigger.duration.s"></option>
            <option value="min" data-i18n="trigger.duration.m"></option>
            <option value="hr" data-i18n="trigger.duration.h"></option>
        </select>
    </div>
    <div class="form-row node-type-wait">
    <label></label>
        <input type="checkbox" id="node-input-extend" style="margin-left: 0px; vertical-align: top; width: auto !important;"> <label style="width:auto !important;" for="node-input-extend" data-i18n="trigger.extend"></label>
    </div>
    <div class="form-row node-type-wait">
        <label data-i18n="trigger.then-send"></label>
        <input type="hidden" id="node-input-op2type">
        <input style="width: 70%" type="text" id="node-input-op2">
    </div>
    <div class="form-row">
        <label data-i18n="trigger.label.reset" style="width:auto"></label>
        <div style="display:inline-block; width:70%;vertical-align:top">
        <ul>
            <li data-i18n="trigger.label.resetMessage"></li>
            <li><span data-i18n="trigger.label.resetPayload"></span> <input type="text" id="node-input-reset" style="width:150px" data-i18n="[placeholder]trigger.label.resetprompt"></li>
        </ul>
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name"></input>
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('trigger',{
        category: 'function',
        color:"#E6E0F8",
        defaults: {
            op1: {value:"1", validate: RED.validators.typedInput("op1type")},
            op2: {value:"0", validate: RED.validators.typedInput("op2type")},
            op1type: {value:"val"},
            op2type: {value:"val"},
            duration: {value:"250",required:true,validate:RED.validators.number()},
            extend: {value:"false"},
            units: {value:"ms"},
            reset: {value:""},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "trigger.png",
        label: function() {
            if (this.duration > 0) {
                return this.name|| this._("trigger.label.trigger")+" "+this.duration+this.units;
            }
            else {
                return this.name|| this._("trigger.label.trigger-block");
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-then-type").change(function() {
                if ($(this).val() == "block") {
                    $(".node-type-wait").hide();
                } else {
                    $(".node-type-wait").show();
                }
            });

            if (this.op1type === 'val') {
                $("#node-input-op1type").val('str');
            }
            if (this.op2type === 'val') {
                $("#node-input-op2type").val('str');
            }

            var optionNothing = {value:"nul",label:this._("trigger.output.nothing"),hasValue:false};
            var optionPayload = {value:"pay",label:this._("trigger.output.existing"),hasValue:false}

            var optionOriginalPayload = {value:"pay",label:this._("trigger.output.original"),hasValue:false}
            var optionLatestPayload = {value:"payl",label:this._("trigger.output.latest"),hasValue:false}

            $("#node-input-op1").typedInput({
                default: 'str',
                typeField: $("#node-input-op1type"),
                types:['flow','global','str','num','bool','json',
                    optionPayload,
                    optionNothing
                ]
            });
            $("#node-input-op2").typedInput({
                default: 'str',
                typeField: $("#node-input-op2type"),
                types:['flow','global','str','num','bool','json',
                    optionOriginalPayload,
                    optionLatestPayload,
                    optionNothing
                ]
            });

            if (this.duration == "0") {
                $("#node-then-type").val("block");
            } else {
                $("#node-then-type").val("wait");
            }
            $("#node-then-type").change();

            if (this.extend === "true" || this.extend === true) {
                $("#node-input-extend").prop("checked",true);
            } else {
                $("#node-input-extend").prop("checked",false);
            }

        },
        oneditsave: function() {
            if ($("#node-then-type").val() == "block") {
                $("#node-input-duration").val("0");
            }

        }
    });
</script>
<script type="text/x-red" data-help-name="trigger">
    <p>Creates two messages on the output separated by a timeout whenever <i>any</i> <code>msg</code> arrives on the input.</p>
    <p>For example, this can be used to toggle a Raspberry PI GPIO pin on and off.</p>
    <p>The two output states can be specified as can the duration of the timer.
    Either output can be set to a value, or templated from the inbound
    <code>msg</code> using mustache syntax. <pre>The payload is {{payload}}</pre></p>
    <p>If the <code>msg.payload</code> is an object then setting the output to
    <i>existing payload</i> will pass the complete payload object through.</p>
    <p>Optionally the timer can be extended by being retriggered... or not.</p>
    <p>By setting the first output to <i>nothing</i>, and selecting extend timer - a watchdog timer can be created.
    No output will happen as long as repeated inputs occur within the timeout period.</p>
    <p>Setting the timer to 0 creates an "infinite" timeout - the first output will happen but the second
    never will, and neither can the first be retriggered - so a true one shot.</p>
    <p>If a <code>msg.reset</code> property is present, or the <code>msg.payload</code>
    matches the optional reset value, any timeout currently in progress
    will be cleared and the second output will not happen.</p>
    <p>The blue status icon will be visible while the node is active.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="comment">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-comment"></i> <span data-i18n="comment.label.title"></span></label>
        <input type="text" id="node-input-name">
    </div>
    <div class="form-row" style="margin-bottom: 0px;">
        <label for="node-input-info" style="width: 100% !important;"><i class="fa fa-comments"></i> <span data-i18n="comment.label.body"></span></label>
        <input type="hidden" id="node-input-info" autofocus="autofocus">
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-info-editor"></div>
    </div>
    <div class="form-tips" data-i18n="[html]comment.tip"></div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('comment',{
        category: 'function',
        color:"#ffffff",
        defaults: {
            name: {value:""},
            info: {value:""}
        },
        inputs:0,
        outputs:0,
        icon: "comment.png",
        label: function() {
            return this.name||"";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        info: function() {
            return (this.name?"# "+this.name+"\n":"")+(this.info||"");
        },
        oneditprepare: function() {
            var that = this;
            this.editor = RED.editor.createEditor({
                id: 'node-input-info-editor',
                mode: 'ace/mode/markdown',
                value: $("#node-input-info").val()
            });
            this.editor.focus();
        },
        oneditsave: function() {
            $("#node-input-info").val(this.editor.getValue());
            delete this.editor;
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-text-editor-row)");
            var height = $("#dialog-form").height();
            for (var i=0;i<rows.size();i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-text-editor-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            $(".node-text-editor").css("height",height+"px");
            this.editor.resize();
        }
    });
</script>
<script type="text/x-red" data-help-name="comment">
    <p>A node you can use to add comments to your flows.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="unknown">
    <div class="form-tips"><span data-i18n="[html]unknown.tip"></span></div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('unknown',{
        category: 'unknown',
        color:"#fff0f0",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "",
        label: function() {
            return "("+this.name+")"||this._("unknown.label.unknown");
        },
        labelStyle: function() {
            return "node_label_unknown";
        }
    });
</script>
<script type="text/x-red" data-help-name="unknown">
    <p>This node is a type unknown to your installation of Node-RED.</p>
    <p><i>If you deploy with the node in this state, it's configuration will be preserved, but
    the flow will not start until the missing type is installed.</i></p>
    <p>It is possible this node type is already installed, but is missing a dependency. Check the Node-RED start-up log for
       any error messages associated with the missing node type. Use <b>npm install &lt;module&gt;</b> to install any missing modules
       and restart Node-RED and reimport the nodes.</p>
    <p>Otherwise, you should contact the author of the flow to obtain a copy of the missing node type.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="tls-config">
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-cert"><i class="fa fa-file-text-o"></i> <span data-i18n="tls.label.cert"></span></label>
        <input style="width: 60%;" type="text" id="node-config-input-cert" data-i18n="[placeholder]tls.placeholder.cert">
    </div>
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-key"><i class="fa fa-file-text-o"></i> <span data-i18n="tls.label.key"></span></label>
        <input style="width: 60%;" type="text" id="node-config-input-key" data-i18n="[placeholder]tls.placeholder.key">
    </div>
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-ca"><i class="fa fa-file-text-o"></i> <span data-i18n="tls.label.ca"></span></label>
        <input style="width: 60%;" type="text" id="node-config-input-ca" data-i18n="[placeholder]tls.placeholder.ca">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-config-input-verifyservercert" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-config-input-verifyservercert" style="width: 70%;" data-i18n="tls.label.verify-server-cert"></label>
    </div>
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input style="width: 60%;" type="text" id="node-config-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('tls-config',{
        category: 'config',
        defaults: {
            name: {value:""},
            cert: {value:"", validate: function(v) {
                var currentKey = $("#node-config-input-key").val();
                if (currentKey === undefined) {
                    currentKey = this.key;
                }
                return currentKey === '' || v != '';
            }},
            key: {value:"", validate: function(v) {
                var currentCert = $("#node-config-input-cert").val();
                if (currentCert === undefined) {
                    currentCert = this.cert;
                }
                return currentCert === '' || v != '';
            }},
            ca: {value:""},
            verifyservercert: {value: true}
        },
        label: function() {
            return this.name || this._("tls.tls");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
<script type="text/x-red" data-help-name="tls-config">
    <p>Configuration options for TLS connections.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="mqtt in">
    <div class="form-row">
        <label for="node-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
        <input type="text" id="node-input-broker">
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
        <input type="text" id="node-input-topic" data-i18n="[placeholder]common.label.topic">
    </div>
    <div class="form-row">
        <label for="node-input-qos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
        <select id="node-input-qos" style="width:125px !important">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('mqtt in',{
        category: 'input',
        defaults: {
            name: {value:""},
            topic: {value:"",required:true,validate: RED.validators.regex(/^(#$|(\+|[^+#]*)(\/(\+|[^+#]*))*(\/(\+|#|[^+#]*))?$)/)},
            qos: {value: "2"},
            broker: {type:"mqtt-broker", required:true}
        },
        color:"#d8bfd8",
        inputs:0,
        outputs:1,
        icon: "bridge.png",
        label: function() {
            return this.name||this.topic||"mqtt";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.qos === undefined) {
                $("#node-input-qos").val("2");
            }
        }
    });
</script>

<script type="text/x-red" data-template-name="mqtt out">
    <div class="form-row">
        <label for="node-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
        <input type="text" id="node-input-broker">
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
        <input type="text" id="node-input-topic" data-i18n="[placeholder]common.label.topic">
    </div>
    <div class="form-row">
        <label for="node-input-qos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
        <select id="node-input-qos" style="width:125px !important">
            <option value=""></option>
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
        </select>
        &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-input-retain" style="width:125px !important">
            <option value=""></option>
            <option value="false" data-i18n="mqtt.false"></option>
            <option value="true" data-i18n="mqtt.true"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="mqtt.tip"></span></div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('mqtt out',{
        category: 'output',
        defaults: {
            name: {value:""},
            topic: {value:""},
            qos: {value:""},
            retain: {value:""},
            broker: {type:"mqtt-broker", required:true}
        },
        color:"#d8bfd8",
        inputs:1,
        outputs:0,
        icon: "bridge.png",
        align: "right",
        label: function() {
            return this.name||this.topic||"mqtt";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

<script type="text/x-red" data-template-name="mqtt-broker">
    <div class="form-row">
        <ul style="background: #fff; min-width: 600px; margin-bottom: 20px;" id="node-config-mqtt-broker-tabs"></ul>
    </div>
    <div id="node-config-mqtt-broker-tabs-content" style="min-height: 170px;">
        <div id="mqtt-broker-tab-connection" style="display:none">
            <div class="form-row node-input-broker">
                <label for="node-config-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
                <input class="input-append-left" type="text" id="node-config-input-broker" placeholder="e.g. localhost" style="width: 40%;" >
                <label for="node-config-input-port" style="margin-left: 10px; width: 35px; "> <span data-i18n="mqtt.label.port"></span></label>
                <input type="text" id="node-config-input-port" data-i18n="[placeholder]mqtt.label.port" style="width:45px">
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-usetls" style="width: auto" data-i18n="mqtt.label.use-tls"></label>
                <div id="node-config-row-tls" class="hide">
                    <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-config-input-tls"><span data-i18n="mqtt.label.tls-config"></span></label><input style="width: 300px;" type="text" id="node-config-input-tls">
                </div>
            </div>
            <div class="form-row">
                <label for="node-config-input-clientid"><i class="fa fa-tag"></i> <span data-i18n="mqtt.label.clientid"></span></label>
                <input type="text" id="node-config-input-clientid" data-i18n="[placeholder]mqtt.placeholder.clientid">
            </div>
            <div class="form-row">
                <label for="node-config-input-keepalive" style="width: auto"><i class="fa fa-clock-o"></i> <span data-i18n="mqtt.label.keepalive"></span></label>
                <input type="text" id="node-config-input-keepalive" style="width: 50px">
                <input type="checkbox" id="node-config-input-cleansession" style="margin-left: 30px; height: 1em;display: inline-block; width: auto; vertical-align: middle;">
                <label for="node-config-input-cleansession" style="width: auto;" data-i18n="mqtt.label.cleansession"></label>
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-compatmode" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-compatmode" style="width: auto;" data-i18n="mqtt.label.compatmode"></label>
            </div>
        </div>
        <div id="mqtt-broker-tab-security" style="display:none">
            <div class="form-row">
                <label for="node-config-input-user"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
                <input type="text" id="node-config-input-user">
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password"></span></label>
                <input type="password" id="node-config-input-password">
            </div>
        </div>
        <div id="mqtt-broker-tab-birth" style="display:none">
            <div class="form-row">
                <label for="node-config-input-birthTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-birthTopic" data-i18n="[placeholder]mqtt.placeholder.birth-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-birthQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-birthQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-birthRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-birthPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-birthPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
        <div id="mqtt-broker-tab-will" style="display:none">
            <div class="form-row">
                <label for="node-config-input-willTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-willTopic" data-i18n="[placeholder]mqtt.placeholder.will-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-willQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-willQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-willRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-willPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-willPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('mqtt-broker',{
        category: 'config',
        defaults: {
            broker: {value:"",required:true},
            port: {value:1883,required:true,validate:RED.validators.number()},
            tls: {type:"tls-config",required: false},
            clientid: {value:"", validate: function(v) {
                    if ($("#node-config-input-clientid").length) {
                        // Currently editing the node
                        return $("#node-config-input-cleansession").is(":checked") || (v||"").length > 0;
                    } else {
                        return (this.cleansession===undefined || this.cleansession) || (v||"").length > 0;
                    }
                }},
            usetls: {value: false},
            verifyservercert: { value: false},
            compatmode: { value: true},
            keepalive: {value:60,validate:RED.validators.number()},
            cleansession: {value: true},
            willTopic: {value:""},
            willQos: {value:"0"},
            willRetain: {value:false},
            willPayload: {value:""},
            birthTopic: {value:""},
            birthQos: {value:"0"},
            birthRetain: {value:false},
            birthPayload: {value:""}
        },
        credentials: {
            user: {type:"text"},
            password: {type: "password"}
        },
        label: function() {
            var b = this.broker;
            if (b === "") { b = "undefined"; }
            return (this.clientid?this.clientid+"@":"")+b+":"+this.port;
        },
        oneditprepare: function () {
            var tabs = RED.tabs.create({
                id: "node-config-mqtt-broker-tabs",
                onchange: function(tab) {
                    $("#node-config-mqtt-broker-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });
            tabs.addTab({
                id: "mqtt-broker-tab-connection",
                label: this._("mqtt.tabs-label.connection")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-security",
                label: this._("mqtt.tabs-label.security")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-birth",
                label: this._("mqtt.tabs-label.birth")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-will",
                label: this._("mqtt.tabs-label.will")
            });
            setTimeout(function() { tabs.resize()},0);
            if (typeof this.cleansession === 'undefined') {
                this.cleansession = true;
                $("#node-config-input-cleansession").prop("checked",true);
            }
            if (typeof this.usetls === 'undefined') {
                this.usetls = false;
                $("#node-config-input-usetls").prop("checked",false);
            }
            if (typeof this.compatmode === 'undefined') {
                this.compatmode = true;
                $("#node-config-input-compatmode").prop('checked', true);
            }
            if (typeof this.keepalive === 'undefined') {
                this.keepalive = 15;
                $("#node-config-input-keepalive").val(this.keepalive);
            }
            if (typeof this.willQos === 'undefined') {
                this.willQos = "0";
                $("#node-config-input-willQos").val("0");
            }
            if (typeof this.birthQos === 'undefined') {
                this.birthQos = "0";
                $("#node-config-input-birthQos").val("0");
            }

            function updateTLSOptions() {
                if ($("#node-config-input-usetls").is(':checked')) {
                    $("#node-config-row-tls").show();
                } else {
                    $("#node-config-row-tls").hide();
                }
            }
            updateTLSOptions();
            $("#node-config-input-usetls").on("click",function() {
                updateTLSOptions();
            });
            var node = this;
            function updateClientId() {
                if ($("#node-config-input-cleansession").is(":checked")) {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid"));
                } else {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid-nonclean"));
                }
                $("#node-config-input-clientid").change();
            }
            setTimeout(updateClientId,0);
            $("#node-config-input-cleansession").on("click",function() {
                updateClientId();
            });
        },
        oneditsave: function() {
            if (!$("#node-config-input-usetls").is(':checked')) {
                $("#node-config-input-tls").val("");
            }
        }
    });
</script>
<script type="text/x-red" data-help-name="mqtt in">
    <p>Connects to a broker and subscribes to the specified topic.</p>
    <p>Outputs a message with the properties:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    <p><code>msg.payload</code> will be a String, unless it is detected as a binary buffer.</p>
</script><script type="text/x-red" data-help-name="mqtt out">
    <p>Connects to a MQTT broker and publishes messages.</p>
    <p><code>msg.payload</code> is used as the payload of the published message.
    If it contains an Object it will be converted to JSON before being sent.
    </p>
    <p>The topic used can be configured in the node or, if left blank, can be set
       by <code>msg.topic</code>.</p>
    <p>Likewise the QoS and retain values can be configured in the node or, if left
       blank, set by <code>msg.qos</code> and <code>msg.retain</code> respectively.
       By default, messages are published at QoS 0 with the retain flag set to false.</p>
</script><script type="text/x-red" data-help-name="mqtt-broker">
    <p>A minimum MQTT broker connection requires only a broker server address to be added to the default configuration.</p>
    <p>To secure the connection with SSL/TLS, a TLS Configuration must also be configured and selected.</p>
    <p>If you create a Client ID it must be unique to the broker you are connecting to.</p>
    <p>For more information about MQTT see the <a href="http://www.eclipse.org/paho/" target="_blank">Eclipse Paho</a> site.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="http in">
    <div class="form-row">
        <label for="node-input-method"><i class="fa fa-tasks"></i> <span data-i18n="httpin.label.method"></span></label>
        <select type="text" id="node-input-method" style="width:70%;">
        <option value="get">GET</option>
        <option value="post">POST</option>
        <option value="put">PUT</option>
        <option value="delete">DELETE</option>
        <option value="patch">PATCH</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-globe"></i> <span data-i18n="httpin.label.url"></span></label>
        <input id="node-input-url" type="text" placeholder="/url">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row row-swagger-doc">
        <label for="node-input-swaggerDoc"><i class="fa fa-file-text-o"></i> <span data-i18n="httpin.label.doc"></span></label>
        <input type="text" id="node-input-swaggerDoc">
    </div>
    <div id="node-input-tip" class="form-tips"><span data-i18n="httpin.tip.in"></span><code><span id="node-input-path"></span></code>.</div>
</script>



<script type="text/x-red" data-template-name="http response">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="[html]httpin.tip.res"></span></div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('http in',{
        category: 'input',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            url: {value:"",required:true},
            method: {value:"get",required:true},
            swaggerDoc: {type:"swagger-doc", required:false}
        },
        inputs:0,
        outputs:1,
        icon: "white-globe.png",
        label: function() {
            if (this.name) {
                return this.name;
            } else if (this.url) {
                var root = RED.settings.httpNodeRoot;
                if (root.slice(-1) != "/") {
                    root = root+"/";
                }
                if (this.url.charAt(0) == "/") {
                    root += this.url.slice(1);
                } else {
                    root += this.url;
                }
                return "["+this.method+"] "+root;
            } else {
                return "http";
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var root = RED.settings.httpNodeRoot;
            if (root.slice(-1) == "/") {
                root = root.slice(0,-1);
            }
            if (root == "") {
                $("#node-input-tip").hide();
            } else {
                $("#node-input-path").html(root);
                $("#node-input-tip").show();
            }
            if(!RED.nodes.getType("swagger-doc")){
                $('.row-swagger-doc').hide();
            }
        }

    });

    RED.nodes.registerType('http response',{
        category: 'output',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:0,
        align: "right",
        icon: "white-globe.png",
        label: function() {
            return this.name||"http";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
<script type="text/x-red" data-help-name="http in">
    <p>Provides an input node for http requests, allowing the creation of simple web services.</p>
    <p>The resulting message has the following properties:
        <ul>
            <li>msg.req : <a href="http://expressjs.com/api.html#req">http request</a></li>
            <li>msg.res : <a href="http://expressjs.com/api.html#res">http response</a></li>
        </ul>
    </p>
    <p>For POST/PUT requests, the body is available under <code>msg.req.body</code>. This
       uses the <a href="http://expressjs.com/api.html#bodyParser">Express bodyParser middleware</a> to parse the content to a JSON object.
    </p>
    <p>
       By default, this expects the body of the request to be url encoded:
       <pre>foo=bar&amp;this=that</pre>
    </p>
    <p>
       To send JSON encoded data to the node, the content-type header of the request must be set to
       <code>application/json</code>.
    </p>
    <p>
       <b>Note: </b>This node does not send any response to the http request.
       This should be done with a subsequent HTTP Response node.
    </p>

</script><script type="text/x-red" data-help-name="http response">
    <p>Sends responses back to http requests received from an HTTP Input node.</p>
    <p>The response can be customised using the following message properties:</p>
    <ul>
        <li><code>payload</code> is sent as the body of the response</li>
        <li><code>statusCode</code>, if set, is used as the response status code (default: 200)</li>
        <li><code>headers</code>, if set, should be an object containing field/value
        pairs to be added as response headers.</li>
        <li><code>cookies</code>, if set, can be used to set or delete cookies.
    </ul>
    <h3>Cookie handling</h3>
    <p>The <code>cookies</code> property must be an object of name/value pairs.
    The value can be either a string to set the value of the cookie with default
    options, or it can be an object of options.<p>
    <p>The following example sets two cookies - one called <code>name</code> with
    a value of <code>nick</code>, the other called <code>session</code> with a
    value of <code>1234</code> and an expiry set to 15 minutes.</p>
    <pre>
msg.cookies = {
    name: 'nick',
    session: {
        value: '1234',
        maxAge: 900000
    }
}</pre>
    <p>The valid options include:</p>
    <ul>
    <li><code>domain</code> - (String) domain name for the cookie</li>
    <li><code>expires</code> - (Date) expiry date in GMT. If not specified or set to 0, creates a session cookie</li>
    <li><code>maxAge</code> - (String) expiry date as relative to the current time in milliseconds</li>
    <li><code>path</code> - (String) path for the cookie. Defaults to /</li>
    <li><code>value</code> - (String) the value to use for the cookie</li>
    </ul>
    <p>To delete a cookie, set its <code>value</code> to <code>null</code>.</p>

</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="http request">
    <div class="form-row">
        <label for="node-input-method"><i class="fa fa-tasks"></i> <span data-i18n="httpin.label.method"></span></label>
        <select type="text" id="node-input-method" style="width:70%;">
        <option value="GET">GET</option>
        <option value="POST">POST</option>
        <option value="PUT">PUT</option>
        <option value="DELETE">DELETE</option>
        <option value="use" data-i18n="httpin.setby"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-globe"></i> <span data-i18n="httpin.label.url"></span></label>
        <input id="node-input-url" type="text" placeholder="http://">
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-usetls" style="width: auto" data-i18n="httpin.use-tls"></label>
        <div id="node-row-tls" class="hide">
            <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-input-tls"><span data-i18n="httpin.tls-config"></span></label><input type="text" style="width: 300px" id="node-input-tls">
        </div>
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-useAuth" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-useAuth" style="width: 70%;"><span data-i18n="httpin.basicauth"></span></label>
        <div style="margin-left: 20px" class="node-input-useAuth-row hide">
            <div class="form-row">
                <label for="node-input-user"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
                <input type="text" id="node-input-user">
            </div>
            <div class="form-row">
                <label for="node-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password"></span></label>
                <input type="password" id="node-input-password">
            </div>
        </div>
    </div>


    <div class="form-row">
        <label for="node-input-ret"><i class="fa fa-arrow-left"></i> <span data-i18n="httpin.label.return"></span></label>
        <select type="text" id="node-input-ret" style="width:70%;">
        <option value="txt" data-i18n="httpin.utf8"></option>
        <option value="bin" data-i18n="httpin.binary"></option>
        <option value="obj" data-i18n="httpin.json"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips" id="tip-json" hidden><span data-i18n="httpin.tip.req"></span></div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('http request',{
        category: 'function',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            method:{value:"GET"},
            ret: {value:"txt"},
            url:{value:""},
            tls: {type:"tls-config",required: false}
        },
        credentials: {
            user: {type:"text"},
            password: {type: "password"}
        },
        inputs:1,
        outputs:1,
        icon: "white-globe.png",
        label: function() {
            return this.name||this._("httpin.httpreq");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-useAuth").change(function() {
                if ($(this).is(":checked")) {
                    $(".node-input-useAuth-row").show();
                } else {
                    $(".node-input-useAuth-row").hide();
                    $('#node-input-user').val('');
                    $('#node-input-password').val('');
                }
            });
            if (this.credentials.user || this.credentials.has_password) {
                $('#node-input-useAuth').prop('checked', true);
            } else {
                $('#node-input-useAuth').prop('checked', false);
            }
            $("#node-input-useAuth").change();

            function updateTLSOptions() {
                if ($("#node-input-usetls").is(':checked')) {
                    $("#node-row-tls").show();
                } else {
                    $("#node-row-tls").hide();
                }
            }
            if (this.tls) {
                $('#node-input-usetls').prop('checked', true);
            } else {
                $('#node-input-usetls').prop('checked', false);
            }
            updateTLSOptions();
            $("#node-input-usetls").on("click",function() {
                updateTLSOptions();
            });
            $("#node-input-ret").change(function() {
                if ($("#node-input-ret").val() === "obj") {
                    $("#tip-json").show();
                } else {
                    $("#tip-json").hide();
                }
            });
        },
        oneditsave: function() {
            if (!$("#node-input-usetls").is(':checked')) {
                $("#node-input-tls").val("_ADD_");
            }
        }
    });
</script>
<script type="text/x-red" data-help-name="http request">
    <p>Provides a node for making http requests.</p>
    <p>The URL and HTTP method can be configured in the node, if they are left blank they should be set in an incoming message on <code>msg.url</code> and <code>msg.method</code>:</p>
    <ul>
        <li><code>url</code>, if set, is used as the url of the request. Must start with http: or https:</li>
        <li><code>method</code>, if set, is used as the HTTP method of the request.
        Must be one of <code>GET</code>, <code>PUT</code>, <code>POST</code>, <code>PATCH</code> or <code>DELETE</code> (default: GET)</li>
        <li><code>headers</code>, if set, should be an object containing field/value
        pairs to be added as request headers</li>
        <li><code>payload</code> is sent as the body of the request</li>
    </ul>
    <p>When configured within the node, the URL property can contain <a href="http://mustache.github.io/mustache.5.html" target="_blank">mustache-style</a> tags. These allow the
    url to be constructed using values of the incoming message. For example, if the url is set to
    <code>example.com/{{{topic}}}</code>, it will have the value of <code>msg.topic</code> automatically inserted.
    Using {{{...}}} prevents mustache from escaping characters like / & etc.</p>
    <p>
    The output message contains the following properties:
    <ul>
        <li><code>payload</code> is the body of the response</li>
        <li><code>statusCode</code> is the status code of the response, or the error code if the request could not be completed</li>
        <li><code>headers</code> is an object containing the response headers</li>
        <li><code>responseUrl</code> is the url of the server that responds</li>
    </ul>
    <p><b>Note</b>: If you need to configure a proxy please add <b>http_proxy=...</b> to your environment variables and restart Node-RED.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!-- WebSocket Input Node -->
<script type="text/x-red" data-template-name="websocket in">
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-dot-circle-o"></i> <span data-i18n="websocket.label.type"></span></label>
        <select id="node-input-mode">
            <option value="server" data-i18n="websocket.listenon"></option>
            <option value="client" data-i18n="websocket.connectto"></option>
        </select>
    </div>
    <div class="form-row" id="websocket-server-row">
        <label for="node-input-server"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.path"></span></label>
        <input type="text" id="node-input-server">
    </div>
    <div class="form-row" id="websocket-client-row">
        <label for="node-input-client"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.url"></span></label>
        <input type="text" id="node-input-client">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>



<script type="text/javascript">

(function() {

    function ws_oneditprepare() {
        $("#websocket-client-row").hide();
        $("#node-input-mode").change(function() {
            if ( $("#node-input-mode").val() === 'client') {
                $("#websocket-server-row").hide();
                $("#websocket-client-row").show();
            }
            else {
                $("#websocket-server-row").show();
                $("#websocket-client-row").hide();
            }
        });

        if (this.client) {
            $("#node-input-mode").val('client').change();
        }
        else {
            $("#node-input-mode").val('server').change();
        }
    }

    function ws_oneditsave() {
        if ($("#node-input-mode").val() === 'client') {
            $("#node-input-server").append('<option value="">Dummy</option>');
            $("#node-input-server").val('');
        }
        else {
            $("#node-input-client").append('<option value="">Dummy</option>');
            $("#node-input-client").val('');
        }
    }

    function ws_label() {
        var nodeid = (this.client)?this.client:this.server;
        var wsNode = RED.nodes.node(nodeid);
        return this.name||(wsNode?"[ws] "+wsNode.label():"websocket");
    }

    function ws_validateserver() {
        if ($("#node-input-mode").val() === 'client' || (this.client && !this.server)) {
            return true;
        }
        else {
            return RED.nodes.node(this.server) != null;
        }
    }

    function ws_validateclient() {
        if ($("#node-input-mode").val() === 'client' || (this.client && !this.server)) {
            return RED.nodes.node(this.client) != null;
        }
        else {
            return true;
        }
    }

    RED.nodes.registerType('websocket in',{
        category: 'input',
        defaults: {
            name: {value:""},
            server: {type:"websocket-listener", validate: ws_validateserver},
            client: {type:"websocket-client", validate: ws_validateclient}
        },
        color:"rgb(215, 215, 160)",
        inputs:0,
        outputs:1,
        icon: "white-globe.png",
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        label: ws_label,
        oneditsave: ws_oneditsave,
        oneditprepare: ws_oneditprepare
    });

    RED.nodes.registerType('websocket out',{
        category: 'output',
        defaults: {
            name: {value:""},
            server: {type:"websocket-listener", validate: ws_validateserver},
            client: {type:"websocket-client", validate: ws_validateclient}
        },
        color:"rgb(215, 215, 160)",
        inputs:1,
        outputs:0,
        icon: "white-globe.png",
        align: "right",
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        label: ws_label,
        oneditsave: ws_oneditsave,
        oneditprepare: ws_oneditprepare
    });

    RED.nodes.registerType('websocket-listener',{
        category: 'config',
        defaults: {
            path: {value:"",required:true,validate:RED.validators.regex(/^((?!\/debug\/ws).)*$/)},
            wholemsg: {value:"false"}
        },
        inputs:0,
        outputs:0,
        label: function() {
            var root = RED.settings.httpNodeRoot;
            if (root.slice(-1) != "/") {
                root = root+"/";
            }
            if (this.path.charAt(0) == "/") {
                root += this.path.slice(1);
            } else {
                root += this.path;
            }
            return root;
        },
        oneditprepare: function() {
            var root = RED.settings.httpNodeRoot;
            if (root.slice(-1) == "/") {
                root = root.slice(0,-1);
            }
            if (root === "") {
                $("#node-config-ws-tip").hide();
            } else {
                $("#node-config-ws-path").html(root);
                $("#node-config-ws-tip").show();
            }
        }
    });

    RED.nodes.registerType('websocket-client',{
        category: 'config',
        defaults: {
            path: {value:"",required:true,validate:RED.validators.regex(/^((?!\/debug\/ws).)*$/)},
            wholemsg: {value:"false"}
        },
        inputs:0,
        outputs:0,
        label: function() {
            return this.path;
        }
    });

})();
</script>

<!-- WebSocket out Node -->
<script type="text/x-red" data-template-name="websocket out">
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-dot-circle-o"></i> <span data-i18n="websocket.label.type"></span></label>
        <select id="node-input-mode">
            <option value="server" data-i18n="websocket.listenon"></option>
            <option value="client" data-i18n="websocket.connectto"></option>
        </select>
    </div>
    <div class="form-row" id="websocket-server-row">
        <label for="node-input-server"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.path"></span></label>
        <input type="text" id="node-input-server">
    </div>
    <div class="form-row" id="websocket-client-row">
        <label for="node-input-client"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.url"></span></label>
        <input type="text" id="node-input-client">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>



<!-- WebSocket Server configuration node -->
<script type="text/x-red" data-template-name="websocket-listener">
    <div class="form-row">
        <label for="node-config-input-path"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.path"></span></label>
        <input id="node-config-input-path" type="text" placeholder="/ws/example">
    </div>
    <div class="form-row">
        <label for="node-config-input-wholemsg">&nbsp;</label>
        <select type="text" id="node-config-input-wholemsg" style="width: 70%;">
            <option value="false" data-i18n="websocket.payload"></option>
            <option value="true" data-i18n="websocket.message"></option>
        </select>
    </div>
    <div class="form-tips">
        <span data-i18n="[html]websocket.tip.path1"></span>
        <p id="node-config-ws-tip"><span data-i18n="[html]websocket.tip.path2"></span><code><span id="node-config-ws-path"></span></code>.</p>
    </div>
</script>



<!-- WebSocket Client configuration node -->
<script type="text/x-red" data-template-name="websocket-client">
    <div class="form-row">
        <label for="node-config-input-path"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.url"></span></label>
        <input id="node-config-input-path" type="text" placeholder="ws://example.com/ws">
    </div>
    <div class="form-row">
        <label for="node-config-input-wholemsg">&nbsp;</label>
        <select type="text" id="node-config-input-wholemsg" style="width: 70%;">
            <option value="false" data-i18n="websocket.payload"></option>
            <option value="true" data-i18n="websocket.message"></option>
        </select>
    </div>
    <div class="form-tips">
        <p><span data-i18n="[html]websocket.tip.url1"></span></p>
        <span data-i18n="[html]websocket.tip.url2"></span>
    </div>
</script>


<script type="text/x-red" data-help-name="websocket in">
    <p>WebSocket input node.</p>
    <p>By default, the data received from the WebSocket will be in <code>msg.payload</code>.
    The socket can be configured to expect a properly formed JSON string, in which
    case it will parse the JSON and send on the resulting object as the entire message.</p>
</script><script type="text/x-red" data-help-name="websocket out">
    <p>WebSocket out node.</p>
    <p>By default, <code>msg.payload</code> will be sent over the WebSocket. The socket
    can be configured to encode the entire <code>msg</code> object as a JSON string and send that
    over the WebSocket.</p>

    <p>If the message arriving at this node started at a WebSocket In node, the message
    will be sent back to the client that triggered the flow. Otherwise, the message
    will be broadcast to all connected clients.</p>
    <p>If you want to broadcast a message that started at a WebSocket In node, you
    should delete the <code>msg._session</code> property within the flow.</p>
</script><script type="text/x-red" data-help-name="websocket-listener">
   <p>This configuration node creates a WebSocket Server endpoint using the specified path.</p>
</script><script type="text/x-red" data-help-name="websocket-client">
   <p>This configuration node connects a WebSocket client to the specified URL.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="switch">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row">
        <label data-i18n="switch.label.property"></label>
        <input type="text" id="node-input-property" style="width: 70%"/>
    </div>
    <div class="form-row node-input-rule-container-row">
        <ol id="node-input-rule-container"></ol>
    </div>
    <div class="form-row">
        <select id="node-input-checkall" style="width:100%; margin-right:5px;">
            <option value="true" data-i18n="switch.checkall"></option>
            <option value="false" data-i18n="switch.stopfirst"></option>
        </select>
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('switch', {
        color: "#E2D96E",
        category: 'function',
        defaults: {
            name: {value:""},
            property: {value:"payload", required:true, validate: RED.validators.typedInput("propertyType")},
            propertyType: { value:"msg" },
            rules: {value:[{t:"eq", v:""}]},
            checkall: {value:"true", required:true},
            outputs: {value:1}
        },
        inputs: 1,
        outputs: 1,
        icon: "switch.png",
        label: function() {
            return this.name||"switch";
        },
        oneditprepare: function() {
            var node = this;
            var previousValueType = {value:"prev",label:this._("inject.previous"),hasValue:false};

            $("#node-input-property").typedInput({default:this.propertyType||'msg',types:['msg','flow','global','jsonata']});
            var operators = [
                {v:"eq",t:"=="},
                {v:"neq",t:"!="},
                {v:"lt",t:"<"},
                {v:"lte",t:"<="},
                {v:"gt",t:">"},
                {v:"gte",t:">="},
                {v:"btwn",t:this._("switch.rules.btwn")},
                {v:"cont",t:this._("switch.rules.cont")},
                {v:"regex",t:this._("switch.rules.regex")},
                {v:"true",t:this._("switch.rules.true")},
                {v:"false",t:this._("switch.rules.false")},
                {v:"null",t:this._("switch.rules.null")},
                {v:"nnull",t:this._("switch.rules.nnull")},
                {v:"else",t:this._("switch.rules.else")}
            ];

            var andLabel = this._("switch.and");
            var caseLabel = this._("switch.ignorecase");

            function resizeRule(rule) {
                var newWidth = rule.width();
                var selectField = rule.find("select");
                var type = selectField.val()||"";
                var valueField = rule.find(".node-input-rule-value");
                var btwnField1 = rule.find(".node-input-rule-btwn-value");
                var btwnField2 = rule.find(".node-input-rule-btwn-value2");
                var selectWidth;
                if (type.length < 4) {
                    selectWidth = 60;
                } else if (type === "regex") {
                    selectWidth = 147;
                } else {
                    selectWidth = 120;
                }
                selectField.width(selectWidth);
                if (type === "btwn") {
                    btwnField1.typedInput("width",(newWidth-selectWidth-70));
                    btwnField2.typedInput("width",(newWidth-selectWidth-70));
                } else {
                    if (type === "true" || type === "false" || type === "null" || type === "nnull" || type === "else") {
                        // valueField.hide();
                    } else {
                        valueField.typedInput("width",(newWidth-selectWidth-70));
                    }
                }
            }

            $("#node-input-rule-container").css('min-height','250px').css('min-width','450px').editableList({
                addItem: function(container,i,opt) {
                    if (!opt.hasOwnProperty('r')) {
                        opt.r = {};
                    }
                    var rule = opt.r;
                    if (!rule.hasOwnProperty('t')) {
                        rule.t = 'eq';
                    }
                    var row = $('<div></div>').appendTo(container);
                    var row2 = $('<div></div>',{style:"padding-top: 5px; padding-left: 175px;"}).appendTo(container);
                    var row3 = $('<div></div>',{style:"padding-top: 5px; padding-left: 102px;"}).appendTo(container);
                    var selectField = $('<select></select>',{style:"width:120px; margin-left: 5px; text-align: center;"}).appendTo(row);
                    for (var d in operators) {
                        selectField.append($("<option></option>").val(operators[d].v).text(operators[d].t));
                    }
                    var valueField = $('<input/>',{class:"node-input-rule-value",type:"text",style:"margin-left: 5px;"}).appendTo(row).typedInput({default:'str',types:['msg','flow','global','str','num','jsonata',previousValueType]});
                    var btwnValueField = $('<input/>',{class:"node-input-rule-btwn-value",type:"text",style:"margin-left: 5px;"}).appendTo(row).typedInput({default:'num',types:['msg','flow','global','str','num','jsonata',previousValueType]});
                    var btwnAndLabel = $('<span></span>',{class:"node-input-rule-btwn-label"}).text(" "+andLabel+" ").appendTo(row3);
                    var btwnValue2Field = $('<input/>',{class:"node-input-rule-btwn-value2",type:"text",style:"margin-left:2px;"}).appendTo(row3).typedInput({default:'num',types:['msg','flow','global','str','num','jsonata',previousValueType]});
                    var finalspan = $('<span></span>',{style:"float: right;margin-top: 6px;"}).appendTo(row);
                    finalspan.append(' &#8594; <span class="node-input-rule-index">'+(i+1)+'</span> ');
                    var caseSensitive = $('<input/>',{id:"node-input-rule-case-"+i,class:"node-input-rule-case",type:"checkbox",style:"width:auto;vertical-align:top"}).appendTo(row2);
                    $('<label></label>',{for:"node-input-rule-case-"+i,style:"margin-left: 3px;"}).text(caseLabel).appendTo(row2);
                    selectField.change(function() {
                        resizeRule(container);
                        var type = selectField.val();
                        if (type === "btwn") {
                            valueField.typedInput('hide');
                            btwnValueField.typedInput('show');
                        } else {
                            btwnValueField.typedInput('hide');
                            if (type === "true" || type === "false" || type === "null" || type === "nnull" || type === "else") {
                                valueField.typedInput('hide');
                            } else {
                                valueField.typedInput('show');
                            }
                        }
                        if (type === "regex") {
                            row2.show();
                            row3.hide();
                        } else if (type === "btwn"){
                            row2.hide();
                            row3.show();
                        } else {
                            row2.hide();
                            row3.hide();
                        }
                    });
                    selectField.val(rule.t);
                    if (rule.t == "btwn") {
                        btwnValueField.typedInput('value',rule.v);
                        btwnValueField.typedInput('type',rule.vt||'num');
                        btwnValue2Field.typedInput('value',rule.v2);
                        btwnValue2Field.typedInput('type',rule.v2t||'num');
                    } else if (typeof rule.v != "undefined") {
                        valueField.typedInput('value',rule.v);
                        valueField.typedInput('type',rule.vt||'str');
                    }
                    if (rule.case) {
                        caseSensitive.prop('checked',true);
                    } else {
                        caseSensitive.prop('checked',false);
                    }
                    selectField.change();
                },
                removeItem: function(opt) {
                    if (opt.hasOwnProperty('i')) {
                        var removedList = $("#node-input-rule-container").data('removedList')||[];
                        removedList.push(opt.i);
                        $("#node-input-rule-container").data('removedList',removedList);
                    }

                    var rules = $("#node-input-rule-container").editableList('items');
                    rules.each(function(i) { $(this).find(".node-input-rule-index").html(i+1); });
                },
                resizeItem: resizeRule,
                sortItems: function(rules) {
                    var rules = $("#node-input-rule-container").editableList('items');
                    rules.each(function(i) { $(this).find(".node-input-rule-index").html(i+1); });
                },
                sortable: true,
                removable: true
            });

            for (var i=0;i<this.rules.length;i++) {
                var rule = this.rules[i];
                $("#node-input-rule-container").editableList('addItem',{r:rule,i:i});
            }
        },
        oneditsave: function() {
            var rules = $("#node-input-rule-container").editableList('items');
            var ruleset;
            var node = this;
            node.rules = [];
            var changedOutputs = {};
            var removedList = $("#node-input-rule-container").data('removedList')||[];
            removedList.forEach(function(i) {
                changedOutputs[i] = -1;
            });
            rules.each(function(i) {
                var ruleData = $(this).data('data');
                var rule = $(this);
                var type = rule.find("select").val();
                var r = {t:type};
                if (!(type === "true" || type === "false" || type === "null" || type === "nnull" || type === "else")) {
                    if (type === "btwn") {
                        r.v = rule.find(".node-input-rule-btwn-value").typedInput('value');
                        r.vt = rule.find(".node-input-rule-btwn-value").typedInput('type');
                        r.v2 = rule.find(".node-input-rule-btwn-value2").typedInput('value');
                        r.v2t = rule.find(".node-input-rule-btwn-value2").typedInput('type');
                    } else {
                        r.v = rule.find(".node-input-rule-value").typedInput('value');
                        r.vt = rule.find(".node-input-rule-value").typedInput('type');
                    }
                    if (type === "regex") {
                        r.case = rule.find(".node-input-rule-case").prop("checked");
                    }
                }
                if (ruleData.hasOwnProperty('i')) {
                    if (ruleData.i !== i) {
                        changedOutputs[ruleData.i] = i;
                    }
                }
                node.rules.push(r);
            });
            this._outputs = changedOutputs;
            this.outputs = node.rules.length;
            this.propertyType = $("#node-input-property").typedInput('type');
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-input-rule-container-row)");
            var height = size.height;
            for (var i=0;i<rows.size();i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-input-rule-container-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            $("#node-input-rule-container").editableList('height',height);
        }
    });
</script>
<script type="text/x-red" data-help-name="switch">
    <p>A node to route messages based on property values.</p>
    <p>When a message arrives, the selected property is evaluated against each
    of the defined rules. The message is then sent to the output of <i>all</i>
    rules that pass.</p>
    <p><b>Note</b>: the <i>otherwise</i> rule applies as a "not any of" the rules preceding it.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="change">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row" style="margin-bottom:0;">
        <label><i class="fa fa-list"></i> <span data-i18n="change.label.rules"></span></label>
    </div>
    <div class="form-row node-input-rule-container-row">
        <ol id="node-input-rule-container"></ol>
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('change', {
        color: "#E2D96E",
        category: 'function',
        defaults: {
            name: {value:""},
            rules:{value:[{t:"set",p:"payload",pt:"msg",to:"",tot:"str"}]},
            // legacy
            action: {value:""},
            property: {value:""},
            from: {value:""},
            to: {value:""},
            reg: {value:false}
        },
        inputs: 1,
        outputs: 1,
        icon: "swap.png",
        label: function() {
            if (this.name) {
                return this.name;
            }
            if (!this.rules) {
                if (this.action === "replace") {
                    return this._("change.label.set",{property:"msg."+this.property});
                } else if (this.action === "change") {
                    return this._("change.label.change",{property:"msg."+this.property});
                } else if (this.action === "move") {
                    return this._("change.label.move",{property:"msg."+this.property});
                } else {
                    return this._("change.label.delete",{property:"msg."+this.property});
                }
            } else {
                if (this.rules.length == 1) {
                    if (this.rules[0].t === "set") {
                        return this._("change.label.set",{property:(this.rules[0].pt||"msg")+"."+this.rules[0].p});
                    } else if (this.rules[0].t === "change") {
                        return this._("change.label.change",{property:(this.rules[0].pt||"msg")+"."+this.rules[0].p});
                    } else if (this.rules[0].t === "move") {
                        return this._("change.label.move",{property:(this.rules[0].pt||"msg")+"."+this.rules[0].p});
                    } else {
                        return this._("change.label.delete",{property:(this.rules[0].pt||"msg")+"."+this.rules[0].p});
                    }
                } else {
                    return this._("change.label.changeCount",{count:this.rules.length});
                }
            }
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            var set = this._("change.action.set");
            var change = this._("change.action.change");
            var del = this._("change.action.delete");
            var move = this._("change.action.move");
            var to = this._("change.action.to");
            var search = this._("change.action.search");
            var replace = this._("change.action.replace");
            var regex = this._("change.label.regex");

            function resizeRule(rule) {
                var newWidth = rule.width();
                rule.find('.red-ui-typedInput').typedInput("width",newWidth-150);

            }
            $('#node-input-rule-container').css('min-height','300px').css('min-width','450px').editableList({
                addItem: function(container,i,opt) {
                    var rule = opt;
                    if (!rule.hasOwnProperty('t')) {
                        rule = {t:"set",p:"payload",to:"",tot:"str"};
                    }
                    if (rule.t === "change" && rule.re) {
                        rule.fromt = 're';
                        delete rule.re;
                    }
                    if (rule.t === "set" && !rule.tot) {
                        if (rule.to.indexOf("msg.") === 0 && !rule.tot) {
                            rule.to = rule.to.substring(4);
                            rule.tot = "msg";
                        } else {
                            rule.tot = "str";
                        }
                    }
                    if (rule.t === "move" && !rule.tot) {
                        rule.tot = "msg";
                    }

                    var row1 = $('<div></div>').appendTo(container);
                    var row2 = $('<div></div>',{style:"margin-top:8px;"}).appendTo(container);
                    var row3 = $('<div></div>',{style:"margin-top:8px;"}).appendTo(container);
                    var row4 = $('<div></div>',{style:"margin-top:8px;"}).appendTo(container);

                    var selectField = $('<select></select>',{class:"node-input-rule-type",style:"width:110px; margin-right:10px;"}).appendTo(row1);
                    var selectOptions = [{v:"set",l:set},{v:"change",l:change},{v:"delete",l:del},{v:"move",l:move}];
                    for (var i=0; i<4; i++) {
                        selectField.append($("<option></option>").val(selectOptions[i].v).text(selectOptions[i].l));
                    }

                    var propertyName = $('<input/>',{class:"node-input-rule-property-name",type:"text"})
                        .appendTo(row1)
                        .typedInput({types:['msg','flow','global']});

                    $('<div></div>',{style:"display:inline-block;text-align:right; width:120px; padding-right:10px; box-sizing:border-box;"})
                        .text(to)
                        .appendTo(row2);
                    var propertyValue = $('<input/>',{class:"node-input-rule-property-value",type:"text"})
                        .appendTo(row2)
                        .typedInput({default:'str',types:['msg','flow','global','str','num','bool','json','date','jsonata']});

                    var row3_1 = $('<div></div>').appendTo(row3);
                    $('<div></div>',{style:"display:inline-block;text-align:right; width:120px; padding-right:10px; box-sizing:border-box;"})
                        .text(search)
                        .appendTo(row3_1);
                    var fromValue = $('<input/>',{class:"node-input-rule-property-search-value",type:"text"})
                        .appendTo(row3_1)
                        .typedInput({default:'str',types:['msg','flow','global','str','re','num','bool']});

                    var row3_2 = $('<div></div>',{style:"margin-top:8px;"}).appendTo(row3);
                    $('<div></div>',{style:"display:inline-block;text-align:right; width:120px; padding-right:10px; box-sizing:border-box;"})
                        .text(replace)
                        .appendTo(row3_2);
                    var toValue = $('<input/>',{class:"node-input-rule-property-replace-value",type:"text"})
                        .appendTo(row3_2)
                        .typedInput({default:'str',types:['msg','flow','global','str','num','bool','json']});

                    $('<div></div>',{style:"display:inline-block;text-align:right; width:120px; padding-right:10px; box-sizing:border-box;"})
                        .text(to)
                        .appendTo(row4);
                    var moveValue = $('<input/>',{class:"node-input-rule-property-move-value",type:"text"})
                        .appendTo(row4)
                        .typedInput({default:'msg',types:['msg','flow','global']});

                    selectField.change(function() {
                        var width = $("#node-input-rule-container").width();
                        var type = $(this).val();
                        if (type == "set") {
                            row2.show();
                            row3.hide();
                            row4.hide();
                        } else if (type == "change") {
                            row2.hide();
                            row3.show();
                            row4.hide();
                        } else if (type == "delete") {
                            row2.hide();
                            row3.hide();
                            row4.hide();
                        } else if (type == "move") {
                            row2.hide();
                            row3.hide();
                            row4.show();
                        }
                        resizeRule(container);
                    });

                    selectField.val(rule.t);
                    propertyName.typedInput('value',rule.p);
                    propertyName.typedInput('type',rule.pt);
                    propertyValue.typedInput('value',rule.to);
                    propertyValue.typedInput('type',rule.tot);
                    moveValue.typedInput('value',rule.to);
                    moveValue.typedInput('type',rule.tot);
                    fromValue.typedInput('value',rule.from);
                    fromValue.typedInput('type',rule.fromt);
                    toValue.typedInput('value',rule.to);
                    toValue.typedInput('type',rule.tot);
                    selectField.change();

                    var newWidth = $("#node-input-rule-container").width();
                    resizeRule(container);
                },
                resizeItem: resizeRule,
                removable: true,
                sortable: true
            });

            if (!this.rules) {
                var rule = {
                    t:(this.action=="replace"?"set":this.action),
                    p:this.property,
                    pt:"msg"
                }

                if ((rule.t === "set")||(rule.t === "move")) {
                    rule.to = this.to;
                } else if (rule.t === "change") {
                    rule.from = this.from;
                    rule.to = this.to;
                    rule.re = this.reg;
                }

                delete this.to;
                delete this.from;
                delete this.reg;
                delete this.action;
                delete this.property;

                this.rules = [rule];
            }

            for (var i=0; i<this.rules.length; i++) {
                var rule = this.rules[i];
                $("#node-input-rule-container").editableList('addItem',rule);
            }
        },
        oneditsave: function() {
            var rules = $("#node-input-rule-container").editableList('items');
            var ruleset;
            var node = this;
            node.rules= [];
            rules.each(function(i) {
                var rule = $(this);
                var type = rule.find(".node-input-rule-type").val();
                var r = {
                    t:type,
                    p:rule.find(".node-input-rule-property-name").typedInput('value'),
                    pt:rule.find(".node-input-rule-property-name").typedInput('type')
                };
                if (type === "set") {
                    r.to = rule.find(".node-input-rule-property-value").typedInput('value');
                    r.tot = rule.find(".node-input-rule-property-value").typedInput('type');
                } else if (type === "move") {
                    r.to = rule.find(".node-input-rule-property-move-value").typedInput('value');
                    r.tot = rule.find(".node-input-rule-property-move-value").typedInput('type');
                } else if (type === "change") {
                    r.from = rule.find(".node-input-rule-property-search-value").typedInput('value');
                    r.fromt = rule.find(".node-input-rule-property-search-value").typedInput('type');
                    r.to = rule.find(".node-input-rule-property-replace-value").typedInput('value');
                    r.tot = rule.find(".node-input-rule-property-replace-value").typedInput('type');
                }
                node.rules.push(r);
            });
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-input-rule-container-row)");
            var height = size.height;
            for (var i=0; i<rows.size(); i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-input-rule-container-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));

            $("#node-input-rule-container").editableList('height',height);
        }
    });
</script>
<script type="text/x-red" data-help-name="change">
    <p>Set, change, delete or move properties of a message, flow context or global context.</p>
    <p>The node can specify multiple rules that will be applied in turn.</p>
    <p>The available operations are:</p>
    <ul>
        <li><b>Set</b> - set a property. The value can be a variety of different types, or
            can be taken from an existing message or context property.</li>
        <li><b>Change</b> - search &amp; replace parts of the property. If regular expressions
            are enabled, the <b>replace with</b> property can include capture groups, for
            example <code>$1</code>. Replace will only change the <b>type</b> if there
            is a complete match.</li>
        <li><b>Delete</b> - delete a property.</li>
        <li><b>Move</b> - move or rename a property.</li>
    </ul>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="range">
    <div class="form-row">
        <label for="node-input-action"><i class="fa fa-dot-circle-o"></i> <span data-i18n="range.label.action"></span></label>
        <select id="node-input-action" style="width:70%;">
            <option value="scale" data-i18n="range.scale.payload"></option>
            <option value="clamp" data-i18n="range.scale.limit"></option>
            <option value="roll" data-i18n="range.scale.wrap"></option>
        </select>
    </div>
    <br/>
    <div class="form-row"><i class="fa fa-sign-in"></i> <span data-i18n="range.label.inputrange"></span>:</div>
    <div class="form-row"><label></label>
        <span data-i18n="range.label.from"></span>: <input type="text" id="node-input-minin" data-i18n="[placeholder]range.placeholder.min" style="width:100px;"/>
        &nbsp;&nbsp;<span data-i18n="range.label.to"></span>: <input type="text" id="node-input-maxin" data-i18n="[placeholder]range.placeholder.maxin" style="width:100px;"/>
    </div>
    <div class="form-row"><i class="fa fa-sign-out"></i> <span data-i18n="range.label.resultrange"></span>:</div>
    <div class="form-row"><label></label>
        <span data-i18n="range.label.from"></span>: <input type="text" id="node-input-minout" data-i18n="[placeholder]range.placeholder.min" style="width:100px;"/>
        &nbsp;&nbsp;<span data-i18n="range.label.to"></span>: <input type="text" id="node-input-maxout" data-i18n="[placeholder]range.placeholder.maxout" style="width:100px;"/>
    </div>
    <br/>
    <div class="form-row"><label></label>
        <input type="checkbox" id="node-input-round" style="display: inline-block; width: auto; vertical-align: top;">
        <label style="width: auto;" for="node-input-round"><span data-i18n="range.label.roundresult"></span></label></input>
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips" id="node-tip"><span data-i18n="range.tip"></span></div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('range', {
        color: "#E2D96E",
        category: 'function',
        defaults: {
            minin: {value:"",required:true,validate:RED.validators.number()},
            maxin: {value:"",required:true,validate:RED.validators.number()},
            minout: {value:"",required:true,validate:RED.validators.number()},
            maxout: {value:"",required:true,validate:RED.validators.number()},
            action: {value:"scale"},
            round: {value:false},
            name: {value:""}
        },
        inputs: 1,
        outputs: 1,
        icon: "range.png",
        label: function() {
            return this.name || "range";
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        }
    });
</script>
<script type="text/x-red" data-help-name="range">
    <p>A simple function node to remap numeric input values to another scale.</p>
    <p>Currently only does a linear scaling.</p>
    <p><b>Note:</b> This only operates on <b>numbers</b>. Anything else will try to be made into a number and rejected if that fails.</p>
    <p><i>Scale and limit to target range</i> means that the result will never be outside the range specified within the result range.</p>
    <p><i>Scale and wrap within the target range</i> means that the result will essentially be a "modulo-style" wrap-around within the result range.</p>
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="split">
    <div class="form-row">
        <label for="node-input-splt"><i class="fa fa-scissors"></i> Split</label>
        <input type="text" id="node-input-splt" placeholder="character to split strings on : e.g. \n">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('split',{
        category: 'function',
        color:"#E2D96E",
        defaults: {
            name: {value:""},
            splt: {value:"\\n"}
        },
        inputs:1,
        outputs:1,
        icon: "split.png",
        label: function() {
            return this.name||"split";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

<script type="text/x-red" data-template-name="join">
    <div class="form-row">
        <label>Mode</label>
        <select id="node-input-mode" style="width:200px;">
            <option value="auto">automatic</option>
            <option value="custom">manual</option>
        </select>
    </div>
    <div class="node-row-custom">
        <div class="form-row node-row-property">
            <label>Combine each </label>
            <input type="text" id="node-input-property" style="width:70%;">
            <input type="hidden" id="node-input-propertyType">
        </div>
        <div class="form-row">
            <label>to create </label>
            <select id="node-input-build" style="width:200px;">
                <option id="node-input-build-string" value="string">a String</option>
                <option value="array">an Array</option>
                <option value="object">a key/value Object</option>
                <option value="merged">a merged Object</option>
            </select>
        </div>
        <div class="form-row node-row-key">
            <label style="vertical-align: top; margin-top: 7px;">using</label>
            <div style="display:inline-block">
                <input type="text" id="node-input-key"  style="width:300px;">
                <div style="margin-top: 7px;">as the property key</div>
            </div>
        </div>
        <div class="form-row node-row-joiner">
            <label for="node-input-joiner">joined using</label>
            <input type="text" id="node-input-joiner" style="width: 40px">
        </div>

        <div class="form-row node-row-trigger">
            <label style="width: auto;">Send the message:</label>
            <ul>
                <li style="height: 40px;">
                    <label style="width: 280px;" for="node-input-count">After a fixed number of messages:</label> <input id="node-input-count" placeholder="count" type="text" style="width: 75px;">
                </li>
                <li style="height: 40px;">
                    <label style="width: 280px;" for="node-input-timeout">After a timeout following the first message:</label> <input id="node-input-timeout" placeholder="seconds" type="text" style="width: 75px;">
                </li>
                <li style="height: 40px;">
                    <label style="width: auto; padding-top: 6px;">After a message with the <code>msg.complete</code> property set</label>
                </li>
            </ul>
        </div>
    </div>
    <div class="form-tips form-tips-auto hide">This mode assumes this node is either
    paired with a <i>split</i> node or the received messages will have a properly
    configured <code>msg.parts</code> property.</div>

</script>



<script type="text/javascript">
    RED.nodes.registerType('join',{
        category: 'function',
        color:"#E2D96E",
        defaults: {
            name: {value:""},
            mode: {value:"auto"},
            build: { value:"string"},
            property: { value: "payload", validate: RED.validators.typedInput("propertyType")},
            propertyType: { value:"msg"},
            key: {value:"topic"},
            joiner: { value:"\\n"},
            timeout: {value:""},
            count: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "join.png",
        label: function() {
            return this.name||"join";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-mode").change(function(e) {
                var val = $(this).val();
                $(".node-row-custom").toggle(val==='custom');
                $(".form-tips-auto").toggle(val==='auto');
            });

            $("#node-input-build").change(function(e) {
                var val = $(this).val();
                $(".node-row-key").toggle(val==='object');
                $(".node-row-joiner").toggle(val==='string');
                $(".node-row-trigger").toggle(val!=='auto');
                if (val === 'string') {
                    $("#node-input-property").typedInput('types',['msg']);
                } else {
                    $("#node-input-property").typedInput('types',['msg', {value:"full",label:"complete message",hasValue:false}]);
                }
            })

            $("#node-input-property").typedInput({
                typeField: $("#node-input-propertyType"),
                types:['msg', {value:"full",label:"complete message",hasValue:false}]
            })
            $("#node-input-key").typedInput({
                types:['msg', {value:"merge",label:"",hasValue: false}]
            })

            $("#node-input-build").change();
            $("#node-input-mode").change();
        }
    });
</script>
<script type="text/x-red" data-help-name="split">
    <p>A function that splits <code>msg.payload</code> into multiple messages.</p>
    <p>The behaviour is determined by the type of <code>msg.payload</code>:</p>
    <ul>
        <li><b>string</b> - a message is sent for each part of the string after it is split using the specified character, by default a newline (<code>\n</code>).
        <li><b>array</b> - a message is sent for each element of the array</li>
        <li><b>object</b> - a message is sent for each key/value pair of the object. <code>msg.parts.key</code> is set to the key of the property.</li>
    </ul>
    <p>Each message is sent with the <code>msg.parts</code> property set. This is
    an object that provides any subsequent <i>join</i> node the necessary information
    for it to reassemble the messages back into a single one. The object has the following
    properties:</p>
    <ul>
        <li><b>id</b> - an identifier for the group of messages</li>
        <li><b>index</b> - the position within the group</li>
        <li><b>count</b> - the total number of messages in the group</li>
        <li><b>type</b> - the type of message - string/array/object</li>
        <li><b>ch</b> - for a string, the character used to split</li>
        <li><b>key</b> - for an object, the key of the property this message was created from</li>
    </ul>
</script><script type="text/x-red" data-help-name="join">
    <p>A function that joins a sequence of messages into a single message.</p>
    <p>When paired with the <b>split</b> node, it will automatically join the messages
    to reverse the split that was performed.</p>
    <p>The node can join either a specific property of each received message or,
    if the output type is not string, the entire message.</p>
    <p>The type of the resulting message property can be:</p>
    <ul>
        <li>a <b>string</b> - created by joining the property of each message with the specified join character.</li>
        <li>an <b>array</b>.</li>
        <li>a <b>key/value object</b> - created by using a property of each message to determine the key under which
        the required value is stored.</li>
        <li>a <b>merged object</b> - created by merging the property of each message under a single object.</li>
    </ul>
    The other properties of the output message are taken from the last message received before the result is sent.</p>
    <p>A <i>count</i> can be set for how many messages should be received before generating the output message</p>
    <p>A <i>timeout</i> can be set to trigger sending the new message using whatever has been received so far.</p>
    <p>If a message is received with the <b>msg.complete</b> property set, the output message is sent.</p>
    <p>The automatic behaviour relies on the received messages to have <b>msg.parts</b> set. The split node generates
    this property, but can be manually created. It has the following properties:</p>
   <ul>
       <li><b>id</b> - an identifier for the group of messages</li>
       <li><b>index</b> - the position within the group</li>
       <li><b>count</b> - the total number of messages in the group</li>
       <li><b>type</b> - the type of message - string/array/object</li>
       <li><b>ch</b> - for a string, the character used to split</li>
       <li><b>key</b> - for an object, the key of the property this message was created from</li>
   </ul>
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="csv">
    <div class="form-row">
        <label for="node-input-temp"><i class="fa fa-list"></i> <span data-i18n="csv.label.columns"></span></label>
        <input type="text" id="node-input-temp" data-i18n="[placeholder]csv.placeholder.columns">
    </div>
    <div class="form-row">
        <label for="node-input-select-sep"><i class="fa fa-text-width"></i> <span data-i18n="csv.label.separator"></span></label>
            <select style="width: 150px" id="node-input-select-sep">
                <option value="," data-i18n="csv.separator.comma"></option>
                <option value="\t" data-i18n="csv.separator.tab"></option>
                <option value=" " data-i18n="csv.separator.space"></option>
                <option value=";" data-i18n="csv.separator.semicolon"></option>
                <option value=":" data-i18n="csv.separator.colon"></option>
                <option value="#" data-i18n="csv.separator.hashtag"></option>
                <option value="" data-i18n="csv.separator.other"></option>
           </select>
           <input style="width: 40px;" type="text" id="node-input-sep" pattern=".">
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <hr align="middle"/>
    <div class="form-row">
        <label style="width: 100%;"><i class="fa fa-gears"></i> <span data-i18n="csv.label.c2o"></span></label>
        <label style="margin-left: 10px; margin-right: -10px;"><i class="fa fa-sign-in"></i> <span data-i18n="csv.label.input"></span></label>
        <input style="width: 30px" type="checkbox" id="node-input-hdrin"><label style="width: auto;" for="node-input-hdrin"><span data-i18n="csv.label.firstrow"></span></span>
    </div>
    <div class="form-row">
        <label style="margin-left: 10px; margin-right: -10px;"><i class="fa fa-sign-out"></i> <span data-i18n="csv.label.output"></span></label>
        <select type="text" id="node-input-multi" style="width: 250px;">
            <option value="one" data-i18n="csv.output.row"></option>
            <option value="mult" data-i18n="csv.output.array"></option>
        </select>
    </div>
    <hr align="middle"/>
    <div class="form-row">
        <label style="width: 100%;"><i class="fa fa-gears"></i> <span data-i18n="csv.label.o2c"></span></label>
        <label style="margin-left: 10px; margin-right: -10px;"><i class="fa fa-sign-in"></i> <span data-i18n="csv.label.output"></span></label>
        <input style="width: 30px" type="checkbox" id="node-input-hdrout"><label style="width: auto;" for="node-input-hdrout"><span data-i18n="csv.label.includerow"></span></span>
    </div>
    <div class="form-row">
        <label style="margin-left: 10px; margin-right: -10px;"><i class="fa fa-align-left"></i> <span data-i18n="csv.label.newline"></span></label>
        <select style="width: 150px" id="node-input-ret">
            <option value='\n' data-i18n="csv.newline.linux"></option>
            <option value='\r' data-i18n="csv.newline.mac"></option>
            <option value='\r\n' data-i18n="csv.newline.windows"></option>
       </select>
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('csv',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""},
            sep: {value:',',required:true,validate:RED.validators.regex(/^.{1,2}$/)},
            //quo: {value:'"',required:true},
            hdrin: {value:""},
            hdrout: {value:""},
            multi: {value:"one",required:true},
            ret: {value:'\\n'},
            temp: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "parser-csv.png",
        label: function() {
            return this.name||"csv";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.sep == "," || this.sep == "\\t" || this.sep == ";" || this.sep == ":" || this.sep == " " || this.sep == "#") {
                $("#node-input-select-sep").val(this.sep);
                $("#node-input-sep").hide();
            } else {
                $("#node-input-select-sep").val("");
                $("#node-input-sep").val(this.sep);
                $("#node-input-sep").show();
            }
            $("#node-input-select-sep").change(function() {
                var v = $("#node-input-select-sep").val();
                $("#node-input-sep").val(v);
                if (v == "") {
                    $("#node-input-sep").val("");
                    $("#node-input-sep").show().focus();
                } else {
                    $("#node-input-sep").hide();
                }
            });
        }
    });
</script>
<script type="text/x-red" data-help-name="csv">
    <p>A function that parses the <code>msg.payload</code> to convert CSV to/from a javascript object.
    Places the result in the payload.</p>
    <p>If the input is a string it tries to parse it as CSV and creates a javascript object.</p>
    <p>If the input is a javascript object it tries to build a CSV string.</p>
    <p>If the input is a simple array the output is just a CSV generated from that array.</p>
    <p>If the input is an array of arrays, or an array of objects, a multiple-line CSV is created.</p>
    <p>The columns template should contain an ordered list of column headers. For CSV input these become the property names.
    For CSV output these specify the properties to extract from the object and the order for the CSV.</p>
    <p>If the input is an array then the columns template does not matter, but can be used to generate a row of column titles.</p>
    <p><b>Note:</b> the columns should always be specified comma separated - even if another separator is chosen for the data.</p>
    </script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="html">
    <div class="form-row">
        <label for="node-input-tag"><i class="fa fa-filter"></i> <span data-i18n="html.label.select"></span></label>
        <input type="text" id="node-input-tag" placeholder="h1">
    </div>
    <div class="form-row">
        <label for="node-input-ret"><i class="fa fa-sign-out"></i> <span data-i18n="html.label.output"></span></label>
        <select id="node-input-ret" style="width:70%">
            <option value="html" data-i18n="html.output.html"></option>
            <option value="text" data-i18n="html.output.text"></option>
            <option value="attr" data-i18n="html.output.attr"></option>
            <!-- <option value="val">return the value from a form element</option> -->
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-as">&nbsp;</label>
        <select id="node-input-as" style="width:70%">
            <option value="single" data-i18n="html.format.single"></option>
            <option value="multi" data-i18n="html.format.multi"></option>
        </select>
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" style="width:70%" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="[html]html.tip"></span></div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('html',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""},
            tag: {value:""},
            ret: {value:"html"},
            as: {value:"single"}
        },
        inputs:1,
        outputs:1,
        icon: "parser-html.png",
        label: function() {
            return this.name||this.tag||"html";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
<script type="text/x-red" data-help-name="html">
    <p>Extracts elements from an html document held in <code>msg.payload</code> using a selector.</p>
    <p>If left blank the selector may be set dynamically by passing in <code>msg.select</code> along with the <code>msg.payload</code>.
    <p>The selector uses <a href="https://github.com/cheeriojs/cheerio/blob/master/Readme.md" target="_blank">Cheerio</a>
     which uses the <a href="https://github.com/fb55/CSSselect#user-content-supported-selectors" target="_blank">CSS selector</a> syntax.</p>
    <p>The result can be either a single message with a payload containing an array of the matched elements, or multiple
       messages that each contain a matched element.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="json">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('json',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "parser-json.png",
        label: function() {
            return this.name||"json";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
<script type="text/x-red" data-help-name="json">
    <p>A function that parses the <code>msg.payload</code> to convert a JSON string to/from a javascript object. Places the result back into the payload.</p>
    <p>If the input is a JSON string it tries to parse it to a javascript object.</p>
    <p>If the input is a javascript object it creates a JSON string.</p>
</script><!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="xml">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row" id="advanced">
    </div>
    <div id="advanced-options">
        <div class="form-row">
            <i class="fa fa-key"></i> <span data-i18n="xml.label.represent"></span> <input type="text" id="node-input-attr" style="text-align:center; width:40px" placeholder="$">
        </div>
        <div class="form-row">
            <i class="fa fa-key"></i> <span data-i18n="xml.label.prefix"></span> <input type="text" id="node-input-chr" style="text-align:center; width:40px" placeholder="_">
        </div>
        <div class="form-tips"><span data-i18n="xml.tip"></span></div>
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('xml',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""},
            attr: {value:""},
            chr: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "parser-xml.png",
        label: function() {
            return this.name||"xml";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var showadvanced = showadvanced || true;
            var advanced = this._("xml.label.advanced");
            var showall = function() {
                showadvanced = !showadvanced;
                if (showadvanced) {
                    $("#advanced-options").show();
                    $("#advanced").html('<label for="node-advanced" style="width:200px !important"><i class="fa fa-minus-square"></i> '+advanced+'</label>');
                }
                else {
                    $("#advanced-options").hide();
                    $("#advanced").html('<label for="node-advanced" style="width:200px !important"><i class="fa fa-plus-square"></i> '+advanced+' ...</label>');
                }
            };
            showall();
            $("#advanced").click( function() { showall(); });
        }
    });
</script>
<script type="text/x-red" data-help-name="xml">
    <p>A function that parses the <code>msg.payload</code> to convert xml to/from a javascript object. Places the result in the payload.</p>
    <p>If the input is a string it tries to parse it as XML and creates a javascript object.</p>
    <p>If the input is a javascript object it tries to build an XML string.</p>
    <p>You can also pass in a <code>msg.options</code> object to override all the multitude of parameters. See
    <a href="https://github.com/Leonidas-from-XIV/node-xml2js/blob/master/README.md#options" target="_blank">the xml2js docs</a>
     for more information.</p>
     <p>If set, options in the edit dialogue override those passed in on the msg.options object.</p>
</script>
<script type="text/x-red" data-template-name="yaml">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('yaml',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "parser-yaml.png",
        label: function() {
            return this.name||"yaml";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
<script type="text/x-red" data-help-name="yaml">
    <p>A function that parses the <code>msg.payload</code> to convert a YAML string to/from a javascript object. Places the result back into the payload.</p>
    <p>If the input is a YAML string it tries to parse it to a javascript object.</p>
    <p>If the input is a javascript object it creates a YAML string.</p>
</script>
<script type="text/x-red" data-template-name="e-mail">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-envelope"></i> <span data-i18n="email.label.to"></span></label>
        <input type="text" id="node-input-name" placeholder="email@address.com">
    </div>
    <!-- <div class="form-row">
        <label for="node-input-pin"><i class="fa fa-asterisk"></i> Service</label>
        <select type="text" id="node-input-pin" style="width: 150px;">
            <option value="-" disabled> </option>
            <option value="DynectEmail">DynectEmail</option>
            <option value="Gmail">Gmail</option>
            <option value="hot.ee">hot.ee</option>
            <option value="Hotmail">Hotmail</option>
            <option value="iCloud">iCloud</option>
            <option value="mail.ee">mail.ee</option>
            <option value="Mail.Ru">Mail.Ru</option>
            <option value="Mailgun">Mailgun</option>
            <option value="Mailjet">Mailjet</option>
            <option value="Mandrill">Mandrill</option>
            <option value="Postmark">Postmark</option>
            <option value="QQ">QQ</option>
            <option value="QQex">QQex</option>
            <option value="SendGrid">SendGrid</option>
            <option value="SendCloud">SendCloud</option>
            <option value="SES">SES</option>
            <option value="Yahoo">Yahoo</option>
            <option value="yandex">yandex</option>
            <option value="Zoho">Zoho</option>
         </select>
    </div> -->
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-globe"></i> <span data-i18n="email.label.server"></span></label>
        <input type="text" id="node-input-server" placeholder="smtp.gmail.com">
    </div>
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-random"></i> <span data-i18n="email.label.port"></span></label>
        <input type="text" id="node-input-port" placeholder="465">
    </div>
    <div class="form-row">
        <label for="node-input-userid"><i class="fa fa-user"></i> <span data-i18n="email.label.userid"></span></label>
        <input type="text" id="node-input-userid">
    </div>
    <div class="form-row">
        <label for="node-input-password"><i class="fa fa-lock"></i> <span data-i18n="email.label.password"></span></label>
        <input type="password" id="node-input-password">
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-dname"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-dname" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-tips" id="node-tip"><span data-i18n="[html]email.tip.cred"></span></div>
</script>



<script type="text/javascript">
(function() {
    RED.nodes.registerType('e-mail',{
        category: 'social-output',
        color:"#c7e9c0",
        defaults: {
            server: {value:"smtp.gmail.com",required:true},
            port: {value:"465",required:true},
            name: {value:""},
            dname: {value:""}
        },
        credentials: {
            userid: {type:"text"},
            password: {type: "password"},
            global: { type:"boolean"}
        },
        inputs:1,
        outputs:0,
        icon: "envelope.png",
        align: "right",
        label: function() {
            return this.dname||this.name||"email";
        },
        labelStyle: function() {
            return (this.dname||!this.topic)?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.credentials.global) {
                $('#node-tip').show();
            } else {
                $('#node-tip').hide();
            }
        }
    });
})();
</script>


<script type="text/x-red" data-template-name="e-mail in">
    <div class="form-row node-input-repeat">
        <label for="node-input-repeat"><i class="fa fa-repeat"></i> <span data-i18n="email.label.repeat"></span></label>
        <input type="text" id="node-input-repeat" style="width: 80px"> <span data-i18n="email.label.seconds">seconds</span>
    </div>
    <div class="form-row">
        <label for="node-input-protocol"><i class="fa fa-envelope"></i> <span data-i18n="email.label.protocol"></span></label>
        <select type="text" id="node-input-protocol">
            <option value="IMAP">IMAP</option>
            <option value="POP3">POP3</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-useSSL"><i class="fa fa-lock"></i> <span data-i18n="email.label.useSSL"></span></label>
        <input type="checkbox" id="node-input-useSSL" style="width: auto;">
    </div>
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-globe"></i> <span data-i18n="email.label.server"></span></label>
        <input type="text" id="node-input-server" placeholder="imap.gmail.com">
    </div>
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-random"></i> <span data-i18n="email.label.port"></span></label>
        <input type="text" id="node-input-port" placeholder="993">
    </div>
    <div class="form-row">
        <label for="node-input-userid"><i class="fa fa-user"></i> <span data-i18n="email.label.userid"></span></label>
        <input type="text" id="node-input-userid">
    </div>
    <div class="form-row">
        <label for="node-input-password"><i class="fa fa-lock"></i> <span data-i18n="email.label.password"></span></label>
        <input type="password" id="node-input-password">
    </div>
    <div class="form-row node-input-box">
        <label for="node-input-box"><i class="fa fa-inbox"></i> <span data-i18n="email.label.folder"></span></label>
        <input type="text" id="node-input-box">
    </div>
    <div class="form-row node-input-disposition">
            <label for="node-input-disposition"><i class="fa fa-trash"></i> <span data-i18n="email.label.disposition"></span></label>
        <select type="text" id="node-input-disposition">
            <option value="None" selected="selected">None</option>
            <option value="Read">Mark Read</option>
            <option value="Delete">Delete</option>
        </select>
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <script>
        var checkPorts = function() {
            var currentPort = $("#node-input-port").val();
            if (currentPort === "143" || currentPort === "993" || currentPort === "110" || currentPort == "995") {
                if ($("#node-input-useSSL").prop("checked") === true) {
                    $("#node-input-port").val($("#node-input-protocol").val() === "IMAP"?"993":"995");
                } else {
                    $("#node-input-port").val($("#node-input-protocol").val() === "IMAP"?"143":"110");
                }
            }
        };

        $("#node-input-useSSL").change(function(x, y) {
          console.log("useSSL: x="+ JSON.stringify(x) + ", y=" + y);
          console.log("Value: " + $("#node-input-useSSL").prop("checked"));
          checkPorts();
        });

        $("#node-input-protocol").change(function() {
            var protocol = $("#node-input-protocol").val();
            if (protocol === "IMAP") {
                $(".node-input-box").show();
                $(".node-input-disposition").show();
            } else {
                $(".node-input-box").hide();
                $(".node-input-disposition").hide();
            }
            checkPorts();
        });
    </script>




<script type="text/javascript">
(function() {
    RED.nodes.registerType('e-mail in',{
        category: 'social-input',
        color:"#c7e9c0",
        defaults: {
            name: {value:""},
            protocol: {value: "IMAP", required:true}, // Which protocol to use to connect to the mail server ("IMAP" or "POP3")
            server: {value:"imap.gmail.com",required:true},
            useSSL: {value: true},
            port: {value:"993",required:true},
            box: {value:"INBOX"}, // For IMAP, The mailbox to process
            disposition: { value: "Read" }, // For IMAP, the disposition of the read email
            repeat: {value:"300",required:true}
        },
        credentials: {
            userid: {type:"text"},
            password: {type: "password"},
            global: { type:"boolean"}
        },
        inputs:0,
        outputs:1,
        icon: "envelope.png",
        label: function() {
            return this.name||"email";
        },
        labelStyle: function() {
            return (this.name||!this.topic)?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.credentials.global) {
                $('#node-tip').show();
            } else {
                $('#node-tip').hide();
            }
            if (typeof this.box === 'undefined') {
                $("#node-input-box").val("INBOX");
                this.box = "INBOX";
            }
        }
    });
})();
</script>
<script type="text/x-red" data-help-name="e-mail">
    <p>Sends the <code>msg.payload</code> as an email, with a subject of <code>msg.topic</code>.</p>
    <p>The default message recipient can be configured in the node, if it is left
    blank it should be set using the <code>msg.to</code> property of the incoming message. If left blank
    you can also specify <code>msg.cc</code> and/or <code>msg.bcc</code> properties.</p>
    <p>You may optionally set <code>msg.from</code> in the payload which will override the <code>userid</code>
    default value.</p>
    <p>The payload can be html format.</p>
    <p>If the payload is a binary buffer then it will be converted to an attachment.
    The filename should be set using <code>msg.filename</code>. Optionally <code>msg.description</code> can be added for the body text.</p>
    <p>Alternatively you may provide <code>msg.attachments</code> which should contain an array of one or
    more attachments in <a href="https://www.npmjs.com/package/nodemailer#attachments" target="_new">nodemailer</a> format.</p>
    <p>If required by your recipient you may also pass in a <code>msg.envelope</code> object, typically containing extra from and to properties.</p>
    <p>Note: uses SMTP with SSL to port 465.</p>
</script><script type="text/x-red" data-help-name="e-mail in">
    <p>Repeatedly gets a <b>single email</b> from an IMAP server and forwards on as a msg if not already seen.</p>
    <p>The subject is loaded into <code>msg.topic</code> and <code>msg.payload</code> is the plain text body.
       If there is text/html then that is returned in <code>msg.html</code>. <code>msg.from</code> and <code>msg.date</code> are also set if you need them.</p>
    <p>Additionally <code>msg.header</code> contains the complete header object including
    <i>to</i>, <i>cc</i> and other potentially useful properties.</p>
    <p>Uses the imap module.</p>
    <p><b>Note:</b> this node <i>only</i> gets the most recent single email from the inbox, so set the repeat (polling) time appropriately.</p>
    <p>Note: uses IMAP with SSL to port 993.</p>
    <p>Any attachments supplied in the incoming email can be found in the <code>msg.attachments</code> property.  This will be an array of objects where
    each object represents a specific attachments.  The format of the object is:</p>

<pre>
{
  contentType:        // The MIME content description
  fileName:           // A suggested file name associated with this attachment
  transferEncoding:   // How was the original email attachment encodded?
  contentDisposition: // Unknown
  generatedFileName:  // A suggested file name associated with this attachment
  contentId:          // A unique generated ID for this attachment
  checksum:           // A checksum against the data
  length:             // Size of data in bytes
  content:            // The actual content of the data contained in a Node.js Buffer object
                      // We can turn this into a base64 data string with content.toString('base64')
}
</pre>
<p>For POP3, the default port numbers are 110 for plain TCP and 995 for SSL.  For IMAP the port numbers are 143 for plain TCP and 993 for SSL.</p>

</script>
<script type="text/x-red" data-template-name="feedparse">
    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-globe"></i> <span data-i18n="feedparse.label.feedurl"></span></label>
        <input type="text" id="node-input-url">
    </div>
    <div class="form-row">
        <label for="node-input-interval"><i class="fa fa-repeat"></i> <span data-i18n="feedparse.label.refresh"></span></label>
        <input type="text" id="node-input-interval" style="width: 50px"> <span data-i18n="feedparse.label.minutes"></span>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('feedparse',{
        category: 'advanced-input',
        color:"#C0DEED",
        defaults: {
            name: {value:""},
            url: {value:"", required:true},
            interval: { value:15, required: true,validate:RED.validators.number()}
        },
        inputs:0,
        outputs:1,
        icon: "feed.png",
        label: function() {
            return this.name||this.url;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
<script type="text/x-red" data-help-name="feedparse">
    <p>Monitors an RSS/atom feed for new entries.</p>
    <p>The <code>msg.topic</code> contains the original article link. The <code>msg.payload</code>
    contains the description, and <code>msg.article</code> contains the complete article object,
    which has properties such as <code>.title</code>, <code>.summary</code>, <code>.date</code> and so on.</p>
</script>
<script type="text/x-red" data-template-name="rbe">
    <div class="form-row">
        <label for="node-input-func"><i class="fa fa-wrench"></i> <span data-i18n="rbe.label.func"></span></label>
        <select type="text" id="node-input-func" style="width:74%;">
            <option value="rbe" data-i18n="rbe.opts.rbe"></option>
            <option value="deadband" data-i18n="rbe.opts.deadband"></option>
            <option value="narrowband" data-i18n="rbe.opts.narrowband"></option>
        </select>
    </div>
    <div class="form-row" id="node-bandgap">
        <label for="node-input-gap">&nbsp;</label>
        <input type="text" id="node-input-gap" data-i18n="[placeholder]rbe.placeholder.bandgap" style="width:70px;">
        <select type="text" id="node-input-inout" style="width:55%;">
            <option value="out" data-i18n="rbe.opts.out"></option>
            <option value="in" data-i18n="rbe.opts.in"></option>
        </select>
    </div>
    <div class="form-row" id="node-startvalue">
        <label for="node-input-start"><i class="fa fa-thumb-tack"></i> <span data-i18n="rbe.label.start"></span></label>
        <input type="text" id="node-input-start" data-i18n="[placeholder]rbe.placeholder.start" style="width:71%;">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="rbe.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]rbe.label.name" style="width:71%;">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType("rbe", {
        color:"#E2D96E",
        category: 'function',
        defaults: {
            name: {value:""},
            func: {value:"rbe"},
            gap: {value:"",validate:RED.validators.regex(/^(\d*[.]*\d*|)(%|)$/)},
            start: {value:""},
            inout: {value:"out"}
        },
        inputs:1,
        outputs:1,
        icon: "rbe.png",
        label: function() {
            return this.name||this.func||"rbe";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            //$( "#node-input-gap" ).spinner({min:0});
            if ($("#node-input-inout").val() === null) {
                $("#node-input-inout").val("out");
            }
            $("#node-input-func").on("change",function() {
                if ($("#node-input-func").val() === "rbe") {
                    $("#node-bandgap").hide();
                } else {
                    $("#node-bandgap").show();
                }
                if ($("#node-input-func").val() === "narrowband") {
                    $("#node-startvalue").show();
                } else {
                    $("#node-startvalue").hide();
                }
            });
        }
    });
</script>
<script type="text/x-red" data-help-name="rbe">
    <p>Report by Exception node - only passes on data if it has changed.</p>
    <p>The node can either block until the <code>msg.payload</code> is
    different to the previous one - <b>rbe</b> mode. This works on numbers, strings, and simple objects.</p>
    <p>Or it can block until the value changes by a specified amount - <b>deadband</b> mode.</p>
    <p>In deadband mode the incoming payload must contain a parseable <i>number</i> and is
    output only if greater than + or - the <i>band gap</i> away from a previous value.</p>
    <p>Deadband also supports % - only sends if the input differs by more than x% of the original value.</p>
    <p>It can also ignore outlier values - <b>narrowband</b> mode.</p>
    <p>In narrowband mode the incoming payload is blocked if it is more than + or - the band gap
    away from the previous value. Useful for ignoring outliers from a faulty sensor for example.</p>
    <p>Both Deadband and Narrowband allow comparison against either the <i>previous valid output value</i>, thus
    ignoring any values out of range; or the <i>previous input value</i>, which resets the set point, thus allowing
    gradual drift (deadband), or a step change (narrowband).</p>
    <p><b>Note:</b> This works on a per <code>msg.topic</code> basis. This means that a single rbe node can
    handle multiple topics at the same time.</p>
</script>
<script type="text/x-red" data-template-name="twitter-credentials">
    <div class="form-row" id="node-config-twitter-row"></div>
    <input type="hidden" id="node-config-input-screen_name">
</script>

<script type="text/javascript">
(function() {
    var twitterConfigNodeId = null;
    var twitterConfigNodeIntervalId = null;

    RED.nodes.registerType('twitter-credentials',{
        category: 'config',
        defaults: {
            screen_name: {value:""}
        },
        credentials: {
            screen_name: {type:"text"},
            access_token: {type: "password"},
            access_token_secret: {type:"password"}
        },
        label: function() {
            return this.screen_name;
        },
        exportable: false,
        oneditprepare: function() {
            var twitterConfigNodeId = this.id;
            var clickhere = this._("twitter.label.clickhere");
            var twitterID = this._("twitter.label.twitter-id");
            function showTwitterAuthStart() {
                var pathname = document.location.pathname;
                if (pathname.slice(-1) != "/") {
                    pathname += "/";
                }
                var callback = encodeURIComponent(location.protocol+"//"+location.hostname+":"+location.port+pathname+"twitter-credentials/"+twitterConfigNodeId+"/auth/callback");
                $("#node-config-dialog-ok").button("disable");
                $("#node-config-twitter-row").html('<div style="text-align: center; margin-top: 20px; "><a class="btn" id="node-config-twitter-start" href="twitter-credentials/'+twitterConfigNodeId+'/auth?callback='+callback+'" target="_blank">'+clickhere+'</a></div>');
                $("#node-config-twitter-start").click(function() {
                    twitterConfigNodeIntervalId = window.setTimeout(pollTwitterCredentials,2000);
                });
            }
            function updateTwitterScreenName(sn) {
                $("#node-config-input-screen_name").val(sn);
                $("#node-config-twitter-row").html('<label><i class="fa fa-user"></i> '+twitterID+'</label><span class="input-xlarge uneditable-input">'+sn+'</span>');
            }
            function pollTwitterCredentials(e) {
                $.getJSON('credentials/twitter-credentials/'+twitterConfigNodeId,function(data) {
                    if (data.screen_name) {
                        updateTwitterScreenName(data.screen_name);
                        twitterConfigNodeIntervalId = null;
                        $("#node-config-dialog-ok").button("enable");
                    } else {
                        twitterConfigNodeIntervalId = window.setTimeout(pollTwitterCredentials,2000);
                    }
                })
            }
            if (!this.screen_name || this.screen_name === "") {
                showTwitterAuthStart();
            } else {
                if (this.credentials.screen_name) {
                    updateTwitterScreenName(this.credentials.screen_name);
                } else {
                    showTwitterAuthStart();
                }
            }
        },
        oneditsave: function() {
            if (twitterConfigNodeIntervalId) {
                window.clearTimeout(twitterConfigNodeIntervalId);
            }
        },
        oneditcancel: function(adding) {
            if (twitterConfigNodeIntervalId) {
                window.clearTimeout(twitterConfigNodeIntervalId);
            }
        }
    });
})();
</script>

<script type="text/x-red" data-template-name="twitter in">
    <div class="form-row">
        <label for="node-input-twitter"><i class="fa fa-user"></i> <span data-i18n="twitter.label.twitter-id"></span></label>
        <input type="text" id="node-input-twitter">
    </div>
    <div class="form-row">
        <label for="node-input-user"><i class="fa fa-search"></i> <span data-i18n="twitter.label.search"></span></label>
        <select type="text" id="node-input-user" style="display: inline-block; vertical-align: middle; width:60%;">
            <option value="false" data-i18n="twitter.search.public"></option>
            <option value="true" data-i18n="twitter.search.follow"></option>
            <option value="user" data-i18n="twitter.search.user"></option>
            <option value="dm" data-i18n="twitter.search.direct"></option>
            <option value="event" data-i18n="twitter.search.events"></option>
        </select>
    </div>
    <div class="form-row" id="node-input-tags-row">
        <label for="node-input-tags"><i class="fa fa-tags"></i> <span id="node-input-tags-label" data-i18n="twitter.label.for"></span></label>
        <input type="text" id="node-input-tags" data-i18n="[placeholder]twitter.placeholder.for">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="[html]twitter.tip"></span></div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('twitter in',{
        category: 'social-input',
        color:"#C0DEED",
        defaults: {
            twitter: {type:"twitter-credentials",required:true},
            tags: {value:""},
            user: {value:"false",required:true},
            name: {value:""},
            topic: {value:"tweets"},
            inputs: {value:0}
        },
        inputs: 0,
        outputs: 1,
        icon: "twitter.png",
        label: function() {
            if (this.name) {
                return this.name;
            }
            var uname = RED.nodes.node(this.twitter);
            if (this.user == "dm") {
                return (uname?uname.label()+" ":"")+this._("twitter.label.dmslabel");
            } else if (this.user == "event") {
                var user = RED.nodes.node(this.twitter);
                return (user?user.label()+" ":"")+this._("twitter.label.eventslabel");
            } else if (this.user == "user") {
                return this.tags+" "+this._("twitter.label.tweetslabel");
            }
            else if (this.user == "true") {
                return this._("twitter.label.followers") + (uname?(" "+uname.label()):"");
            }
            return "twitter";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var userlabel = this._("twitter.label.user");
            var userph = this._("twitter.placeholder.user");
            var forlabel = this._("twitter.label.for");
            var forph = this._("twitter.placeholder.for");
            $("#node-input-user").change(function() {
                var type = $("#node-input-user option:selected").val();
                if (type == "user") {
                    $("#node-input-tags-row").show();
                    $("#node-input-tags-label").html(userlabel);
                    $("#node-input-tags").attr("placeholder",userph);
                } else if ((type == "dm")||(type == "true")||(type == "event")) {
                    $("#node-input-tags-row").hide();
                } else {
                    $("#node-input-tags-row").show();
                    $("#node-input-tags-label").html(forlabel);
                    $("#node-input-tags").attr("placeholder",forph);
                }
            });
            $("#node-input-user").change();
        },
        oneditsave: function() {
            if ($('#node-input-tags').val() === '' && $("#node-input-user option:selected").val() === 'false') {
                this.inputs = 1;
            }
            else {
                //set back the default state of 0 inputs
                //this.inputs = 0;
            }
        }
    });
</script>


<script type="text/x-red" data-template-name="twitter out">
    <div class="form-row">
        <label for="node-input-twitter"><i class="fa fa-user"></i> <span data-i18n="twitter.label.twitter-id"></span></label>
        <input type="text" id="node-input-twitter">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('twitter out',{
        category: 'social-output',
        color:"#C0DEED",
        defaults: {
            twitter: {type:"twitter-credentials",required:true},
            name: {value:"Tweet"}
        },
        inputs:1,
        outputs:0,
        icon: "twitter.png",
        align: "right",
        label: function() {
            return this.name;
        }
    });
</script>
<script type="text/x-red" data-help-name="twitter in">
    <p>Twitter input node. Can be used to search either:
    <ul><li>the public stream for tweets containing the configured search term</li>
        <li>all the tweets from accounts that the authenticated user follows</li>
        <li>all tweets by specified users</li>
        <li>direct messages received by the authenticated user</li>
        <li>twitter events for the authenticated user</li>
    </ul></p>
    <p>Use space for <i>and</i> and comma , for <i>or</i> when searching for multiple terms.
    If you want to pass in the search term(s) via the <code>msg.payload</code>, leave the <b>for</b> field blank.</p>
    <p>Sets the <code>msg.topic</code> to <i>tweets/</i> and then appends the senders screen name.</p>
    <p>Sets <code>msg.location</code> to the tweeters location if known.</p>
    <p>When returning events it sets the <code>msg.payload</code> to the twitter event, a full list is documented by
    <a href="https://dev.twitter.com/streaming/overview/messages-types#Events_event" target="_new">Twitter</a>.</p>
    <p>Sets <code>msg.tweet</code> to the full tweet object as documented by <a href="https://dev.twitter.com/overview/api/tweets" target="_new">Twitter</a>.

    <p><b>Note</b>: This node is not connected to the FireHose, so will not return 100% of all tweets to a busy @id or #hashtag.</p>
    <p><b>Note:</b> when set to follow specific users, or your direct messages, the node is subject to
      the rate limiting of the Twitter API. If you deploy the flows multiple times within a 15 minute window, you may
      exceed the limit and will see errors from the node. These errors will clear automatically when the current 15
      minute window passes.</p>
</script><script type="text/x-red" data-help-name="twitter out">
    <p>Twitter out node. Tweets the <code>msg.payload</code>.</p>
    <p>To send a Direct Message (DM) - use a payload like "D {username} {message}"</p>
    <p>If <code>msg.media</code> exists and is a Buffer object, this node will treat it
       as an image and attach it to the tweet.</p>
    <p>If <code>msg.params</code> exists and is an object of name:value pairs,
    this node will treat it as parameters for the update request.</p>
</script><!--
  Copyright 2013,2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="tcp in">
    <div class="form-row">
        <label for="node-input-server"><i class="icon-resize-small"></i> Connect</label>
        to port &nbsp;<input type="text" id="node-input-port" style="width: 250px;">
    </div>
    <div class="form-row" id="node-input-host-row" style="padding-left: 110px;">
        at host <input type="text" id="node-input-host" placeholder="localhost" style="width: 250px;">
    </div>
    <div class="form-row">
        <label><i class="icon-th"></i> Output</label>
        a
        <select id="node-input-datamode" style="width:110px;">
            <option value="stream">stream of</option>
            <option value="single">single</option>
        </select>
        <select id="node-input-datatype" style="width:140px;">
            <option value="buffer">Buffer</option>
            <option value="utf8">String</option>
            <option value="base64">Base64 String</option>
        </select>
        payload<span id="node-input-datamode-plural">s</span>
    </div>
    <div id="node-row-newline" class="form-row hidden" style="padding-left: 110px;">
        delimited by <input type="text" id="node-input-newline" style="width: 110px;">
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="icon-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('tcp in',{
        category: 'input',
        color:"Silver",
        defaults: {
            server: {value:"client",required:true},
            host: {value:"",validate:function(v) { return (this.server == "server")||v.length > 0;} },
            port: {value:"",required:true,validate:RED.validators.number()},
            datamode:{value:"stream"},
            datatype:{value:"buffer"},
            newline:{value:""},
            topic: {value:""},
            name: {value:""},
            base64: {/*deprecated*/ value:false,required:true}
        },
        inputs:0,
        outputs:1,
        icon: "bridge-dash.png",
        label: function() {
            return this.name || "tcp:"+(this.host?this.host+":":"")+this.port;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var updateOptions = function() {
                var datamode = $("#node-input-datamode option:selected").val();
                var datatype = $("#node-input-datatype option:selected").val();
                if (datamode == "stream") {
                    $("#node-input-datamode-plural").show();
                    if (datatype == "utf8") {
                        $("#node-row-newline").show();
                    } else {
                        $("#node-row-newline").hide();
                    }
                } else {
                    $("#node-input-datamode-plural").hide();
                    $("#node-row-newline").hide();
                }
            };
            updateOptions();
            $("#node-input-server").change(updateOptions);
            $("#node-input-datatype").change(updateOptions);
            $("#node-input-datamode").change(updateOptions);
        }
    });
</script>


<script type="text/x-red" data-template-name="tcp out">
    <div class="form-row">
        <label for="node-input-beserver"><i class="icon-resize-small"></i> Type</label>
        <select id="node-input-beserver" style="width:150px; margin-right:5px;">
            <!-- <option value="server">Listen on</option> -->
            <option value="client">Connect to</option>
            <option value="reply">Reply to TCP</option>
        </select>
        <span id="node-input-port-row">port <input type="text" id="node-input-port" style="width: 50px"></span>
    </div>
    <div class="form-row hidden" id="node-input-host-row" style="padding-left: 110px;">
        at host <input type="text" id="node-input-host" placeholder="localhost" style="width: 40%;">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-base64" placeholder="base64" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-base64" style="width: 70%;">Decode Base64 message ?</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>



<script type="text/javascript">
    RED.nodes.registerType('tcp out',{
        category: 'output',
        color:"Silver",
        defaults: {
            host: {value:"",validate:function(v) { return (this.beserver != "client")||v.length > 0;} },
            port: {value:"",validate:function(v) { return (this.beserver == "reply")||RED.validators.number()(v) } },
            beserver: {value:"client",required:true},
            base64: {value:false,required:true},
            name: {value:""}
        },
        inputs:1,
        outputs:0,
        icon: "bridge-dash.png",
        align: "right",
        label: function() {
            return this.name || "tcp:"+(this.host?this.host+":":"")+this.port;
        },
        labelStyle: function() {
            return (this.name)?"node_label_italic":"";
        },
        oneditprepare: function() {
            var updateOptions = function() {
                var sockettype = $("#node-input-beserver option:selected").val();
                if (sockettype == "reply") {
                    $("#node-input-port-row").hide();
                    $("#node-input-host-row").hide();
                } else {
                    $("#node-input-port-row").show();
                }

                if (sockettype == "client") {
                    $("#node-input-host-row").show();
                } else {
                    $("#node-input-host-row").hide();
                }
            };
            updateOptions();
            $("#node-input-beserver").change(updateOptions);
        }
    });
</script>


<script type="text/x-red" data-template-name="tcp request">
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-globe"></i> Server</label>
        <input type="text" id="node-input-server" placeholder="ip.address" style="width:45%">
        &nbsp;port <input type="text" id="node-input-port" style="width:60px">
    </div>
    <div class="form-row">
        <label for="node-input-out"><i class="fa fa-sign-out"></i> Return</label>
        <select type="text" id="node-input-out" style="width:56%;">
            <option value="time">after a fixed timeout of</option>
            <option value="char">when character received is</option>
            <option value="count">a fixed number of chars</option>
            <option value="sit">never - keep connection open</option>
        </select>
        <input type="text" id="node-input-splitc"  style="width:50px;">
        <span id="node-units"></span>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <script>
        var previous = null;
        $("#node-input-out").on('focus', function () { previous = this.value; }).change(function() {
            if (previous == null) { previous = $("#node-input-out").val(); }
            if ($("#node-input-out").val() == "char") {
                if (previous != "char") $("#node-input-splitc").val("\\n");
                $("#node-units").text("");
            }
            else if ($("#node-input-out").val() == "time") {
                if (previous != "time") $("#node-input-splitc").val("0");
                $("#node-units").text("ms");
            }
            else if ($("#node-input-out").val() == "count") {
                if (previous != "count") $("#node-input-splitc").val("12");
                $("#node-units").text("chars");
            }
            else {
                if (previous != "sit") $("#node-input-splitc").val("0");
                $("#node-units").text("");
            }
        });
</script>



<script type="text/javascript">
    RED.nodes.registerType('tcp request',{
        category: 'function',
        color:"Silver",
        defaults: {
            server: {value:""},
            port: {value:"",validate:RED.validators.regex(/^(\d*|)$/)},
            out: {value:"time",required:true},
            splitc: {value:"0",required:true},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "bridge-dash.png",
        label: function() {
            return this.name || "tcp:"+(this.server?this.server+":":"")+this.port;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
<script type="text/x-red" data-help-name="tcp in">
    <p>Provides a tcp input client. Connects to a remote tcp port.</p>
</script><script type="text/x-red" data-help-name="tcp out">
    <p>Provides a tcp output client. Connects to a remote tcp port, or replies to messages received from a TCP In node.</p>
    <p>Only <code>msg.payload</code> is sent.</p>
    <p>If <code>msg.payload</code> is a string containing a base64 encoding of binary
    data, the Base64 decoding option will cause it to be converted back to binary
    before being sent.</p>
</script><script type="text/x-red" data-help-name="tcp request">
    <p>A simple TCP request node - sends the <code>msg.payload</code> to a server tcp port and expects a response.</p>
    <p>Connects, sends the "request", reads the "response". It can either count a number of
    returned characters into a fixed buffer, match a specified character before returning,
    wait a fixed timeout from first reply and then return, or just sit and wait for data.</p>
    <p>The response will be output in <code>msg.payload</code> as a buffer, so you may want to .toString() it.</p>
    <p>If you leave tcp host or port blank they must be set by using the <code>msg.host</code> and <code>msg.port</code> properties.</p>
</script><!--
  Copyright 2013,2014 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!--  The Output Node  -->
<script type="text/x-red" data-template-name="udp out">
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-envelope"></i> Send a</label>
        <select id="node-input-multicast" style='width:40%'>
          <option value="false">udp message</option>
          <option value="broad">broadcast message</option>
          <option value="multi">multicast message</option>
        </select>
        to port <input type="text" id="node-input-port" placeholder="port" style="width: 70px">
    </div>
    <div class="form-row node-input-addr">
        <label for="node-input-addr" id="node-input-addr-label"><i class="fa fa-list"></i> Address</label>
        <input type="text" id="node-input-addr" placeholder="destination ip" style="width: 70%;">
    </div>
    <div class="form-row node-input-iface">
        <label for="node-input-iface"><i class="fa fa-random"></i> Interface</label>
        <input type="text" id="node-input-iface" placeholder="(optional) ip address of eth0">
    </div>
    <div class="form-row">
        <label for="node-input-outport-type">&nbsp;</label>
        <select id="node-input-outport-type">
          <option id="node-input-outport-type-random" value="random">use random local port</option>
          <option value="fixed">bind to local port</option>
        </select>
        <input type="text" id="node-input-outport"  style="width: 70px;" placeholder="port">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-base64" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-base64" style="width: 70%;">Decode Base64 encoded payload ?</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips">Tip: leave address and port blank if you want to set using <b>msg.ip</b> and <b>msg.port</b>.</div>
    <script>
        $("#node-input-multicast").change(function() {
            var id = $("#node-input-multicast option:selected").val();
            if (id !== "multi") {
                $(".node-input-iface").hide();
                $("#node-input-addr-label").html('<i class="fa fa-list"></i> Address');
                $("#node-input-addr")[0].placeholder = 'destination ip';
            }
            else {
                $(".node-input-iface").show();
                $("#node-input-addr-label").html('<i class="fa fa-list"></i> Group');
                $("#node-input-addr")[0].placeholder = '225.0.18.83';
            }
            if (id === "broad") {
                $("#node-input-addr")[0].placeholder = '255.255.255.255';
            }
        });
    </script>




<script type="text/javascript">
    RED.nodes.registerType('udp out',{
        category: 'output',
        color:"Silver",
        defaults: {
            name: {value:""},
            addr: {value:""},
            iface: {value:""},
            port: {value:""},
            outport: {value:""},
            base64: {value:false,required:true},
            multicast: {value:"false"}
        },
        inputs:1,
        outputs:0,
        icon: "bridge-dash.png",
        align: "right",
        label: function() {
            return this.name||"udp "+(this.addr+":"+this.port);
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var type = this.outport==""?"random":"fixed";
            $("#node-input-outport-type option").filter(function() {
                return $(this).val() == type;
            }).attr('selected',true);


            $("#node-input-outport-type").change(function() {
                var type = $(this).children("option:selected").val();
                if (type == "random") {
                    $("#node-input-outport").val("").hide();
                } else {
                    $("#node-input-outport").show();
                }
            });

            $("#node-input-outport-type").change();

            $("#node-input-multicast").change(function() {
                var type = $(this).children("option:selected").val();
                if (type == "false") {
                    $("#node-input-outport-type-random").html("bind to random local port");
                } else {
                    $("#node-input-outport-type-random").html("bind to target port");
                }
            });
            $("#node-input-multicast").change();
        }
    });
</script>
<script type="text/x-red" data-help-name="udp out">
    <p>This node sends <code>msg.payload</code> to the designated udp host and port. Supports multicast.</p>
    <p>You may also use <code>msg.ip</code> and <code>msg.port</code> to set the destination values.<br/>
    <b>Note</b>: the statically configured values have precedence.</p>
    <p>If you select broadcast either set the address to the local broadcast ip address, or maybe try 255.255.255.255,
    which is the global broadcast address.</p>
    <p>On some systems you may need to be root to use ports below 1024 and/or broadcast.</p>
</script><!--
  Copyright 2013,2014 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="mqlight in">
    <div class="form-row">
        <label for="node-input-service"><i class="icon-folder-close"></i> Service</label>
        <select type="text" id="node-input-service" style="display: inline-block; width: 70%;">
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tag"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="news/nodered">
    </div>
    <div class="form-row">
        <label for="node-input-share"><i class="fa fa-tag"></i> Share</label>
        <input type="text" id="node-input-share">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips" id="node-missing-service-warning" style="display: none"><i class="fa fa-warning"></i><b> Warning:</b> There are no MQ Light services connected</div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('mqlight in', {
            category: 'input',
            defaults: {
                name: {value: ""},
                service: {value: "", required: true},
                topic: {value: ""},
                share: {value:""}
            },
            color: "#6da7d1",
            inputs: 0,
            outputs: 1,
            icon: "mqlightin.png",
            label: function() {
                if (this.topic) {
                    return this.topic+(this.share?" ["+this.share+"]":"");
                } else {
                    return this.name || "mqlight";
                }
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('mqlight/vcap/', function(services) {
                    if (services.length === 0) {
                        $("#node-missing-service-warning").show();
                    } else {
                        var select = $('#node-input-service');
                        for (var i = 0; i < services.length; ++i) {
                            var name = services[i];
                            var option = "<option value=\"" + name + "\">" + name + "</option>";
                            select.append(option);
                        }
                    }
                });
            }
        });
    })();
</script>

<script type="text/x-red" data-template-name="mqlight out">
    <div class="form-row">
        <label for="node-input-service"><i class="icon-folder-close"></i> Service</label>
        <select type="text" id="node-input-service" style="display: inline-block; vertical-align:top; width: 70%;">
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tag"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="news/nodered">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips" id="node-missing-service-warning" style="display: none"><i class="fa fa-warning"></i><b> Warning:</b> There are no MQ Light services connected</div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('mqlight out', {
            category: 'output',
            defaults: {
                name: {value: ""},
                service: {value: "", required: true},
                topic: {value: ""}
            },
            color: "#6da7d1",
            inputs: 1,
            outputs: 0,
            align: "right",
            icon: "mqlightin.png",
            label: function() {
                return this.name || this.topic || "mqlight";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('mqlight/vcap/', function(services) {
                    if (services.length === 0) {
                        $("#node-missing-service-warning").show();
                    } else {
                        var select = $('#node-input-service');
                        for (var i = 0; i < services.length; ++i) {
                            var name = services[i];
                            var option = "<option value=\"" + name + "\">" + name + "</option>";
                            select.append(option);
                        }
                    }
                });
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="mqlight in">
    <p>Provides an MQ Light receive client.</p>
    <p>Subscribes the client to a destination based on the supplied topic and (optional) share arguments.</p>
    <p>Topic can contain any character in the Unicode character set, with # representing a multilevel wildcard and + a
    single level wildcard as described <a href="https://developer.ibm.com/messaging/mq-light/wildcard-topicpatterns/">here</a>.
    <p>Share identifies a shared destination for which messages are anycast between connected subscribers. If left blank,
    it defaults to a private destination.</p>
    <p>Received messages will be sent on in <code>msg.payload</code> with their topic sent in <code>msg.topic</code>
    and the share, if specified, sent in <code>msg.share</code>.</p>
</script><script type="text/x-red" data-help-name="mqlight out">
    <p>Provides an MQ Light send client.</p>
    <p>Sends the value passed in on <code>msg.payload</code> to the specified topic.</p>
    <p>The topic can be passed in on <code>msg.topic</code>, however the topic in the node must be blank for this to take
    effect. If the topic is set in the node <code>msg.topic</code> will be overridden.</p>
</script><!--
  Copyright 2013 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="mongodb">
    <div class="form-row">
        <label for="node-config-input-hostname"><i class="icon-bookmark"></i> Host</label>
        <input class="input-append-left" type="text" id="node-config-input-hostname" placeholder="localhost" style="width: 40%;" >
        <label for="node-config-input-port" style="margin-left: 10px; width: 35px; "> Port</label>
        <input type="text" id="node-config-input-port" placeholder="27017" style="width:45px">
    </div>
    <div class="form-row">
        <label for="node-config-input-db"><i class="icon-briefcase"></i> Database</label>
        <input type="text" id="node-config-input-db" placeholder="test">
    </div>
    <div class="form-row">
        <label for="node-config-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-config-input-user"><i class="icon-user"></i> Username</label>
        <input type="text" id="node-config-input-user">
    </div>
    <div class="form-row">
        <label for="node-config-input-pass"><i class="icon-lock"></i> Password</label>
        <input type="password" id="node-config-input-pass">
    </div>
</script>

<script type="text/javascript">

    RED.nodes.registerType('mongodb',{
        category: 'config',
        color:"rgb(218, 196, 180)",
        defaults: {
            hostname: { value:"127.0.0.1"},
            port: { value: 27017},
            db: { value:""},
            name: { value:"" },
            //user -> credentials
            //pass -> credentials
        },
        label: function() {
            return this.name||this.hostname+":"+this.port+"/"+this.db;
        },
        oneditprepare: function() {
            $.getJSON('mongodb/'+this.id,function(data) {
                if (data.user) {
                    $('#node-config-input-user').val(data.user);
                }
                if (data.hasPassword) {
                    $('#node-config-input-pass').val('__PWRD__');
                } else {
                    $('#node-config-input-pass').val('');
                }

            });
        },
        oneditsave: function() {
            var newUser = $('#node-config-input-user').val();
            var newPass = $('#node-config-input-pass').val();
            var credentials = {};
            credentials.user = newUser;
            if (newPass != '__PWRD__') {
                credentials.password = newPass;
            }
            $.ajax({
                url: 'mongodb/'+this.id,
                type: 'POST',
                data: credentials,
                success:function(result){}
            });
        },
        ondelete: function() {
            $.ajax({
                url: 'mongodb/'+this.id,
                type: 'DELETE',
                success: function(result) {}
            });
        }
    });
</script>


<script type="text/x-red" data-template-name="mongodb out">
    <div class="form-row">
        <label for="node-input-service"><i class="icon-folder-close"></i> Service</label>
        <select id="node-input-service">
            <option value="" disabled></option>
            <option value="_ext_">External service</option>
        </select>
    </div>
    <div class="form-row hide" id="node-input-external-details">
        <label for="node-input-mongodb"><i class="icon-bookmark"></i> Server</label>
        <input type="text" id="node-input-mongodb">
    </div>
    <div class="form-row">
        <label for="node-input-collection"><i class="icon-briefcase"></i> Collection</label>
        <input type="text" id="node-input-collection" placeholder="collection">
    </div>
        <div class="form-row">
        <label for="node-input-operation"><i class="icon-wrench"></i> Operation</label>
        <select type="text" id="node-input-operation" style="display: inline-block; vertical-align: top;">
            <option value="store">save</option>
            <option value="insert">insert</option>
            <option value="update">update</option>
            <option value="delete">remove</option>
        </select>
    </div>
    <div class="form-row node-input-payonly">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-payonly" placeholder="Only" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-payonly" style="width: 70%;">Only store msg.payload object ?</label>
    </div>
    <div class="form-row node-input-upsert">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-upsert" placeholder="Only" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-upsert" style="width: 70%;">Create a new document if no match found</label>
    </div>
    <div class="form-row node-input-multi">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-multi" placeholder="Only" style="display: inline-block; width: auto; vertical-align: top;;">
        <label for="node-input-multi" style="width: 70%;">Update all matching documents</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips" id="node-warning" style="display: none"><b> Tip:</b> If no collection is set, ensure <b>msg.collection</b> will contain the collection name
    </div>
</script>



<script type="text/x-red" data-template-name="mongodb in">
    <div class="form-row">
        <label for="node-input-service"><i class="icon-folder-close"></i> Service</label>
        <select id="node-input-service">
            <option value="" disabled></option>
            <option value="_ext_">External service</option>
        </select>
    </div>
    <div class="form-row hide" id="node-input-external-details">
        <label for="node-input-mongodb"><i class="icon-bookmark"></i> Server</label>
        <input type="text" id="node-input-mongodb">
    </div>
    <div class="form-row">
        <label for="node-input-collection"><i class="icon-briefcase"></i> Collection</label>
        <input type="text" id="node-input-collection" placeholder="collection">
    </div>
    <div class="form-row">
        <label for="node-input-operation"><i class="fa fa-wrench"></i> Operation</label>
        <select type="text" id="node-input-operation" style="display: inline-block; vertical-align: top;">
            <option value="find">find</option>
            <option value="count">count</option>
            <option value="aggregate">aggregate</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips" id="node-warning" style="display: none"><b> Tip:</b> If no collection is set, ensure <b>msg.collection</b> will contain the collection name
    </div>
</script>



<script type="text/javascript">
    (function() {

        function oneditprepare() {
            var select = $('#node-input-service')
            var node = this;
            $.getJSON('mongodb/vcap/', function(data) {
                var last = select.children().last();
                var opts = [];
                for (var i =0; i<data.length; i++) {
                    opts.push('<option value="' + data[i].name + '"' + (node.service === data[i].name ? " selected" : "") + '>' + data[i].name + '</option>');
                }
                if (opts.length === 0) {
                    node.service = "_ext_";
                    select.find("option").filter(function() {return $(this).val() === node.service;
                    }).attr('selected', true);
                } else {
                    last.before(opts.join(""));
                }
                select.change();
            });

            select.change(function() {
                var service = select.val();
                if (service === "_ext_") {
                    $("#node-input-external-details").show();
                } else {
                    $("#node-input-external-details").hide();
                }
            });

            $("#node-input-operation").change(function () {
                var id = $("#node-input-operation option:selected").val();

                if (id === "update") {
                    $(".node-input-payonly").hide();
                    $(".node-input-upsert, .node-input-multi").show();
                } else if (id === "delete") {
                    $(".node-input-payonly, .node-input-upsert, .node-input-multi").hide();
                } else {
                    $(".node-input-payonly").show();
                    $(".node-input-upsert, .node-input-multi").hide();
                }
            });

            $("#node-input-collection").change(function () {
                if($("#node-input-collection").val() === "") {
                    $("#node-warning").show();
                } else {
                    $("#node-warning").hide();
                }
            });
        }

        function label() {
            var mongoNode = RED.nodes.node(this.mongodb);
            if (this.name) {
                return this.name;
            }
            if (this.service === "_ext_") {
                return (mongoNode?mongoNode.label() + " " + this.collection: "mongodb");
            }
            return this.service || "mongodb";
        }

        function validateServer(v) {
            return this.service !== "_ext_" || v !== "_ADD_";
        }

        RED.nodes.registerType('mongodb out', {
            category: 'storage-output',
            color:"rgb(218, 196, 180)",
            defaults: {
                service: {value:"", required: true},
                mongodb: { type:  "mongodb", validate: validateServer},
                name: {value: ""},
                collection: {value: ""},
                payonly: {value: false},
                upsert: {value: false},
                multi: {value: false},
                operation: {value: "store"}
            },
            inputs: 1,
            outputs: 0,
            icon: "mongodb.png",
            align: "right",
            label: label,
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: oneditprepare
        });


        RED.nodes.registerType('mongodb in',{
            category: 'storage-input',
            color: "rgb(218, 196, 180)",
            defaults: {
                service: {value: "", required: true},
                mongodb: {type: "mongodb", validate: validateServer},
                name: {value: ""},
                collection: {value: ""},
                operation: {value: "find"}
            },
            inputs: 1,
            outputs: 1,
            icon: "mongodb.png",
            label: label,
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: oneditprepare
        });
    })();
</script>
<script type="text/x-red" data-help-name="mongodb out">
    <p>A simple MongoDB output node. Can save, insert, update and remove objects from a chosen collection.</p>
    <p>Save will update an existing object or insert a new object if one does not already exist.</p>
    <p>Insert will insert a new object.</p>
    <p>Save and insert either store <b>msg</b> or <code>msg.payload</code>.</p>
    <p>Update will modify an existing object or objects. The query to select objects to update uses <code>msg.query</code> and the update to the element uses <code>msg.payload</code>.</p>
    <p>Update can add a object if it does not exist or update multiple objects.</p>
    <p>Remove will remove objects that match the query passed in on <code>msg.payload</code>. A blank query will delete <i>all of the objects</i> in the collection.</p>
    <p>You can either set the collection method in the node config or on <code>msg.collection</code>. Setting it in the node will override <code>msg.collection</code>.</p>
    <p>By default MongoDB creates an <i>_id</i> property as the primary key - so repeated injections of the same <code>msg</code> will result in many database entries.</p>
    <p>If this is NOT the desired behaviour - ie. you want repeated entries to overwrite, then you must set the <code>msg._id</code> property to be a constant by the use of a previous function node.</p>
    <p>This could be a unique constant or you could create one based on some other msg property.</p>
    <p>Currently we do not limit or cap the collection size at all... this may well change.</p>
</script><script type="text/x-red" data-help-name="mongodb in">
    <p>Calls a MongoDB collection method based on the selected operator.</p>
    <p>Find queries a collection using the <code>msg.payload</code> as the query statement as per the .find() function.
    Optionally, you may also (via a function) set a <code>msg.projection</code> object to constrain the returned fields,
    a <code>msg.sort</code> object and a <code>msg.limit</code> object.</p>
    <p>Count returns a count of the number of documents in a collection or matching a query using the <code>msg.payload</code> 
    as the query statement.</p>
    <p>Aggregate provides access to the aggregation pipeline using the <code>msg.payload</code> as the pipeline array.</p>
    <p>See the <a href="http://docs.mongodb.org/manual/reference/method/db.collection.find/" target="new"><i>MongoDB
    collection methods docs</i></a> for examples.</p>
    <p>The result is returned in <code>msg.payload</code>.</p>
</script><!--
  Copyright 2013 Andrew D Lindsay @AndrewDLindsay
  http://blog.thiseldo.co.uk

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="twilio out">
    <div class="form-row">
        <label for="node-input-service"><i class="icon-folder-close"></i> Service</label>
        <select id="node-input-service">
            <option value="" disabled></option>
            <option value="_ext_">External service</option>
        </select>
    </div>
    <div class="form-row" id="node-input-twilio-row">
        <label for="node-input-twilio"><i class="icon-user"></i> Twilio</label>
        <input type="text" id="node-input-twilio">
    </div>
    <div class="form-row" id="node-input-from-row">
        <label for="node-input-from"><i class="icon-user"></i> From</label>
        <input type="text" id="node-input-from" placeholder="+4412345678901">
    </div>
    <div class="form-row">
        <label for="node-input-number"><i class="icon-envelope"></i> SMS to</label>
        <input type="text" id="node-input-number" placeholder="+4412345678901">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>



<script type="text/x-red" data-template-name="twilio-api">
    <div class="form-row">
        <label for="node-config-input-sid">Account SID</label>
        <input type="text" id="node-config-input-sid">
    </div>
    <div class="form-row">
        <label for="node-config-input-from"><i class="icon-envelope"></i> From</label>
        <input type="text" id="node-config-input-from" placeholder="01234 5678901">
    </div>
    <div class="form-row">
        <label for="node-config-input-token"><i class="icon-lock"></i> Token</label>
        <input type="password" id="node-config-input-token">
    </div>
    <div class="form-row">
        <label for="node-config-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>
</script>

<script type="text/javascript">


    (function() {
    
        RED.nodes.registerType('twilio-api',{
            category: 'config',
            defaults: {
                sid: {value:"",required:true},
                from: {value:"",required:true},
                // token -> credentials
                name: { value: ""}
            },
            label: function() {
                return this.name||this.from;
            },
            oneditprepare: function() {
                $.getJSON('twilio-api/'+this.id,function(data) {
                    if (data.hasToken) {
                        $('#node-config-input-token').val('__PWRD__');
                    } else {
                        $('#node-config-input-token').val('');
                    }
    
                });
            },
            oneditsave: function() {
                var newToken = $('#node-config-input-token').val();
                if (newToken != '__PWRD__') {
                var credentials = {};
                    credentials.token = newToken;
                    $.ajax({
                        url: 'twilio-api/'+this.id,
                        type: 'POST',
                        data: credentials,
                        success:function(result){}
                    });
                }
            },
            ondelete: function() {
                $.ajax({
                    url: 'twilio-api/'+this.id,
                    type: 'DELETE',
                    success: function(result) {}
                });
            }
        });
        
        RED.nodes.registerType('twilio out',{
            category: 'output',
            defaults: {
                service: {value:"", required: true},
                twilio:{type:"twilio-api",validate:function(v) {
                    return (this.service && this.service != "_ext_") || (v&&v!="_ADD_");
                }},
                from: {value:""},
                number: {value:""},
                name: {value:""}
            },
            color:"#FF595F",
            inputs:1,
            outputs:0,
            icon: "twilio.png",
            align: "right",
            label: function() {
                var api = RED.nodes.node(this.twilio);
                if (this.name) {
                    return this.name;
                }
                if (this.service == "_ext_") {
                    return (api?api.label():"twilio");
                }
                return this.service||"twilio";
            },
            labelStyle: function() {
                return this.name?"node_label_italic":"";
            },
            oneditprepare: function() {
                var select = $('#node-input-service')
                var node = this;
                $.getJSON('twilio-api/vcap/',function(data) {
                    var last = select.children().last();
                    var opts = [];
                    for (var i =0;i<data.length;i++) {
                        opts.push('<option value="'+data[i].name+'"'+(node.service==data[i].name?" selected":"")+'>'+data[i].name+'</option>');
                    }
                    if (opts.length == 0) {
                        node.service = "_ext_";
                        select.find("option").filter(function() {return $(this).val() == node.service;}).attr('selected',true);
                    } else {
                        last.before(opts.join(""));
                    }
                    select.change();
                });
                select.change(function() {
                    var service = select.val();
                    if (service == "_ext_") {
                        $("#node-input-twilio-row").show();
                        $("#node-input-from-row").hide();
                    } else {
                        $("#node-input-twilio-row").hide();
                        $("#node-input-from-row").show();
                    }
                });
            }
        });
    })();

</script>
<script type="text/x-red" data-help-name="twilio out">
    <p>Sends an SMS message using the Twilio service.</p>
    <p><code>msg.payload</code> is used as the body of the message. The node can be configured with the number
    to send the message to. Alternatively, if the number is left blank, it can be set using <code>msg.topic</code>.</p>
    <p>You must have an account with Twilio to use this node. You can register for one <a href="https://www.twilio.com/">here</a>.</p>
    <p>You can either set your account details within the node, or provide it as a bound service within Bluemix.</p>
</script>
<!--
  Copyright 2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="weather_insights">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-service"><i class="fa fa-question"></i> Service</label>
        <select type="text" id="node-input-service" style="display: inline-block; width: 70%;" >
            <option value="/forecast/daily/10day.json">Daily Forecast (10 Days)</option>
            <option value="/forecast/hourly/48hour.json">Hourly Forecast (48 Hours)</option>
            <option value="/observations.json">Current Observations</option>
            <option value="/observations/timeseries.json?hours=23">Historic Observations (24 Hours)</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-geocode"><i class="fa fa-tag"></i> Location</label>
        <input type="text" id="node-input-geocode" placeholder="latitude,longitude">
    </div>
    <div class="form-row">
        <label for="node-input-units"><i class="fa fa-question"></i> Units</label>
        <select type="text" id="node-input-units" style="display: inline-block; width: 70%;" >
            <option value="m">Metric</option>
            <option value="e">Imperial (English)</option>
            <option value="h">Hybrid</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-language"><i class="fa fa-question"></i> Language</label>
        <input type="text" id="node-input-language" placeholder="Language Code">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('weather_insights', {
            category: 'weather',
            defaults: {
                name: {value: ""},
                service: {value: "/forecast/daily/10day.json"},
                geocode: {value: ""},
                units: {value: "m"},
                language: {value: ""}
            },
            credentials: {
                username: {type:"text"},
                password: {type:"password"}
            },
            color: "rgb(192, 222, 237)",
            inputs: 1,
            outputs: 1,
            icon: "weather.png",
            paletteLabel: "weather insights",
            label: function() {
                return this.name || "weather insights";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('weather_insights/vcap/')
                  .done(function (service) {
                      $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                      $('.credentials').show();
                  }).always(function () {
                      $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="weather_insights">
    <p>The Weather Insights service allows you access historical and real-time weather data from The Weather Company.</p>
    <p>You can retrieve weather data for an area specified by a geolocation. The data allows you to forecast, detect, and visualize disruptive weather events.</p>
    <p>The forecast service to query must be set on the editor panel to choose from forecasts (hourly and daily) or observations (current or 24 hours).</p>
    <p>The geo-location to retrieve results for can be set in the editor panel or at runtime through <code>msg.payload</code>.
    This <code>msg.payload</code> value must be a valid comma-delimited latitude and longitude string, e.g. <code>34.53,84.50</code>.</p>
    <p>The <code>msg.language</code> parameter to set the forecast text language can be set using the message parameter. If this value is set
    in the editor configuration panel, message parameter values will be ignored. If no value is set on the message or in the editor, it defaults to "en-US".</p>
    The service also supports the <code>msg.location</code> parameter with lat and lon attributes.</p>
    <p>The results will be returned on <code>msg.forecasts</code>, <code>msg.observation</code> or <code>msg.observations</code>
     depending on the service.</p>
    <p>For more information about Weather Insights service, read the <a href="https://www.ng.bluemix.net/docs/services/Weather/index.html" target="_new">documentation</a>.</p>
</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<script type="text/x-red" data-template-name="business-rules">

    <div class="form-row">
        <label for="node-input-service"><i class="fa fa-hand-o-right"></i> Bluemix Service</label>
        <select type="text" id="node-input-service" style="display: inline-block; vertical-align:middle; width: 72%;">
        	<option value="">Select a Business Rules service instance</option>
        </select>
    </div>
    
    <div class="form-row">
        <label for="node-input-rulesets"><i class="fa fa-hand-o-right"></i> Decision Services </label>
        <select type="text" id="node-input-rulesets" style="display: inline-block; vertical-align:middle; width: 72%;">
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-ruleset"><i class="fa fa-save"></i> Current </label>
        <input type="text" id="node-input-ruleset" placeholder="Ruleset Path" readonly style="display: inline-block; vertical-align:middle; width: 72%;"/>
    </div>

    <div class="form-row">
        <label for="node-input-test-test-mode"><i class="fa fa-cog"></i> Test </label>
        <select type="text" id="node-input-test-mode" style="display: inline-block; vertical-align:middle; width: 59%;">
            <option value="false">Current Decision Service with trace disabled</option>
            <option value="true">Current Decision Service with trace enabled</option>
        </select>
        <a id="node-input-htds-test-btn" class="btn" href="#" onclick="javascript:TestDecisionService();return false;">
            <i class="fa fa-external-link"></i> Run</a>
    </div>

    <div class="form-tips" id="node-missing-service-warning" style="display: none"><i class="fa fa-warning"></i><b> Warning:</b> There is no Business Rules service connected
    </div>

    <div class="form-tips" id="node-node-info"><i class="fa fa-book"></i><b> Tips:</b> Check out the node info tab for more information
    </div>


</script>



<script type="text/javascript">

 function TestDecisionService () {
            var traceMode = null, serviceSelect = null, rulesetSelect = null, serviceSelectedVal = null, rulesetSelectedVal = null
                req_string = null, fullURL = null;
            
            traceMode = $('#node-input-test-mode').val();
            serviceSelect = $('#node-input-service');
            rulesetSelect = $('#node-input-ruleset');
            serviceSelectedVal = serviceSelect.val();
            rulesetSelectedVal = rulesetSelect.val();
            req_string = 'business-rules/get-htds-test-uri/' + encodeURIComponent(serviceSelectedVal)+ '/'+ encodeURIComponent(rulesetSelectedVal) ;
            $.getJSON(req_string, function(data) {
                fullURL = 'https://' + data.username + ':' + data.password + '@' + data.url.host + '/DecisionService/run.jsp?path=' +rulesetSelectedVal+'&trace='+(traceMode === "true" ? true : false);
                window.open(fullURL);
            });
}

    (function() {

		function updateRulesetList(node) {
            
			var serviceSelect = $('#node-input-service');
			var rulesetsSelect = $('#node-input-rulesets');
			
            rulesetsSelect.empty();
			$.getJSON('business-rules/service/' + serviceSelect.val() + '/rulesets', function(rulesets) {
				$.each(rulesets, function(index, ruleset) {
					var option = "<option value=\"" + ruleset + "\">"+ ruleset + "</option>";
					rulesetsSelect.append(option);
				});
                rulesetsSelect.find("option").filter(function() {return $(this).val() === node.rulesets;}).attr('selected', true);
			});
            
		}
			
        function oneditprepare() {

            var node = this;

            $.getJSON('business-rules/vcap/', function(services) {
                if (services.length == 0) {
                    $("#node-missing-service-warning").show();
                } else {
                    // Assume service[0]
                    var select = $('#node-input-service');
                    var rulesetsSelect = $('#node-input-rulesets');

                    for (var i = 0; i < services.length; ++i) {
                        var name = services[i];
                        var option = "<option value=\"" + name + "\">"+ name + "</option>";
                        select.append(option);
                    }
                    
                    select.find("option").filter(function() {return $(this).val() === node.service;}).attr('selected', true);

					// update list of ruleset for the selected service when the service changes
					$('#node-input-service').change(function() {
        				updateRulesetList(node);
        			});
					updateRulesetList(node);
        			
                    // update the text value when rulesets are selected
					rulesetsSelect.change(function() {
						$("#node-input-ruleset").val($(this).val());
					});
                }
            });
        }

        RED.nodes.registerType('business-rules',{
            category: 'Smarter Process',
            defaults: {
                service: {value: ""},
                rulesets: {value: ""},
                ruleset: {value: ""}
            },
            color: "rgb(255, 255, 255)",
            inputs: 1,
            outputs: 1,
            icon: "businessrules-icon25x25.png",
            paletteLabel: "business rules",
            label: function() {
                return this.name || "business rules";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: oneditprepare
        });
    })();
</script>
<script type="text/x-red" data-help-name="business-rules">
    <p>Enables developers to spend less time recoding and testing when the business policy changes.</p>
    <p>The Business Rules service minimizes your code changes by keeping business logic separate from application logic.</p>
    <p><b>Node Configuration</b></p>
    <ul>
    <li> Create and Bind a Business Rules service instance on this Node-RED App</li>
    <li> Deploy some Decisions Services</li>
    <li> Select the Decision Service to be executed and click on Done</li>
    <li> In input, wire your Business Rules node with a valid Json or Xml payload (use the test tool to help you)</li>
    <li> In output, wire your Business Rules node with the node that will use the response of Decision Service execution request done by this node</li>
    </ul>

    <p><b>Node input</b></p>
    <ul>
    <li><code>msg.payload</code> : a string representing a valid XML or JSON payload matching the selected Decision Service in the node configuration.</li>
    </ul>
    <p><b>Node output</b></p>
    <ul>
    <li><code>msg.payload</code> : the decision corresponding the input data, returned either in XML or JSON as detected in the input.</li>
    </ul>

    <p><b>Documentations</b></p>
    <ul>
        <li><a href="https://github.com/ylecleach/labs/tree/master/node-red/basic-labs/business-rules" target="_blank">Business Rules Node Tutorials</a></li>
        <li><a href="https://console.ng.bluemix.net/docs/services/rules/rules.html#rules" target="_blank">Business Rules Service documentation</a></li>
        <li><a href="http://www.ibm.com/developerworks/topics/business%20rules%20service" target="_blank">All Business Rules service tutorials</a></li>
        <li><a href="http://www.ibm.com/developerworks/bpm/library/techarticles/1504_reinholds-bluemix/1504_reinholds.html" target="_blank">Top 10 Bluemix tutorials for BPM</a></li>
    </ul>

</script>
<!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="predictive_analytics">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-key"><i class="fa fa-key"></i> API Key</label>
        <input type="password" id="node-input-key" placeholder="API key">
    </div>
    <div class="form-row">
        <label for="node-input-cid"><i class="fa fa-question"></i> Context ID</label>
        <input type="text" id="node-input-cid" placeholder="Please hit search" style="width:61%">
        <a id="node-lookup-key" class="btn"><i class="fa fa-search"></i></a>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('predictive_analytics', {
            category: 'analysis',
            defaults: {
                name: {value:""},
                cid: {value:"", required:true}
            },
            credentials: {
                key: {type:"password"}
            },
            color: "rgb(192, 222, 237)",
            inputs: 1,
            outputs: 1,
            icon: "spss.png",
            paletteLabel: "predictive analytics",
            label: function() {
                return this.name || "predictive analytics";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                var bm = false;
                var myId = this.id;

                $.getJSON('predictive_analytics/vcap/')
                    .done(function (service) {
                        if (service) { bm = true; }
                        $('.credentials').toggle(!service);
                    })
                    .fail(function () {
                        $('.credentials').show();
                        if ($("#node-input-key").val().length === 0) {
                            $("#node-input-cid").val("Please enter API key then hit search");
                        }
                    }).always(function () {
                        $('#credentials-check').hide();
                    });

                try {
                    $("#node-input-cid").autocomplete( "destroy" );
                } catch(err) {
                }
                $("#node-lookup-key").click(function() {
                    var lkey = $("#node-input-key").val();
                    if (bm || lkey.length !== 0) {
                        var u = 'predictive_analytics/models/';
                        if (!bm) {
                            if (lkey !== "__PWRD__") { u += "?k="+lkey; }
                            else { u += "?id="+myId; }
                        }
                        $.getJSON(u)
                            .done(function (list) {
                                $("#node-input-cid").autocomplete({
                                    source:list,
                                    minLength:0,
                                    close: function( event, ui ) {
                                        $("#node-input-cid").autocomplete( "destroy" );
                                    }
                                }).autocomplete("search","");
                            })
                            .fail(function (err) {
                                $("#node-input-cid").val("fetch failed - enter manually");
                            });
                    }
                });
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="predictive_analytics">
    <p>The Predictive Analytics node allows you score an input set of parameters using an SPSS model running
    on a <a href="http://bluemix.net" target="_new">Bluemix</a> Predictive Analytics Service.</p>
    <p>You must pass in a <code>msg.payload</code> object <i>as required</i> by the model... so you must
    know what the model looks like. Typically it would be an object similar to :</p>
    <pre>{
    "tablename":"scoring",
    "header":["X","Y","Z"],
    "data":[[4,2,1]]
}</pre>
    <p>The <code>data</code> may be an array of multiple input arrays, and each element will be scored.</p>
    <p>The results will be returned as a <code>msg.payload</code> object formatted as defined by the model.</p>
    <p>For more information about the Predictive Analytics service, read the
    <a href="https://www.ng.bluemix.net/docs/services/PredictiveModeling/index.html" target="_new">documentation</a>.</p>
</script><!--
  Copyright 2014 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="ibm hdfs in">

    <div class="form-row">
        <label for="node-input-filename"><i class="icon-file"></i> Filename</label>
        <input type="text" id="node-input-filename" placeholder="Filename">
    </div>
    <div class="form-row">
        <label for="node-input-format"><i class="fa fa-sign-out"></i> Output as</label>
        <select id="node-input-format">
            <option value="utf8">a utf8 string</option>
            <option value="">a Buffer</option>
        </select>
    </div>
	<div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

	<div class="form-tips">
		<div class = "form-tipsBounded">		
			<b>Bounded Service:</b> Provide a valid filename with filepath starting with slash. The file gets created under the folder /user/biblumix <br/>			
			Check the info tab, to get more information about each of the fields
		</div>
		<div class = "form-tipsUnbounded">
			<b>Unbounded Service:</b> Big Insights service not bound. This node wont work<br/>
		</div>
	</div>

</script>



<script type="text/javascript">
    
    RED.nodes.registerType('ibm hdfs in',{
        category: 'storage-input',
        color:"rgb(115, 185, 221)",
        defaults: {
            name: {value:""},
			filename:{value:"", required:true},
            format: {value:"utf8"}
        },
        inputs:1,
        outputs:1,
        icon: "ibmhdfs_icon.png",

        label: function() {
            return this.name||"ibm hdfs";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },oneditprepare: function() {
			result = "";
            $.ajax({
                url: 'iotFoundation/bigdata?ts=' + Math.random(),
                type: 'GET',
                success:function(result){},
				statusCode: {
					403: function() {
						result = "unbound";
						$(".form-tipsUnbounded").show();
						$(".form-tipsBounded").hide();
					},
					200: function() {
						result = "bound";
						$(".form-tipsUnbounded").hide();
						$(".form-tipsBounded").show();
					}
				}
			});
		}
    });
</script>


<script type="text/x-red" data-template-name="ibm hdfs">
    <div class="form-row">
        <label for="node-input-filename"><i class="icon-file"></i> Filename</label>
        <input type="text" id="node-input-filename" placeholder="Filename">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-appendNewline" placeholder="Name" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-appendNewline" style="width: 70%;">Append newline ?</label>
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-overwriteFile" placeholder="Name" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-overwriteFile" style="width: 70%;">Overwrite complete file ?</label>
    </div>
	<div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

	<div class="form-tips">
		<div class = "form-tipsBounded">		
			<b>Bounded Service:</b> Provide a valid filename with filepath starting with slash. The file gets created under the folder /user/biblumix <br/>		
			Check the info tab, to get more information about each of the fields
		</div>
		<div class = "form-tipsUnbounded">
			<b>Unbounded Service:</b> Big Insights service not bound. This node wont work<br/>
		</div>
	</div>

</script>



<script type="text/javascript">
    
    RED.nodes.registerType('ibm hdfs',{
        category: 'storage-input',
        color:"rgb(115, 185, 221)",
        defaults: {
            name: {value:""},
            filename: {value:"", required:true},
            appendNewline: {value:true},
            overwriteFile: {value:false}
		},
        inputs:1,
        outputs:0,
        align: "right",
        icon: "ibmhdfs_icon.png",

        label: function() {
            return this.name||"ibm hdfs in";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },oneditprepare: function() {
			result = "";
            $.ajax({
                url: 'iotFoundation/bigdata?ts=' + Math.random(),
                type: 'GET',
                success:function(result){},
				statusCode: {
					403: function() {
						result = "unbound";
						$(".form-tipsUnbounded").show();
						$(".form-tipsBounded").hide();
					},
					200: function() {
						result = "bound";
						$(".form-tipsUnbounded").hide();
						$(".form-tipsBounded").show();
					}
				}
			});
		}
    });
</script><script type="text/x-red" data-help-name="ibm hdfs in">
    <p>Reads the specified file and sends the content as <b>msg.payload</b>, and the filename as <b>msg.filename</b>.</p>
	<p>Provide the file location, in filename, like for e.g. /event/test.txt</p>
    <p>The filename can be overridden by the <code>filename</code> property of the incoming message.</p>
</script><script type="text/x-red" data-help-name="ibm hdfs">
    <p>Writes <b>msg.payload</b> to the file specified, e.g. to create a log.</p>
    <p>The filename can be overridden by the <code>filename</code> property of the incoming message.</p>
    <p>A newline is added to every message. But this can be turned off if required, for example, to allow binary files to be written.</p>
    <p>The default behaviour is to append to the file. This can be changed to overwrite the file each time, for example if you want to output a "static" web page or report.</p>
    <p>If a <code>delete</code> property exists then the file will be deleted instead.</p>
</script><!--
  Copyright 2014,2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
 
<script type="text/x-red" data-template-name="ibmpush">
   
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <br>
    <b>Mobile Push Properties</b><br/>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-share-alt"></i> Mode</label>
        <select id="node-input-mode" style="margin-right:3px;">
            <option default value="SANDBOX">SANDBOX</option>
            <option value="PRODUCTION">PRODUCTION</option>
        </select>
        
    </div>
    <div id="propDiv">
        <div class="form-row">
            <label id="node-input-ApplicationIDLabel" for="node-input-ApplicationID"><i class="icon-bookmark"></i> ID</label>
            <input type="text" id="node-input-ApplicationID" placeholder="Application ID e.g: 4cf38f2e-0465-4e40-887c-d69c85128389">
        </div>
        <div class="form-row">
            <label for="node-input-ApplicationSecret"><i class="icon-lock"></i> Secret</label>
            <input type="password" id="node-input-ApplicationSecret" placeholder="Application Secret">
        </div>

        <br/>
    </div>
    <b>Notification</b>
    
    <div class="form-row">
        <label for="node-input-notification"><i class="icon-tasks"></i> Type</label>
        <select id="node-input-notification" style="margin-right:3px;">
            <option default value="broadcast">Broadcast</option>
            <option value="tags">By Tags</option>
            <option value="deviceid">By DeviceIds</option>
            <option value="android">Only Android devices</option>
            <option value="ios">Only iOS devices</option>
        </select>
        
    </div>
    
    <div class="form-row">
        <label id="node-input-identifiersLabel" for="node-input-identifiers"><i class="icon-tag"></i> Identifiers</label>
        <input type="text" id="node-input-identifiers" placeholder="e.g: GoldCoupons,SilverCoupons">
    </div>
    <div class="form-tips">
        <div id = "form-tipsBounded">        
            <b>Bounded Service:</b> Select a Notification Type and <i>msg.payload</i> will be sent as a Notification <br/>         
            Check the info tab, to get more information about each of the fields
        </div>
        <div id = "form-tipsUnbounded">
            <b>Unbounded Service:</b> IBM Push Notification service is not bound. Either bind the IBM Push Notification service or provide the <i>Application ID and Secret</i>.<br/>
        </div>
        <div id = "form-tipsLocal">
            <b>Local Mode:</b> Node-RED is running in local mode. Provide the <i>Application ID and Secret</i><br/>
        </div>
</div>
    
</script>






<script type="text/javascript">
    RED.nodes.registerType('ibmpush',{
        category: 'output',
        color:"rgb(115, 185, 221)",     
        defaults: {   
            name: {},
            ApplicationID: {value:"", required:false},
            //ApplicationSecret: {value:"", required:true},
            identifiers: {value:""},
            notification: {value:"broadcast"},
            mode: {value:"SANDBOX"}
        },
        inputs:1,               
        outputs:0,
        icon: "ibmpush-icon.png", 
        align: "right",
        label: function() {
            return this.name ||"IBM Push";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function () {

            $.getJSON('ibmpush/vcap/',function(data) {
                console.log("resp");
                console.log(data);
                if(data.isBound) {
                    
                    $("#propDiv").hide();
                    //tooltip
                    $("#form-tipsUnbounded").hide();
                    $("#form-tipsLocal").hide();
                } else if(data.isBluemix){
                    $("#propDiv").show();
                    //tooltip
                    $("#form-tipsBounded").hide();
                    $("#form-tipsLocal").hide();
                } else {
                    $("#propDiv").show();
                    //tooltip
                    $("#form-tipsBounded").hide();
                    $("#form-tipsUnbounded").hide();
                }
                
            });
            
            $.getJSON("ibmpush/"+this.id, function(data) {
                    
                    if (data.hasPassword) {
                        $('#node-input-ApplicationSecret').data("v",'__PWRD__');
                        $("#node-input-ApplicationSecret").val("__PWRD__");
                    } else {
                        $('#node-input-ApplicationSecret').data("v",'');
                        $("#node-input-ApplicationSecret").val("");
                    }
            });

            var notificationSelect = $('#node-input-notification');
            notificationSelect.change(function() {
                var service = notificationSelect.val();
                if (service === "broadcast" || service === "android" || service === "ios") {
                    $("#node-input-identifiersLabel").hide();
                    $("#node-input-identifiers").hide();
                } else {
                    $("#node-input-identifiersLabel").show();
                    $("#node-input-identifiers").show();
                }
            });

        },
        
        oneditsave: function() {
            
            var oldPass = $('#node-input-ApplicationSecret').data("v");
            var newPass = $("#node-input-ApplicationSecret").val();
            
            if(oldPass != newPass) {
                if (newPass == "") {
                        $.ajax({
                            url: 'ibmpush/'+this.id,
                            type: 'DELETE',
                            success: function(result) {}
                        });
                } else {
                    var credentials = {};
                    if (newPass != "__PWRD__") {
                        credentials.password = newPass;
                    }
                    $.ajax({
                        url: "ibmpush/"+this.id,
                        type: "POST",
                        data: credentials,
                        success: function(result) {}
                    });
                }
                return true;
            }
        }
    });

    
</script><script type="text/x-red" data-help-name="ibmpush">
    <p>Sends Push Notifications to mobile devices using IBM Push notification for Bluemix</p>
    <p><code>msg.payload</code> is used as the alert in the Notification.
    <p><b>Mobile Push Properties</b></p>
    <p> <b>Mode</b> Select the mode of operation for the IBM Push Notification. You can override this property by providing <code>msg.mode</code> </p> 

    <p> <b>Application ID and Secret</b> mandatory only when used in <i>non-Bluemix environment</i> and must be copied from the IBM Push Notification service in Bluemix. 
    If used in <i>Bluemix</i>, these properties will be automatically read.</p> 
    
    <p><b>Notification Type</b> Type of notification to be pushed.
        <ul>
            <li><i>Broadcast</i> - Send notifications to all the registered devices</li>
            <li><i>By Tags</i> - Send notifications to devices subscribed to that tag. Can take multiple values seperated by comma(,)</li>
            <li><i>By DeviceIds</i> - Send notifications to devices by their device ID. Can take multiple values seperated by comma(,)</li>
            <li><i>Only Android devices</i> - Send notifications to all the registered Android devices</li>
            <li><i>Only iOS devices</i> - Send notifications to all the registered iOS devices</li>

        </ul>
    </p>

    <p><b>Notification Identifiers</b> Used when notifications are sent <i>By Tags and By DeviceIds</i>. This can take multiple values seperated by comma(,). Example: GoldCoupons,SilverCoupons</p>

    <p> Visit this <a target="_blank" href="https://new-console.ng.bluemix.net/docs/services/mobilepush/c_overview_push.html">link</a> for more information on IBM Push Notification for Bluemix

</script><!--
  Copyright 2014, 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="ibmiot">
	<div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-config-input-user"><i class="fa fa-user-secret"></i> API Key</label>
        <input type="text" id="node-config-input-user">
    </div>
    <div class="form-row">
        <label for="node-config-input-pass"><i class="fa fa-lock"></i> API Token</label>
        <input type="password" id="node-config-input-password">
    </div>
    <div class="form-row">
        <label for="node-config-input-shared"><i class="fa fa-tag"></i> Scalable</label>
        <input type="checkbox" id="node-config-input-shared" style="width: 15px;">

        <label for="node-config-input-appId" style="margin-left: 20px; width: 120px" ><i class="fa fa-tag"></i> Application ID</label>
        <input type="text" id="node-config-input-appId" style="width: 35%; ">
    </div>
    <div class="form-row">
       <label for="node-config-input-keepalive">  <i class="fa fa-clock-o"></i> Keep Alive </label>
       <input type="text" id="node-config-input-keepalive" placeholder="60" style="width: 50px;">
       <label style="width: 80px;"> Seconds </label>
       <input type="checkbox" id="node-config-input-cleansession" style="margin-left: 30px; height: 1em;display: inline-block; width: auto; vertical-align: middle;">
       <label for="node-config-input-cleansession" style="width: auto;">Use Clean Session</label>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('ibmiot',{
        category: 'config',
        color:"rgb(0, 155, 255)",
        defaults: {
            name: { value:"" },
            keepalive: {value: 60, validate:RED.validators.number()},
            cleansession: {value: true},
            appId : { value : "" },
            shared : { value : false }
            //user -> credentials
            //pass -> credentials
        },
        label: function() {
            return this.name || this.appId;
        },
        oneditprepare: function() {
            if($("#node-config-input-keepalive").val() === '') {
                $("#node-config-input-keepalive").val("60");
            }

            if (typeof this.cleansession === 'undefined') {
                this.cleansession = true;
                $("#node-config-input-cleansession").prop("checked",true);
            }

            $("#node-config-input-shared").change(function() {
              if ($('#node-config-input-shared').is(":checked")) {
                $("#node-config-input-appId").prop('required',true);
              } else {
                $("#node-config-input-appId").prop('required',false);
              }
              
            });
        },
		credentials: {
			user: {type:"text"},
			password: {type:"password"}
		}
    });
</script>



<script type="text/x-red" data-template-name="ibmiot out">

    <div class="form-row">
        <label for="node-input-authentication" id="node-input-authenticationLabel" style="width:130px;"><i class="fa fa-umbrella"></i> Authentication</label>
		<select id="node-input-authentication"  style="width:300px;">
			<option value="quickstart">Quickstart</option>
			<option value="apiKey">API Key</option>
			<option value="boundService" id = "node-input-bounded-outnode">Bluemix Service</option>
		</select>
    </div>

	<div class="form-row hide" id="node-input-apiKey-div">
        <label for="node-input-apiKey" id="node-input-apiKeyLabel" style="width:130px;"><i class="fa fa-key"></i> API Key</label>
        <input type="text" id="node-input-apiKey" placeholder="API Key" style="width:300px;">
    </div>

	<div class="form-row">
        <label for="node-input-outputType" id="node-input-outputTypeLabel" style="width:130px;"><i class="fa fa-gears"></i> Output Type</label>
		<select id="node-input-outputType"  style="width:300px;">
			<option value="evt">Device Event</option>
			<option value="cmd">Device Command</option>
		</select>
    </div>

	<div class="form-row">
        <label for="node-input-deviceType" id="node-input-deviceTypeLabel" style="width:130px;"><i class="fa fa-rocket"></i> Device Type</label>
        <input type="text" id="node-input-deviceType" placeholder="device type e.g. armmbed" style="width:300px;">
    </div>


	<div class="form-row">
        <label for="node-input-deviceId" id="node-input-deviceIdLabel" style="width:130px;"><i class="fa fa-street-view"></i> Device Id</label>
        <input type="text" id="node-input-deviceId" placeholder="device id e.g. ab12cd231a21" style="width:300px;">
    </div>

    <div class="form-row">
        <label for="node-input-eventCommandType" id="node-input-eventCommandTypeId" style="width:130px;"><i class="fa fa-tachometer"></i> Event Type</label>
        <input type="text" id="node-input-eventCommandType" placeholder="command/event format e.g blink" style="width:300px;">
    </div>
    <div class="form-row">
        <label for="node-input-format" id="node-input-formatLabel"style="width:130px;"><i class="fa fa-file"></i> Format</label>
        <input type="text" id="node-input-format" placeholder="format e.g. json" style="width:300px;">
    </div>
    <div class="form-row">
        <label for="node-input-data" style="width:130px;"><i class="fa fa-database"></i> Data</label>
        <input type="text" id="node-input-data" placeholder="payload information e.g. data points" style="width:300px;">
    </div>

    <div class="form-row" id="node-form-qos-div">
        <label id="node-input-qos-label" for="node-input-qos" style="width:130px;"> <i class="fa fa-empire"></i> QoS </label>
        <select id="node-input-qos" style="width:50px;">
            <option value=''></option>
            <option value=0>0</option>
            <option value=1>1</option>
            <option value=2>2</option>
        </select>
    </div>

	<div class="form-row">
        <label for="node-input-name" style="width:130px;"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="iot-new-out" style="width:300px;">
    </div>

	<div class="form-row hidden">
        <label for="node-input-service" style="width:130px;"><i class="fa fa-tag"></i> Service</label>
        <input type="text" id="node-input-service" placeholder="iot-new-out" style="width:300px;">
    </div>

    <div class="form-tips">
		<div id="registeredTips">
			<b>Note:</b> If there is a property in the message that corresponds to any of the values entered above, then the property in the message takes precedence. See the Info tab for more details.<br/>
			<b>Example JSON device event:</b> {"d":{"myName":"Arduino Uno", "temperature":989}}
		</div>

		<div id="quickstartTips">
			<b>Note:</b> If there is a property in the message that corresponds to any of the values entered above, then the property in the message takes precedence. See the Info tab for more details.<br/>
			<b>Quickstart flow can only accept JSON events.</b> <br/>
			<b>Example JSON device event:</b> {"d":{"myName":"Arduino Uno", "temperature":989}}
		</div>
	</div>
</script>




<script type="text/x-red" data-template-name="ibmiot in">
    <div class="form-row">
        <label for="node-input-authentication" id="node-input-authenticationLabel" style="width:130px;"><i class="fa fa-umbrella"></i> Authentication</label>
		<select id="node-input-authentication"  style="width:300px;">
			<option value="quickstart">Quickstart</option>
			<option value="apiKey">API Key</option>
			<option value="boundService" id = "node-input-bounded-innode">Bluemix Service</option>
		</select>
    </div>

	<div class="form-row hide" id = "node-input-apiKey-div">
        <label for="node-input-apiKey" id="node-input-apiKeyLabel" style="width:130px;"><i class="fa fa-key"></i> API Key</label>
        <input type="text" id="node-input-apiKey" placeholder="API Key" style="width:300px;">
    </div>

    <div class="form-row">
        <label for="node-input-inputType" id="node-input-inputTypeLabel" style="width:130px;"><i class="fa fa-gears"></i> Input Type</label>
		<select id="node-input-inputType"  style="width:300px;">
			<option value="evt">Device Event</option>
			<option value="cmd" id="node-input-inputTypeCmd">Device Command</option>
			<option value="devsts">Device Status</option>
			<option value="appsts">Application Status</option>
		</select>
    </div>

    <div class="form-row">
        <label for="node-input-deviceType" id="node-input-deviceTypeLabel" style="width:130px;"><i class="fa fa-rocket"></i> Device Type</label>
		<input type="checkbox" id="node-input-allDeviceTypes" style="width:10px;" >
		<label for="node-input-allDeviceTypesLabel" id="node-input-allDeviceTypesLabel" style="width:40px;">All or </label>
        <input type="text" id="node-input-deviceType" placeholder="device type e.g. armmbed" style="width:240px;">
    </div>
	<div class="form-row">
        <label for="node-input-deviceId" id="node-input-deviceIdLabel"style="width:130px;"><i class="fa fa-street-view"></i> Device Id</label>
		<input type="checkbox" id="node-input-allDevices" style="width:10px;">
		<label for="node-input-allDevicesLabel" id="node-input-allDevicesLabel" style="width:40px;">All or </label>
        <input type="text" id="node-input-deviceId" placeholder="device id e.g. ab12cd231a21" style="width:240px;">
    </div>
	<div class="form-row">
        <label for="node-input-applicationId" id="node-input-applicationIdLabel"style="width:130px;"><i class="fa fa-tasks"></i> Application Id</label>
		<input type="checkbox" id="node-input-allApplications" style="width:10px;">
		<label for="node-input-allApplicationsLabel" id="node-input-allApplicationsLabel" style="width:40px;">All or </label>
        <input type="text" id="node-input-applicationId" placeholder="application id e.g. ab12cd231a21" style="width:240px;">
    </div>

	<div class="form-row">
        <label for="node-input-event" id="node-input-eventLabel" style="width:130px;"><i class="fa fa-tasks"></i> Event</label>
		<input type="checkbox" id="node-input-allEvents" style="width:10px;" >
		<label for="node-input-allEventsLabel" id="node-input-allEventsLabel" style="width:40px;">All or </label>
        <input type="text" id="node-input-eventType" placeholder="event type e.g. status" style="width:240px;">
    </div>

	<div class="form-row">
        <label for="node-input-event" id="node-input-commandLabel" style="width:130px;"><i class="fa fa-tasks"></i> Command</label>
		<input type="checkbox" id="node-input-allCommands" style="width:10px;" >
		<label for="node-input-allCommandsLabel" id="node-input-allCommandsLabel" style="width:40px;">All or </label>
        <input type="text" id="node-input-commandType" placeholder="comand type e.g. blink" style="width:240px;">
    </div>

    <div class="form-row">
        <label for="node-input-format" id="node-input-formatLabel"  style="width:130px;"><i class="fa fa-file"></i> Format</label>
		<input type="checkbox" id="node-input-allFormats" style="width:10px;" >
		<label for="node-input-allFormatsLabel" id="node-input-allFormatsLabel" style="width:40px;">All or </label>
        <input type="text" id="node-input-format" placeholder="format e.g. json" style="width:240px;">
    </div>

    <div class="form-row" id="node-form-qos-div">
        <label id="node-input-qos-label" for="node-input-qos" style="width:130px;"><i class="fa fa-empire"></i> QoS </label>
        <select id="node-input-qos" style="width:70px;">
            <option value=0>0</option>
            <option value=1>1</option>
            <option value=2>2</option>
        </select>
    </div>

	<div class="form-row">
        <label for="node-input-name" style="width:130px;"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="iot-new-in" style="width:300px;">
    </div>

	<div class="form-row hidden">
        <label for="node-input-service" style="width:130px;"><i class="fa fa-tag"></i> Service</label>
        <input type="text" id="node-input-service" placeholder="iot-new-out" style="width:300px;">
    </div>

    <div class="form-tips">
		<div id="registeredTips">
			Use the Input Type property to configure this node to
			receive Events sent by IoT Devices, Commands sent to IoT Devices, Status Messages referring to IoT Devices, or Status Messages referring to IoT Applications<br/>
		</div>

		<div id="quickstartTips">
			<b>Quickstart:</b> Use the Input Type property to configure this node to receive Events sent by IoT Devices, Status Messages referring to IoT Devices, or Status Messages referring to IoT Applications<br/>
		</div>

		Check the info tab, to get more information about each of the fields
	</div>

</script>





<script type="text/javascript">
	RED.nodes.registerType('ibmiot out',{
		category: 'output',
		color:"rgb(0, 155, 255)",
		defaults: {
			authentication: {value:"quickstart"},
			apiKey: {type:"ibmiot", validate: validateAuthorization},
			outputType: {value:""},
			deviceId: {value:"", required: true},
			deviceType: {value:"", required: true},
			eventCommandType: {value:"", required: true},
			format: {value:"", required: true},
			data: {value:"", required: true},
			qos: {value: 0},
			name: { value:"IBM IoT" },
			service: {value: ""}
		},
		inputs:1,
		outputs:0,
		icon: "iotcloud-icon.png",
		align: "right",
		label: function() {
			return this.name || "ibmiot out";
		},
		labelStyle: function() {
			return this.name ? "node_label_italic" : "";
		},
		oneditprepare: function() {
			var result = "";
			var noderedVersion = "";
			$.getJSON('ibmiot/service?ts=' + Math.random(), function(data) {
				var authnode = document.getElementById('node-input-authentication');
				var bluemixnode = authnode.lastElementChild;
				if(data.service !== 'registered') {
					if(bluemixnode.id === 'node-input-bounded-outnode') {
						bluemixnode.remove();
					} else {
					}

				} else {
				}
				noderedVersion = data.version;
				var serviceSelected = $("#node-input-authentication").val();
				if(serviceSelected === "quickstart") {

					result = "quickstart";

					$('#node-input-service').val(result);

					document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
					document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
					$('#node-input-eventCommandType').attr("placeholder", "event type e.g. status");

					$("#node-input-apiKey-div").hide();

					$('#node-input-outputType').val("evt");
					$("#node-input-outputTypeLabel").hide();
					$("#node-input-outputType").hide();
					$("#node-input-deviceTypeLabel").hide();
					$("#node-input-deviceType").hide();
					$("#node-input-deviceType").val(noderedVersion);
					$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					$("#node-input-formatLabel").hide();
					$("#node-input-format").val("json");
					$("#node-input-format").hide();

					$("#registeredTips").hide();
					$("#quickstartTips").show();

                                        $("#node-form-qos-div").hide();
				} else if(serviceSelected === "apiKey"){
					result = "registered";

					$("#node-input-apiKey-div").show();

					var id = $("#node-input-outputType").val();
					if (id == "evt") {
						document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
						$('#node-input-eventCommandType').attr("placeholder", "event type e.g. blink");
					}

					if (id == "cmd") {
						document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-legal"></i> Command Type</label>';
						$('#node-input-eventCommandType').attr("placeholder", "command type e.g. blink");
					}


					$('#node-input-service').val(result);
					$("#node-input-outputTypeLabel").show();
					$("#node-input-outputType").show();
					$("#node-input-deviceTypeLabel").show();
					$("#node-input-deviceType").show();
					$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					$("#node-input-formatLabel").show();
					$("#node-input-format").show();

                                        $("#node-form-qos-div").show();

					$("#registeredTips").show();
					$("#quickstartTips").hide();

					$("#node-input-outputType").change(function() {
						var id = $("#node-input-outputType option:selected").val();
						if (id == "evt") {
							document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
							$('#node-input-eventCommandType').attr("placeholder", "event type e.g. blink");
						} else if (id == "cmd") {
							document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-legal"></i> Command Type</label>';
							$('#node-input-eventCommandType').attr("placeholder", "command type e.g. blink");
						}
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					});

				} else {
					result = "registered";

					$("#node-input-apiKey-div").hide();

					$("#node-input-apiTokenLabel").hide();
					$("#node-input-apiToken").hide();

					var id = $("#node-input-outputType").val();
					if (id == "evt") {
						document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
						$('#node-input-eventCommandType').attr("placeholder", "event type e.g. blink");
					}

					if (id == "cmd") {
						document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-legal"></i> Command Type</label>';
						$('#node-input-eventCommandType').attr("placeholder", "command type e.g. blink");
					}

					$('#node-input-service').val(result);
					$("#node-input-outputTypeLabel").show();
					$("#node-input-outputType").show();
					$("#node-input-deviceTypeLabel").show();
					$("#node-input-deviceType").show();
					$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					$("#node-input-formatLabel").show();
					$("#node-input-format").show();

                                        $("#node-form-qos-div").show();

					$("#registeredTips").show();
					$("#quickstartTips").hide();

					$("#node-input-outputType").change(function() {
						var id = $("#node-input-outputType option:selected").val();
						if (id == "evt") {
							document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
							$('#node-input-eventCommandType').attr("placeholder", "event type e.g. blink");
						} else if (id == "cmd") {
							document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-legal"></i> Command Type</label>';
							$('#node-input-eventCommandType').attr("placeholder", "command type e.g. blink");
						}
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					});
				}
				$("#node-input-authentication").change(function() {
					var serviceSelected = $("#node-input-authentication option:selected").val();
					if(serviceSelected === "quickstart") {

						result = "quickstart";

						$('#node-input-service').val(result);

						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
						$('#node-input-eventCommandType').attr("placeholder", "event type e.g. status");

						$("#node-input-apiKey-div").hide();

						$('#node-input-outputType').val("evt");
						$("#node-input-outputTypeLabel").hide();
						$("#node-input-outputType").hide();
						$("#node-input-deviceTypeLabel").hide();
						$("#node-input-deviceType").hide();
						$("#node-input-deviceType").val(noderedVersion);
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.-]/gi, ""));
						$("#node-input-formatLabel").hide();
						$("#node-input-format").val("json");
						$("#node-input-format").hide();

						$("#registeredTips").hide();
						$("#quickstartTips").show();

                                                $("#node-form-qos-div").hide();
					} else if(serviceSelected === "apiKey"){
						result = "registered";
						$("#node-input-apiKey-div").show();

						var id = $("#node-input-outputType").val();
						if (id == "evt") {
							document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
							$('#node-input-eventCommandType').attr("placeholder", "event type e.g. blink");
						}

						if (id == "cmd") {
							document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-legal"></i> Command Type</label>';
							$('#node-input-eventCommandType').attr("placeholder", "command type e.g. blink");
						}


						$('#node-input-service').val(result);
						$("#node-input-outputTypeLabel").show();
						$("#node-input-outputType").show();
						$("#node-input-deviceTypeLabel").show();
						$("#node-input-deviceType").show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$("#node-input-formatLabel").show();
						$("#node-input-format").show();

                                                $("#node-form-qos-div").show();

						$("#registeredTips").show();
						$("#quickstartTips").hide();

						$("#node-input-outputType").change(function() {
							var id = $("#node-input-outputType option:selected").val();
							if (id == "evt") {
								document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
								$('#node-input-eventCommandType').attr("placeholder", "event type e.g. blink");
							} else if (id == "cmd") {
								document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-legal"></i> Command Type</label>';
								$('#node-input-eventCommandType').attr("placeholder", "command type e.g. blink");
							}
							$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						});
					} else {
						result = "registered";

						$("#node-input-apiKey-div").hide();

						var id = $("#node-input-outputType").val();
						if (id == "evt") {
							document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
							$('#node-input-eventCommandType').attr("placeholder", "event type e.g. blink");
						}

						if (id == "cmd") {
							document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-legal"></i> Command Type</label>';
							$('#node-input-eventCommandType').attr("placeholder", "command type e.g. blink");
						}

						$('#node-input-service').val(result);
						$("#node-input-outputTypeLabel").show();
						$("#node-input-outputType").show();
						$("#node-input-deviceTypeLabel").show();
						$("#node-input-deviceType").show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$("#node-input-formatLabel").show();
						$("#node-input-format").show();

                                                $("#node-form-qos-div").show();

						$("#registeredTips").show();
						$("#quickstartTips").hide();

						$("#node-input-outputType").change(function() {
							var id = $("#node-input-outputType option:selected").val();
							if (id == "evt") {
								document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-tachometer"></i> Event Type</label>';
								$('#node-input-eventCommandType').attr("placeholder", "event type e.g. blink");
							} else if (id == "cmd") {
								document.getElementById('node-input-eventCommandTypeId').innerHTML='<i class="fa fa-legal"></i> Command Type</label>';
								$('#node-input-eventCommandType').attr("placeholder", "command type e.g. blink");
							}
							$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						});
					}
				});
			});
		}
	});

	function validateAuthorization(v) {
		return this.authentication !== "quickstart" || this.authentication !== "boundService";
	}

</script>

<script type="text/javascript">
	RED.nodes.registerType('ibmiot in',{
		category: 'input',
		color:"rgb(0, 155, 255)",
		defaults: {
			authentication: {value:"quickstart"},
			apiKey: {type:"ibmiot", validate: validateAuthorization},
			inputType: {value:"evt"},
			deviceId: {value:""},
			applicationId: {value:""},
			deviceType: {value:""},
			eventType: {value:""},
			commandType: {value:""},
			format: {value:""},
			name: { value:"IBM IoT" },
			service: {value:""},
			allDevices: {value: ""},
			allApplications: {value: ""},
			allDeviceTypes: {value: ""},
			allEvents: {value: ""},
			allCommands: {value: ""},
			allFormats: {value: ""},
                        qos: {value: 0},

		},
		inputs:0,
		outputs:1,
		icon: "iotcloud-icon.png",
		label: function() {
			return this.name || "iot-new-in";
		},
		labelStyle: function() {
				return this.name ? "node_label_italic" : "";
		},
		oneditprepare: function() {
			result = "";

			var noderedVersion = "";
			$.getJSON('ibmiot/service?ts=' + Math.random(), function(data) {
				var authnode = document.getElementById('node-input-authentication');
				var bluemixnode = authnode.lastElementChild;

				if(data.service !== 'registered') {
					noderedVersion = data.version;

					if(bluemixnode.id === 'node-input-bounded-innode') {
						bluemixnode.remove();
					} else {

					}

				} else {

				}
			});

			var serviceSelected = $("#node-input-authentication").val();

			if(serviceSelected === "quickstart") {
				result = "quickstart";

                                $("#node-input-apiKey-div").hide();

				var id = $("#node-input-inputType").val();
				if (id == "evt") {
					$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					$('#node-input-deviceIdLabel').show();
					$('#node-input-deviceId').show();

					$('#node-input-applicationIdLabel').hide();
					$("#node-input-applicationId").val('');
					$('#node-input-applicationId').hide();

					document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
					$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");
				}

				if (id == "devsts") {
					$('#node-input-deviceIdLabel').show();
					$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					$('#node-input-deviceId').show();

					$('#node-input-applicationIdLabel').hide();
					$("#node-input-applicationId").val('');
					$('#node-input-applicationId').hide();

					document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
					$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");
				}

				if (id == "appsts") {
					$('#node-input-deviceIdLabel').hide();
					$("#node-input-deviceId").val('');
					$('#node-input-deviceId').hide();

					$('#node-input-applicationIdLabel').show();
					$('#node-input-applicationId').show();

					document.getElementById('node-input-applicationIdLabel').innerHTML='<i class="fa fa-tasks"></i> App Id</label>';
					$('#node-input-applicationId').attr("placeholder", "app id e.g. myapp02");

				}

				$('#node-input-service').val(result);

				$("#node-input-inputTypeCmd").hide();
				$("#node-input-allDevicesLabel").hide();
				$("#node-input-allDevices").prop("checked", false);
				$("#node-input-allDevices").hide();

				$("#node-input-allApplicationsLabel").hide();
				$("#node-input-allApplications").prop("checked", false);
				$("#node-input-allApplications").hide();

				$("#node-input-deviceTypeLabel").hide();
				$("#node-input-deviceType").val("+");
				$("#node-input-deviceType").hide();
				$("#node-input-allDeviceTypesLabel").hide();
				$("#node-input-allDeviceTypes").prop("checked", true);
				$("#node-input-allDeviceTypes").hide();
				$("#node-input-eventLabel").hide();
				$("#node-input-eventType").val("+");
				$("#node-input-eventType").hide();
				$("#node-input-allEventsLabel").hide();
				$("#node-input-allEvents").prop("checked", true);
				$("#node-input-allEvents").hide();
				$("#node-input-formatLabel").hide();
				$("#node-input-format").val("json");
				$("#node-input-format").hide();
				$("#node-input-allFormatsLabel").hide();
				$("#node-input-allFormats").hide();

				$("#node-input-commandLabel").hide();
				$("#node-input-allCommands").hide();
				$("#node-input-allCommandsLabel").hide();
				$("#node-input-commandType").hide();

				$("#registeredTips").hide();
				$("#quickstartTips").show();

				var allDevicesValue = $("#node-input-allDevices").is(":checked");
				if( allDevicesValue) {
					$("#node-input-deviceId").prop("disabled", false);
				}

				var allDeviceTypesValue = $("#node-input-allDeviceTypes").is(":checked");
				if( allDeviceTypesValue) {
					$("#node-input-deviceType").prop("disabled", false);
				}

				var allEventsValue = $("#node-input-allEvents").is(":checked");
				if( allEventsValue) {
					$("#node-input-eventType").prop("disabled", false);
				}

				var allFormatsValue = $("#node-input-allFormats").is(":checked");
				if( allFormatsValue) {
					$("#node-input-format").prop("disabled", false);
				}

				var inputTypeSelected = $("#node-input-inputType").val();
				if( inputTypeSelected == "cmd") {
					$("#node-input-inputType").val("evt");
				}


				$("#node-input-inputType").change(function() {
					var id = $("#node-input-inputType option:selected").val();
					if (id == "evt") {
						$('#node-input-deviceIdLabel').show();
						$('#node-input-deviceId').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));

						$('#node-input-applicationIdLabel').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");
					}

					if (id == "devsts") {
						$('#node-input-deviceIdLabel').show();
						$('#node-input-deviceId').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));

						$('#node-input-applicationIdLabel').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");
					}

					if (id == "appsts") {
						$('#node-input-deviceIdLabel').hide();
						$("#node-input-deviceId").val('');
						$('#node-input-deviceId').hide();

						$('#node-input-applicationIdLabel').show();
						$('#node-input-applicationId').show();

						document.getElementById('node-input-applicationIdLabel').innerHTML='<i class="fa fa-tasks"></i> App Id</label>';
						$('#node-input-applicationId').attr("placeholder", "app id e.g. myapp02");

					}

				});
                                $("#node-form-qos-div").hide();
			} else {

				result = "registered";

				if( serviceSelected === "boundService") {
					$("#node-input-apiKey-div").hide();
				} else {
	                $("#node-input-apiKey-div").show();
				}

				$('#node-input-service').val(result);
				$("#node-input-inputTypeCmd").show();
				$("#node-input-inputType").show();
				$("#node-input-allDevicesLabel").show();
				$("#node-input-allDevices").show();
				$("#node-input-deviceTypeLabel").show();
				$("#node-input-deviceType").show();
				$("#node-input-allDeviceTypesLabel").show();
				$("#node-input-allDeviceTypes").show();
				$("#node-input-eventLabel").show();
				$("#node-input-eventType").show();
				$("#node-input-allEventsLabel").show();
				$("#node-input-allEvents").show();
				$("#node-input-formatLabel").show();
				$("#node-input-format").show();
				$("#node-input-allFormatsLabel").show();
				$("#node-input-allFormats").show();

                                $("#node-form-qos-div").show();

				$("#registeredTips").show();
				$("#quickstartTips").hide();

                                if(!$("#node-input-qos option:selected").length) {
                                   document.getElementById("node-input-qos").options[0].selected = true;
                                }

				var allDevicesValue = $("#node-input-allDevices").is(":checked");
				if( allDevicesValue) {
					$("#node-input-deviceId").prop("disabled", true);
				} else {
					$("#node-input-deviceId").prop("disabled", false);
				}
				$("#node-input-allDevices").change(function() {
					if($("#node-input-allDevices").is(":checked")) {
						$("#node-input-deviceId").prop("disabled", true);
					} else {
						$("#node-input-deviceId").prop("disabled", false);
					}
				});

				var allApplicationsValue = $("#node-input-allApplications").is(":checked");
				if( allApplicationsValue) {
					$("#node-input-applicationId").prop("disabled", true);
				} else {
					$("#node-input-applicationId").prop("disabled", false);
				}
				$("#node-input-allApplications").change(function() {
					if($("#node-input-allApplications").is(":checked")) {
						$("#node-input-applicationId").prop("disabled", true);
					} else {
						$("#node-input-applicationId").prop("disabled", false);
					}
				});

				var allDeviceTypesValue = $("#node-input-allDeviceTypes").is(":checked");
				if( allDeviceTypesValue) {
					$("#node-input-deviceType").prop("disabled", true);
				} else {
					$("#node-input-deviceType").prop("disabled", false);
				}
				$("#node-input-allDeviceTypes").change(function() {
					if($("#node-input-allDeviceTypes").is(":checked")) {
						$("#node-input-deviceType").prop("disabled", true);
					} else {
						$("#node-input-deviceType").prop("disabled", false);
					}
				});

				var allEventsValue = $("#node-input-allEvents").is(":checked");
				if( allEventsValue) {
					$("#node-input-eventType").prop("disabled", true);
				} else {
					$("#node-input-eventType").prop("disabled", false);
				}
				$("#node-input-allEvents").change(function() {
					if($("#node-input-allEvents").is(":checked")) {
						$("#node-input-eventType").prop("disabled", true);
					} else {
						$("#node-input-eventType").prop("disabled", false);
					}
				});

				var allCommandsValue = $("#node-input-allCommands").is(":checked");
				if( allCommandsValue) {
					$("#node-input-commandType").prop("disabled", true);
				} else {
					$("#node-input-commandType").prop("disabled", false);
				}
				$("#node-input-allCommands").change(function() {
					if($("#node-input-allCommands").is(":checked")) {
						$("#node-input-commandType").prop("disabled", true);
					} else {
						$("#node-input-commandType").prop("disabled", false);
					}
				});

				var allFormatsValue = $("#node-input-allFormats").is(":checked");
				if( allFormatsValue) {
					$("#node-input-format").prop("disabled", true);
				} else {
					$("#node-input-format").prop("disabled", false);
				}
				$("#node-input-allFormats").change(function() {
					if($("#node-input-allFormats").is(":checked")) {
						$("#node-input-format").prop("disabled", true);
					} else {
						$("#node-input-format").prop("disabled", false);
					}
				});

				var id = $("#node-input-inputType").val();
				if (id == "evt") {
					$('#node-input-deviceIdLabel').show();
					$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					$('#node-input-deviceId').show();

					$('#node-input-applicationIdLabel').hide();
					$('#node-input-allApplicationsLabel').hide();
					$('#node-input-allApplications').hide();
					$("#node-input-applicationId").val('');
					$('#node-input-applicationId').hide();

					document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
					document.getElementById('node-input-eventLabel').innerHTML='<i class="fa fa-tasks"></i> Event';
					$('#node-input-eventType').attr("placeholder", "event type e.g. status");
					$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

					$("#node-input-eventLabel").show();
					$("#node-input-allEvents").show();
					$("#node-input-allEventsLabel").show();
					$("#node-input-eventType").show();

					$("#node-input-commandLabel").hide();
					$("#node-input-allCommands").hide();
					$("#node-input-allCommandsLabel").hide();
					$("#node-input-commandType").hide();

					$("#node-input-formatLabel").show();
					$("#node-input-format").show();
					$("#node-input-allFormats").show();
					$("#node-input-allFormatsLabel").show();
					$("#node-input-deviceTypeLabel").show();
					$("#node-input-deviceType").show();
					$("#node-input-allDeviceTypes").show();
					$("#node-input-allDeviceTypesLabel").show();

					$("#node-input-allDevices").show();
					$("#node-input-allDevicesLabel").show();

				} else if (id == "devsts"){
					$('#node-input-deviceIdLabel').show();
					$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					$('#node-input-deviceId').show();

					$('#node-input-applicationIdLabel').hide();
					$('#node-input-allApplicationsLabel').hide();
					$('#node-input-allApplications').hide();
					$("#node-input-applicationId").val('');
					$('#node-input-applicationId').hide();

					document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
					$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

					$("#node-input-eventLabel").hide();
					$("#node-input-allEvents").hide();
					$("#node-input-allEventsLabel").hide();
					$("#node-input-eventType").hide();

					$("#node-input-commandLabel").hide();
					$("#node-input-allCommands").hide();
					$("#node-input-allCommandsLabel").hide();
					$("#node-input-commandType").hide();

					$("#node-input-formatLabel").hide();
					$("#node-input-format").hide();
					$("#node-input-allFormats").hide();
					$("#node-input-allFormatsLabel").hide();
					$("#node-input-deviceTypeLabel").show();
					$("#node-input-deviceType").show();
					$("#node-input-allDeviceTypes").show();
					$("#node-input-allDeviceTypesLabel").show();

					$("#node-input-allDevices").show();
					$("#node-input-allDevicesLabel").show();
				} else if (id == "cmd"){
					$('#node-input-deviceIdLabel').show();
					$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
					$('#node-input-deviceId').show();

					$('#node-input-applicationIdLabel').hide();
					$('#node-input-allApplicationsLabel').hide();
					$('#node-input-allApplications').hide();
					$("#node-input-applicationId").val('');
					$('#node-input-applicationId').hide();

					document.getElementById('node-input-eventLabel').innerHTML='<i class="fa fa-tasks"></i> Command';
					document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
					$('#node-input-eventType').attr("placeholder", "command type e.g. blink");
					$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");


					$("#node-input-eventLabel").hide();
					$("#node-input-allEvents").hide();
					$("#node-input-allEventsLabel").hide();
					$("#node-input-eventType").hide();

					$("#node-input-commandLabel").show();
					$("#node-input-allCommands").show();
					$("#node-input-allCommandsLabel").show();
					$("#node-input-commandType").show();

					$("#node-input-formatLabel").show();
					$("#node-input-format").show();
					$("#node-input-allFormats").show();
					$("#node-input-allFormatsLabel").show();
					$("#node-input-deviceTypeLabel").show();
					$("#node-input-deviceType").show();
					$("#node-input-allDeviceTypes").show();
					$("#node-input-allDeviceTypesLabel").show();

					$("#node-input-allDevices").show();
					$("#node-input-allDevicesLabel").show();
				} else if (id == "appsts") {

					$('#node-input-deviceIdLabel').hide();
					$("#node-input-deviceId").val('');
					$('#node-input-deviceId').hide();

					$('#node-input-applicationIdLabel').show();
					$('#node-input-allApplicationsLabel').show();
					$('#node-input-allApplications').show();
					$('#node-input-applicationId').show();

					$("#node-input-commandLabel").hide();
					$("#node-input-allCommands").hide();
					$("#node-input-allCommandsLabel").hide();
					$("#node-input-commandType").hide();

					document.getElementById('node-input-applicationIdLabel').innerHTML='<i class="fa fa-tasks"></i> App Id</label>';
					$('#node-input-applicationId').attr("placeholder", "app id e.g. myapp02");

					$("#node-input-eventLabel").hide();
					$("#node-input-allEvents").hide();
					$("#node-input-allEventsLabel").hide();
					$("#node-input-eventType").hide();

					$("#node-input-formatLabel").hide();
					$("#node-input-format").hide();
					$("#node-input-allFormats").hide();
					$("#node-input-allFormatsLabel").hide();
					$("#node-input-deviceTypeLabel").hide();
					$("#node-input-deviceType").hide();
					$("#node-input-allDeviceTypes").hide();
					$("#node-input-allDeviceTypesLabel").hide();

					$("#node-input-allDevices").hide();
					$("#node-input-allDevicesLabel").hide();

				} else {

				}

				$("#node-input-inputType").change(function() {
					var id = $("#node-input-inputType option:selected").val();
					if (id == "evt") {
						$('#node-input-deviceIdLabel').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$('#node-input-deviceId').show();

						$('#node-input-applicationIdLabel').hide();
						$('#node-input-allApplicationsLabel').hide();
						$('#node-input-allApplications').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-eventLabel').innerHTML='<i class="fa fa-tasks"></i> Event';
						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						$('#node-input-eventType').attr("placeholder", "event type e.g. status");
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

						$("#node-input-eventLabel").show();
						$("#node-input-allEvents").show();
						$("#node-input-allEventsLabel").show();
						$("#node-input-eventType").show();

						$("#node-input-commandLabel").hide();
						$("#node-input-allCommands").hide();
						$("#node-input-allCommandsLabel").hide();
						$("#node-input-commandType").hide();

						$("#node-input-formatLabel").show();
						$("#node-input-format").show();
						$("#node-input-allFormats").show();
						$("#node-input-allFormatsLabel").show();
						$("#node-input-deviceTypeLabel").show();
						$("#node-input-deviceType").show();
						$("#node-input-allDeviceTypes").show();
						$("#node-input-allDeviceTypesLabel").show();

						$("#node-input-allDevices").show();
						$("#node-input-allDevicesLabel").show();

					} else if (id == "devsts"){
						$('#node-input-deviceIdLabel').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$('#node-input-deviceId').show();

						$('#node-input-applicationIdLabel').hide();
						$('#node-input-allApplicationsLabel').hide();
						$('#node-input-allApplications').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

						$("#node-input-eventLabel").hide();
						$("#node-input-allEvents").hide();
						$("#node-input-allEventsLabel").hide();
						$("#node-input-eventType").hide();

						$("#node-input-commandLabel").hide();
						$("#node-input-allCommands").hide();
						$("#node-input-allCommandsLabel").hide();
						$("#node-input-commandType").hide();

						$("#node-input-formatLabel").hide();
						$("#node-input-format").hide();
						$("#node-input-allFormats").hide();
						$("#node-input-allFormatsLabel").hide();
						$("#node-input-deviceTypeLabel").show();
						$("#node-input-deviceType").show();
						$("#node-input-allDeviceTypes").show();
						$("#node-input-allDeviceTypesLabel").show();

						$("#node-input-allDevices").show();
						$("#node-input-allDevicesLabel").show();
					} else if (id == "cmd"){
						$('#node-input-deviceIdLabel').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$('#node-input-deviceId').show();

						$('#node-input-applicationIdLabel').hide();
						$('#node-input-allApplicationsLabel').hide();
						$('#node-input-allApplications').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-eventLabel').innerHTML='<i class="fa fa-tasks"></i> Command';
						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						$('#node-input-eventType').attr("placeholder", "command type e.g. blink");
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

						$("#node-input-eventLabel").hide();
						$("#node-input-allEvents").hide();
						$("#node-input-allEventsLabel").hide();
						$("#node-input-eventType").hide();


						$("#node-input-commandLabel").show();
						$("#node-input-allCommands").show();
						$("#node-input-allCommandsLabel").show();
						$("#node-input-commandType").show();


						$("#node-input-formatLabel").show();
						$("#node-input-format").show();
						$("#node-input-allFormats").show();
						$("#node-input-allFormatsLabel").show();
						$("#node-input-deviceTypeLabel").show();
						$("#node-input-deviceType").show();
						$("#node-input-allDeviceTypes").show();
						$("#node-input-allDeviceTypesLabel").show();

						$("#node-input-allDevices").show();
						$("#node-input-allDevicesLabel").show();
					} else if (id == "appsts") {

						$('#node-input-deviceIdLabel').hide();
						$('#node-input-deviceId').hide();

						$('#node-input-applicationIdLabel').show();
						$('#node-input-allApplicationsLabel').show();
						$('#node-input-allApplications').show();
						$('#node-input-applicationId').show();

						document.getElementById('node-input-applicationIdLabel').innerHTML='<i class="fa fa-tasks"></i> App Id</label>';
						$('#node-input-applicationId').attr("placeholder", "app id e.g. myapp02");

						$('#node-input-deviceId').attr("placeholder", "app id e.g. myapp02");

						$("#node-input-eventLabel").hide();
						$("#node-input-allEvents").hide();
						$("#node-input-allEventsLabel").hide();
						$("#node-input-eventType").hide();

						$("#node-input-commandLabel").hide();
						$("#node-input-allCommands").hide();
						$("#node-input-allCommandsLabel").hide();
						$("#node-input-commandType").hide();

						$("#node-input-formatLabel").hide();
						$("#node-input-format").hide();
						$("#node-input-allFormats").hide();
						$("#node-input-allFormatsLabel").hide();
						$("#node-input-deviceTypeLabel").hide();
						$("#node-input-deviceId").val('');
						$("#node-input-deviceType").hide();
						$("#node-input-allDeviceTypes").hide();
						$("#node-input-allDeviceTypesLabel").hide();

						$("#node-input-allDevices").hide();
						$("#node-input-allDevicesLabel").hide();
					} else {

					}
				});
			}

			$("#node-input-authentication").change(function() {
				var serviceSelected = $("#node-input-authentication option:selected").val();

				var allDevicesValue = $("#node-input-allDevices").is(":checked");
				if( allDevicesValue) {
					$("#node-input-deviceId").prop("disabled", false);
				}

				if(serviceSelected === "quickstart") {
					result = "quickstart";

					$("#node-input-apiKey-div").hide();

					var id = $("#node-input-inputType").val();
					if (id == "evt") {
						$('#node-input-deviceIdLabel').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$('#node-input-deviceId').show();

						$('#node-input-applicationIdLabel').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");
					}

					if (id == "devsts") {
						$('#node-input-deviceIdLabel').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$('#node-input-deviceId').show();

						$('#node-input-applicationIdLabel').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");
					}

					if (id == "appsts") {
						$('#node-input-deviceIdLabel').hide();
						$("#node-input-deviceId").val('');
						$('#node-input-deviceId').hide();

						$('#node-input-applicationIdLabel').show();
						$('#node-input-applicationId').show();

						document.getElementById('node-input-applicationIdLabel').innerHTML='<i class="fa fa-tasks"></i> App Id</label>';
						$('#node-input-applicationId').attr("placeholder", "app id e.g. myapp02");

					}

					$('#node-input-service').val(result);

					$("#node-input-inputTypeCmd").hide();
					$("#node-input-allDevicesLabel").hide();
					$("#node-input-allDevices").prop("checked", false);
					$("#node-input-allDevices").hide();

					$("#node-input-allApplicationsLabel").hide();
					$("#node-input-allApplications").prop("checked", false);
					$("#node-input-allApplications").hide();

					$("#node-input-deviceTypeLabel").hide();
					$("#node-input-deviceType").val("+");
					$("#node-input-deviceType").hide();
					$("#node-input-allDeviceTypesLabel").hide();
					$("#node-input-allDeviceTypes").prop("checked", true);
					$("#node-input-allDeviceTypes").hide();
					$("#node-input-eventLabel").hide();
					$("#node-input-eventType").val("+");
					$("#node-input-eventType").hide();
					$("#node-input-allEventsLabel").hide();
					$("#node-input-allEvents").prop("checked", true);
					$("#node-input-allEvents").hide();
					$("#node-input-formatLabel").hide();
					$("#node-input-format").val("json");
					$("#node-input-format").hide();
					$("#node-input-allFormatsLabel").hide();
					$("#node-input-allFormats").hide();
                                        $("#node-form-qos-div").hide();

					$("#node-input-commandLabel").hide();
					$("#node-input-allCommands").hide();
					$("#node-input-allCommandsLabel").hide();
					$("#node-input-commandType").hide();

					$("#registeredTips").hide();
					$("#quickstartTips").show();

					var allDevicesValue = $("#node-input-allDevices").is(":checked");
					if( allDevicesValue) {
						$("#node-input-deviceId").prop("disabled", false);
					}

					var allDeviceTypesValue = $("#node-input-allDeviceTypes").is(":checked");
					if( allDeviceTypesValue) {
						$("#node-input-deviceType").prop("disabled", false);
					}

					var allEventsValue = $("#node-input-allEvents").is(":checked");
					if( allEventsValue) {
						$("#node-input-eventType").prop("disabled", false);
					}

					var allFormatsValue = $("#node-input-allFormats").is(":checked");
					if( allFormatsValue) {
						$("#node-input-format").prop("disabled", false);
					}

					var inputTypeSelected = $("#node-input-inputType").val();
					if( inputTypeSelected == "cmd") {
						$("#node-input-inputType").val("evt");
					}


					$("#node-input-inputType").change(function() {
						var id = $("#node-input-inputType option:selected").val();
						if (id == "evt") {
							$('#node-input-deviceIdLabel').show();
							$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
							$('#node-input-deviceId').show();

							$('#node-input-applicationIdLabel').hide();
							$("#node-input-applicationId").val('');
							$('#node-input-applicationId').hide();

							document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
							$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");
						}

						if (id == "devsts") {
							$('#node-input-deviceIdLabel').show();
							$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
							$('#node-input-deviceId').show();

							$('#node-input-applicationIdLabel').hide();
							$("#node-input-applicationId").val('');
							$('#node-input-applicationId').hide();

							document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
							$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");
						}

						if (id == "appsts") {
							$('#node-input-deviceIdLabel').hide();
							$("#node-input-deviceId").val('');
							$('#node-input-deviceId').hide();

							$('#node-input-applicationIdLabel').show();
							$('#node-input-applicationId').show();

							document.getElementById('node-input-applicationIdLabel').innerHTML='<i class="fa fa-tasks"></i> App Id</label>';
							$('#node-input-applicationId').attr("placeholder", "app id e.g. myapp02");
						}
					});
				} else {

					result = "registered";

					if( serviceSelected === "boundService" ) {
						$("#node-input-apiKey-div").hide();
					} else {
						$("#node-input-apiKey-div").show();
					}

					$('#node-input-service').val(result);
					$("#node-input-inputTypeCmd").show();
					$("#node-input-inputType").show();
					$("#node-input-allDevicesLabel").show();
					$("#node-input-allDevices").show();
					$("#node-input-deviceTypeLabel").show();
					$("#node-input-deviceType").show();
					$("#node-input-allDeviceTypesLabel").show();
					$("#node-input-allDeviceTypes").show();
					$("#node-input-eventLabel").show();
					$("#node-input-eventType").show();
					$("#node-input-allEventsLabel").show();
					$("#node-input-allEvents").show();
					$("#node-input-formatLabel").show();
					$("#node-input-format").show();
					$("#node-input-allFormatsLabel").show();
					$("#node-input-allFormats").show();
                                        $("#node-form-qos-div").show();

					$("#registeredTips").show();
					$("#quickstartTips").hide();

					var allDevicesValue = $("#node-input-allDevices").is(":checked");
					if( allDevicesValue) {
						$("#node-input-deviceId").prop("disabled", true);
					} else {
						$("#node-input-deviceId").prop("disabled", false);
					}
					$("#node-input-allDevices").change(function() {
						if($("#node-input-allDevices").is(":checked")) {
							$("#node-input-deviceId").prop("disabled", true);
						} else {
							$("#node-input-deviceId").prop("disabled", false);
						}
					});

					var allApplicationsValue = $("#node-input-allApplications").is(":checked");
					if( allApplicationsValue) {
						$("#node-input-applicationId").prop("disabled", true);
					} else {
						$("#node-input-applicationId").prop("disabled", false);
					}
					$("#node-input-allApplications").change(function() {
						if($("#node-input-allApplications").is(":checked")) {
							$("#node-input-applicationId").prop("disabled", true);
						} else {
							$("#node-input-applicationId").prop("disabled", false);
						}
					});

					var allDeviceTypesValue = $("#node-input-allDeviceTypes").is(":checked");
					if( allDeviceTypesValue) {
						$("#node-input-deviceType").prop("disabled", true);
					} else {
						$("#node-input-deviceType").prop("disabled", false);
					}
					$("#node-input-allDeviceTypes").change(function() {
						if($("#node-input-allDeviceTypes").is(":checked")) {
							$("#node-input-deviceType").prop("disabled", true);
						} else {
							$("#node-input-deviceType").prop("disabled", false);
						}
					});

					var allEventsValue = $("#node-input-allEvents").is(":checked");
					if( allEventsValue) {
						$("#node-input-eventType").prop("disabled", true);
					} else {
						$("#node-input-eventType").prop("disabled", false);
					}
					$("#node-input-allEvents").change(function() {
						if($("#node-input-allEvents").is(":checked")) {
							$("#node-input-eventType").prop("disabled", true);
						} else {
							$("#node-input-eventType").prop("disabled", false);
						}
					});

					var allCommandsValue = $("#node-input-allCommands").is(":checked");
					if( allCommandsValue) {
						$("#node-input-commandType").prop("disabled", true);
					} else {
						$("#node-input-commandType").prop("disabled", false);
					}
					$("#node-input-allCommands").change(function() {
						if($("#node-input-allCommands").is(":checked")) {
							$("#node-input-commandType").prop("disabled", true);
						} else {
							$("#node-input-commandType").prop("disabled", false);
						}
					});

					var allFormatsValue = $("#node-input-allFormats").is(":checked");
					if( allFormatsValue) {
						$("#node-input-format").prop("disabled", true);
					} else {
						$("#node-input-format").prop("disabled", false);
					}
					$("#node-input-allFormats").change(function() {
						if($("#node-input-allFormats").is(":checked")) {
							$("#node-input-format").prop("disabled", true);
						} else {
							$("#node-input-format").prop("disabled", false);
						}
					});

					var id = $("#node-input-inputType").val();
					if (id == "evt") {
						$('#node-input-deviceIdLabel').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$('#node-input-deviceId').show();

						$('#node-input-applicationIdLabel').hide();
						$('#node-input-allApplicationsLabel').hide();
						$('#node-input-allApplications').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						document.getElementById('node-input-eventLabel').innerHTML='<i class="fa fa-tasks"></i> Event';
						$('#node-input-eventType').attr("placeholder", "event type e.g. status");
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

						$("#node-input-eventLabel").show();
						$("#node-input-allEvents").show();
						$("#node-input-allEventsLabel").show();
						$("#node-input-eventType").show();

						$("#node-input-commandLabel").hide();
						$("#node-input-allCommands").hide();
						$("#node-input-allCommandsLabel").hide();
						$("#node-input-commandType").hide();

						$("#node-input-formatLabel").show();
						$("#node-input-format").show();
						$("#node-input-allFormats").show();
						$("#node-input-allFormatsLabel").show();
						$("#node-input-deviceTypeLabel").show();
						$("#node-input-deviceType").show();
						$("#node-input-allDeviceTypes").show();
						$("#node-input-allDeviceTypesLabel").show();

						$("#node-input-allDevices").show();
						$("#node-input-allDevicesLabel").show();

					} else if (id == "devsts"){
						$('#node-input-deviceIdLabel').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$('#node-input-deviceId').show();

						$('#node-input-applicationIdLabel').hide();
						$('#node-input-allApplicationsLabel').hide();
						$('#node-input-allApplications').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

						$("#node-input-eventLabel").hide();
						$("#node-input-allEvents").hide();
						$("#node-input-allEventsLabel").hide();
						$("#node-input-eventType").hide();

						$("#node-input-commandLabel").hide();
						$("#node-input-allCommands").hide();
						$("#node-input-allCommandsLabel").hide();
						$("#node-input-commandType").hide();

						$("#node-input-formatLabel").hide();
						$("#node-input-format").hide();
						$("#node-input-allFormats").hide();
						$("#node-input-allFormatsLabel").hide();
						$("#node-input-deviceTypeLabel").show();
						$("#node-input-deviceType").show();
						$("#node-input-allDeviceTypes").show();
						$("#node-input-allDeviceTypesLabel").show();

						$("#node-input-allDevices").show();
						$("#node-input-allDevicesLabel").show();
					} else if (id == "cmd"){
						$('#node-input-deviceIdLabel').show();
						$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
						$('#node-input-deviceId').show();

						$('#node-input-applicationIdLabel').hide();
						$('#node-input-allApplicationsLabel').hide();
						$('#node-input-allApplications').hide();
						$("#node-input-applicationId").val('');
						$('#node-input-applicationId').hide();

						document.getElementById('node-input-eventLabel').innerHTML='<i class="fa fa-tasks"></i> Command';
						document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
						$('#node-input-eventType').attr("placeholder", "command type e.g. blink");
						$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");


						$("#node-input-eventLabel").hide();
						$("#node-input-allEvents").hide();
						$("#node-input-allEventsLabel").hide();
						$("#node-input-eventType").hide();

						$("#node-input-commandLabel").show();
						$("#node-input-allCommands").show();
						$("#node-input-allCommandsLabel").show();
						$("#node-input-commandType").show();

						$("#node-input-formatLabel").show();
						$("#node-input-format").show();
						$("#node-input-allFormats").show();
						$("#node-input-allFormatsLabel").show();
						$("#node-input-deviceTypeLabel").show();
						$("#node-input-deviceType").show();
						$("#node-input-allDeviceTypes").show();
						$("#node-input-allDeviceTypesLabel").show();

						$("#node-input-allDevices").show();
						$("#node-input-allDevicesLabel").show();
					} else if (id == "appsts") {

						$('#node-input-deviceIdLabel').hide();
						$("#node-input-deviceId").val('');
						$('#node-input-deviceId').hide();

						$('#node-input-applicationIdLabel').show();
						$('#node-input-allApplicationsLabel').show();
						$('#node-input-allApplications').show();
						$('#node-input-applicationId').show();

						$("#node-input-commandLabel").hide();
						$("#node-input-allCommands").hide();
						$("#node-input-allCommandsLabel").hide();
						$("#node-input-commandType").hide();

						document.getElementById('node-input-applicationIdLabel').innerHTML='<i class="fa fa-tasks"></i> App Id</label>';
						$('#node-input-applicationId').attr("placeholder", "app id e.g. myapp02");

						$("#node-input-eventLabel").hide();
						$("#node-input-allEvents").hide();
						$("#node-input-allEventsLabel").hide();
						$("#node-input-eventType").hide();

						$("#node-input-formatLabel").hide();
						$("#node-input-format").hide();
						$("#node-input-allFormats").hide();
						$("#node-input-allFormatsLabel").hide();
						$("#node-input-deviceTypeLabel").hide();
						$("#node-input-deviceType").hide();
						$("#node-input-allDeviceTypes").hide();
						$("#node-input-allDeviceTypesLabel").hide();

						$("#node-input-allDevices").hide();
						$("#node-input-allDevicesLabel").hide();

					} else {

					}

					$("#node-input-inputType").change(function() {
						var id = $("#node-input-inputType option:selected").val();
						if (id == "evt") {
							$('#node-input-deviceIdLabel').show();
							$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
							$('#node-input-deviceId').show();

							$('#node-input-applicationIdLabel').hide();
							$('#node-input-allApplicationsLabel').hide();
							$('#node-input-allApplications').hide();
							$("#node-input-applicationId").val('');
							$('#node-input-applicationId').hide();

							document.getElementById('node-input-eventLabel').innerHTML='<i class="fa fa-tasks"></i> Event';
							document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
							$('#node-input-eventType').attr("placeholder", "event type e.g. status");
							$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

							$("#node-input-eventLabel").show();
							$("#node-input-allEvents").show();
							$("#node-input-allEventsLabel").show();
							$("#node-input-eventType").show();

							$("#node-input-commandLabel").hide();
							$("#node-input-allCommands").hide();
							$("#node-input-allCommandsLabel").hide();
							$("#node-input-commandType").hide();

							$("#node-input-formatLabel").show();
							$("#node-input-format").show();
							$("#node-input-allFormats").show();
							$("#node-input-allFormatsLabel").show();
							$("#node-input-deviceTypeLabel").show();
							$("#node-input-deviceType").show();
							$("#node-input-allDeviceTypes").show();
							$("#node-input-allDeviceTypesLabel").show();

							$("#node-input-allDevices").show();
							$("#node-input-allDevicesLabel").show();

						} else if (id == "devsts"){
							$('#node-input-deviceIdLabel').show();
							$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
							$('#node-input-deviceId').show();

							$('#node-input-applicationIdLabel').hide();
							$('#node-input-allApplicationsLabel').hide();
							$('#node-input-allApplications').hide();
							$("#node-input-applicationId").val('');
							$('#node-input-applicationId').hide();

							document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
							$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

							$("#node-input-eventLabel").hide();
							$("#node-input-allEvents").hide();
							$("#node-input-allEventsLabel").hide();
							$("#node-input-eventType").hide();

							$("#node-input-commandLabel").hide();
							$("#node-input-allCommands").hide();
							$("#node-input-allCommandsLabel").hide();
							$("#node-input-commandType").hide();

							$("#node-input-formatLabel").hide();
							$("#node-input-format").hide();
							$("#node-input-allFormats").hide();
							$("#node-input-allFormatsLabel").hide();
							$("#node-input-deviceTypeLabel").show();
							$("#node-input-deviceType").show();
							$("#node-input-allDeviceTypes").show();
							$("#node-input-allDeviceTypesLabel").show();

							$("#node-input-allDevices").show();
							$("#node-input-allDevicesLabel").show();
						} else if (id == "cmd"){
							$('#node-input-deviceIdLabel').show();
							$("#node-input-deviceId").val($("#node-input-deviceId").val().trim().replace(/[^a-zA-Z0-9_\.\-]/gi, ""));
							$('#node-input-deviceId').show();

							$('#node-input-applicationIdLabel').hide();
							$('#node-input-allApplicationsLabel').hide();
							$('#node-input-allApplications').hide();
							$("#node-input-applicationId").val('');
							$('#node-input-applicationId').hide();

							document.getElementById('node-input-eventLabel').innerHTML='<i class="fa fa-tasks"></i> Command';
							document.getElementById('node-input-deviceIdLabel').innerHTML='<i class="fa fa-street-view"></i> Device Id</label>';
							$('#node-input-eventType').attr("placeholder", "command type e.g. blink");
							$('#node-input-deviceId').attr("placeholder", "device id e.g. ab12cd231a21");

							$("#node-input-eventLabel").hide();
							$("#node-input-allEvents").hide();
							$("#node-input-allEventsLabel").hide();
							$("#node-input-eventType").hide();

							$("#node-input-commandLabel").show();
							$("#node-input-allCommands").show();
							$("#node-input-allCommandsLabel").show();
							$("#node-input-commandType").show();

							$("#node-input-formatLabel").show();
							$("#node-input-format").show();
							$("#node-input-allFormats").show();
							$("#node-input-allFormatsLabel").show();
							$("#node-input-deviceTypeLabel").show();
							$("#node-input-deviceType").show();
							$("#node-input-allDeviceTypes").show();
							$("#node-input-allDeviceTypesLabel").show();

							$("#node-input-allDevices").show();
							$("#node-input-allDevicesLabel").show();
						} else if (id == "appsts") {

							$('#node-input-deviceIdLabel').hide();
							$('#node-input-deviceId').hide();

							$('#node-input-applicationIdLabel').show();
							$('#node-input-allApplicationsLabel').show();
							$('#node-input-allApplications').show();
							$('#node-input-applicationId').show();

							document.getElementById('node-input-applicationIdLabel').innerHTML='<i class="fa fa-tasks"></i> App Id</label>';
							$('#node-input-applicationId').attr("placeholder", "app id e.g. myapp02");

							$('#node-input-deviceId').attr("placeholder", "app id e.g. myapp02");

							$("#node-input-eventLabel").hide();
							$("#node-input-allEvents").hide();
							$("#node-input-allEventsLabel").hide();
							$("#node-input-eventType").hide();

							$("#node-input-commandLabel").hide();
							$("#node-input-allCommands").hide();
							$("#node-input-allCommandsLabel").hide();
							$("#node-input-commandType").hide();

							$("#node-input-formatLabel").hide();
							$("#node-input-format").hide();
							$("#node-input-allFormats").hide();
							$("#node-input-allFormatsLabel").hide();
							$("#node-input-deviceTypeLabel").hide();
							$("#node-input-deviceId").val('');
							$("#node-input-deviceType").hide();
							$("#node-input-allDeviceTypes").hide();
							$("#node-input-allDeviceTypesLabel").hide();

							$("#node-input-allDevices").hide();
							$("#node-input-allDevicesLabel").hide();
						} else {

						}
					});
				}

			});

		}
	});

	function validateAuthorization(v) {
		return this.authentication !== "quickstart" || this.authentication !== "boundService";
	}

</script>
<script type="text/x-red" data-help-name="ibmiot">
  <p> To use Shared subscription, check <b>Scalable</b> and provide the <b>Application ID</b>. The <b>Application ID</b> must be same across different clients.  
</script><script type="text/x-red" data-help-name="ibmiot out">
   <p>Output node that can be used with Watson IoT Platform to send a commands to a device or send an event on behalf of a device </p>
   <p>The following message properties take precedence and override the values configured in the node:
   <p><b>msg.deviceId </b> overrides the value of "Device Id"</p>
   <p><b>msg.deviceType</b> overrides the value of "Device Type"</p>
   <p><b>msg.eventOrCommandType</b> overrides the value of "Event Type" or "Command Type"</p>
   <p><b>msg.format</b> overrides the value of "Format". This Node supports json, buffer and other types. When the format is set to json, this node expects either an object or Stringify version of the json object. In order to send the buffer and other types, just send the contents as is without doing any conversion and set the format appropriately.</p>
   <p><b>msg.payload</b> overrides the value of "Data"</p>
   <p>In Non-Quickstart mode, value for QoS (Quality of Service) and connection
      keep alive interval value can be specified.
   </p>
   <p>The <b>Quality of Service (QoS)</b> level is an agreement between sender
      and receiver of a message regarding the guarantees of delivering a message.
      There are 3 QoS levels in MQTT: 0,1,2. Client can choose the QoS level
      depending on its network reliability and application logic.
   </p>
   <p>
      The <b>keep alive</b> functionality assures that the connection is still open and
      both Watson IoT Platform and client are connected to one another. Therefore the client
      species a time interval in seconds and communicates it to the Watson IoT Platform during
      the establishment of the connection. The interval is the longest possible
      period of time, which Watson IoT Platform and client can endure without sending a message.
   </p>
   <p>
       A <b>persistent session</b> can be requested by the client on connection establishment with the Watson IoT Platform using the <b>cleanSession</b> Flag.
       If the clean session is set to <b>true</b> then the client does not have a persistent session and all information are lost when the client disconnects for any reason.
       When clean session is set to <b>false</b>, a persistent session is created and it will be preserved until the client requests a clean session again.
       If there is already a session available then it is used and queued messages will be delivered to the client if available. For more information, refer to Watson IoT Platform documentation.
    </p>
   <p><b>Note:</b>Some of the functions of this node are not available when it is running in <b>Quickstart</b> Mode.</p>
</script><script type="text/x-red" data-help-name="ibmiot in">
	<p>Input node that can be used with Watson IoT Platform to receive events sent from devices, receive commands sent to devices,  or receive status updates concerning devices or applications. It produces an object called msg and sets <b>msg.payload</b> to be a String containing the payload of the incoming message.</p>
	<p>The value of "Device Id" is stored in <b>msg.deviceId</b></p>
	<p>The value of "Application Id" is stored in <b>msg.applicationId</b></p>
	<p>The value of "Device Type" is stored in  <b>msg.deviceType</b></p>
	<p>The value of "Event Type" is stored in  <b>msg.eventType</b></p>
	<p>The value of "Command Type" is stored in <b>msg.commandType</b></p>
	<p>The value of "Format" is stored in <b>msg.format</b>. This node supports json, buffer and other types. When the format is set to json, this node parses the incoming data using JSON.parse() and outputs. When the buffer object is received by this node, it outputs the contents as is without any conversion. And for remaining types, this node outputs the message in String. </p>
  <p>In Non-Quickstart mode, value for QoS (Quality of Service) and connection
     keep alive interval value can be specified.
  </p>
  <p>The <b>Quality of Service (QoS)</b> level is an agreement between sender
     and receiver of a message regarding the guarantees of delivering a message.
     There are 3 QoS levels in MQTT: 0,1,2. Client can choose the QoS level
     depending on its network reliability and application logic.
  </p>
  <p>
     The <b>keep alive</b> functionality assures that the connection is still open and
     both Watson IoT Platform and client are connected to one another. Therefore the client
     species a time interval in seconds and communicates it to the Watson IoT Platform during
     the establishment of the connection. The interval is the longest possible
     period of time, which Watson IoT Platform and client can endure without sending a message.
  </p>
  <p>
       A <b>persistent session</b> can be requested by the client on connection establishment with the Watson IoT Platform using the <b>cleanSession</b> Flag.
       If the clean session is set to <b>true</b> then the client does not have a persistent session and all information are lost when the client disconnects for any reason.
       When clean session is set to <b>false</b>, a persistent session is created and it will be preserved until the client requests a clean session again.
       If there is already a session available then it is used and queued messages will be delivered to the client if available. For more information, refer to Watson IoT Platform documentation.
   </p>
	<p><b>Note:</b>Some of the functions of this node are not available when it is running in <b>Quickstart</b> Mode.</p>
</script><!--
  Copyright 2014,2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="cloudant">
    <div class="form-row">
        <label for="node-config-input-host"><i class="fa fa-bookmark"></i> Host</label>
        <input class="input-append-left" type="text" id="node-config-input-host" placeholder="[username].cloudant.com or http://your-server.com">
    </div>
    <div class="form-row">
        <label for="node-config-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-config-input-username">
    </div>
    <div class="form-row">
        <label for="node-config-input-pass"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-config-input-pass">
    </div>
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("cloudant",{
        category: "config",
        color: "rgb(114, 199, 231)",
        defaults: {
            host: {value:"", required:true},
            name: {value:""}
        },
        credentials: {
            username: {type:"text"},
            pass: {type:"password"}
        },
        label: function() {
            return this.name || this.host;
        }
    });
</script>

<script type="text/x-red" data-template-name="cloudant out">
    <div class="form-row">
        <label for="node-input-service"><i class="fa fa-folder-close"></i> Service</label>
        <select id="node-input-service" style="width:68%;">
            <!-- <option value="" disabled></option> -->
            <option value="_ext_"> External cloudant or couchdb service</option>
        </select>
    </div>
    <div class="form-row hide" id="node-input-external-details">
        <label for="node-input-cloudant"><i class="fa fa-bookmark"></i> Server</label>
        <input type="text" id="node-input-cloudant">
    </div>
    <div class="form-row">
        <label for="node-input-database"><i class="fa fa-briefcase"></i> Database</label>
        <input type="text" id="node-input-database" placeholder="database" style="width:65%;">
    </div>
    </div>
        <div class="form-row">
        <label for="node-input-operation"><i class="fa fa-wrench"></i> Operation</label>
        <select type="text" id="node-input-operation" style="width:68%;">
            <option value="insert">insert</option>
            <option value="delete">remove</option>
        </select>
    </div>
    <div class="form-row node-input-payonly">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-payonly" placeholder="Only"
               style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-payonly" style="width:65%;">Only store msg.payload object?</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name" style="width:65%;">
    </div>
    <script>
        $("#node-input-operation").change(function() {
            var id = $("#node-input-operation option:selected").val();
            if (id == "delete") $(".node-input-payonly").hide();
            else $(".node-input-payonly").show();
        });
    </script>


<script type="text/x-red" data-template-name="cloudant in">
    <div class="form-row">
        <label for="node-input-service"><i class="fa fa-folder-close"></i> Service</label>
        <select id="node-input-service" style="width:68%;">
            <!-- <option value="" disabled></option> -->
            <option value="_ext_"> External cloudant or couchdb service</option>
        </select>
    </div>
    <div class="form-row hide" id="node-input-external-details">
        <label for="node-input-cloudant"><i class="fa fa-bookmark"></i> Server</label>
        <input type="text" id="node-input-cloudant">
    </div>
    <div class="form-row">
        <label for="node-input-database"><i class="fa fa-briefcase"></i> Database</label>
        <input type="text" id="node-input-database" placeholder="database" style="width:65%;">
    </div>
    <div class="form-row">
        <label for="node-input-search"><i class="fa fa-search"></i> Search by</label>
        <select id="node-input-search" style="width:68%;">
            <option value="_id_">_id</option>
            <option value="_idx_">search index</option>
            <option value="_all_">all documents</option>
        </select>
    </div>
    <div id="node-search-index-form" class="form-row">
        <label>&nbsp;</label>
        <input type="text" id="node-input-design" style="width:30%" placeholder="design document">
        /
        <input type="text" id="node-input-index" style="width:30%" placeholder="index name">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name" style="width:65%;">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("cloudant out", {
        category: "storage-output",
        color: "rgb(114, 199, 231)",
        defaults: {
            name: { value: "" },
            cloudant: { type:"cloudant", validate:validateServer},
            database: { value:"", required:true, validate:validateDatabase },
            service: { value:"", required:true },
            payonly: { value:false },
            operation: { value:"insert" }
        },
        inputs: 1,
        outputs: 0,
        icon: "cloudant.png",
        align: "right",
        label: label,
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: oneditprepare
    });

    RED.nodes.registerType("cloudant in", {
        category: "storage-input",
        color: "rgb(114, 199, 231)",
        defaults: {
            name    : { value:"" },
            cloudant: { type:"cloudant", validate:validateServer },
            database: { value:"", required:true, validate:validateDatabase },
            service : { value:"", required:true },
            search  : { value:"_id_", required:true },
            design  : { value:"" },
            index   : { value:"" }
        },
        inputs : 1,
        outputs: 1,
        icon   : "cloudant.png",
        label  : label,
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: oneditprepare
    });

    function oneditprepare() {
        var node = this;
        var serviceSelect  = $('#node-input-service');
        var searchBySelect = $('#node-input-search');
        var searchForm     = $('#node-search-index-form');

        $.getJSON('cloudant/vcap/',function(data) {
            var last = serviceSelect.children().last();
            var opts = [];

            for (var i=0; i < data.length; i++) {
                var selected = node.service == data[i].name;
                opts.push('<option value="' + data[i].name + '"' + (selected ? " selected":"") + '>' + data[i].name + '</option>');
            }

            if (opts.length == 0) {
                node.service = "_ext_";
                serviceSelect.find("option").filter(function() {
                    return $(this).val() == node.service;
                }).attr('selected', true);
            } else {
                last.before(opts.join(""));
            }

            serviceSelect.change();
        });

        serviceSelect.change(function() {
            var service = serviceSelect.val();
            if (service == "_ext_") {
                $("#node-input-external-details").show();
            } else {
                $("#node-input-external-details").hide();
            }
        });

        searchBySelect.change(function() {
            var searchBy = searchBySelect.val();

            if (searchBy === "_idx_") {
                node._def.defaults.design.required = true;
                node._def.defaults.index.required  = true;
                searchForm.show();
            } else {
                node._def.defaults.design.required = false;
                node._def.defaults.index.required  = false;
                searchForm.hide();
            }
        });
    }

    function label() {
        return this.name || this.database || "cloudant";
    }

    function validateServer(v) {
        return this.service != "_ext_" || v != "_ADD_";
    }

    // https://wiki.apache.org/couchdb/HTTP_database_API#Naming_and_Addressing
    function validateDatabase(v) {
        return (v.indexOf('_') !== 0) && (v.search(/[A-Z\s\\/]/g) < 0)
    }
</script>




<script type="text/x-red" data-help-name="cloudant out">
   <p>
       A simple Cloudant output node. Stores <b>msg</b> in a chosen database.
    </p>
   <p>
       Cloudant generates a random id for the <code>_id</code> property if one
       is not specified and a new document will be <b>inserted</b> each time.
       You can <b>insert</b> only the <code>msg.payload</code> by checking the
       checkbox in the configuration window.
   </p>
   <p>
       If you want to <b>update</b> an existing document you must specify the
       latest values for <code>_id</code> and <code>_rev</code> in your object.
       If they don't match the current values stored in the database you will
       receive a <b>conflict error</b> message, so make sure you are using the
       most updated information for the document.
    </p>
    <p>
        It is also possible to <b>delete</b> documents from the database by
        providing values for <code>_id</code> and <code>_rev</code> and selecting
        the <b>remove</b> option for the node. You can pass these values in the
        <code>msg</code> object itself or as an object in the
        <code>msg.payload</code>.
    </p>
    <p>
        The <b>database name</b> must follow these rules:
        <ul>
            <li>No spaces</li>
            <li>All letters in small caps</li>
            <li>The first character can't be <code>_</code></li>
        </ul>
    </p>
    <p>
        Your document should avoid having top-level fields that start with
        <code>_</code>, with exceptions for <code>_id</code>, <code>_rev</code>
        and other <a href="https://wiki.apache.org/couchdb/HTTP_Document_API#Special_Fields">
        CouchDB reserved words</a>.
    </p>
</script><script type="text/x-red" data-help-name="cloudant in">
   <p>
        A node for searching documents in a Cloudant database.
    </p>
    <p>
        Searching for documents can be done in three modes: directly by using the
        document's <b>_id</b>, by using an existing <a
        href="https://cloudant.com/for-developers/search/" target="_blank">Search
        Index</a> or retrieving <b>all documents</b> stored in your database.
    </p>
    <p>
        When querying using the <b>_id</b> option, the value for the document's
        <code>_id</code> should be passed in the <code>msg.payload</code> as a
        string.
    </p>
    <p>
        To use an existing <b>Search Index</b> stored on the desired database,
        the query argument should be passed on the <code>msg.payload</code> as a
        string following the <code>indexName:value</code> pattern. Keep in mind
        that <i>the index must be created beforehand in the database.</i> and
        referenced here by its <code>design document/index name</code>.
    </p>
    <p>
        When querying using a <b>Search Index</b> you can pass the search
        parameters as an object in <code>msg.payload</code>.
    </p>
    <p>
        For example, you can pass an object like this:
    <p>
        <code>{ query: "abc*", limit: 100 }</code>
    </p>
    <p>
        to change the value of <code>limit</code>. You can find more information
        about <b>Search Index</b> parameters in the <a
        href="https://docs.cloudant.com/api.html?http#queries" target="_blank">
        official Cloudant documentation</a>.
    </p>
    <p>
        The last method to retrieve documents is to simply get all of them by
        selecting the option <b>all documents</b>.
    </p>
    <p>
        The <b>database name</b> must follow these rules:
        <ul>
            <li>No spaces</li>
            <li>All letters in small caps</li>
            <li>The first character can't be <code>_</code></li>
        </ul>
    </p>
</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="openwhisk-service">
<div class="form-row">
    <label for="node-config-input-api"><i class="fa fa-cloud"></i> API URL</label>
    <input type="text" id="node-config-input-api">
</div>
<div class="form-row">
    <label for="node-config-input-key"><i class="fa fa-lock"></i> Auth Key</label>
    <input type="password" id="node-config-input-key">
</div>
<div class="form-row">
    <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
    <input type="text" id="node-config-input-name" data-i18n="[placeholder]node-red:common.label.name">
</div>
</script>

<script type="text/x-red" data-template-name="openwhisk-trigger">
<div class="form-row">
    <label for="node-input-service"><i class="fa fa-cloud"></i> Service</label>
    <input type="text" id="node-input-service">
</div>
<div class="form-row">
    <label for="node-input-namespace"><i class="fa fa-users"></i> Namespace</label>
    <select id="node-input-namespace">
    </select>
</div>
<div class="form-row">
    <label for="node-input-trigger"><i class="fa fa-cog"></i> Trigger</label>
    <input type="text" style="width: 45%;" id="node-input-trigger">
    <div style="display: inline-block; width: 95px; margin: 5px 35px 0 10px;">
      <label for="node-input-edit" style="width: 75px;">Allow Edits</label>
      <input type="checkbox" id="node-input-edit" style="width: 14px; margin-top: 0px;">
    </div>
</div>

<div class="form-row trigger-source" style="display: none;">
  <label><i class="fa fa-list"></i> Parameters</label>
  <input type="hidden" id="node-input-parameters" autofocus="autofocus">
</div>
<div class="form-row node-input-parameters-container-row trigger-source" style="display: none;">
  <ol id="node-input-parameters-container"></ol>
</div>

<div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
    <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
</div>
</script>

<script type="text/x-red" data-template-name="openwhisk-action">
<div class="form-row">
    <label for="node-input-namespace"><i class="fa fa-cloud"></i> Service</label>
    <input type="text" id="node-input-service">
</div>

<div class="form-row">
    <label for="node-input-namespace"><i class="fa fa-users"></i> Namespace</label>
    <select id="node-input-namespace">
    </select>
</div>

<div class="form-row">
    <label for="node-input-action"><i class="fa fa-cog"></i> Action</label>
    <input type="text"  style="width: 45%" id="node-input-action">
    <div style="display: inline-block; width: 95px; margin: 5px 35px 0 10px;">
      <label for="node-input-edit" style="width: 75px;">Allow Edits</label>
      <input type="checkbox" id="node-input-edit" style="width: 14px; margin-top: 0px;">
  </div>
</div>

<div class="form-row action-source" style="display: none;">
  <label><i class="fa fa-list"></i> Parameters</label>
  <input type="hidden" id="node-input-parameters" autofocus="autofocus">
</div>
<div class="form-row node-input-parameters-container-row action-source" style="display: none;">
  <ol id="node-input-parameters-container"></ol>
</div>
<div class="form-row action-source" style="margin-bottom: 0px; display: none;">
  <label for="node-input-func" style="width: 200px;">
    <i class="fa fa-wrench"></i> Action Source
    </label>
  <input type="hidden" id="node-input-func" autofocus="autofocus">
  <input type="hidden" id="node-input-noerr">
</div>

<div class="form-row node-text-editor-row action-source" style="display: none;">
  <div style="height: 250px;" class="node-text-editor" id="node-input-func-editor" ></div>
</div>

<div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
    <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
</div>

</script>






<script type="text/javascript">
(function() {
    RED.nodes.registerType('openwhisk-service', {
        category: 'config',
        defaults: {
            name: { value: "" },
            api: { value: "https://openwhisk.ng.bluemix.net/api/v1"},
        },
        credentials: {
            key: {type:"password"}
        },
        label: function() {
            return this.name || this.namespace ||  "OpenWhisk Service";
        }
    });

    RED.nodes.registerType('openwhisk-trigger', {
        category: 'output',
        defaults: {
            name: { value: "" },
            namespace: { value: "" },
            trigger: { value: "" },
            service: { type:"openwhisk-service", required: true },
            params: { value: [{key: "", value: "", disabled: true}] },
            edit: { value: false }
        },
        align: "right",
        inputs: 1,
        outputs: 0,
        color: "#6C9FC3",
        icon: "openwhisk.png",
        paletteLabel:"OpenWhisk",
        label: function() {
            return this.name || this.trigger ||  "Trigger";
        },
        oneditprepare: function () {
          $("#node-input-parameters-container").editableList({
            removable: true,
            addItem: addItem
          });

          this.params.forEach(function (param) {
              if (param.key) {
                  $("#node-input-parameters-container").editableList('addItem', param);
              }
          });

          if (this.edit) {
              $('.trigger-source').show();
          } else if (this.trigger && this.namespace && this.service) {
              retrieveTriggerSource(this);
          }

          if (this.service) {
              retrieveNamespaceListTrigger(this);
          }

          var that = this;

          $('#node-input-service').change(function () {
              that.namespaces = undefined;
              retrieveNamespaceListTrigger(that);
          });

          $('#node-input-trigger').keyup(function () {
            clearTimeout(that.timeout);
            that.timeout = setTimeout(function () {
              retrieveTriggerSource(that);
            }, 500);
          });

          $("#node-input-edit").change(function () {
            var checked = $("#node-input-edit").prop("checked");
            if (checked) {
              makeParametersReadOnly(false);
            } else {
              retrieveTriggerSource(that);
            }
          });

          makeParametersReadOnly(true);
        },
        oneditsave: function () {
          var checked = $("#node-input-edit").prop("checked");
          if (checked) {
            var params = [];
            $(".node-input-parameters-container-row li").each(function (idx, li) {
              var key = $(li).find(".params-key").val();
              var value = $(li).find(".params-value").val();
              params.push({key: key, value: value});
            })
            this.params = params;
          } else {
            this.params = [{disabled: true}];
          }
        },

    });

    function makeParametersReadOnly(readOnly) {
      $(".node-input-parameters-container-row input").prop('disabled', readOnly);
      if (readOnly) {
        $(".node-input-parameters-container-row .editor-button").hide();
      } else {
        $(".node-input-parameters-container-row .editor-button").show();
      }
    }

    function makeActionReadOnly(editor, readOnly) {
      editor.setOptions({
        readOnly: readOnly,
        highlightActiveLine: !readOnly,
        highlightGutterLine: !readOnly
      });
      editor.renderer.$cursorLayer.element.style.opacity = readOnly ? 0 : 1;
      makeParametersReadOnly(readOnly);
    }

    function retrieveNamespaceListAction(node) {
        retrieveNamespaceList(node, retrieveActionSource)
    }

    function retrieveNamespaceListTrigger(node) {
        retrieveNamespaceList(node, retrieveTriggerSource)
    }

    function retrieveNamespaceList(node, retrieveSource) {
        // Bail if there is no value set for service.
        var service = RED.nodes.node($("#node-input-service").val());
        if (!service) return;

        if (node.namespaces && node.namespaces.length) {
            drawNamespaceList(node, retrieveSource);
            return;
        }

        var url = "openwhisk-namespace-list/";

        // if the user has defined the service before deploying, send the credentials.
        // otherwise, send the service identifier.
        if (service.credentials && service.credentials.has_key) {
            url += "?key=" + service.credentials.key + "&api=" + service.api;
        } else {
            url += "?id=" + service.id;
        }

        $.getJSON(url)
            .done(function (result) {
                node.namespaces = result;
                drawNamespaceList(node, retrieveSource);
            });
    }

    function drawNamespaceList (node, retrieveSource) {
        var namespaceDiv = $('#node-input-namespace');
        if (!namespaceDiv || !node.namespaces) return;
        // empty the list before populating it
        namespaceDiv.empty();
        // populate the list
        node.namespaces.forEach(function (namespace) {
            namespaceDiv.append($('<option>', {value: namespace, text: namespace}));
        });
        // if namespace is not set use the first item in the list
        if (node.namespace) {
            namespaceDiv.val(node.namespace);
        }
        // when a new selection is made update the state
        namespaceDiv.change(function (e, d) {
            var selected = $('#node-input-namespace option').filter(':selected').text();;
            if (node.namespace === selected) return;
            node.namespace = selected;
            retrieveSource(node);
        });
    }

    function retrieveActionSource(node) {
      var action = $('#node-input-action').val();
      var namespace = $('#node-input-namespace').val();
      var service = RED.nodes.node($("#node-input-service").val());

      if (!action || !namespace || !service) return;
      $('.action-source').show();
      $(".fa-cog").addClass("fa-spin")

      var url = "openwhisk-action/?action=" + action + "&namespace=" + namespace;
      // if the user has defined the service before deploying, send the credentials.
      // otherwise, send the service identifier.
      if (service.credentials && service.credentials.has_key) {
        url += "&key=" + service.credentials.key + "&api=" + service.api;
      } else {
        url += "&id=" + service.id;
      }

      $.getJSON(url)
        .done(function (result) {
          node.editor.setValue(result.exec.code);
          node.editor.clearSelection();
          $("#node-input-edit").prop("checked", false);
          $(".fa-cog").removeClass("fa-spin")
          $("#node-input-parameters-container").editableList('empty');
          var parameters = result.parameters || [];
          if (!parameters.length) parameters.push({});
          parameters.forEach(function (param) {
            param.disabled = true;
            $("#node-input-parameters-container").editableList('addItem', param);
          });
          makeActionReadOnly(node.editor, true);
        })
        .fail(function () {
          $('.action-source').hide();
          $(".fa-cog").removeClass("fa-spin")
        });
    };

    function retrieveTriggerSource(node) {
      var action = $('#node-input-trigger').val();
      var namespace = $('#node-input-namespace').val();
      var service = RED.nodes.node($("#node-input-service").val());

      if (!action || !namespace || !service) return;
      $('.trigger-source').show();
      $(".fa-cog").addClass("fa-spin")

      var url = "openwhisk-trigger/?trigger=" + action + "&namespace=" + namespace;
      if (service.credentials && service.credentials.has_key) {
        url += "&key=" + service.credentials.key + "&api=" + service.api;
      } else {
        url += "&id=" + service.id;
      }

      $.getJSON(url)
        .done(function (result) {
          $("#node-input-edit").prop("checked", false);
          $(".fa-cog").removeClass("fa-spin")
          $("#node-input-parameters-container").editableList('empty');
          var parameters = result.parameters || [];
          if (!parameters.length) parameters.push({});
          parameters.forEach(function (param) {
            param.disabled = true;
            $("#node-input-parameters-container").editableList('addItem', param);
          });
          makeParametersReadOnly(true);
        })
        .fail(function () {
          $('.trigger-source').hide();
          $(".fa-cog").removeClass("fa-spin")
        });
    }

    var addItem = function (row, index, data) {
      var key = data.key || "";
      var value = data.value || "";
      var disabled = data.disabled ? "disabled" : "";
      var template = '<i style="color: #eee; margin-left:15px;" class="fa fa-bars"></i><input class="params-key" style="width: 40%; margin-left: 15px;" '+disabled+' type="text" placeholder="key" value="'+key+'"><input class="params-value" style="width: 40%; margin-left: 15px;" '+disabled+' type="text" placeholder="value" value="'+value+'">';
      $(row).html(template);
    };

    RED.nodes.registerType('openwhisk-action', {
        category: 'function',
        defaults: {
            name: { value: "" },
            func: {value:""},
            namespace: { value: "" },
            action: { value: "" },
            params: { value: [{key: "", value: "", disabled: true}] },
            service: { type:"openwhisk-service", required: true },
            edit: { value: false }
        },
        inputs: 1,
        outputs: 1,
        color: "#6C9FC3",
        icon: "openwhisk.png",
        paletteLabel:"OpenWhisk",
        oneditprepare: function () {
          // create editor dom element
          this.editor = RED.editor.createEditor({
            id: 'node-input-func-editor',
            mode: 'ace/mode/javascript',
            value: $("#node-input-func").val()
          });

          makeActionReadOnly(this.editor, true);

          $("#node-input-parameters-container").editableList({
            removable: true,
            addItem: addItem
          });

          this.params.forEach(function (param) {
              if (param.key) {
                  $("#node-input-parameters-container").editableList('addItem', param);
              }
          });
          // if node configuration includes custom action source,
          // show the editor panel straight away.
          if (this.edit) {
              $('.action-source').show();
          // otherwise, if we have the correct parameters, retrieve it
          // from the platform.
          } else if (this.action && this.namespace && this.service) {
              retrieveActionSource(this);
          }

          if (this.service) {
              retrieveNamespaceListAction(this);
          }

          var that = this;

          $('#node-input-service').change(function () {
              that.namespaces = undefined;
              retrieveNamespaceListAction(that);
          });

          // whenever action name changes, update Action source.
          // debounce events to half a second.
          $('#node-input-action').keyup(function () {
            clearTimeout(that.timeout);
            that.timeout = setTimeout(function () {
              retrieveActionSource(that);
            }, 500);
          });

          // when user swaps back to non-edit mode,
          // retrieve current action source from openwhisk.
          // otherwise, take editor out of readonly mode.
          $("#node-input-edit").change(function () {
            var checked = $("#node-input-edit").prop("checked");
            if (checked) {
              makeActionReadOnly(that.editor, false);
              that.editor.focus();
            } else {
              retrieveActionSource(that);
            }
          });
        },
        oneditsave: function () {
            var annot = this.editor.getSession().getAnnotations();
            this.noerr = 0;
            $("#node-input-noerr").val(0);
            for (var k=0; k < annot.length; k++) {
                if (annot[k].type === "error") {
                    $("#node-input-noerr").val(annot.length);
                    this.noerr = annot.length;
                }
            }
            // if user has decided to allow source modifications, store the
            // function definition within the node. otherwise, wipe it out
            // so we can retrieve it from the API next time...
            var checked = $("#node-input-edit").prop("checked");
            if (checked) {
              $("#node-input-func").val(this.editor.getValue());
              var params = []
              $(".node-input-parameters-container-row li").each(function (idx, li) {
                var key = $(li).find(".params-key").val();
                var value = $(li).find(".params-value").val();
                params.push({key: key, value: value});
              })
              this.params = params;
            } else {
              $("#node-input-func").val("");
              this.params = [{disabled: true}];
            }
            delete this.editor;
        },
        label: function() {
            return this.name || this.action ||  "Action";
        }
    });
})();
</script>
<script type="text/x-red" data-help-name="openwhisk-service"></script><script type="text/x-red" data-help-name="openwhisk-trigger">
<p>Invoke an OpenWhisk trigger.</p>
<p>The namespace and trigger can be configured in the node or, if left blank,
provided by <code>msg.namespace</code> and <code>msg.trigger</code> respectively.</p>
<p><code>msg.payload</code> should be an object of key-value pairs to pass to the
trigger; any other type is ignored.</p>
</script><script type="text/x-red" data-help-name="openwhisk-action">
<p>Invoke an OpenWhisk action.</p>
<p>The namespace and trigger can be configured in the node or, if left blank,
provided by <code>msg.namespace</code> and <code>msg.action</code> respectively.</p>
<p><code>msg.payload</code> should be an object of key-value pairs to pass to the
action; any other type is ignored.</p>
<p>The output message contains the following properties:</p>
<ul>
<li><code>payload</code> is the result of the action</li>
<li><code>data</code> is the complete response object</li>
</ul>
</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-conversation-v1">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-workspaceid"><i class="fa fa-tag"></i> Workspace ID</label>
        <input type="text" id="node-input-workspaceid" placeholder="WorkspaceID">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-context" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-context" style="width: 70%;"> Save context</label>
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-multiuser" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-multiuser" style="width: 70%;"> Multiple Users</label>
    </div>
    <div class="form-tips" id="conversation-form-tips">
      <strong>Note:</strong> When using with multiple users, <code>msg.user</code> must be set.<br>
      See info box for details.
    </div>
</script>





<script type="text/javascript">
    var oneditprepare = function() {
        $('input#node-input-context').change(function () {
            var checked = $('input#node-input-context').prop('checked')
            if (checked) {
                $('input#node-input-multiuser').parent().show();
                $('#conversation-form-tips').show();
            } else {
                $('input#node-input-multiuser').parent().hide();
                $('#conversation-form-tips').hide();
            }
        });
        $.getJSON('watson-conversation/vcap/')
            .done(function (service) {
              $('.credentials').toggle(!service);
            })
            .fail(function () {
              $('.credentials').show();
            })
            .always(function () {
              $('#credentials-check').hide();
            })
    };

    (function() {
        RED.nodes.registerType('watson-conversation-v1', {
            category: 'IBM Watson',
            defaults: {
              name: {value: ""},
              workspaceid: {value: ""},
              multiuser: {value: false},
              context: {value: true}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: 'rgb(84,149,230)',
            inputs: 1,
            outputs: 1,
            icon: "conversation-v1-25x25.png",
            paletteLabel: "conversation",
            label: function() {
                return this.name || "conversation";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: oneditprepare
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-conversation-v1">
	<p>With the IBM Watson Conversation service you can create cognitive agents  virtual agents that combine machine learning, natural language understanding, and integrated dialog scripting tools to provide outstanding customer engagements.</p>

    <p><b>Usage</b></p>
    <p>This node should be provided in input : </p>
    <ul>
    <li><code>msg.payload</code> : the message of the conversation to analyse. Format: String </li>
    <li><code>msg.user</code> (optional): unique identifier of the user. This will be used to maintain the context of the conversation for each user when using with multiple users. Format: String </li>
    <li><code>msg.params.workspace_id</code> : unique identifier of the workspace to be used. Could be also configured in the node. Format: String </li>
    <li><code>msg.params.context</code> (optional): A context object that includes state information for the conversation. When you send multiple requests for the same conversation, include the context object from the response. (<a href="http://www.ibm.com/watson/developercloud/conversation/api/v1/#send_input" target="_blank">documentation</a>). This will overwrite any context saved in the node. Format: JSON </li>
    <li><code>msg.params.alternate_intents</code> (optional) : whether to return more than one intent. Default is false. Set to true to return all matching intents. For example, return all intents when the confidence is not high to allow users to choose their intent.</li>
    <li><code>msg.params.output</code> (optional) : see API documentation </li>
    <li><code>msg.params.entities</code> (optional) : see API documentation </li>
    <li><code>msg.params.output</code> (optional) : see API documentation </li>
    <li><code>msg.additional_context</code> (optional) : additional properties that will be added to the context object. Format: Object </li>
    <br/>
    <li><code>msg.params.username</code> : If provided will be used as the username credential for the Conversation service.</li>
    <li><code>msg.params.password</code> : If provided will be used as the password credential for the Conversation service.</li>
    </ul>
    <p>See <a href="http://www.ibm.com/watson/developercloud/conversation/api/v1/#send_input" target="_blank">Conversation API documentation</a> for details.</p>
    <p>All Results will made available at <code>msg.payload</code> in JSON format. Check the  <a href="http://www.ibm.com/watson/developercloud/conversation/api/v1/#send_input" target="_blank">documentation</a> for details.</p>

    <p><b>Important</b> : before using this node, a workspace must be created and configured using the Watson Conversation Tool available in Bluemix, in the Watson Conversation instance detail page.</p>
    <p><b>Documentation</b>
    <ul>
    <li><a href="http://www.ibm.com/watson/developercloud/doc/conversation/" target="_blank">Watson Conversation API documentation</a></li>
    <li><a href="https://watson-api-explorer.mybluemix.net/" target="_blank">Watson API Explorer</a></li>
    <li><a href="http://www.ibm.com/watson/developercloud/doc/conversation/tutorial_basic.shtml" target="_blank">Basic tutorial</a>
    <li><a href="https://github.com/watson-developer-cloud/node-red-bluemix-starter" target="_blank">Sample Flow in the Watson Node-RED Starter</a>
    </ul>
</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-conversation-v1-experimental">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-workspaceid"><i class="fa fa-tag"></i> Workspace ID</label>
        <input type="text" id="node-input-workspaceid" placeholder="WorkspaceID">
    </div>

</script>





<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-conversation-v1-experimental', {
            category: 'Watson Deprecated',
            defaults: {
              name: {value: ""},
              workspaceid: {value: ""}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: 'rgb(84,149,230)',
            inputs: 1,
            outputs: 1,
            icon: "conversation-v1-25x25.png",
            paletteLabel: "conversation",
            label: function() {
                return this.name || "conversation";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
              $.getJSON('watson-conversation/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  })
                  .always(function () {
                    $('#credentials-check').hide();
                  })

            }
        });


    })();
</script>
<script type="text/x-red" data-help-name="watson-conversation-v1-experimental">
	<p>This node is for the experimental version of the Watson Conversation service which
  was made generally available 2016-08-01. Please switch to the Node that supports the
  generally available version of the service.</p>
  <br/>
  <p>
  With the IBM Watson Conversation service you can create cognitive agents 
  virtual agents that combine machine learning, natural language understanding, and
  integrated dialog scripting tools to provide outstanding customer engagements.</p>

    <p><b>Usage</b></p>
    <p>This node should be provided in input : </p>
    <ul>
    <li><code>msg.params.workspace_id</code> : unique identifier of the workspace to be used. Could be also configured in the node. Format: String </li>
    <li><code>msg.payload</code> : the message of the conversation to analyse; Format: String </li>
    </ul>
    <p>All Results will made available at <code>msg.result</code> in JSON format, with the following information :</p>
    <ul>
    <li><code>msg.result.input.text</code>: the input used for the analysis Format: String </li>
    <li><code>msg.result.intents</code> : a array of Objects {"intent": string, confidence: number}. Example : { "intent": "weather", "confidence": 0.12767628721396487 }</li>
    <li><code>msg.result.input.entities</code>: the input used for the analysis Format: String </li>
    </ul>

    <p><b>Important</b> : before using this node, a workspace must be created and configured using the Watson Conversation Tool available in Bluemix, in the Watson Conversation instance detail page.</p>
    <br/>

    <p>For full details, please see the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/doc/conversation/overview.shtml">Watson Conversation API documentation</a></p>
    <p>See also the <a href="https://watson-api-explorer.mybluemix.net/">API Explorer</a> and the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/doc/conversation/tutorial_basic.shtml">Tutorial</a>.</p>

    <p>Check the sample Flow for this node on  <a href="https://github.com/watson-developer-cloud/node-red-bluemix-starter">Watson Node-RED Starter</a></p>
</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-discovery-v1">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>

    <div class="form-row">
        <label for="node-input-discovery-method"><i class="fa fa-book"></i> Method: </label>
        <select type="text" id="node-input-discovery-method" style="display: inline-block; width: 70%;">
            <option value="listEnvrionments">List existing envionments</option>
            <option value="getEnvironmentDetails">Retrieve environment details</option>
            <option value="listCollections">List existing collections</option>
            <option value="getCollectionDetails">Retrieve collection details</option>
            <option value="listConfigurations">List existing configurations</option>
            <option value="getConfigurationDetails">Retrieve configuration details</option>
            <option value="query">Search in collection</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-environmentname"><i class="fa fa-tag"></i> Environment Name</label>
        <input type="text" id="node-input-environmentname" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-environment_id"><i class="fa fa-tag"></i> Environment ID</label>
        <input type="text" id="node-input-environment_id" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-collection_id"><i class="fa fa-tag"></i> Collection ID</label>
        <input type="text" id="node-input-collection_id" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-configurationname"><i class="fa fa-tag"></i> Configuration Name</label>
        <input type="text" id="node-input-configurationname" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-configuration_id"><i class="fa fa-tag"></i> Configuration ID</label>
        <input type="text" id="node-input-configuration_id" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-count"><i class="fa fa-tag"></i> Number of documents</label>
        <input type="text" id="node-input-count" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-query"><i class="fa fa-tag"></i> Query for Search</label>
        <input type="text" id="node-input-query" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-filter"><i class="fa fa-tag"></i> Filter for Search</label>
        <input type="text" id="node-input-filter" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-aggregation"><i class="fa fa-tag"></i> Aggregation for Search</label>
        <input type="text" id="node-input-aggregation" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-return"><i class="fa fa-tag"></i> List of sections to return</label>
        <input type="text" id="node-input-return" placeholder="">
    </div>

</script>



<script type="text/javascript">

    // Need to simulate a namespace, so that some of the variables don't leak across nodes
    function DiscoveryExperimentalV1 () {}

    // This is the namespace for this version of this Node.
    var disV1 = new DiscoveryExperimentalV1();

    //disV1.abc = 'abc';
    disV1.hideAll = function() {
      $('#node-input-environmentname').parent().hide();
      $('#node-input-environment_id').parent().hide();
      $('#node-input-collection_id').parent().hide();
      $('#node-input-configurationname').parent().hide();
      $('#node-input-configuration_id').parent().hide();
      $('#node-input-count').parent().hide();
      $('#node-input-query').parent().hide();
      $('#node-input-filter').parent().hide();
      $('#node-input-aggregation').parent().hide();
      $('#node-input-return').parent().hide();
    };

    disV1.showSelectedFields = function(fields) {
      for (i = 0; i < fields.length; i++) {
        $(fields[i]).parent().show();
      }
    }

    disV1.processSelectedMethod = function(method) {
      disV1.hideAll();
      fields = [];
      switch (method) {
        case 'listEnvrionments':
          fields.push('#node-input-environmentname');
          break;
        case 'getEnvironmentDetails':
        case 'listCollections':
          fields.push('#node-input-environment_id');
          break;
        case 'getCollectionDetails':
          fields.push('#node-input-environment_id'
                          + ', #node-input-collection_id');
          break;
        case 'listConfigurations':
          fields.push('#node-input-environment_id'
                          + ', #node-input-configurationname');
          break;
        case 'getConfigurationDetails':
          fields.push('#node-input-environment_id'
                         + ', #node-input-configuration_id');
          break;
        case 'query':
          fields.push('#node-input-environment_id'
                         + ', #node-input-collection_id'
                         + ', #node-input-count'
                         + ', #node-input-query'
                         + ', #node-input-filter'
                         + ', #node-input-aggregation'
                         + ', #node-input-return');
          break;
      }
      disV1.showSelectedFields(fields);
    }

    disV1.UIListeners = function () {
      $('#node-input-discovery-method').change(function(val){
        var method = $('#node-input-discovery-method').val();
        disV1.processSelectedMethod(method);
      });
    }

    disV1.checkForPrepare = function () {
      disV1.hideAll();
      disV1.UIListeners();
    };

    // This is the on edit prepare function, which will be invoked everytime the dialog is shown.
    function oneditprepare() {
      disV1.checkForPrepare();
      $.getJSON('watson-discovery/vcap/')
        .done(function (service) {
          $('.credentials').toggle(!service);
        })
        .fail(function () {
          $('.credentials').show();
        }).always(function () {
          $('#credentials-check').hide();
        })
    }

    (function() {
        RED.nodes.registerType('watson-discovery-v1', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ""},
                environmentname: {value: ""},
                environment_id: {value: ""},
                collection_id: {value: ""},
                configurationname: {value: ""},
                configuration_id: {value: ""},
                count: {value: "1"},
                query: {value: ""},
                filter: {value: ""},
                aggregation: {value: ""},
                return: {value: ""},
                "discovery-method": {value:"listEnvrionments"}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(230,140,80)",
            inputs: 1,
            outputs: 1,
            icon: "discovery.png",
            paletteLabel: "discovery",
            label: function() {
                return this.name || "discovery";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: oneditprepare
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-discovery-v1">
    <p>This is the Node for the V1 Watson Discovery service.</p>
    <p>The following methods are available:</p>
    <ul>
        <li>
            <p><b>List Existing Envrionments</b><p>
            <p>For this methong the node does not need any input. If the envrionment name field is left blank
      it will list all envrionments created for the instance of the Discovery service.
      If the envrionment name is specified, then only the details for
      the Discovery envrionment with the specified name will be returned.
            </p>
            <p>The environment being requested can be overridden by specifying the search name
      in <code>msg.discoveryparams.environmentname</code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.environments</code> : A list of the envrionments created under
              the Discovery service instance.</li>
              </ul>
        </li>
        <br/>
        <li>
            <p><b>Get Envrionment Details</b><p>
            <p>For this method the node needs an Environment ID as input.
            </p>
            <p>The environment being requested can be overridden by specifying the search id
      in <code>msg.discoveryparams.environment_id</code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.environment_details</code> : Details of the requested environment.</li>
              </ul>
        </li>
        <br/>
        <li>
            <p><b>List Existing Collections</b><p>
            <p>For this method the node needs an Environment ID as input.</p>
            <p>The Environment ID for the collection list being requested can be overridden by specifying the search id
      in <code>msg.discoveryparams.environment_id</code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.collections</code> : A list of the collections created under
              the environment in the Discovery service instance.</li>
              </ul>
        </li>
        <br/>
        <li>
            <p><b>Get Collections Details</b><p>
            <p>For this methond the node needs an Environment ID and Collection ID as input.
            </p>
            <p>The collection being requested can be overridden by specifying the
            search ids in
            <code>msg.discoveryparams.environment_id</code>
            and <code>msg.discoveryparams.collection_id</code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.collection_details</code> : Details of the requested collection.</li>
              </ul>
        </li>
        <br/>
        <li>
            <p><b>List Existing Configurations</b><p>
            <p>For this method the node needs an Environment ID as input.</p>
            <p>and an optional Configuration name to show only the
               configuration with the given name.</p>
            <p>The Environment ID for the configuration list being requested can be
               overridden by specifying the environment id in
               <code>msg.discoveryparams.environment_id</code>
               The configuration name can be overridden by specifying the name inspect
               <code>msg.discoveryparams.configuration_name</code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.configurations</code> : A list of the configurations
                  created under
                  the environment in the Discovery service instance.</li>
              </ul>
        </li>
        <br/>
        <li>
            <p><b>Get Configuration Details</b><p>
            <p>For this method node needs an Environment ID and Configuration ID as input.</p>
            <p>The Environment and Configuration IDs for the configuration being
               requested can be
               overridden by specifying the environment id in
               <code>msg.discoveryparams.environment_id</code>
               and the configuration id in
               <code>msg.discoveryparams.configuration_id</code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.configuration_details</code> : Details the
                  requested configuration.</li>
              </ul>
        </li>
        <br/>
        <li>
            <p><b>Search in Collection</b><p>
            <p>For this method the node needs an Environment ID and Collection ID as input.
            </p>
            <p>The collection being requested can be overridden by specifying the
            search ids in
            <code>msg.discoveryparams.environment_id</code>
            and <code>msg.discoveryparams.collection_id</code>
            </p>
            <p>Optionally you can specify the number of documents to retrieve, a
               query to find the most relevant search results, a filter
               to limit the search results an aggregation to return an
               exact result, and a comma separated list of the sections of the
               documents to return.</p>
            <p>The query being submitted can be overridden by specifying the
            query in <code>msg.discoveryparams.query</code>.
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.search_results</code> : Details of the requested collection.</li>
              </ul>
        </li>

    </ul>

    <p>For more information about the Discovery service,
    read the service <a href="https://www.ibm.com/watson/developercloud/doc/discovery/">documentation</a>.</p>

</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-discovery-v1-query-builder">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div id="credentials-not-found" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Could not bind to service.
            </b> This node can not be further configured without a valid service.
            Try entering valid credentials?
        </div>
    </div>
    <div id="something-went-wrong" class="form-row">
        <div class="form-tips">
            <div>
                <input disabled type="text" id="node-input-errorwarning"/>
            </div>
        </div>
    </div>


    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>

    <div class="form-row">
        <label for="node-input-environment"><i class="fa fa-book"></i> Environment</label>
        <select type="text" id="node-input-environment" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>
    <div>
        <input type="hidden" id="node-input-environmenthidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-collection"><i class="fa fa-book"></i> Collection</label>
        <select type="text" id="node-input-collection" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>
    <div>
        <input type="hidden" id="node-input-collectionhidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-query1"><i class="fa fa-book"></i> Query Key 1</label>
        <select type="text" id="node-input-query1" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
        <input type="text" id="node-input-queryvalue1" placeholder="">
    </div>
    <div>
        <input type="hidden" id="node-input-query1hidden"/>
        <input type="hidden" id="node-input-queryvalue1hidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-query2"><i class="fa fa-book"></i> Query Key 2</label>
        <select type="text" id="node-input-query2" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
        <input type="text" id="node-input-queryvalue2" placeholder="">
    </div>
    <div>
        <input type="hidden" id="node-input-query2hidden"/>
        <input type="hidden" id="node-input-queryvalue2hidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-query3"><i class="fa fa-book"></i> Query Key 3</label>
        <select type="text" id="node-input-query3" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
        <input type="text" id="node-input-queryvalue3" placeholder="">
    </div>
    <div>
        <input type="hidden" id="node-input-query3hidden"/>
        <input type="hidden" id="node-input-queryvalue3hidden"/>
    </div>

</script>



<script type="text/javascript">

    // Need to simulate a namespace, so that some of the variables don't leak across nodes
    function DiscoveryQueryBuilderV1 () {}

    // This is the namespace for this version of this Node.
    var disQB = new DiscoveryQueryBuilderV1();
    disQB.environments = null;
    disQB.collections = {};
    disQB.schemas = {};

    // Initially assume that we dont have credentials and that neither system
    // nor local set have been provided.
    disQB.have_credentials = false;
    disQB.using_local_credentials = true;

    disQB.environment_selected = $('#node-input-environmenthidden').val();
    disQB.collection_selected = $('#node-input-collectionhidden').val();
    disQB.query1_selected = $('#node-input-query1hidden').val();
    disQB.query2_selected = $('#node-input-query2hidden').val();
    disQB.query3_selected = $('#node-input-query3hidden').val();


    // Nothing is to be shown unless the values to show in the listCollections
    // can be obtained from the service.
    disQB.hideAll = function() {
      $('#credentials-not-found').show();
      $('#something-went-wrong').hide();
      $('#node-input-environment').parent().hide();
      $('#node-input-collection').parent().hide();
      $('#node-input-query1').parent().hide();
      $('#node-input-query2').parent().hide();
      $('#node-input-query3').parent().hide();
    };

    disQB.showSelectedFields = function(fields) {
      for (i = 0; i < fields.length; i++) {
        $(fields[i]).parent().show();
      }
    }

    // Set up listeners for the select lists to determine if the subsequent
    // list boxes need refreshing. ie. A change in selected Envionment, needs
    // the collection list to be revised. A change in selected collection, needs
    // the schema lists to be revised.
    disQB.UIListeners = function () {
      $('#node-input-username').change(function(val){
        disQB.getCredentials();
      });

      $('#node-input-password').change(function(val){
        disQB.getCredentials();
      });

      $('#node-input-environment').change(function (val) {
        disQB.environment_selected = $('#node-input-environment').val();
        if (disQB.environment_selected &&
              !disQB.collectionCheck()) {
          disQB.getCollections();
        }
        else if (disQB.environment_selected) {
          disQB.populateCollections();
        }
      });

      $('#node-input-collection').change(function (val) {
        disQB.collection_selected = $('#node-input-collection').val();
        if (disQB.collection_selected &&
              !disQB.schemaCheck()) {
          disQB.getSchemas();
        }
        else if (disQB.collection_selected) {
          disQB.populateSchemas();
        }
      });

      $('#node-input-query1').change(function (val) {
        disQB.query1_selected = $('#node-input-query1').val();
      });

      $('#node-input-query2').change(function (val) {
        disQB.query2_selected = $('#node-input-query2').val();
      });

      $('#node-input-query3').change(function (val) {
        disQB.query3_selected = $('#node-input-query3').val();
      });

    }

    // The dialog is about to be shown.
    disQB.checkForPrepare = function () {
      disQB.hideAll();
      disQB.UIListeners();
    };

    // Search the cache for a collection
    disQB.collectionCheckForEnv = function (env) {
      var coll = null;
      if (disQB.collections && disQB.collections[env])
      {
        coll = disQB.collections[env];
      }
      return coll;
    }

    // Search the collection cache for the selected envrionment
    disQB.collectionCheck = function () {
      return disQB.collectionCheckForEnv(disQB.environment_selected);
    }

    // Search for a collection schema
    disQB.schemaCheckForCollection = function (coll) {
      var schema = null;
      if (disQB.schemas && disQB.schemas[coll])
      {
        schema = disQB.schemas[coll];
      }
      return schema;
    }

    // Search the schema cache for the selected collection.
    disQB.schemaCheck = function () {
      return disQB.schemaCheckForCollection(disQB.collection_selected);
    }

    // Fill up the Envrionment switch list
    disQB.populateEnvironments = function() {
      if (disQB.environments && disQB.environments.length) {
        $('select#node-input-environment').empty();

        disQB.environments.forEach(function(env) {
          var selectedText = '';
          if (disQB.environment_selected === env.environment_id) {
            selectedText = 'selected="selected"';
          }
          $('select#node-input-environment')
            .append('<option value='
                          + '"' + env.environment_id + '"'
                          + selectedText
                          + '>'
                          + env.name
                          + '</option>');
        });
        if (!disQB.collectionCheck()) {
          disQB.getCollections();
        }
      }
    };

    // Fill up the collection switch list
    disQB.populateCollections = function() {
      var coll = disQB.collectionCheck();
      if (coll && coll.length) {
        $('select#node-input-collection').empty();

        coll.forEach(function(c) {
          var selectedText = '';
          if (disQB.collection_selected === c.collection_id) {
            selectedText = 'selected="selected"';
          }
          $('select#node-input-collection')
            .append('<option value='
                          + '"' + c.collection_id + '"'
                          + selectedText
                          + '>'
                          + c.name
                          + '</option>');
        });
        if (!disQB.schemaCheck()) {
          disQB.getSchemas();
        }
      }
    };

    // Fill up the 3 schema switch lists
    disQB.populateSchemas = function() {
      var schema = disQB.schemaCheck();
      if (schema && schema.length) {
        $('select#node-input-query1').empty();
        $('select#node-input-query2').empty();
        $('select#node-input-query3').empty();

        schema.forEach(function(s) {
          var selected1Text = '';
          var selected2Text = '';
          var selected3Text = '';
          if (disQB.query1_selected === s) {
            selected1Text = 'selected="selected"';
          }
          if (disQB.query2_selected === s) {
            selected2Text = 'selected="selected"';
          }
          if (disQB.query3_selected === s) {
            selected3Text = 'selected="selected"';
          }
          $('select#node-input-query1')
            .append('<option value='
                          + '"' + s + '"'
                          + selected1Text
                          + '>'
                          + s
                          + '</option>');
          $('select#node-input-query2')
            .append('<option value='
                          + '"' + s + '"'
                          + selected2Text
                          + '>'
                          + s
                          + '</option>');
          $('select#node-input-query3')
            .append('<option value='
                          + '"' + s + '"'
                          + selected3Text
                          + '>'
                          + s
                          + '</option>');
        });
      }
    };


    // If we have a list of envrionments, then the
    // environment switch list can be shown.
    disQB.showEnvironments = function () {
      if (disQB.environments) {
        $('select#node-input-environment').parent().show();
        disQB.populateEnvironments();
      }
    }

    // If we have a collection for the envrionment, then the
    // collection switch list can be shown.
    disQB.showCollections = function () {
      if (disQB.collections && disQB.collectionCheck()) {
        $('select#node-input-collection').parent().show();
        disQB.populateCollections();
      }
    }

    // If we have a schema for the collection, then the
    // three query switch lists can be shown.
    disQB.showSchemas = function () {
      if (disQB.schemas && disQB.schemaCheck()) {
        $('select#node-input-query1').parent().show();
        $('select#node-input-query2').parent().show();
        $('select#node-input-query3').parent().show();
        disQB.populateSchemas();
      }
    }

    // Retrieve the available environments from the server, if data is returned, then
    // can enable the dynamic selection fields.
    disQB.getEnvironments = function () {
      var u = $('#node-input-username').val();
      var p = $('#node-input-password').val();

      $.getJSON('watson-discovery-v1-query-builder/environments',
                 {un: u, pwd: p}
      ).done(function (data) {
        $('#something-went-wrong').hide();
        if (data.error) {
          $('#something-went-wrong').show();
          $('input#node-input-errorwarning').val(data.error);
        }
        else {
          $('#credentials-not-found').hide();
          disQB.environments = data;
          disQB.have_credentials = true;
          disQB.showEnvironments();
        }
      }).fail(function (err) {
        var txt = 'Got server error ';
        if (err.status) {
          txt += '(' + err.status + ') '
        }
        txt += 'when trying to retrieve available envrionments';
        $('#something-went-wrong').show();
        $('input#node-input-errorwarning').val(txt);
      }).always(function () {
      });
    }

    // Retrieve the available collections in the selected envrionment from the server,
    // if data is returned, then can enable the dynamic selection fields.
    disQB.getCollections = function () {
      var u = $('#node-input-username').val();
      var p = $('#node-input-password').val();

      $.getJSON('watson-discovery-v1-query-builder/collections',
                 {un: u, pwd: p,
                  environment_id: disQB.environment_selected}
      ).done(function (data) {
        $('#something-went-wrong').hide();
        if (data.error) {
          $('#something-went-wrong').show();
          $('input#node-input-errorwarning').val(data.error);
        }
        else {
          disQB.collections[disQB.environment_selected] = data;
          disQB.showCollections();
        }
      }).fail(function (err) {
        var txt = 'Got server error ';
        if (err.status) {
          txt += '(' + err.status + ') '
        }
        txt += 'when trying to retrieve available collections';
        $('#something-went-wrong').show();
        $('input#node-input-errorwarning').val(txt);
      }).always(function () {
      });
    }

    // Retrieve the available collections in the selected envrionment from the server,
    // if data is returned, then can enable the dynamic selection fields.
    disQB.getSchemas = function () {
      var u = $('#node-input-username').val();
      var p = $('#node-input-password').val();

      $.getJSON('watson-discovery-v1-query-builder/schemas',
                 {un: u, pwd: p,
                  environment_id: disQB.environment_selected,
                  collection_id: disQB.collection_selected
                 }
      ).done(function (data) {
        $('#something-went-wrong').hide();
        if (data.error) {
          $('#something-went-wrong').show();
          $('input#node-input-errorwarning').val(data.error);
        }
        else {
          disQB.schemas[disQB.collection_selected] = data;
          disQB.showSchemas();
        }
      }).fail(function (err) {
        var txt = 'Got server error ';
        if (err.status) {
          txt += '(' + err.status + ') '
        }
        txt += 'when trying to retrieve available schemas for collection';
        $('#something-went-wrong').show();
        $('input#node-input-errorwarning').val(txt);
      }).always(function () {
      });
    }


    // Simple check that is only invoked if the service is not bound into bluemix.
    // In this case the user has to provide credentials. Once there are credentials,
    // then the discovery environments are retrieved.
    disQB.getCredentials = function () {
      var u = $('#node-input-username').val();
      var p = $('#node-input-password').val();

      if (u && u.length && p) {
        if (!disQB.environments) {
          disQB.getEnvironments();
        }
      }
    }

    // The dynamic nature of the selection fields in this node has caused problems.
    // Whenever there is a fetch for the models, on a page refresh or applicaiton
    // restart, the settings for the dynamic fields are lost.
    // So hidden (text) fields are being used to squirrel away the values, so that
    // they can be restored.
    disQB.restoreHidden = function () {
      disQB.environment_selected = $('#node-input-environmenthidden').val();
      $('select#node-input-environment').val(disQB.environment_selected);

      disQB.collection_selected = $('#node-input-collectionhidden').val();
      $('select#node-input-collection').val(disQB.collection_selected);

      disQB.query1_selected = $('#node-input-query1hidden').val();
      $('select#node-input-query1').val(disQB.query1_selected);

      disQB.queryvalue1_selected = $('#node-input-queryvalue1hidden').val();
      $('select#node-input-queryvalue1').val(disQB.queryvalue1_selected);

      disQB.query2_selected = $('#node-input-query2hidden').val();
      $('select#node-input-query2').val(disQB.query2_selected);

      disQB.queryvalue2_selected = $('#node-input-queryvalue2hidden').val();
      $('select#node-input-queryvalue2').val(disQB.queryvalue2_selected);

      disQB.query3_selected = $('#node-input-query3hidden').val();
      $('select#node-input-query3').val(disQB.query3_selected);

      disQB.queryvalue3_selected = $('#node-input-queryvalue3hidden').val();
      $('select#node-input-queryvalue3').val(disQB.queryvalue3_selected);
    }


    // This is the on edit prepare function, which will be invoked everytime the dialog is shown.
    function oneditprepare() {
      disQB.hideAll();
      disQB.restoreHidden();

      disQB.checkForPrepare();
      if (!disQB.have_credentials) {
        $.getJSON('watson-discovery-v1-query-builder/vcap/')
          .done(function (service) {
            $('.credentials').toggle(!service);
            // for some reason the getJSON resets the vars so need to restoreHidden again
            // so again.
            disQB.restoreHidden();
            if (!service) {
              // no bound service, so check local settings to see if they are valid
              disQB.using_local_credentials = true;
              disQB.getCredentials();
            } else {
              // credentials are only valid if we can get hold of the models using them
              disQB.using_local_credentials = false;
              if (!disQB.environments) {disQB.getEnvironments();}
            }
          })
          .fail(function () {
            $('.credentials').show();
          }).always(function () {
            $('#credentials-check').hide();
          })
      }
      // credentials can be set during the oneditprepare process, so check again.
      if (disQB.have_credentials || disQB.using_local_credentials)
      {
        $('#credentials-check').hide();
        if (disQB.have_credentials) {
          $('#credentials-not-found').hide();
        }
        if (disQB.using_local_credentials) {
          $('.credentials').show();
        }
        disQB.showEnvironments();
        disQB.showCollections();
        disQB.showSchemas();
      }
    }

    // Save the values in the dyanmic lists to the hidden fields.
    function oneditsave(){
      disQB.environment_selected = $('#node-input-environment').val();
      $('#node-input-environmenthidden').val(disQB.environment_selected);

      disQB.collection_selected = $('#node-input-collection').val();
      $('#node-input-collectionhidden').val(disQB.collection_selected);

      disQB.query1_selected = $('#node-input-query1').val();
      $('#node-input-query1hidden').val(disQB.query1_selected);

      disQB.queryvalue1_selected = $('#node-input-queryvalue1').val();
      $('#node-input-queryvalue1hidden').val(disQB.queryvalue1_selected);

      disQB.query2_selected = $('#node-input-query2').val();
      $('#node-input-query2hidden').val(disQB.query2_selected);

      disQB.queryvalue2_selected = $('#node-input-queryvalue2').val();
      $('#node-input-queryvalue2hidden').val(disQB.queryvalue2_selected);

      disQB.query3_selected = $('#node-input-query3').val();
      $('#node-input-query3hidden').val(disQB.query3_selected);

      disQB.queryvalue3_selected = $('#node-input-queryvalue3').val();
      $('#node-input-queryvalue3hidden').val(disQB.queryvalue3_selected);
    }

    (function() {
        RED.nodes.registerType('watson-discovery-v1-query-builder', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ""},
                password: {value: ''},
                environment: {value: ''},
                environmenthidden: {value: ''},
                collection: {value: ''},
                collectionhidden: {value: ''},
                query1: {value: ''},
                query1hidden: {value: ''},
                queryvalue1: {value: ''},
                queryvalue1hidden: {value: ''},
                query2: {value: ''},
                query2hidden: {value: ''},
                queryvalue2: {value: ''},
                queryvalue2hidden: {value: ''},
                query3: {value: ''},
                query3hidden: {value: ''},
                queryvalue3: {value: ''},
                queryvalue3hidden: {value: ''}
            },
            credentials: {
              username: {type:"text"} //,
              // password: {type:"password"}
            },
            color: "rgb(200,140,80)",
            inputs: 1,
            outputs: 1,
            icon: "discovery.png",
            paletteLabel: "discovery query builder",
            label: function() {
                return this.name || "discovery query builder";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: oneditprepare,
            oneditsave: oneditsave
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-discovery-v1-query-builder">
    <p>This is the Query Builder Node for the V1 Watson Discovery service.</p>
    <p>Use this node upflow of a Watson Discovery Node to build the query to be used
    by the Discovery Node</p>

    <p>The node fetches the searchable fields in the collection and allows you to
      set upto 3 query search items.
    </p>
    <p>The output from the Node is an object in <code>msg.discoveryparams</code>
    that the Watson Discovery Node uses as override settings.
    </p>

    <p>For more information about the Discovery service,
    read the service <a href="https://www.ibm.com/watson/developercloud/doc/discovery/">documentation</a>.</p>

</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-discovery">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>

    <div class="form-row">
        <label for="node-input-discovery-method"><i class="fa fa-book"></i> Method: </label>
        <select type="text" id="node-input-discovery-method" style="display: inline-block; width: 70%;">
            <option value="listEnvrionments">List existing envionments</option>
            <option value="getEnvironmentDetails">Retrieve environment details</option>
            <option value="listCollections">List existing collections</option>
            <option value="getCollectionDetails">Retrieve collection details</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-environmentname"><i class="fa fa-tag"></i> Environment Name</label>
        <input type="text" id="node-input-environmentname" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-environment_id"><i class="fa fa-tag"></i> Environment ID</label>
        <input type="text" id="node-input-environment_id" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-collection_id"><i class="fa fa-tag"></i> Collection ID</label>
        <input type="text" id="node-input-collection_id" placeholder="">
    </div>

</script>



<script type="text/javascript">

    // Need to simulate a namespace, so that some of the variables don't leak across nodes
    function DiscoveryExperimental () {}

    // This is the namespace for this version of this Node.
    var disExp = new DiscoveryExperimental();

    //disExp.abc = 'abc';
    disExp.hideAll = function() {
      $('#node-input-environmentname').parent().hide();
      $('#node-input-environment_id').parent().hide();
      $('#node-input-collection_id').parent().hide();
    };

    disExp.processSelectedMethod = function(method) {
      disExp.hideAll();
      switch (method) {
        case 'listEnvrionments':
          $('#node-input-environmentname').parent().show();
          break;
        case 'getEnvironmentDetails':
        case 'listCollections':
          $('#node-input-environment_id').parent().show();
          break;
        case 'getCollectionDetails':
          $('#node-input-environment_id').parent().show();
          $('#node-input-collection_id').parent().show();
          break;
      }
    }

    disExp.UIListeners = function () {
      $('#node-input-discovery-method').change(function(val){
        var method = $('#node-input-discovery-method').val();
        disExp.processSelectedMethod(method);
      });
    }

    disExp.checkForPrepare = function () {
      disExp.hideAll();
      disExp.UIListeners();
    };

    // This is the on edit prepare function, which will be invoked everytime the dialog is shown.
    function oneditprepare() {
      disExp.checkForPrepare();
      $.getJSON('watson-discovery/vcap/')
        .done(function (service) {
          $('.credentials').toggle(!service);
        })
        .fail(function () {
          $('.credentials').show();
        }).always(function () {
          $('#credentials-check').hide();
        })
    }

    (function() {
        RED.nodes.registerType('watson-discovery', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""},
                environmentname: {value: ""},
                environment_id: {value: ""},
                collection_id: {value: ""},
                "discovery-method": {value:"listEnvrionments"}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(84,149,230)",
            inputs: 1,
            outputs: 1,
            icon: "discovery.png",
            paletteLabel: "discovery",
            label: function() {
                return this.name || "discovery";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: oneditprepare
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-discovery">
    <p>This is the Node for the V1 Experimental Watson Discovery service.</p>
    <p>This Experimental node has now been deprecated.</p>
    <p>The following methods are available:</p>
    <ul>
        <li>
            <p><b>List Existing Envrionments</b><p>
            <p>The node does not need any input. If the envrionment name field is left blank
      it will list all envrionments created for the instance of the Discovery service.
      If the envrionment name is specified, then only the details for
      the Discovery envrionment with the specified name will be returned.
            </p>
            <p>The environment being requested can be overridden by specifying the search name
      in <code>msg.discoveryparams.environmentname</code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.environments</code> : A list of the envrionments created under
              the Discovery service instance.</li>
              </ul>
        </li>
        <br/>
        <li>
            <p><b>Get Envrionment Details</b><p>
            <p>The node needs an Environment ID as input.
            </p>
            <p>The environment being requested can be overridden by specifying the search id
      in <code>msg.discoveryparams.environment_id</code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.environment_details</code> : Details of the requested environment.</li>
              </ul>
        </li>
        <br/>
        <li>
            <p><b>List Existing Collections</b><p>
            <p>The node needs an Environment ID as input.</p>
            <p>The Environment ID for the collection list being requested can be overridden by specifying the search id
      in <code>msg.discoveryparams.environment_id</code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.collections</code> : A list of the collections created under
              the environment in the Discovery service instance.</li>
              </ul>
        </li>
        <br/>
        <li>
            <p><b>Get Collections Details</b><p>
            <p>The node needs an Environment ID and Collection ID as input.
            </p>
            <p>The collection being requested can be overridden by specifying the
            search ids in
            <code>msg.discoveryparams.environment_id/code>
            and <code>msg.discoveryparams.collection_id/code>
            </p>
            <p>Node output : </p>
              <ul>
                <li><code>msg.collection_details</code> : Details of the requested collection.</li>
              </ul>
        </li>
        <br/>
    </ul>
    <p>For more information about the Discovery service,
    read the service <a href="https://www.ibm.com/watson/developercloud/doc/discovery/">documentation</a>.</p>

</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<script type="text/javascript">
	RED.nodes.registerType('convert',{
		category: 'IBM_Watson',
		color: 'rgb(99, 158, 230)',
		defaults: {
			name: {value:""},
			target: {value:"",required:true},
			username: {value:"",required:true},
			password: {value:"",required:true},
			service: {value:"",required:true},
		},		
		inputs:1,
		outputs:1,
		icon: "DocumentConversion.png",
		label: function() {
			return this.name||"convert";
		},
		
		converts: [],

		oneditprepare: function() {
			var node = this;
			
			$.getJSON('convert/vcap/',function(data) {
				node.converts = data;
				var last = $('#node-input-service').children().last();
				var opts = [];
	
				for (var i=0; i < data.length; i++) {
					var selected = node.service === data[i].name;
					opts.push(
						'<option value="' + data[i].name + '"' + (selected ? " selected":"") + '>' +
							data[i].name +
						'</option>'
					);
				}
	
				if (opts.length === 0) {
					node.service = "_ext_";
					$('#node-input-service').find("option").filter(function() {
						return $(this).val() == node.service;
					}).attr('selected', true);
				} else {
					last.before(opts.join(""));
				}
	
				if (node.service === '_ext_') {
					$("#external_convert_details :input").attr('disabled',false);
				} else {
					for (var i2=0;i2<node.converts.length;i2++) {
						var ta = node.converts[i2];
						if (ta.name === node.service) {
							$("#node-input-url").val(ta.url);
							$("#node-input-username").val(ta.username);
							$("#node-input-password").val(ta.password);
							util.log("** Convert: "+JSON.stringify(node.converts[i2]));
						}
					}
					$("#external_convert_details :input").attr('disabled',true);
				}
			}); 

			$("#node-input-service").on("change",function() {
				$("#node--input-service").val(this.value);
				if (this.value === '_ext_') {
					$("#external_convert_details :input").attr('disabled',false);
				} else {
					if(node.converts) {
						$("#external_convert_details :input").attr('disabled',true);
						for (var i=0;i<node.converts.length;i++) {
							var ta = node.converts[i];
							if (ta.name === this.value) {
								$("#node-input-url").val(ta.url);
								$("#node-input-username").val(ta.username);
								$("#node-input-password").val(ta.password);
							}
						}
					}

				}
			});
		}
	});


</script>

<script type="text/x-red" data-template-name="convert">
	<div class="form-row">
		<label for="node-input-name"><i class="icon-tag"></i> Name</label>
		<input type="text" id="node-input-name" placeholder="Name">
	</div>
	<div class="form-row">
		<label for="node-input-target"><i class="fa fa-file-text"></i> Target</label>
		<select id="node-input-target">
			<option value="ANSWER_UNITS">Answer Units</option>
			<option value="NORMALIZED_HTML">Normalized HTML</option>
			<option value="NORMALIZED_TEXT">Normalized Text</option>
			<!--option value=".json">Answer Units</option>
			<option value=".html">Normalized HTML</option>
			<option value=".txt">Normalized Text</option -->
		</select>
	</div>

	<div class="form-row">
		<label for="node-input-service"><i class="fa fa-globe"></i> Service</label>
		<select id="node-input-service">
			<option value="" disabled></option>
			<option value="_ext_"> External service</option>
		</select>
	</div>
	
	<div id="external_convert_details">
		<div class="form-row">
			<label for="node-input-username"><i class="fa fa-user"></i> Username</label>
			<input type="text" id="node-input-username">
		</div>
		<div class="form-row">
			<label for="node-input-password"><i class="fa fa-lock"></i> Password</label>
			<input type="text" id="node-input-password">
		</div>
	</div>
	
	
</script>


	



<script type="text/x-red" data-help-name="convert">
	<p>A node for Watson Document Conversion.</p>
	<p>The contents to be converted must be placed in <b>msg.payload</b>. Those contents can be a url pointing to the file 
	or a binary stream with the file contents. The target of conversion must be specified. If the value is not specified in 
	the configuration dialog for the node, it will be taken from <b>msg.target</b>. Optionally, details on how to format 
	the file contents may be placed on <b>msg.word</b>, <b>msg.normalized_html</b> or <b>msg.txt</b> for Word, HTML or 
	Text files (more information on the formatting can be found in the 
	<a href='http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/doc/document-conversion/customizing.shtml'> 
	Document Conversion API documentation</a>).
</script><script type="text/x-red" data-help-name="convert">
	<p>A node for interfacing with Document Convert</p>
</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!-- Corpus Configuration Node -->
<script type="text/x-red" data-template-name="watson-concept-insights-corpus">

    <div class="form-row">
        <label for="node-config-input-corpusmode"><i class="fa fa-question"></i> Mode</label>
        <select type="text" id="node-config-input-corpusmode" style="display: inline-block; width: 70%;" >
            <option value="user">User defined Corpus</option>
            <option value="public">Public Corpus</option>
        </select>
    </div>
    <div class="form-row corpusmode user">
        <label for="node-config-input-cname"><i class="fa fa-tag"></i> Corpus Name</label>
        <input type="text" id="node-config-input-cname" placeholder="Name">
    </div>
    <div class="form-row corpusmode user">
        <label for="node-config-input-access"><i class="fa fa-lock"></i> Access</label>
        <select type="text" id="node-config-input-access">
            <option value="private">Private</option>
            <option value="public">Public</option>
        </select>
    </div>
    <div class="form-row corpusmode public">
        <label for="node-config-input-publiccorpus"><i class="fa fa-globe"></i> Public Corpus</label>
        <select type="text" id="node-config-input-publiccorpus">
            <option value="TEDTalks">TED Talks</option>

        </select>
    </div>
</script>

<script type="text/javascript">
(function() {
    RED.nodes.registerType('watson-concept-insights-corpus',{
        category: 'config',
        defaults: {
            cname:{value: ""},
            access:{value: "private"},
            corpusmode: {value: "user"},
            publiccorpus: {value: "TEDTalks"}
        },
        label: function() {
            return this.cname || this.publiccorpus;
        },
        oneditprepare: function() {
            $('#node-config-input-corpusmode').change(function () {
                var mode = $('#node-config-input-corpusmode').val();
                $('.form-row.corpusmode.' + mode).show();
                $('.form-row.corpusmode:not(.' + mode + ')').hide();
            });
        }
    });
})();
</script>

<!-- Upload Document Node -->
<script type="text/x-red" data-template-name="watson-concept-insights-upload-document">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-corpus"><i class="fa fa-database"></i> Corpus</label>
        <input type="text" id="node-input-corpus">
    </div>
    <div class="form-row">
        <label for="node-input-documentname"><i class="fa fa-tag"></i> Document Name</label>
        <input type="text" id="node-input-documentname" placeholder="Document Name">
    </div>
    <div class="form-row">
        <label for="node-input-documentlabel"><i class="fa fa-tag"></i> Document Label</label>
        <input type="text" id="node-input-documentlabel" placeholder="Document Label">
    </div>
    <div class="form-row">
        <label for="node-input-contenttype"><i class="fa fa-font"></i> Content Type</label>
        <select type="text" id="node-input-contenttype" style="display: inline-block; width: 70%;">
            <option value="text/plain">Text</option>
            <option value="text/html">HTML</option>
            <option value="text/x-wiki">Wikitext</option>
            <option value="text/url">URL</option>
        </select>
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-concept-insights-upload-document', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""},
                corpus: {value: "", type: 'watson-concept-insights-corpus'},
                documentname: {value: "", required: true},
                documentlabel: {value: "", required: true},
                contenttype: {value: "", required: true}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(85, 150, 230)",
            inputs: 1,
            outputs: 0,
            icon: "ConceptInsights.png",
            paletteLabel: "concept insights upload document",
            label: function() {
                return this.name || "concept insights upload document";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-concept-insights/vcap/').done(function (service) {
                    $('.credentials').toggle(!service);
                }).fail(function () {
                    $('.credentials').show();
                }).always(function () {
                    $('#credentials-check').hide();
                });
            }
        });
    })();
</script>

<!-- Searching Node -->
<script type="text/x-red" data-template-name="watson-concept-insights-search">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-corpus"><i class="fa fa-database"></i> Corpus</label>
        <input type="text" id="node-input-corpus">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-question"></i> Mode</label>
        <select type="text" id="node-input-mode" style="display: inline-block; width: 70%;" >
            <option value="corpus">Corpus</option>
            <option value="document">Document</option>
        </select>
    </div>
    <div class="form-row mode corpus">
        <label for="node-input-corpusapicall"><i class="fa fa-laptop"></i> API Call</label>
        <select type="text" id="node-input-corpusapicall" style="display: inline-block; width: 70%;" >
            <option value="statistics">Corpus Statistics</option>
            <option value="relatedconcepts">Related Concepts</option>
            <option value="relationscores">Relation Scores</option>
            <option value="conceptualsearch">Conceptual Search</option>
            <option value="documentlabel">Search Document Labels</option>
        </select>
    </div>
    <div class="form-row mode corpus query" style="display: none;">
        <label for="node-input-query"><i class="fa fa-search"></i> Query</label>
        <input type="text" id="node-input-query">
    </div>
    <div class="form-row mode document">
        <label for="node-input-docapicall"><i class="fa fa-laptop"></i> API Call</label>
        <select type="text" id="node-input-docapicall" style="display: inline-block; width: 70%;" >
            <option value="annotations">Document Annotations</option>
            <option value="relatedconcepts">Related Concepts</option>
            <option value="relationscores">Relation Scores</option>
        </select>

        <div class="form-row">
            <label for="node-input-docname"><i class="fa fa-tag"></i> Document Name</label>
            <input type="text" id="node-input-docname" placeholder="Document Name">
        </div>
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-concept-insights-search', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""},
                corpus: {value: "", type: 'watson-concept-insights-corpus'},
                mode: {value: "corpus"},
                docapicall: {value: "annotations"},
                corpusapicall: {value: "statistics"},
                docname: {value: ""},
                query: {value: ""}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(85, 150, 230)",
            inputs: 1,
            outputs: 1,
            icon: "ConceptInsights.png",
            paletteLabel: "concept insights search",
            label: function() {
                return this.name || "concept insights search";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $('#node-input-mode').change(function () {
                    var mode = $('#node-input-mode').val();
                    $('.form-row.mode.' + mode +':not(.query)').show();
                    $('.form-row.mode:not(.' + mode + ')').hide();
                });

                $('#node-input-corpusapicall').change(function () {

                    $('#node-input-corpusapicall').change(function () {
                        var mode = $('#node-input-corpusapicall').val();
                        if (mode == 'documentlabel') {
                          $('.form-row.mode.corpus.query').show();
                        } else {
                          $('.form-row.mode.corpus.query').hide();
                        }
                    });
                });

                $.getJSON('watson-concept-insights/vcap/').done(function (service) {
                    $('.credentials').toggle(!service);
                }).fail(function () {
                    $('.credentials').show();
                }).always(function () {
                    $('#credentials-check').hide();
                })
            }
        });
    })();
</script>

<!-- Search Concepts Node -->
<script type="text/x-red" data-template-name="watson-concept-insights-search-concepts">

    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
</script>



<script type="text/javascript">
(function() {
    RED.nodes.registerType('watson-concept-insights-search-concepts',{
        category: 'Watson Deprecated',
        credentials: {
          username: {type:"text"},
          password: {type:"password"}
        },
        color: "rgb(85, 150, 230)",
        inputs: 1,
        outputs: 1,
        icon: "ConceptInsights.png",
        paletteLabel: "concept insights search concepts",
        label: function() {
            return this.name || "concept insights search concepts";
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            $.getJSON('watson-concept-insights/vcap/').done(function (service) {
                $('.credentials').toggle(!service);
            }).fail(function () {
                $('.credentials').show();
            }).always(function () {
                $('#credentials-check').hide();
            });
        }
    });
})();
</script>

<!-- Related Concepts Node -->
<script type="text/x-red" data-template-name="watson-concept-insights-related-concepts">

    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
</script>



<script type="text/javascript">
(function() {
    RED.nodes.registerType('watson-concept-insights-related-concepts',{
        category: 'Watson Deprecated',
        credentials: {
          username: {type:"text"},
          password: {type:"password"}
        },
        color: "rgb(85, 150, 230)",
        inputs: 1,
        outputs: 1,
        icon: "ConceptInsights.png",
        paletteLabel: "concept insights related concepts",
        label: function() {
            return this.name || "concept insights related concepts";
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            $.getJSON('watson-concept-insights/vcap/').done(function (service) {
                $('.credentials').toggle(!service);
            }).fail(function () {
                $('.credentials').show();
            }).always(function () {
                $('#credentials-check').hide();
            });
        }
    });
})();
</script>
<script type="text/x-red" data-help-name="watson-concept-insights-upload-document">
    <p><b>NB:</b> The Watson Concept Insights service has been deprecated in favour of Concepts in
    AlchemyLanguage. Once the service
    has been switched off this node will no longer work. The node will be removed from the palette in a
    future release. </p>
    <br/>

    <p>The IBM Watson Concept Insights service enables you to identify conceptual associations in the content that you provide. Input content is auto-tagged against a concept graph, which is a formal representation of the relationships between concepts that are present in the data. The concept graph used by the Concept Insights service is based on content that has been ingested from the English language Wikipedia.</p>
    <p>The upload document node can be used to upload a document to a specified corpus for indexing and analysis. The file to be uploaded should be passed into the node on <code>msg.payload</code>.</p>
    <p>Supported <code>msg.payload</code> types:</b>.</p>
    <ul>
        <li><b>String</b> Text, HTML or Wikitext to be uploaded as a document</li>
    </ul>
    <p>Documents are uploaded to a corpus. You can choose a <b>public</b> corpus or a <b>user defined</b> corpus. This can be modified in the corpus configuration panel. A document name and label is required, where the label provides a brief description of the documents contents.</p>
    <p>For more information about the Concept Insights service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/concept-insights.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-concept-insights-search">
     <p><b>NB:</b> The Watson Concept Insights service has been deprecated in favour of Concepts in
     AlchemyLanguage. Once the service
     has been switched off this node will no longer work. The node will be removed from the palette in a
     future release. </p>
    <br/>
    <p>The IBM Watson Concept Insights service enables you to identify conceptual associations in the content that you provide. Input content is auto-tagged against a concept graph, which is a formal representation of the relationships between concepts that are present in the data. The concept graph used by the Concept Insights service is based on content that has been ingested from the English language Wikipedia.</p>
    <p>The search node can be used to search a corpus or individual documents within a corpus. A corpus configuration can be specified within the node configuration panel. The node has two modes, <b>corpus</b> mode and <b>document</b> mode. In <b>corpus</b> mode, the following queries can be executed:</p>
    <ul>
        <li><b>Corpus Statistics</b> Returns a statistical overview of the documents in a corpus and the concepts identified in those documents.</li>
        <li><b>Related Concepts</b> Returns an array of concepts that are conceptually related to a given corpus. Each entry includes a score that indicates the strength of the relation. A higher score indicates a stronger relation.</li>
        <li><b>Relation Scores</b> Returns confidence scores for the relationships between a corpus and each concept in a list of query concepts. Higher scores indicate greater confidences. The array of query concepts must be passed in on <code>msg.concepts</code>.</li>
        <li><b>Conceptual Search</b> Returns documents from the corpus that are sorted by conceptual relevance to a list of given query concepts. Each result includes an explanation for how the document relates to the query. The array of query concepts must be passed in on <code>msg.concepts</code>.</li>
        <li><b>Search Document Labels</b> Searches for documents within a corpus by using partial matches on label fields.</li>
    </ul>
    <p>In <b>document</b> mode, the following queries can be executed:</p>
    <ul>
        <li><b>Document Annotations</b> Returns annotations that relate concepts to sections of document data. The document name can be specified in the node configuration panel.</li>
        <li><b>Related Concepts</b> Returns related concepts for a given document. Each result includes a score that indicates the confidence in the relation. A higher score indicates a stronger relation. The document name can be specified in the node configuration panel.</li>
        <li><b>Relation Scores</b> Returns confidence scores for the relationships between a document and each concept in a list of query concepts. Higher scores indicate greater confidences. The array of query concepts must be passed in on <code>msg.concepts</code>.</li>
    </ul>
    <p>The result is returned on <code>msg.payload</code>.</p>
    <p>For more information about the Concept Insights service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/concept-insights.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-concept-insights-search-concepts">
    <p><b>NB:</b> The Watson Concept Insights service has been deprecated in favour of Concepts in
    AlchemyLanguage. Once the service
    has been switched off this node will no longer work. The node will be removed from the palette in a
    future release. </p>
    <br/>
    <p>The IBM Watson Concept Insights service enables you to identify conceptual associations in the content that you provide. Input content is auto-tagged against a concept graph, which is a formal representation of the relationships between concepts that are present in the data. The concept graph used by the Concept Insights service is based on content that has been ingested from the English language Wikipedia.</p>
    <p>The search concepts node can be used to search the English language Wikipedia content graph for concepts closely matching a given search term. The search term should be passed into the node on <code>msg.payload</code>.</p>
    <p>Supported <code>msg.payload</code> types:</b>.</p>
    <ul>
        <li><b>String</b> The search term for querying concepts.</li>
    </ul>
    <p>Concepts are returned as an array on <code>msg.concepts</code> and the response from the concept insights service is returned on <code>msg.payload</code>.</p>
    <p>For more information about the Concept Insights service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/concept-insights.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-concept-insights-related-concepts">
    <p><b>NB:</b> The Watson Concept Insights service has been deprecated in favour of Concepts in
    AlchemyLanguage. Once the service
    has been switched off this node will no longer work. The node will be removed from the palette in a
    future release. </p>
    <br/>
    <p>The IBM Watson Concept Insights service enables you to identify conceptual associations in the content that you provide. Input content is auto-tagged against a concept graph, which is a formal representation of the relationships between concepts that are present in the data. The concept graph used by the Concept Insights service is based on content that has been ingested from the English language Wikipedia.</p>
    <p>The related concepts node returns related concepts for a given set of source concepts. The source concepts are passed in as an <b>array</b> on <code>msg.concepts</code> and the related concepts are returned on <code>msg.payload</code>.</p>
    <p>For more information about the Concept Insights service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/concept-insights.html">documentation</a>.</p>
</script><!--
  Copyright 2013,2015,2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="alchemy-date-extraction">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-apikey"><i class="fa fa-key"></i> API Key</label>
        <input type="password" id="node-input-apikey" placeholder="API Key">
    </div>
    <div class="form-row" style="padding-top: 10px;">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('alchemy-date-extraction', {
            category: 'IBM Watson',
            defaults: {
              name: {value: ""},
            },
            credentials: {
              apikey: {type:"password"}
            },
            color: '#00A2FF',
            inputs: 1,
            outputs: 1,
            icon: "alchemy.png",
            paletteLabel: "Date Extraction",
            label: function() {
                return this.name || "Date Extraction";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
              $.getJSON('alchemy-date-extraction/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  })
                  .always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="alchemy-date-extraction">
    <p>Using the Date Extract node, you can use the Alchemy APIs to analyse external URLs, HTML files or text content.</p>
    <p>For full details on the feature details, please see the <a href="http://www.ibm.com/watson/developercloud/alchemy-language/api/v1/#date_extraction">Alchemy API documentation</a></p>
    <p>The content to be analysed should be passed in on <code>msg.payload</code>.</p>
    <p>Valid <code>msg.payload</code> types: URL, HTML or Text Content.</p>
    <p>If you need to send custom parameters along with each feature, set those parameters as children of the <code>msg.alchemy_options</code> object. eg. to return the source text with the extracted entities
      <code>msg.alchemy_options = {showSourceText: 1};</code>
    </p>
    <p>By default the <code>anchorDate</code> is set to the current date and time</p>
    </p>
    <br>
    <p>Results from the Alchemy API service will made available at <code>msg.features</code>. Each feature result will be a separate child property.</p>
</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/javascript">
    RED.nodes.registerType('service-dialog', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""},
                mode: {value: "converse"},
				dialog: {value: ""},
				clientid: {value: ""},
				converse: {value: ""}
            },
            color: "rgb(99, 158, 230)",
            inputs: 1,
            outputs: 1,
            icon: "dialog-icon25x25.png",
            paletteLabel: "Dialog",
            label: function() {
                return this.name || "Dialog Node";
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },

            oneditprepare: function() {
				$('#node-input-mode').change(function () {
					var mode = $('#node-input-mode').val();
					if (mode == "list" || mode == "create") {
						$('.form-row.mode.dialog').hide();
                    } else if (mode == "delete") {
                        $('.form-row.mode.dialog').show();
                        $('.form-row.mode.converse').hide();
                    } else if (mode == "deleteall") {
                        $('.form-row.mode.dialog').hide();
                        $('.form-row.mode.converse').hide();
					} else if (mode == "startconverse") {
						$('.form-row.mode.dialog').show();
						$('.form-row.mode.converse').hide();
					} else {
						$('.form-row.mode.dialog').show();
					}
				})

                $.getJSON('service-dialog/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
</script>



<script type="text/x-red" data-template-name="service-dialog">
	<div class="form-row">
		<label for="node-input-name"> <i class="icon-tag"> </i> Name </label>
		<input type="text" id="node-input-name" placeholder="Name"/>
	</div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-question"></i> Mode</label>
        <select type="text" id="node-input-mode" style="display: inline-block; width: 70%;" >
            <option value="create">Create a new Dialog</option>
            <option value="list">List Available Dialogs</option>
            <option value="startconverse">Start Conversation</option>
            <option value="converse">Continue Conversation</option>
            <option value="getprofile">List Profile Variables</option>
            <option value="delete">Delete a Dialog</option>
            <option value="deleteall">Delete all Dialogs</option>
        </select>
    </div>
    <div class="form-row mode dialog">
        <label for="node-input-dialog"><i class="fa fa-tag"></i> Dialog ID</label>
        <input type="text" id="node-input-dialog" placeholder="Dialog ID">
    </div>
    <div class="form-row mode dialog converse">
        <label for="node-input-clientid"><i class="fa fa-tag"></i> Client ID</label>
        <input type="text" id="node-input-clientid" placeholder="clientid">
    </div>
    <div class="form-row mode dialog converse">
        <label for="node-input-converse"><i class="fa fa-tag"></i> Conversation ID</label>
        <input type="text" id="node-input-converse" placeholder="Conversation ID">
    </div>

</script>


<script type="text/x-red" data-help-name="service-dialog">
    <p><b>NB:</b> The Watson Dialog service hase been deprecated. Once the service
      has been switched off this node will no longer work. The node will be removed from the palette in a
      future release. </p>
    <br/>
    <p>The IBM Watson Dialog service enables a developer to automate branching conversations between a user and your application. The Dialog service enables your applications to use natural language to automatically respond to user questions, cross-sell and up-sell, walk users through processes or applications, or even hand-hold users through difficult tasks. (<a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/dialog.html">service documentation</a>)</p>

    <p>Use the drop-down menu in the node configuration window to select the required mode.</p>
    <p></p>
    <p><b>Create Mode :</b></p>
    <p>Creates a dialog template. A XML dialog file is required as input. If the dialog is created successfully the dialog id is returned.</p>
	<p>The file should be passed in on <code>msg.payload</code> and must be a valid Node.js Buffer.</p>
        <p>Example of input nodes for the create mode of the Dialog node:</b>.</p>
    <ul>
        <li>HTTP Request in binary mode</li>
        <li>Dropbox node</li>
        <li>Box node</li>
    </ul>
	<p>In addition, a unique name for the dialog template should be provided in input as</p>
    <pre><code>msg.dialog_params["dialog_name"]</code></pre>
    <p>The dialog id from the service will be returned on <code>msg.dialog</code>.</p>
    <p><b>Note</b> : the Watson Dialog API support 3 files types : encrypted .mct, .json or .xml. This node currently supports only .xml</p>
    <p></p>
    <p><b>List Mode :</b></p>
    <p>A list of the available dialogs is returned. For each a dialog id is given, this id is needed to
	start a conversation.</p>
    <p>The list from the service will be returned on <code>msg.dialog</code>.</p>
    <p></p>
    <p><b>Start Conversation Mode :</b></p>
    <p>The conversation is started and the introduction salutation from the dialog is returned.</p>
    <p>The Dialog Id can be passed either as a property or through a function</p>
	<pre><code>msg.payload="Hello !";
msg.dialog_params = {};
msg.dialog_params["dialog_id"] = "dialog id";
return msg;</code></pre>
	<p>In addition a client id and a converstion id are returned. These ids are needed to continue a conversation.</p>
    <p>The salutation from the service will be returned on <code>msg.dialog</code>.</p>
    <p></p>
    <p><b>Conversation Mode :</b></p>
    <p>The conversation is continued.</p>
    <p>The Client and Conversation IDs can be passed either as properties or through a function</p>
	<pre><code>msg.payload="what type of pizza do you have ?";
msg.dialog_params = {};
msg.dialog_params["client_id"] = "client id";
msg.dialog_params["converse_id"] = "conversation id";
return msg;</code></pre>
    <p>The response from the service will be returned on <code>msg.dialog</code>.</p>
    <p></p>
    <p><b>List Profile Variables :</b></p>
    <p>Retrieves the profile variables that the dialog has set during the conversation. These can be
	used to determine the state of the conversation, and by an applicaiton to perform any further actions.</p>
    <p>The Dialog, Client and Conversation IDs can be passed either as properties or through a function</p>
	<pre><code>msg.dialog_params = {};
msg.dialog_params["dialog_id"] = "dialog id";
msg.dialog_params["client_id"] = "client id";
msg.dialog_params["converse_id"] = "conversation id";
return msg;</code></pre>
    <p>The response from the service will be returned on <code>msg.dialog</code>.</p>
    <p></p>
    <p><b>Delete a Dialog :</b></p>
    <p>Delete all Dialogs and associated data (conversations, profiles variables). To be used with caution</p>
    <p>The Dialog ID can be passed either as properties or through a function</p>
    <pre><code>msg.dialog_params = {};
msg.dialog_params["dialog_id"] = "dialog id";
return msg;</code></pre>
    <p></p>
    <p><b>Delete a Dialog :</b></p>
    <p>Delete a Dialog and all associated data (conversations, profiles variables). </p>
    <p></p>
    <p><b>Delete All Dialogs</b>.</p>
    <p>Delete All Dialogs and all associated data (conversations, profiles variables). </p>
    <p><b>Notice</b>: the Delete All mode is to be used with caution</p>
    <p></p>

    <p>For more information about the Watson Dialog service,
	read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/dialog.html">documentation</a>.</p>

</script><!--
  Copyright 2013,2015,2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="alchemy-feature-extract">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-apikey"><i class="fa fa-key"></i> API Key</label>
        <input type="password" id="node-input-apikey" placeholder="API Key">
    </div>
    <div class="form-row">
        <label for="node-input-features" style="width: 100%"><i class="fa fa-book"></i> Extract the following features: </label>
          <div style="float: left;">
            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-page-image" />
              <label style="width: auto;" for="node-input-page-image">Page Images</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-image-kw" />
              <label style="width: auto;" for="node-input-image-kw">Image Keywords</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-feed" />
              <label style="width: auto;" for="node-input-feed">Feed</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-entity" />
              <label style="width: auto;" for="node-input-entity">Entities</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-keyword" />
              <label style="width: auto;" for="node-input-keyword">Keywords</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-entity-sentiment" />
              <label style="width: auto;" for="node-input-entity-sentiment">Entity and Keyword Sentiment</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-entity-emotion" />
              <label style="width: auto;" for="node-input-entity-emotion">Entity and Keyword Emotion</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-title" />
              <label style="width: auto;" for="node-input-title">Title</label>
            </div>

          </div>

          <div style="margin-left: -200px; float: right;">

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-author" />
              <label style="width: auto;" for="node-input-author">Authors</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-taxonomy" />
              <label style="width: auto;" for="node-input-taxonomy">Taxonomy</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-concept" />
              <label style="width: auto;" for="node-input-concept">Concepts</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-relation" />
              <label style="width: auto;" for="node-input-relation">Relations</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-pub-date" />
              <label style="width: auto;" for="node-input-pub-date">Publication Date</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-doc-sentiment" />
              <label style="width: auto;" for="node-input-doc-sentiment">Document Sentiment</label>
            </div>

            <div>
              <input style="width: 30px; margin-left: 20px; margin-top: 0;"
                     type="checkbox" id="node-input-doc-emotion" />
              <label style="width: auto;" for="node-input-doc-emotion">Document Emotion</label>
            </div>

          </div>
        </div>
    <div class="form-row" style="padding-top: 10px;">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('alchemy-feature-extract', {
            category: 'IBM Watson',
            defaults: {
              name: {value: ""},
              "page-image": {value: ""},
              "image-kw": {value: ""},
              feed: {value: ""},
              entity: {value: ""},
              keyword: {value: ""},
              title: {value: ""},
              author: {value: ""},
              taxonomy: {value: ""},
              concept: {value: ""},
              relation: {value: ""},
              "pub-date": {value: ""},
              "doc-sentiment": {value: ""},
              "doc-emotion": {value: ""},
              "entity-sentiment": {value: ""},
              "entity-emotion": {value: ""}
            },
            credentials: {
              apikey: {type:"password"}
            },
            color: '#00A2FF',
            inputs: 1,
            outputs: 1,
            icon: "alchemy.png",
            paletteLabel: "Feature Extract",
            label: function() {
                return this.name || "Feature Extract";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
              $.getJSON('alchemy-feature-extract/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  })
                  .always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="alchemy-feature-extract">
    <p>Using the Feature Extract node, you can use the Alchemy APIs to analyse external URLs, HTML files or text content.</p>
    <p>The following features are available for analysis:</p>
    <ul>
        <li><b>Page Images</b>, extract available page images.</li>
        <li><b>Image Keywords</b>, discover image content keywords.</li>
        <li><b>Feed</b>, extract RSS/ATOM feed links.</li>
        <li><b>Entities</b>, identify people, companies, organizations, cities, geographic features, and other typed entities.</li>
        <li><b>Title</b>, find content title.</li>
        <li><b>Authors</b>, extract content authors.</li>
        <li><b>Keywords</b>, discover topic keywords for content.</li>
        <li><b>Taxonomy</b>, categorize content against known taxonomies.</li>
        <li><b>Concepts</b>, tag content with related concepts.</li>
        <li><b>Relations</b>, identify Subject-Action-Object relations.</li>
        <li><b>Publication Date</b>, extract available publication date.</li>
        <li><b>Document Sentiment</b>, generate sentiment scores.</li>
        <li><b>Document Emotion</b>, generate emotion scores.</li>
        <li><b>Entity Sentiment</b>, generate entity sentiment scores.</li>
        <li><b>Entity Emotion</b>, generate entity emotion scores.</li>
    </ul>
    <p>For full details on the feature details, please see the <a href="http://www.alchemyapi.com/api">Alchemy API documentation</a></p>
    <p>The content to be analysed should be passed in on <code>msg.payload</code>.</p>
    <p>Valid <code>msg.payload</code> types: URL, HTML or Text Content.</p>
    <p>If you need to send custom parameters along with each feature, set those parameters as children of the <code>msg.alchemy_options</code> object. eg. to limit the output to 3 values per feature set
      <code>msg.alchemy_options = {maxRetrieve: 3};</code>
    </p>
    <br>
    <p>Results from the Alchemy API service will made available at <code>msg.features</code>. Each feature result will be a separate child property.</p>
</script><!--
  Copyright 2013,2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-translator">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div id="credentials-not-found" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Could not bind to service. </b> This node can not be further configured without a valid service. Try entering valid credentials?
        </div>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name"/>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username"/>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password"/>
    </div>

    <div class="form-row">
        <label for="node-input-action"><i class="fa fa-cog"></i> Mode</label>
        <select type="text" id="node-input-action" style="display: inline-block; vertical-align:middle; width: 70%;">
            <option value="translate">Translate</option>
            <option value="custom">Customised Translate</option>
            <option value="train">Train</option>
            <option value="getstatus">Get status</option>
            <option value="delete">Delete</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-domain"><i class="fa fa-book"></i> Domains</label>
        <select type="text" id="node-input-domain" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>

    <div>
        <input type="hidden" id="node-input-domainhidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-custom"><i class="fa fa-book"></i> Customised Model</label>
        <select type="text" id="node-input-custom" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>

    <div>
        <input type="hidden" id="node-input-customhidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-srclang"><i class="fa fa-comments-o"></i> Source</label>
        <select type="text" id="node-input-srclang" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>
    <div>
        <input type="hidden" id="node-input-srclanghidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-destlang"><i class="fa fa-comments-o"></i> Target</label>
        <select type="text" id="node-input-destlang" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>
    <div>
        <input type="hidden" id="node-input-destlanghidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-basemodel"><i class="fa fa-book"></i> Base model</label>
        <select type="text" id="node-input-basemodel" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>
    <div>
        <input type="hidden" id="node-input-basemodelhidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-filetype"><i class="fa fa-book"></i> File type</label>
        <select type="text" id="node-input-filetype" style="display: inline-block; vertical-align:middle; width: 70%;">
            <option value="forcedglossary" selected="selected">Forced glossary</option>
            <option value="parallelcorpus">Parallel corpus</option>
            <option value="monolingualcorpus">Monolingual corpus</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-trainid"><i class="fa fa-tag"></i> Model ID</label>
        <input type="text" id="node-input-trainid" placeholder="Model ID">
    </div>

  <div class="form-row">
       <label for="node-input-lgparams2"><i class="fa fa-cog"></i> Parameters Scope</label>
       <input type="checkbox" id="node-input-lgparams2" style="display: inline-block; width: auto; vertical-align: top;">
       <label for="node-input-lgparams2" style="width: 70%;"> Use Local Parameters</label>
    </div>
    <div>
       <input type="hidden" id="node-input-ldparamshidden2"/>
    </div>

    <div class="form-tips" id="languagetranslation-form-tips">
      <strong>Note:</strong> When using with the language translation utility, 'Use Local Parameters' must be unchecked.<br>
    </div>

</script>



<script type="text/javascript">
  // Need to simulate a namespace, so that some of the variables don't leak across nodes
  function Translator () {
  }

  // This is the namespace for tts.
  var tor = new Translator();

  tor.models = null;
  tor.domains = null;
  tor.basemodels = null;
  tor.custommodels = null;
  tor.domain_type;
  tor.have_credentials = false;
  tor.using_local_credentials = false;
  tor.using_local_parameters2 = false;
  tor.using_gloabal_parameters2 = false;

  tor.action = $('#node-input-action').val();
  tor.domain_selected = $('#node-input-domainhidden').val();
  tor.custom_selected = $('#node-input-customhidden').val();
  tor.srclang_selected = $('#node-input-srclanghidden').val();
  tor.destlang_selected = $('#node-input-destlanghidden').val();
  tor.base_model_selected = $('#node-input-basemodelhidden').val();
  tor.lg_parameters_selected2 = $('#node-input-ldparamshidden2').val();


  tor.LANGUAGES = { 'ar' : 'Arabic',
                    'arz': 'Spoken Arabic',
                    'en': 'English' ,
                    'es': 'Spanish',
                    'fr': 'French',
                    'it': 'Italian',
                    'de': 'German',
                    'pt': 'Portuguese',
                    'ko': 'Korean',
                    'zh': 'Chinese'
                  };

  // convert an id in the form it-ko into Italian - Korean for display
  tor.changeIdToText = function (id) {
    var txt = "";
    var langs = id.split('-');
    var first = true;

    langs.forEach(function(language){
      txt += (tor.LANGUAGES[language] ? tor.LANGUAGES[language] : language);
      if (first) {
        txt += ' - ';
        first = false;
      }
    })
    return txt;
  }

  // Function to be used at the start, as don't want to expose any fields, unless the model is
  // available. The model it self can only be fetched if the credentials are available.
  tor.hideAll = function () {
    if (!tor.models) {
        $('#credentials-not-found').show();
        $('#node-input-action').parent().hide();
        $('select#node-input-srclang, select#node-input-destlang').parent().hide();
        $('select#node-input-domain').parent().hide();
        $('select#node-input-custom').parent().hide();
        $('select#node-input-basemodel').parent().hide();
        $('select#node-input-filetype').parent().hide();
        $('input#node-input-trainid').parent().hide();
        $('input#node-input-lgparams2').parent().hide();
        $('#languagetranslation-form-tips').show();
    }
  }

  // If we have models, then certain fields can be shown.
  // this is invoked in the process tha obtains the models, which may be
  // after the dialog is shown.
  // ie. all the fields are initially hidden, but once the credentials are valid and
  // the model has been retrieved then this function is invoked to update what fields
  // are shown without the user having to close the dialog.
  // Problem is that the onchange is only invoked when the user tabs to another field.
  tor.checkVisibility = function () {
    if (tor.models) {
      $('#node-input-action').parent().show();
      tor.checkActionSelected();
    }
  }

  // sorting functions
  tor.checkUnique = function (value, index, self) {
    return self.indexOf(value) === index;
  }


  // Retrieve the available models from the server, if data is returned, then
  // can enable the dynamic selection fields.
  tor.checkModels = function () {
    var u = $('#node-input-username').val();
    var p = $('#node-input-password').val();

    $.getJSON('watson-translator/models/', {un: u, pwd: p}).done(function (data) {
      if (data.models) {
        tor.models = data.models;
        tor.have_credentials = true;
        tor.checkVisibility();
      }
    }).fail(function (err) {
      console.log(err);
    }).always(function () {});
  }

  // Simple check that is only invoked if the service is not bound into bluemix. In this case the
  // user has to provide credentials. Once there are credentials, then the models are retrieved.
  tor.getCredentials = function () {
    var u = $('#node-input-username').val();
    var p = $('#node-input-password').val();

    if (u && u.length && p) {
      if (!tor.models) {
        tor.checkModels();
        if (tor.models) {$('#node-input-action').parent().show(); }
      }
    } else if (!tor.models) {
      $('#node-input-action').parent().hide();
    }
  }

  // function that is called when the domain or the source language is changed. In this case the
  // destination language selection field is dynamically repopulated, and reselected if the
  // previously selection is still in the new list.
  tor.langDestAvailable = function () {
    if (!tor.domain_type) { return; }

    var pair_lang = tor.domain_type.map(function (a) {
      return a.model_id;
    });

    // need to do an exact source language match to allow for variations
    // like ar and arz. if the input is ar, then don't want it to match with arz
    var available_destlang = pair_lang.filter(function (model_id) {
      return model_id.match('^' + tor.srclang_selected + '-');
    });

    // Flush out the list first
    $('select#node-input-destlang').empty();

    available_destlang.forEach(function (val) {
      var lang = val.split('-')[1];

      var selectedText = '';
      if (tor.destlang_selected === lang) {
        selectedText = 'selected="selected"';
      }
      $('select#node-input-destlang')
        .append('<option value='
                      + '"' + lang + '"'
                      + selectedText
                      + '>'
                      + (tor.LANGUAGES[lang] ? tor.LANGUAGES[lang] : lang)
                      + '</option>');
    });
    tor.destlang_selected = $('#node-input-destlang').val();
  }

  // Populates the domains selection field.
  // If domains have already been retrieved then no need to refetch them.
  tor.checkDomains = function () {
    if (!tor.domains) {
      tor.domains = tor.models.map(function (a) {
        return a.domain;
      });
    }
    if (tor.domains && tor.domains.length) {
      $('select#node-input-domain').empty();
      var unique_domains = tor.domains.filter(tor.checkUnique);

      unique_domains.forEach(function(domain) {
        var selectedText = '';
        if (tor.domain_selected === domain) {
          selectedText = 'selected="selected"';
        }
        $('select#node-input-domain')
          .append('<option value='
                        + '"' + domain + '"'
                        + selectedText
                        + '>'
                        + domain.charAt(0).toUpperCase()
                        + domain.slice(1)
                        + '</option>');
      });

    tor.checkDomainSelected();
    }
  }

  // Populates the base model field. These are the models that are available to be customised.
  tor.checkBaseModels = function () {
    if (!tor.basemodels && tor.models) {
      tor.basemodels = tor.models.filter(function (model) {
        return model.customizable === true;
      });
    }
    if (tor.basemodels) {
      $('select#node-input-basemodel').empty();
      tor.basemodels.forEach(function(base_model){
        var selectedText = '';
        if (tor.base_model_selected === base_model.model_id) {
            selectedText = 'selected="selected"';
        }
        $('select#node-input-basemodel')
            .append('<option value='
                          + '"' + base_model.model_id + '"'
                          + selectedText
                          + '>'
                          + tor.changeIdToText(base_model.model_id)
                          + '</option>');
      });
    }
  }

  // Populates the customised models field. These are the models that have been
  // customised. This control needs to be refreshed. Currently the only that that
  // will happen is by a page refresh. Need to have a trigger everytime the create
  // new model is triggerd, but that is a little complicated and needs to be done on
  // a clear mind.
  tor.checkCustomsAvailable = function () {
    if (!tor.custommodels && tor.models) {
      tor.custommodels = tor.models.filter(function (m) {
        return (m.base_model_id && ('' != m.base_model_id));
      });
    }
    if (tor.custommodels) {
      $('select#node-input-custom').empty();

      tor.custommodels.forEach(function(m){
        var selectedText = '';
        if (tor.custom_selected === m.model_id) {
            selectedText = 'selected="selected"';
        }
        $('select#node-input-custom')
            .append('<option value='
                        + '"' + m.model_id + '"'
                        + selectedText
                        + '>'
                        + m.model_id
                        + ' (' + m.domain + ' ' + m.base_model_id + ' ' + m.name + ')'
                        + '</option>');

      });
    }
  }


  // UI Handler for the Mode / switch.
  // Princliple function is to show / hide the appropriate fields.
  tor.checkActionSelected = function () {
    tor.action = $('#node-input-action').val();
    if (tor.models) {
      $('#credentials-not-found').hide();
      switch (tor.action) {
        case 'translate':
          $('select#node-input-srclang, select#node-input-destlang').parent().show();
          $('select#node-input-domain').parent().show();
          $('select#node-input-custom').parent().hide();
          $('select#node-input-basemodel, select#node-input-filetype').parent('').hide();
          $('input#node-input-trainid').parent('').hide();
          $('input#node-input-lgparams2').parent().show();
          $('#languagetranslation-form-tips').show();
          break;
        case 'custom':
          $('select#node-input-custom').parent().show();
          $('select#node-input-srclang, select#node-input-destlang').parent().hide();
          $('select#node-input-domain').parent().hide();
          $('select#node-input-basemodel, select#node-input-filetype').parent('').hide();
          $('input#node-input-trainid').parent('').hide();
          $('input#node-input-lgparams2').parent().show();
          $('#languagetranslation-form-tips').show();
          break;
        case 'train':
          $('select#node-input-custom').parent().hide();
          $('select#node-input-srclang, select#node-input-destlang').parent().hide();
          $('select#node-input-domain').parent().hide();
          $('select#node-input-basemodel, select#node-input-filetype').parent('').show();
          $('input#node-input-trainid').parent('').hide();
          $('input#node-input-lgparams2').parent().show();
          $('#languagetranslation-form-tips').show();
          break;
        case 'getstatus':
        case 'delete':
          $('select#node-input-custom').parent().hide();
          $('input#node-input-trainid').parent('').show();
          $('select#node-input-srclang, select#node-input-destlang').parent().hide();
          $('select#node-input-domain').parent().hide();
          $('select#node-input-basemodel, select#node-input-filetype').parent('').hide();
          $('input#node-input-lgparams2').parent().show();
          $('#languagetranslation-form-tips').show();
          break;
      }
      tor.checkDomains();
      tor.checkBaseModels();
      tor.checkCustomsAvailable();
    } else {
      $('#credentials-not-found').show();
    }
  }

  // UI Handler for the Parameter scope switch: Local or Global
//  tor.checkParamScopeSelected = function (){
//    // Checkbox control
//    tor.lg_parameters_selected2 = $('input#node-input-lgparams2').prop('checked');
//    if (checked) {
//      tor.using_gloabal_parameters2 = true;
//      tor.using_local_parameters2 = false;
//    } else {
//      tor.using_gloabal_parameters2 = false;
//      tor.using_local_parameters2 = true;
//    }
//  }


  // UI Handler for the domain switch
  // Repopulate the source and languages based on the available translations for the domain
  tor.checkDomainSelected = function (){
    $('#node-input-srclang').empty();
    $('#node-input-destlang').empty();
    if (tor.models && tor.domains) {
      tor.domain_selected = $('#node-input-domain').val();
      tor.domain_type = tor.models.filter(function (model) {
        return model.domain === tor.domain_selected && model.status === 'available';
      });
      var input_lang = tor.domain_type.map(function (a) {
        return a.source;
      });
      var output_lang = tor.domain_type.map(function (a) {
        return a.target;
      });
      input_lang_unique = input_lang.filter(tor.checkUnique);
      output_lang_unique = output_lang.filter(tor.checkUnique);

      // Flush out the List before repopulating it.
      $('select#node-input-srclang').empty();

      input_lang_unique.forEach(function(lang){
        var selectedText = '';
        if (tor.srclang_selected === lang) {
          selectedText = 'selected="selected"';
        }
        $('select#node-input-srclang')
          .append('<option value='
                        + '"' + lang + '"'
                        + selectedText
                        + '>'
                        + (tor.LANGUAGES[lang] ? tor.LANGUAGES[lang] : lang)
                        + '</option>');
      });
      // Having repopulated the input language selection, the old selected item
      // may no longer be in the list, so refresh it.
      tor.srclang_selected = $('#node-input-srclang').val();
      tor.langDestAvailable();
    }
  }


  // Register the handlers for the fields
  tor.UIListeners = function () {
    $('#node-input-username').change(function(val){
      tor.getCredentials();
      if (tor.have_credentials) {
        tor.checkActionSelected();}
    });
    $('#node-input-password').change(function(val){
      tor.getCredentials();
      if (tor.have_credentials) {
        tor.checkActionSelected();
      }
    });

    $('#node-input-action').change(function(val){
      tor.action = $('#node-input-action').val();
      tor.checkActionSelected();
    });

    $('#node-input-domain').change(function (val) {
      tor.domain_selected = $('#node-input-domain').val();
      tor.checkDomainSelected();
    });

    $('#node-input-custom').change(function () {
      tor.custom_selected = $('#node-input-custom').val();
    });

    $('#node-input-srclang').change(function () {
      tor.srclang_selected = $('#node-input-srclang').val();
      tor.langDestAvailable();
    });

    $('#node-input-destlang').change(function () {
      tor.destlang_selected = $('#node-input-destlang').val();
    });

    $('#node-input-basemodel').change(function (val) {
      tor.base_model_selected = $('#node-input-basemodel').val();
    });

    $('#node-input-lgparams2').change(function (val) {
      lg_parameters_selected = $('#node-input-lgparams2').val();
    });

  }

  // The dynamic nature of the selection fields in this node has caused problems.
  // Whenever there is a fetch for the models, on a page refresh or applicaiton
  // restart, the settings for the dynamic fields are lost.
  // So hidden (text) fields are being used to squirrel away the values, so that
  // they can be restored.
  tor.restoreHidden = function () {
    tor.domain_selected = $('#node-input-domainhidden').val();
    $('select#node-input-domain').val(tor.domain_selected);
    tor.srclang_selected = $('#node-input-srclanghidden').val();
    $('select#node-input-srslang').val(tor.srclang_selected);
    tor.destlang_selected = $('#node-input-destlanghidden').val();
    $('select#node-input-destlang').val(tor.destlang_selected);

    tor.base_model_selected = $('#node-input-basemodelhidden').val();
    $('select#node-input-basemodel').val(tor.base_model_selected);
    tor.custom_selected = $('#node-input-customhidden').val();
    $('select#node-input-custom').val(tor.custom_selected);


    tor.lg_parameters_selected2 = $('input#node-input-lgparams2').prop('checked');

  }

  // This is the on edit prepare function, which will be invoked everytime the dialog is shown.
  function oneditprepare() {
    tor.hideAll();
    tor.restoreHidden();

    tor.UIListeners();
    // Look for VCAP Json file, done is called if found or not, with service indicating
    // if the translation service is actually bound into this application.
    if (!tor.have_credentials) {
      $.getJSON('watson-translator/vcap/')
        .done(function (service) {
          // for some reason the getJSON resets the vars so need to restoreHidden again
          // so again.
          tor.restoreHidden();
          $('.credentials').toggle(!service);
          if (!service) {
            // no bound service, so check local settings to see if they are valid
            tor.using_local_credentials = true;
            tor.getCredentials();
          } else {
            // credentials are only valid if we can get hold of the models using them
            tor.using_local_credentials = false;
            if (!tor.models) {tor.checkModels();}
          }
        }).fail(function () {
          $('.credentials').show();
        }).always(function () {
          $('#credentials-check').hide();
        });
    }
    // credentials can be set during the oneditprepare process, so check again.
    if (tor.have_credentials || tor.using_local_credentials)
    {
      $('#credentials-check').hide();
      if (tor.have_credentials) {
        $('#credentials-not-found').hide();
      }
      if (tor.using_local_credentials) {
        $('.credentials').show();
      }
      tor.checkActionSelected();
    }
  }

  // Save the values in the dyanmic lists to the hidden fields.
  function oneditsave(){
    $('#node-input-domainhidden').val(tor.domain_selected);
    $('#node-input-srclanghidden').val(tor.srclang_selected);
    $('#node-input-destlanghidden').val(tor.destlang_selected);
    $('#node-input-basemodelhidden').val(tor.base_model_selected);
    $('#node-input-customhidden').val(tor.custom_selected);
    $('#node-input-ldparamshidden2').val(tor.lg_parameters_selected2);
  }

  // Define and run the function to register this node.
  (function() {
        RED.nodes.registerType('watson-translator', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                action: {value: 'translate'},
                basemodel: {value: ''},
                domain: {value: 'news'},
                srclang: {value: 'en'},
                destlang: {value: 'fr'},
                password: {value: ''},
                custom: {value: ''},
                domainhidden: {value: ''},
                srclanghidden: {value: ''},
                destlanghidden: {value: ''},
                basemodelhidden: {value: ''},
                customhidden: {value: ''},
                filetype: {value: 'forcedglossary'},
                trainid: {value: ''},
                lgparams2: {value: 'lparams'},
                ldparamshidden2: {value: ''}
            },
            credentials: {
              username: {type: 'text'}
              // password: {type: 'text'} << moved to keep track of previous data
            },
            color: "rgb(84,149,230)",
            inputs: 1,
            outputs: 1,
            icon: "LanguageTranslator25x25.png",
            paletteLabel: "language translator",
            label: function() {
                return this.name || "language translator";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: oneditprepare,
            oneditsave: oneditsave
        });
  })();

</script>
<script type="text/x-red" data-help-name="watson-translator">
    <p>The Watson Language Translator service enables you to translate text from one language to another and to add your own translation models.</p>
    <p></p>
    <p><b>Translation Mode</b>.</p>
    <p>The text to translate should be passed in on <code>msg.payload</code>.</p>
    <p>The translated text will be returned on <code>msg.payload</code>.</p>
    <p>The full response from the service will be returned on <code>msg.translation</code></p>
    <p>Source and destination language parameters can be configured through the editor panel or set dynamically using
    the language codes in the following properties, <code>msg.srclang</code> and <code>msg.destlang</code>. Please see
    the documentation linked below for the currently supported source and destination language codes.</p>
    <p></p>
    <p><b>Customised Translation Mode</b>.</p>
    <p>In this mode you can select a translation model that you have customised through
    the training options.</p>
    <p>The text to translate should be passed in on <code>msg.payload</code>.</p>
    <p>The translated text will be returned on <code>msg.payload</code>.</p>
    <p>The full response from the service will be returned on <code>msg.translation</code></p>
    <p></p>
    <p><b>Training Mode</b>.</p>
    <p>This mode enables you to add your own customized model to the Watson Language Translator service. </p>
    <p>In <code>msg.payload</code>, (this can be through box, dropbox or a file-inject node.
       you must specify one of the following file options to customize the training:</p>
    <p>forced_glossary - A UTF-8 encoded TMX file that contains pairs of matching terms in the source and target language that are seen as absolute by the system. This file completely overwrites the original domain data.</p>
    <p>parallel_corpus - A UTF-8 encoded TMX file that contains matching phrases in the source and target language that serve as examples for Watson. Parallel corpora differ from glossaries because they do not overwrite the original domain data.</p>
    <p>monolingual_corpus - A UTF-8 encoded plain text file that contains a body of text in the target language that is related to what you are translating. A monolingual corpus helps improve literal translations to be more fluent and human.</p>
    <p>The Language Translator Node will return the ID of the created customized model.</p>
    <p<b>Note:</b>As the input file is expected on msg.payload, only one file can be specified. This is
    an enforced restriction by this Node. The service API allows more than one file to be specified.</p>
    <p></p>
    <p><b>Get Status Mode</b>.</p>
    <p>This mode allows you to get the status of a model sent to training by providing its ID.</p>
    <p>Values can be the followings:</p>
    <p>training - Training is still in progress.</p>
    <p>queued@<#> - Training has not yet started and the model is in the queue. The # indicates the number of your model in the queue.</p>
    <p>error - Training did not complete because of an error. if you want to see the reason behind the error
    this will be returned in <code>msg.translation</code></p>
    <p>available - Training is completed, and the service is now available to use with your custom translation model.</p>
    <p><b>Delete Mode</b>.</p>
    <p></p>
    <p>This mode allows you to delete a model by providing its ID</p>
    <p><b>Parameters Scope</b>.</p>
    <p>This parameter makes the language translation node to toogle using incoming parameters form the dashboard Dropdown list or locally.</p>
    <p>Values can be the followings:</p>
    <p><b>Local</b>  -  Local parametres if the node is used by its own (default value).</p>
    <p><b>Global</b> -  Global parametres if the node is used with the 'language translator util' and 'dropdown' node.
    Global parameters are set when <b>local in unchecked</b>.</p>
    <p>For more information about the Language Translator service, read the <a href="https://www.ibm.com/watson/developercloud/doc/language-translator">documentation</a>.</p>
</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-language-translator-identify">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-language-translator-identify', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ""}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(84,149,230)",
            inputs: 1,
            outputs: 1,
            icon: "LanguageTranslator25x25.png",
            paletteLabel: "language identify",
            label: function() {
                return this.name || "language identify";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-language-translator-identify/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-language-translator-identify">
    <p>Packaged in with release 0.4.35 of node-red-node-watson</p>
    <p>The Watson Language Translator service can be used to identify languages used in a text input. <p>
    <p>Node input : </p>
    <ul>
    <li><code>msg.payload</code> : The input text to identify language against in UTF-8 format</li>
    </ul>
    <p>Node output : </p>
    <ul>
    <li><code>msg.lang</code> : The identified language with the highest confidence level</li>
    <li><code>msg.languages</code> : array of identified languages with the language 5-letter ISO language code
    with the associated confidence score</li>
    </ul>
    <p>For more information about the Language Identification service,
    read the service <a href="https://www.ibm.com/watson/developercloud/doc/language-translator/">documentation</a>.</p>
</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-translator-util">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name (LTU)</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
</script>




<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-translator-util', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ""}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(84,149,230)",
            inputs: 1,
            outputs: 1,
            icon: "languageid.png",
            paletteLabel: "language translator util",
            label: function() {
                return this.name || "language translator util";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-translator-util/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-translator-util">
    <p>The Language Translator Utility service enables you to set using dasboard utility functions
    the language translation to be used by the Language Translator Node.</p>
    <p></p>
    <p><b>Translator Mode Utility</b>.</p>
    <p>The regular Watson Translator credentials should be set through the UI.</p>
    <p>No input is needed for the node. The node fetches the information automatically.</p>
    <p></p>
    <p>When this node is used with the 'language translator' node, in the 'language translator' node the scope of variables should be set to global.</p>
    <p></p>
    <p>The node will return the following arrays:</p>
    <p>Message model_id (e.g.: en-fr-conversational)<code>msg.model_id</code>.</p>
    <p>Message Domains (e.g.: Conversational)<code>msg.domain</code>.</p>
    <p>Message Source Language (e.g.: English)<code>msg.source</code>.</p>
    <p>Message Target Language (e.g.: French)<code>msg.target</code>.</p>
    <p>For more information about the Language Translator service, read the <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/language-translation.html">documentation</a>.</p>
</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-language-identification">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-language-identification', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(140, 198, 63)",
            inputs: 1,
            outputs: 1,
            icon: "languageid.png",
            paletteLabel: "language identification",
            label: function() {
                return this.name || "language identification";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-language-identification/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-language-identification">
    <p><b>NB:</b> The Watson Language Translation service has been deprecated in favor of the new Watson Translator service. Once the service
      has been switched off this node will no longer work. The node will be removed from the palette in a
      future release. </p>
    <br/>
    <p>The Language Identification service analyzes UTF-8 encoded text, detects the language used in that text, and displays the associated 5-letter ISO language code. </p>
    <p>The text to detect should be passed in on <code>msg.payload</code>.</p>
    <p>The ISO language code will be returned on <code>msg.lang</code>.</p>
    <p>For more information about the Language Identification service,
    read the <a href="https://www.ibm.com/watson/developercloud/language-translation.html">documentation</a>.</p>
</script><!--
  Copyright 2013,2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-translate">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div id="credentials-not-found" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Could not bind to service. </b> This node can not be further configured without a valid service. Try entering valid credentials?
        </div>
    </div>
    <div id="id-error-getting-models" class="form-row">
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name"/>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username"/>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password"/>
    </div>

    <div class="form-row">
        <label for="node-input-action"><i class="fa fa-cog"></i> Mode</label>
        <select type="text" id="node-input-action" style="display: inline-block; vertical-align:middle; width: 70%;">
            <option value="translate">Translate</option>
            <option value="custom">Customised Translate</option>
            <option value="train">Train</option>
            <option value="getstatus">Get status</option>
            <option value="delete">Delete</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-domain"><i class="fa fa-book"></i> Domains</label>
        <select type="text" id="node-input-domain" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>

    <div>
        <input type="hidden" id="node-input-domainhidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-custom"><i class="fa fa-book"></i> Customised Model</label>
        <select type="text" id="node-input-custom" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>

    <div>
        <input type="hidden" id="node-input-customhidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-srclang"><i class="fa fa-comments-o"></i> Source</label>
        <select type="text" id="node-input-srclang" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>
    <div>
        <input type="hidden" id="node-input-srclanghidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-destlang"><i class="fa fa-comments-o"></i> Target</label>
        <select type="text" id="node-input-destlang" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>
    <div>
        <input type="hidden" id="node-input-destlanghidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-basemodel"><i class="fa fa-book"></i> Base model</label>
        <select type="text" id="node-input-basemodel" style="display: inline-block; vertical-align:middle; width: 70%;">
        </select>
    </div>
    <div>
        <input type="hidden" id="node-input-basemodelhidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-filetype"><i class="fa fa-book"></i> File type</label>
        <select type="text" id="node-input-filetype" style="display: inline-block; vertical-align:middle; width: 70%;">
            <option value="forcedglossary" selected="selected">Forced glossary</option>
            <option value="parallelcorpus">Parallel corpus</option>
            <option value="monolingualcorpus">Monolingual corpus</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-trainid"><i class="fa fa-tag"></i> Model ID</label>
        <input type="text" id="node-input-trainid" placeholder="Model ID">
    </div>

    <div class="form-row">
       <label for="node-input-lgparams2"><i class="fa fa-cog"></i> Parameters Scope</label>
       <input type="checkbox" id="node-input-lgparams2" style="display: inline-block; width: auto; vertical-align: top;">
       <label for="node-input-lgparams2" style="width: 70%;"> Use Local Parameters</label>
    </div>
    <div>
       <input type="hidden" id="node-input-ldparamshidden2"/>
    </div>

    <div class="form-tips" id="languagetranslation-form-tips">
      <strong>Note:</strong> When using with the language translation utility, 'Use Local Parameters' must be unchecked.<br>
    </div>

</script>



<script type="text/javascript">
  // Need to simulate a namespace, so that some of the variables don't leak across nodes
  function Translation () {
  }

  // This is the namespace for tts.
  var txn = new Translation();

  txn.models = null;
  txn.domains = null;
  txn.basemodels = null;
  txn.custommodels = null;
  txn.domain_type;
  txn.have_credentials = false;
  txn.using_local_credentials = false;
  txn.using_local_parameters2 = false;
  txn.using_global_parameters2 = false;

  txn.action = $('#node-input-action').val();
  txn.domain_selected = $('#node-input-domainhidden').val();
  txn.custom_selected = $('#node-input-customhidden').val();
  txn.srclang_selected = $('#node-input-srclanghidden').val();
  txn.destlang_selected = $('#node-input-destlanghidden').val();
  txn.base_model_selected = $('#node-input-basemodelhidden').val();
  txn.lg_parameters_selected2 = $('#node-input-ldparamshidden2').val();


  txn.LANGUAGES = { 'ar' : 'Arabic',
                    'arz': 'Spoken Arabic',
                    'en': 'English' ,
                    'es': 'Spanish',
                    'fr': 'French',
                    'it': 'Italian',
                    'de': 'German',
                    'pt': 'Portuguese',
                    'ko': 'Korean',
                    'zh': 'Chinese'
                  };

  // convert an id in the form it-ko into Italian - Korean for display
  txn.changeIdToText = function (id) {
    var txt = "";
    var langs = id.split('-');
    var first = true;

    langs.forEach(function(language){
      txt += (txn.LANGUAGES[language] ? txn.LANGUAGES[language] : language);
      if (first) {
        txt += ' - ';
        first = false;
      }
    })
    return txt;
  }

  // Function to be used at the start, as don't want to expose any fields, unless the model is
  // available. The model it self can only be fetched if the credentials are available.
  txn.hideAll = function () {
    $('#id-error-getting-models').hide();
    if (!txn.models) {
        $('#credentials-not-found').show();
        $('#node-input-action').parent().hide();
        $('select#node-input-srclang, select#node-input-destlang').parent().hide();
        $('select#node-input-domain').parent().hide();
        $('select#node-input-custom').parent().hide();
        $('select#node-input-basemodel').parent().hide();
        $('select#node-input-filetype').parent().hide();
        $('input#node-input-trainid').parent().hide();
        $('input#node-input-lgparams2').parent().hide();
        $('#languagetranslation-form-tips').show();
    }
  }

  // If we have models, then certain fields can be shown.
  // this is invoked in the process tha obtains the models, which may be
  // after the dialog is shown.
  // ie. all the fields are initially hidden, but once the credentials are valid and
  // the model has been retrieved then this function is invoked to update what fields
  // are shown without the user having to close the dialog.
  // Problem is that the onchange is only invoked when the user tabs to another field.
  txn.checkVisibility = function () {
    if (txn.models) {
      $('#node-input-action').parent().show();
      txn.checkActionSelected();
    }
  }

  // sorting functions
  txn.checkUnique = function (value, index, self) {
    return self.indexOf(value) === index;
  }


  // Retrieve the available models from the server, if data is returned, then
  // can enable the dynamic selection fields.
  txn.checkModels = function () {
    var u = $('#node-input-username').val();
    var p = $('#node-input-password').val();

    $.getJSON('watson-translate/models/', {un: u, pwd: p}).done(function (data) {
      if (data.models) {
        $('#id-error-getting-models').hide();
        txn.models = data.models;
        txn.have_credentials = true;
        txn.checkVisibility();
      } else if (data.error){
        $('#id-error-getting-models').show();
        $('#id-error-getting-models').text(data.error);
      }
    }).fail(function (err) {
      console.log(err);
    }).always(function () {});
  }

  // Simple check that is only invoked if the service is not bound into bluemix. In this case the
  // user has to provide credentials. Once there are credentials, then the models are retrieved.
  txn.getCredentials = function () {
    var u = $('#node-input-username').val();
    var p = $('#node-input-password').val();

    if (u && u.length && p) {
      if (!txn.models) {
        txn.checkModels();
        if (txn.models) {$('#node-input-action').parent().show(); }
      }
    } else if (!txn.models) {
      $('#node-input-action').parent().hide();
    }
  }

  // function that is called when the domain or the source language is changed. In this case the
  // destination language selection field is dynamically repopulated, and reselected if the
  // previously selection is still in the new list.
  txn.langDestAvailable = function() {
    if (!txn.domain_type) { return; }

    var pair_lang = txn.domain_type.map(function (a) {
      return a.model_id;
    });

    // need to do an exact source language match to allow for variations
    // like ar and arz. if the input is ar, then don't want it to match with arz
    var available_destlang = pair_lang.filter(function (model_id) {
      return model_id.match('^' + txn.srclang_selected + '-');
    });

    available_destlang.forEach(function (val) {
      var lang = val.split('-')[1];

      var selectedText = '';
      if (txn.destlang_selected === lang) {
        selectedText = 'selected="selected"';
      }
      $('select#node-input-destlang')
        .append('<option value='
                      + '"' + lang + '"'
                      + selectedText
                      + '>'
                      + (txn.LANGUAGES[lang] ? txn.LANGUAGES[lang] : lang)
                      + '</option>');
    });
    txn.destlang_selected = $('#node-input-destlang').val();
  }

  // Populates the domains selection field.
  // If domains have already been retrieved then no need to refetch them.
  txn.checkDomains = function () {
    if (!txn.domains) {
      txn.domains = txn.models.map(function (a) {
        return a.domain;
      });
    }
    if (txn.domains && txn.domains.length) {
      $('select#node-input-domain').empty();
      var unique_domains = txn.domains.filter(txn.checkUnique);

      unique_domains.forEach(function(domain) {
        var selectedText = '';
        if (txn.domain_selected === domain) {
          selectedText = 'selected="selected"';
        }
        $('select#node-input-domain')
          .append('<option value='
                        + '"' + domain + '"'
                        + selectedText
                        + '>'
                        + domain.charAt(0).toUpperCase()
                        + domain.slice(1)
                        + '</option>');
      });

    txn.checkDomainSelected();
    }
  }

  // Populates the base model field. These are the models that are available to be customised.
  txn.checkBaseModels = function () {
    if (!txn.basemodels && txn.models) {
      txn.basemodels = txn.models.filter(function (model) {
        return model.customizable === true;
      });
    }
    if (txn.basemodels) {
      $('select#node-input-basemodel').empty();
      txn.basemodels.forEach(function(base_model){
        var selectedText = '';
        if (txn.base_model_selected === base_model.model_id) {
            selectedText = 'selected="selected"';
        }
        $('select#node-input-basemodel')
            .append('<option value='
                          + '"' + base_model.model_id + '"'
                          + selectedText
                          + '>'
                          + txn.changeIdToText(base_model.model_id)
                          + '</option>');
      });
    }
  }

  // Populates the customised models field. These are the models that have been
  // customised. This control needs to be refreshed. Currently the only that that
  // will happen is by a page refresh. Need to have a trigger everytime the create
  // new model is triggerd, but that is a little complicated and needs to be done on
  // a clear mind.
  txn.checkCustomsAvailable = function() {
    if (!txn.custommodels && txn.models) {
      txn.custommodels = txn.models.filter(function (m) {
        return (m.base_model_id && ('' != m.base_model_id));
      });
    }
    if (txn.custommodels) {
      $('select#node-input-custom').empty();

      txn.custommodels.forEach(function(m){
        var selectedText = '';
        if (txn.custom_selected === m.model_id) {
            selectedText = 'selected="selected"';
        }
        $('select#node-input-custom')
            .append('<option value='
                        + '"' + m.model_id + '"'
                        + selectedText
                        + '>'
                        + m.model_id
                        + ' (' + m.domain + ' ' + m.base_model_id + ' ' + m.name + ')'
                        + '</option>');

      });
    }
  }


  // UI Handler for the Mode / switch.
  // Princliple function is to show / hide the appropriate fields.
  txn.checkActionSelected = function () {
    txn.action = $('#node-input-action').val();
    if (txn.models) {
      $('#credentials-not-found').hide();
      switch (txn.action) {
        case 'translate':
          $('select#node-input-srclang, select#node-input-destlang').parent().show();
          $('select#node-input-domain').parent().show();
          $('select#node-input-custom').parent().hide();
          $('select#node-input-basemodel, select#node-input-filetype').parent('').hide();
          $('input#node-input-trainid').parent('').hide();
          $('input#node-input-lgparams2').parent().show();
          $('#languagetranslation-form-tips').show();
          break;
        case 'custom':
          $('select#node-input-custom').parent().show();
          $('select#node-input-srclang, select#node-input-destlang').parent().hide();
          $('select#node-input-domain').parent().hide();
          $('select#node-input-basemodel, select#node-input-filetype').parent('').hide();
          $('input#node-input-trainid').parent('').hide();
          $('input#node-input-lgparams2').parent().show();
          $('#languagetranslation-form-tips').show();
          break;
        case 'train':
          $('select#node-input-custom').parent().hide();
          $('select#node-input-srclang, select#node-input-destlang').parent().hide();
          $('select#node-input-domain').parent().hide();
          $('select#node-input-basemodel, select#node-input-filetype').parent('').show();
          $('input#node-input-trainid').parent('').hide();
          $('input#node-input-lgparams2').parent().show();
          $('#languagetranslation-form-tips').show();
          break;
        case 'getstatus':
        case 'delete':
          $('select#node-input-custom').parent().hide();
          $('input#node-input-trainid').parent('').show();
          $('select#node-input-srclang, select#node-input-destlang').parent().hide();
          $('select#node-input-domain').parent().hide();
          $('select#node-input-basemodel, select#node-input-filetype').parent('').hide();
          $('input#node-input-lgparams2').parent().show();
          $('#languagetranslation-form-tips').show();
          break;
      }
      txn.checkDomains();
      txn.checkBaseModels();
      txn.checkCustomsAvailable();
    } else {
      $('#credentials-not-found').show();
    }
  }

  // Function does not appear to be used, comment out until someone complains.
  // UI Handler for the Parameter scope switch: Local or Global
  //txn.checkParamScopeSelected = function (){
    // Checkbox control
  //  txn.lg_parameters_selected2 = $('input#node-input-lgparams2').prop('checked');
  //  if (checked) {
  //    txn.using_global_parameters2 = true;
  //    txn.using_local_parameters2 = false;
  //  } else {
  //    txn.using_global_parameters2 = false;
  //    txn.using_local_parameters2 = true;
  //  }
  //}


  // UI Handler for the domain switch
  // Repopulate the source and languages based on the available translations for the domain
  txn.checkDomainSelected = function(){
    $('#node-input-srclang').empty();
    $('#node-input-destlang').empty();
    if (txn.models && txn.domains) {
      txn.domain_selected = $('#node-input-domain').val();
      txn.domain_type = txn.models.filter(function (model) {
        return model.domain === txn.domain_selected && model.status === 'available';
      });
      var input_lang = txn.domain_type.map(function (a) {
        return a.source;
      });
      var output_lang = txn.domain_type.map(function (a) {
        return a.target;
      });
      input_lang_unique = input_lang.filter(txn.checkUnique);
      output_lang_unique = output_lang.filter(txn.checkUnique);

      input_lang_unique.forEach(function(lang){
        var selectedText = '';
        if (txn.srclang_selected === lang) {
          selectedText = 'selected="selected"';
        }
        $('select#node-input-srclang')
          .append('<option value='
                        + '"' + lang + '"'
                        + selectedText
                        + '>'
                        + (txn.LANGUAGES[lang] ? txn.LANGUAGES[lang] : lang)
                        + '</option>');
      });
      // Having repopulated the input language selection, the old selected item
      // may no longer be in the list, so refresh it.
      txn.srclang_selected = $('#node-input-srclang').val();
      txn.langDestAvailable();
    }
  }


  // Register the handlers for the fields
  txn.UIListeners = function () {
    $('#node-input-username').change(function(val){
      txn.getCredentials();
      if (txn.have_credentials) {
        txn.checkActionSelected();}
    });
    $('#node-input-password').change(function(val){
      txn.getCredentials();
      if (txn.have_credentials) {
        txn.checkActionSelected();
      }
    });

    $('#node-input-action').change(function(val){
      txn.action = $('#node-input-action').val();
      txn.checkActionSelected();
    });

    $('#node-input-domain').change(function (val) {
      txn.domain_selected = $('#node-input-domain').val();
      txn.checkDomainSelected();
    });

    $('#node-input-custom').change(function () {
      txn.custom_selected = $('#node-input-custom').val();
    });

    $('#node-input-srclang').change(function () {
      txn.srclang_selected = $('#node-input-srclang').val();
      txn.langDestAvailable();
    });

    $('#node-input-destlang').change(function () {
      txn.destlang_selected = $('#node-input-destlang').val();
    });

    $('#node-input-basemodel').change(function (val) {
      txn.base_model_selected = $('#node-input-basemodel').val();
    });

    $('#node-input-lgparams2').change(function (val) {
      lg_parameters_selected = $('#node-input-lgparams2').val();
    });

  }

  // The dynamic nature of the selection fields in this node has caused problems.
  // Whenever there is a fetch for the models, on a page refresh or applicaiton
  // restart, the settings for the dynamic fields are lost.
  // So hidden (text) fields are being used to squirrel away the values, so that
  // they can be restored.
  txn.restoreHidden = function () {
    txn.domain_selected = $('#node-input-domainhidden').val();
    $('select#node-input-domain').val(txn.domain_selected);
    txn.srclang_selected = $('#node-input-srclanghidden').val();
    $('select#node-input-srslang').val(txn.srclang_selected);
    txn.destlang_selected = $('#node-input-destlanghidden').val();
    $('select#node-input-destlang').val(txn.destlang_selected);

    txn.base_model_selected = $('#node-input-basemodelhidden').val();
    $('select#node-input-basemodel').val(txn.base_model_selected);
    txn.custom_selected = $('#node-input-customhidden').val();
    $('select#node-input-custom').val(txn.custom_selected);


    txn.lg_parameters_selected2 = $('input#node-input-lgparams2').prop('checked');

  }

  // This is the on edit prepare function, which will be invoked everytime the dialog is shown.
  function oneditprepare() {
    txn.hideAll();
    txn.restoreHidden();

    txn.UIListeners();
    // Look for VCAP Json file, done is called if found or not, with service indicating
    // if the translation service is actually bound into this application.
    if (!txn.have_credentials) {
      $.getJSON('watson-translate/vcap/')
        .done(function (service) {
          // for some reason the getJSON resets the vars so need to restoreHidden again
          // so again.
          txn.restoreHidden();
          $('.credentials').toggle(!service);
          if (!service) {
            // no bound service, so check local settings to see if they are valid
            txn.using_local_credentials = true;
            txn.getCredentials();
          } else {
            // credentials are only valid if we can get hold of the models using them
            txn.using_local_credentials = false;
            if (!txn.models) {txn.checkModels();}
          }
        }).fail(function () {
          $('.credentials').show();
        }).always(function () {
          $('#credentials-check').hide();
        });
    }
    // credentials can be set during the oneditprepare process, so check again.
    if (txn.have_credentials || txn.using_local_credentials)
    {
      $('#credentials-check').hide();
      if (txn.have_credentials) {
        $('#credentials-not-found').hide();
      }
      if (txn.using_local_credentials) {
        $('.credentials').show();
      }
      txn.checkActionSelected();
    }
  }

  // Save the values in the dyanmic lists to the hidden fields.
  function oneditsave(){
    $('#node-input-domainhidden').val(txn.domain_selected);
    $('#node-input-srclanghidden').val(txn.srclang_selected);
    $('#node-input-destlanghidden').val(txn.destlang_selected);
    $('#node-input-basemodelhidden').val(txn.base_model_selected);
    $('#node-input-customhidden').val(txn.custom_selected);
    $('#node-input-ldparamshidden2').val(txn.lg_parameters_selected2);
  }

  // Define and run the function to register this node.
  (function() {
        RED.nodes.registerType('watson-translate', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ''},
                action: {value: 'translate'},
                basemodel: {value: ''},
                domain: {value: 'news'},
                srclang: {value: 'en'},
                destlang: {value: 'fr'},
                password: {value: ''},
                custom: {value: ''},
                domainhidden: {value: ''},
                srclanghidden: {value: ''},
                destlanghidden: {value: ''},
                basemodelhidden: {value: ''},
                customhidden: {value: ''},
                filetype: {value: 'forcedglossary'},
                trainid: {value: ''},
                lgparams2: {value: 'lparams'},
                ldparamshidden2: {value: ''}
            },
            credentials: {
              username: {type: 'text'}
              // password: {type: 'text'} << moved to keep track of previous data
            },
            color: "rgb(140, 198, 63)",
            inputs: 1,
            outputs: 1,
            icon: "languageid.png",
            paletteLabel: "language translation",
            label: function() {
                return this.name || "language translation";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: oneditprepare,
            oneditsave: oneditsave
        });
  })();

</script>
<script type="text/x-red" data-help-name="watson-translate">
    <p><b>NB:</b> The Watson Language Translation service has been deprecated in favor of the new Watson Translator service. Once the service
      has been switched off this node will no longer work. The node will be removed from the palette in a
      future release. </p>
    <br/>
    <p>Packaged in with release 0.4.25 of node-red-node-watson</p>
    <p>The Language Translation service enables you to translate text from one language to another and to add your own translation models.</p>
    <p></p>
    <p><b>Translation Mode</b>.</p>
    <p>The text to translate should be passed in on <code>msg.payload</code>.</p>
    <p>The translated text will be returned on <code>msg.payload</code>.</p>
    <p>The full response from the service will be returned on <code>msg.translation</code></p>
    <p>Source and destination language parameters can be configured through the editor panel or set dynamically using
    the language codes in the following properties, <code>msg.srclang</code> and <code>msg.destlang</code>. Please see
    the documentation linked below for the currently supported source and destination language codes.</p>
    <p></p>
    <p><b>Customised Translation Mode</b>.</p>
    <p>In this mode you can select a translation model that you have customised through
    the training options.</p>
    <p>The text to translate should be passed in on <code>msg.payload</code>.</p>
    <p>The translated text will be returned on <code>msg.payload</code>.</p>
    <p>The full response from the service will be returned on <code>msg.translation</code></p>
    <p></p>
    <p><b>Training Mode</b>.</p>
    <p>This mode enables you to add your own customized model to the Watson translation service. </p>
    <p>In the Dropbox node, you must specify one ore more of the following file options to customize the training:</p>
    <p>forced_glossary - A UTF-8 encoded TMX file that contains pairs of matching terms in the source and target language that are seen as absolute by the system. This file completely overwrites the original domain data.</p>
    <p>parallel_corpus - A UTF-8 encoded TMX file that contains matching phrases in the source and target language that serve as examples for Watson. Parallel corpora differ from glossaries because they do not overwrite the original domain data.</p>
    <p>monolingual_corpus - A UTF-8 encoded plain text file that contains a body of text in the target language that is related to what you are translating. A monolingual corpus helps improve literal translations to be more fluent and human.</p>
    <p>The Language Translation Node will return the ID of the created customized model.</p>
    <p></p>
    <p><b>Get Status Mode</b>.</p>
    <p>This mode allows you to get the status of a model sent to training by providing its ID.</p>
    <p>Values can be the followings:</p>
    <p>training - Training is still in progress.</p>
    <p>queued@<#> - Training has not yet started and the model is in the queue. The # indicates the number of your model in the queue.</p>
    <p>error - Training did not complete because of an error. if you want to see the reason behind the error
    this will be returned in <code>msg.translation</code></p>
    <p>available - Training is completed, and the service is now available to use with your custom translation model.</p>
    <p><b>Delete Mode</b>.</p>
    <p></p>
    <p>This mode allows you to delete a model by providing its ID</p>
    <p><b>Parameters Scope</b>.</p>
    <p>This parameter makes the language translation node to toogle using incoming parameters form the dashboard DropDown list or locally.</p>
    <p>Values can be the followings:</p>
    <p><b>Local</b>  -  Local parametres if the node is used by its own (default value).</p>
    <p><b>Global</b> -  Global parametres if the node is used with the 'language translation util' and 'dropdonw' node.
    Global parameters are set when <b>local in unchecked</b>.</p>
    <p>For more information about the Language Translation service, read the <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/language-translation.html">documentation</a>.</p>
</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-translator-util">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name (LTU)</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
</script>




<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-translate-util', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(130, 170, 64)",
            inputs: 1,
            outputs: 1,
            icon: "languageid.png",
            paletteLabel: "language translation-util",
            label: function() {
                return this.name || "language translation-util";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-translate-util/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-translate-util">
    <p><b>NB:</b> The Watson Language Translator service has been deprecated in favor of the new Watson Translator service. Once the service
      has been switched off this node will no longer work. The node will be removed from the palette in a
      future release. </p>
    <br/>
    <p>The Language Translation Utility service enables you to set using dasboard utility functions
    the language translation to be used by the Language Translation Node.</p>
    <p></p>
    <p><b>Translation Mode Utility</b>.</p>
    <p>The regular Watson Translation cerdentials should be set through the UI.</p>
    <p>No input is neede for the node. The node fetches the information automatically.</p>
    <p></p>
    <p>When this node is used with the 'language translation' node, in the 'language translation' node the scope of vaiables should be set to global.</p>
    <p></p>
    <p>The node will return the following arrays:</p>
    <p>Message model_id (e.g.: en-fr-conversational)<code>msg.model_id</code>.</p>
    <p>Message Domains (e.g.: Conversational)<code>msg.domain</code>.</p>
    <p>Message Source Language (e.g.: English)<code>msg.source</code>.</p>
    <p>Message Targate Language (e.g.: French)<code>msg.target</code>.</p>
    <p>For more information about the Language Translation service, read the <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/language-translation.html">documentation</a>.</p>
</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-natural-language-classifier">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-question"></i> Mode</label>
        <select type="text" id="node-input-mode" style="display: inline-block; width: 70%;" >
            <option value="classify">Classify</option>
            <option value="create">Train</option>
			<option value="remove">Remove</option>
		    <option value="list">List</option>
        </select>
    </div>
    <div class="form-row mode classify">
        <label for="node-input-classifier"><i class="fa fa-tag"></i> Classifier ID</label>
        <input type="text" id="node-input-classifier" placeholder="Classifier ID">
    </div>
    <div class="form-row mode create">
        <label for="node-input-language"><i class="fa fa-language"></i> Language</label>
        <select type="text" id="node-input-language" style="display: inline-block; width: 70%;" >
            <option value="ar">Arabic</option>
            <option value="en">English</option>
            <option value="de">German</option>
            <option value="fr">French</option>
            <option value="it">Italian</option>
            <option value="ja">Japanese</option>
            <option value="pt">Portuguese</option>
            <option value="es">Spanish</option>
        </select>
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-natural-language-classifier', {
            category: 'IBM Watson',
            defaults: {
              name: {value: ""},
              mode: {value: "classify"},
              language: {value: "en"},
              classifier: {value: ""}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(140, 198, 63)",
            inputs: 1,
            outputs: 1,
            icon: "NLClassifier.png",
            paletteLabel: "natural language classifier",
            label: function() {
                return this.name || "natural language classifier";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
              $('#node-input-mode').change(function () {
                var mode = $('#node-input-mode').val();
                $('.form-row.mode.' + mode).show();
                $('.form-row.mode:not(.' + mode + ')').hide();
              })
              $.getJSON('watson-natural-language-classifier/vcap/')
                .done(function (service) {
                  $('.credentials').toggle(!service);
                })
                .fail(function () {
                  $('.credentials').show();
                }).always(function () {
                  $('#credentials-check').hide();
                })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-natural-language-classifier">
    <p>The Natural Language Classifier service uses machine learning algorithms to return the top matching predefined classes for short text inputs.</p>
    <p>The node can either train new classifiers or match text against existing classifiers.
       Use the drop-down menu in the node configuration window to select the mode.</p>
    <p></p>
    <p><b>Classifier Mode</b>.</p>
    <p>Set the classifier id in the node configuration window.</p>
    <p>The text to classify should be passed in on <code>msg.payload</code>.</p>
    <p>The returned classification and confidence values will be returned on <code>msg.payload</code>.</p>
    <p></p>
    <p><b>Training Mode</b>.</p>
    <p>Set the training data language in the node configuration window.</p>
    <p>The CSV training data should be passed in on <code>msg.payload</code> as a String or String Array. For more details on the training data format, see this <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/doc/nl-classifier/data_format.shtml">link</a></p>
    <p>The returned classification training status will be returned on <code>msg.payload</code>.</p>
	<p><b>List Mode</b>.</p>
    <p>Set the mode in the node configuration window.</p>
    <p>The request is triggered by a request to the input node
    <p>The returned list of classifiers will be returned on <code>msg.payload</code>.</p>
	<p><b>Remove Mode</b>.</p>
    <p>Set the mode in the node configuration window.</p>
    <p>The Classifier ID should be passed in on <code>msg.payload</code> as a String<p>
    <p>The status of the delete be returned on <code>msg.payload</code>.  It will contain {} if successful</p>
	<p><b>More Information</b>.</p>
    <p>For more information about the Natural Language Classifier service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/natural-language-classifier">documentation</a>.</p>
</script><script>

	// Should this array be dynamically loaded? Or statically add only the most common fields?
	var fields = ['original.url','enriched.url.image','enriched.url.url','enriched.url.title',
				'enriched.url.language','enriched.url.publicationDate.date','enriched.url.text',
				'enriched.url.author','enriched.url.taxonomy.taxonomy_.label','enriched.url.taxonomy.taxonomy_.score', 'enriched.url.concepts'];

	RED.nodes.registerType('news',{
		category: 'IBM_Watson',
		color: '#FFFF80',
		defaults: {
			name: {value:""},
			service: {value:"",required:true},
			key: {value:"",required:true},
	   		start: {value:"",required:true},
			end: {value:"", required:true},
			query: {value:"", required:false},
			custom: {value:true, required:true},
			queries: {value:[]},
			results: {value:[]},
			max: {value:10,required: true},
			mode: {value:"json",required: true},
		},		
		inputs:1,
		outputs:1,
		icon: "news2.png",
		label: function() {
			return this.name||"news";
		},

		oneditprepare: function () {
			var node = this;

			$.getJSON('watson-news/vcap/',function(data) {
				
				node.newss = data;
				var last = $('#node-input-service').children().last();
				var opts = [];
	
				for (var i=0; i < data.length; i++) {
					var selected = node.service === data[i].name;
					opts.push(
						'<option value="' + data[i].name + '"' + (selected ? " selected":"") + '>' +
							data[i].name +
						'</option>'
					);
				}
	
				if (opts.length === 0) {
					node.service = "_ext_";
					$('#node-input-service').find("option").filter(function() {
						return $(this).val() == node.service;
					}).attr('selected', true);
				} else {
					last.before(opts.join(""));
				}
	
				if (node.service === '_ext_') {
					$("#external_news_service :input").attr('disabled',false);
				} else {
					for (var i2=0;i2<node.newss.length;i2++) {
						var ws = node.newss[i2];
						if (ws.name === node.service) {
							$("#node-input-username").val(ws.username);
							$("#node-input-password").val(ws.password);
						}
					}
					$("#external_news_service :input").attr('disabled',true);
				}
				
				if (node.command === 'list') {
					$("#node-input-classifier :input").attr('disabled',true);
				} else {
					$("#node-input-classifier :input").attr('disabled',false);
				}

			});

			$("#node-input-command").on("change",function() {
				if (this.value === 'list') {
					$("#node-input-classifier :input").attr('disabled',true);
				} else {
					$("#node-input-classifier :input").attr('disabled',false);
				}
			});

			$("#node-input-service").on("change",function() {
				$("#node--input-service").val(this.value);
				if (this.value === '_ext_') {
					$("#external_news_details :input").attr('disabled',false);
				} else {
					if(node.newss) {
						$("#external_news_details :input").attr('disabled',true);
						for (var i=0;i<node.newss.length;i++) {
							var ws = node.newss[i];
							if (ws.name === this.value) {
								$("#node-input-username").val(ws.username);
								$("#node-input-password").val(ws.password);
							}
						}
					}

				}
			});

			fields.forEach(function(val) {
				if ($.inArray(val,node.results)<0) {
					$('#node-input-results-list').append($("<option></option>")
						 .attr("value",val)
						 .text(val)); 
				} else {
					$('#node-input-results').append($("<option></option>")
						 .attr("value",val)
						 .text(val)); 
				}
			});

			$('#node_custom_query').toggle(node.custom);
			$('#node_query_wizard').toggle(!node.custom);

			$(function() {
				$( "#node-input-start" ).datepicker();
			});
			$(function() {
				$( "#node-input-end" ).datepicker();
			});

			$("#node-input-add-query").on("click",function() {
				addQuery();
			});

			$("#node-input-add-result").on("click",function() {
				$("#node-input-results-list").val().forEach(function(val) {
					$("#node-input-results").append($("<option></option>")
						 .attr("value",val)
						 .text(val)); 
					$("#node-input-results-list option[value='"+val+"']").remove();
				});
			});

			$("#node-input-remove-result").on("click",function() {
				$("#node-input-results").val().forEach(function(val) {
					$("#node-input-results-list").append($("<option></option>")
						 .attr("value",val)
						 .text(val)); 
					$("#node-input-results option[value='"+val+"']").remove();
				});
			});

			$("#node-input-custom").click(function() {
				$('#node_custom_query').toggle(this.checked);
				$('#node_query_wizard').toggle(!this.checked);
			});

			$("#node-input-service").on("change",function() {
				$("#node-input-service").val(this.value);
				if (this.value === '_ext_') {
					$("#external_news_details :input").attr('disabled',false);
				} else {
					if(node.newss) {
						$("#external_news_details :input").attr('disabled',true);
						for (var i=0;i<node.newss.length;i++) {
							var ta = node.newss[i];
							if (ta.name === this.value) {
								$("#node-input-key").val(ta.key);
							}
						}
					}

				}
			});

			function addQuery(query) {
				var row1 = $("<li></li>");
				var row2 = $("<div></div>",{class:"form-row"}).appendTo(row1);
				var label1 = $("<label></label>",{style:"width: 75px;"}).text("Condition").appendTo(row2);
				var select11 = $("<select></select>",{class:"node-input-field",type:"text",style:"margin-left: 5px;width:30%;"}).appendTo(row2);
				fields.forEach(function(val) {
					select11.append($("<option></option>")
						 .attr("value",val)
						 .text(val)); 
				});
				var select12 = $("<select></select>",{class:"node-input-op",type:"text",style:"margin-left: 5px;width:120px;"}).appendTo(row2);
				var option121 = $("<option></option>").text("Contains").val("cc").appendTo(select12);
				var option122 = $("<option></option>").text("Not Contains").val("nc").appendTo(select12);
				var option123 = $("<option></option>").text("Equal").val("eq").appendTo(select12);
				var option124 = $("<option></option>").text("Not Equal").val("ne").appendTo(select12);
				var option125 = $("<option></option>").text("Greater Than").val("gt").appendTo(select12);
				var option126 = $("<option></option>").text("Less Than").val("lt").appendTo(select12);
				var option127 = $("<option></option>").text("Greater Than or Equal").val("ge").appendTo(select12);
				var option128 = $("<option></option>").text("Less Than or Equal").val("le").appendTo(select12);
				var input13 = $("<input></input>",{class:"node-input-value",type:"text",style:"margin-left: 5px;width:30%;"}).appendTo(row2);
				var button1 = $('<a></a>',{href:"#",class:"editor-button editor-button-small button-remove", style:"margin-top: 7px; margin-left: 5px;"}).appendTo(row2);
				$('<i></i>',{class:"fa fa-remove"}).appendTo(button1);
				$("#node-input-queries-container").append(row1);

				if (query) {
					select11.val(query.field);					
					select12.val(query.op);					
					input13.val(query.value);					
				}

				button1.click(function() {
					row1.fadeOut(300,function() {
						$(this).remove();
					});
				});

			};

			for (var i=0;i<this.queries.length;i++) {
				addQuery(this.queries[i]);
			}

		},

		oneditsave: function() {

			var node = this;
			node.queries= [];
			var queries = $("#node-input-queries-container").children();
			queries.each(function() {
				var query = $(this);
				var q = {
					field:query.find(".node-input-field").val(),
					op:query.find(".node-input-op").val(),
					value:query.find(".node-input-value").val()
				}
				node.queries.push(q);
			});

			node.results= [];
			$("#node-input-results option").each(function() {
				node.results.push($(this).val());
			});
		},
	});

</script>

<script type="text/x-red" data-template-name="news">
	<div class="form-row">
		<label for="node-input-name"><i class="icon-tag"></i> Name</label>
		<input type="text" id="node-input-name">
	</div>
	<div class="form-row">
		<label for="node-input-service"><i class="fa fa-globe"></i> Service</label>
		<select id="node-input-service">
			<option value="" disabled></option>
			<option value="_ext_"> External service</option>
		</select>
	</div>
	<div id="external_news_details">
		<div class="form-row">
			<label for="node-input-key"><i class="icon-tag"></i> Key</label>
			<input type="text" id="node-input-key">
		</div>
	</div>
	<div class="form-row">
		<label for="node-input-start"><i class="fa fa-calendar"></i> Start</label>
		<input type="text" id="node-input-start" style="width: 110px;">
		<label for="node-input-end" style="margin-left: 10px;"><i class="fa fa-calendar"></i> End</label>
		<input type="text" id="node-input-end" style="width: 110px;">
	</div>	
	<div class="form-row">
		<label for="node-input-results-list"><i class="fa fa-check"></i> Outputs</label>
		<select id="node-input-results-list" style="width: 25%;" size='4' multiple></select>
		<a href="#" class="editor-button editor-button-small" id="node-input-add-result"margin- style="margin-left: 4px;"><i class="fa fa-toggle-right"></i> Add</a>
		<a href="#" class="editor-button editor-button-small" id="node-input-remove-result" style="margin-bottom: 4px;">Remove <i class="fa fa-toggle-left"></i></a>
		<select id="node-input-results" style="margin-left: 10px;width: 25%;" size='4' multiple></select>
	</div>	
	<div class="form-row">
		<label for="node-input-max"><i class="fa fa-list"></i> Max. Results</label>
		<input type="text" id="node-input-max" style="width: 30px;">
		<label for="node-input-custom" style="margin-left:10px;width:120px;"><i class="fa fa-question" ></i> Custom query</label>
		<input type="checkbox" id="node-input-custom" style="width: 25px;">
	</div>
	<div id="node_custom_query">
		<div class="form-row">
			<label for="node-input-query"><i class="icon-tag"></i> Query</label>
			<input type="text" id="node-input-query">
		</div>	
	</div>
	<div id="node_query_wizard">
		<div class="form-row">
			<label for="node-input-add-query"><i class="icon-tag"></i> Query</label>
			<a href="#" class="editor-button editor-button-small" id="node-input-add-query" style="margin-left: 4px;"><i class="fa fa-plus"></i> Add</a>
		</div>
		<div class="form-row">
			<div id="node-input-queries-div" style="box-sizing: border-box; border-radius: 5px; height: 150px; padding: 5px; border: 1px solid #ccc; overflow-y:scroll;">
				<ol id="node-input-queries-container" style=" list-style-type:none; margin: 0;"></ol>
			</div>
		</div>
	</div>
</script>



<script type="text/x-red" data-help-name="news">
	<p>Watson Alchemy News provides you with access to a hyper-relevant, curated dataset of news and blogs that has been enriched with AI.</p>
	<p>In order to use the service you need to provide a key. Start and end dates for the search must also be provided. 
	The rest of the fields are optional and default values will be used if none is specified. If the list of output 
	fields is empty, only the number of found articles will be returned.</p>
	<p>Configuration values will be taken from the input message if available. Start and end date, query, result fields and maximum number 
	of results should be placed in <b>msg.start</b>, <b>msg.end</b>, <b>msg.query</b>, <b>msg.result</b>, <b>msg.maximum</b> respectively.
	More information on how to build the queries can be found at the <a href='https://alchemyapi.readme.io/v1.0/docs/rest-api-documentation'>
	API Alchemy documentation</a>.</p>
</script><!--
  Copyright 2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-personality-insights">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-lang"><i class="fa fa-language"></i> Language</label>
        <select type="text" id="node-input-lang" style="display: inline-block; width: 70%;" >
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="ar">Arabic</option>
            <option value="ja">Japanese</option>
        </select>
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-personality-insights', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""},
                lang: {value: "en"}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(140, 198, 63)",
            inputs: 1,
            outputs: 1,
            icon: "personality_insights.png",
            paletteLabel: "personality insights",
            label: function() {
                return this.name || "personality insights";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-personality-insights/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-personality-insights">
    <p><b>NB:</b> This Node makes use of V2 of the Watson Personality Insights service has been
      <b>deprecated</b> in favor
      of V3 of the service. Once the V2 service
      has been switched off this node will no longer work. This node will be removed from the palette in a
      future release. Please use the Personality Insights node that supports V3 of the service.
    </p>
    <br/>

    <p>The Personality Insights V2 service uses linguistic analytics to infer personality and social characteristics, including Big Five, Needs, and Values, from text.</p>
    <p>The text (minimum of a hundred words) to analyse should be passed in on <code>msg.payload</code>.</p>
    <p>You can set the source text language to be either English or Spanish.</p>
    <p>The insights will be returned as a tree on <code>msg.insights</code>.</p>
    <p>For more information about the Personality Insights service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/personality-insights.html">documentation</a>.</p>
</script><!--
  Copyright 2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-personality-insights-v3">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-inputlang"><i class="fa fa-language"></i> Input Text Language</label>
        <select type="text" id="node-input-inputlang" style="display: inline-block; width: 70%;" >
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="ar">Arabic</option>
            <option value="ja">Japanese</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-outputlang"><i class="fa fa-language"></i> Language For Response</label>
        <select type="text" id="node-input-outputlang" style="display: inline-block; width: 70%;" >
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="it">Italian</option>
            <option value="de">German</option>
            <option value="pt-br">Braillian Portuguese</option>
            <option value="es">Spanish</option>
            <option value="ar">Arabic</option>
            <option value="ja">Japanese</option>
            <option value="ko">Korean</option>
            <option value="zh-cn">Simplified Chinese</option>
            <option value="zh-tw">Traditional Chinese</option>
        </select>
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-rawscores" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-rawscores" style="width: 70%;"> Raw Scores</label>
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-consumption" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-consumption" style="width: 70%;"> Consumption Preferences</label>
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-personality-insights-v3', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ""},
                inputlang: {value: "en"},
                outputlang: {value: "en"},
                rawscores: {value: false},
                consumption: {value: false}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(0, 150, 200)",
            inputs: 1,
            outputs: 1,
            icon: "personality_insights.png",
            paletteLabel: "personality insights",
            label: function() {
                return this.name || "personality insights";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-personality-insights-v3/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-personality-insights-v3">
    <p>The Personality Insights V3 service uses
      linguistic analytics to infer personality characteristics from text.
      The service can infer consumption preferences based on the results of its analysis.
    </p>
    <p>The text (minimum of a hundred words) to analyse should be passed in on <code>msg.payload</code>.</p>
    <p>Input Text Language is the language of the input text.
      This setting can be overridden by setting <code>msg.piparams.inputlanguage</code> to a valid
      supported language iso code eg. 'es'.
    </p>
    <p>Language for Response is the language that the response will be returned in.
    <p>Input Text Language is the language of the input text.
      This setting can be overridden by setting <code>msg.piparams.responselanguage</code> to a valid
      supported language iso code eg. 'pt-br'.
    </p>
    </p>
    <p>Raw Scores indicates whether a raw score in addition to a normalized percentile is to be returned
      for each characteristic; raw scores are not compared with a sample population.
    </p>
    <p>Consumption Preferences indicates whether consumption preferences are to be returned
      with the results.
    </p>
    <p>The insights will be returned as a tree on <code>msg.insights</code>.</p>
    <p>For more information about the Personality Insights service,
      read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/personality-insights.html">
      documentation</a>.
    </p>
</script><!--
  Copyright 2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-relationship-extraction">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-dataset"><i class="fa fa-comments-o"></i> Dataset</label>
        <select type="text" id="node-input-dataset" style="display: inline-block; vertical-align:middle; width: 70%;">
            <option value="ie-en-news">English</option>
            <option value="ie-es-news">Spanish</option>
        </select>
    </div>
    <div class="form-tips" id="node-missing-service-warning" style="display: none"><i class="fa fa-warning"></i><b> Warning:</b> There is no Relationship Extraction service connected
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-relationship-extraction', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""},
                dataset: {value: "ie-en-news"}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(185, 120, 252)",
            inputs: 1,
            outputs: 1,
            icon: "relationship_extraction.png",
            paletteLabel: "relationship extraction",
            label: function() {
                return this.name || "relationship extraction";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
              var node = this;
              $.getJSON('watson-relationship-extraction/vcap/')
                .done(function (sids) {
                  $('.credentials').toggle(!sids);
                  if (sids) {
                    var select = $('#node-input-dataset');
                    for (var i = 0; i < sids.length; ++i) {
                      var sid = sids[i].sid;
                      var option = "<option value=\"" + sid + "\">"+ sids[i].description + "</option>";
                      select.append(option);
                    }
                    select.find("option").filter(function() {return $(this).val() === node.dataset;}).attr('selected', true);
                  }
                })
              .fail(function () {
                $('.credentials').show();
              }).always(function () {
                $('#credentials-check').hide();
              })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-relationship-extraction">
    <p><b>NB:</b> The Watson Relationship Extraction service hase been deprecated. Once the service
    has been switched off this node will no longer work. The node will be removed from the palette in a
    future release. </p>
    <br/>

    <p>The Relationship Extraction service intelligently finds relationships between sentence components (nouns, verbs,
    subjects, objects, etc.). From unstructured text, it can extract entities (such as people, locations, organizations,
    events), and the relationships between these entities (such as person employed-by organization, person resides-in location).</p>
    <p>The text to analyse should be passed in on <code>msg.payload</code>.</p>
    <p>There are two different datasets to choose from.</p>
    <ul>
        <li><b>English News</b></li>
        <li><b>Spanish News</b></li>
    </ul>
    <p>The relationships will be returned on <code>msg.relationships</code>.</p>
    <p>For more information about the Relationship Extraction, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/relationship-extraction.html">documentation</a>.</p>
</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!-- Service Credentials Configuration Node -->
<script type="text/x-red" data-template-name="watson-retrieve-rank-credentials">
    <div class="form-row">
        <label for="node-config-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-config-input-username" placeholder="Username">
    </div>
    <div class="form-row">
        <label for="node-config-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-config-input-password" placeholder="Password">
    </div>
</script>

<script type="text/javascript">
(function() {
    RED.nodes.registerType('watson-retrieve-rank-credentials',{
        category: 'config',
        defaults: {
            username:{value: ''},
            password:{value: ''}
        },
        label: function() {
            return 'Retrieve and Rank Credentials';
        }
    });
})();
</script>


<!-- Create Cluster Node -->
<script type="text/x-red" data-template-name="watson-retrieve-rank-create-cluster">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row servicecreds">
        <label for="node-input-bluemix"><i class="fa fa-user"></i> Service Credentials</label>
        <input type="text" id="node-input-servicecreds">
    </div>
    <div class="form-row clustername">
        <label for="node-input-clustername"><i class="fa fa-tag"></i> Cluster Name</label>
        <input type="text" id="node-input-clustername" placeholder="Cluster Name">
    </div>
    <div class="form-row clustersize">
        <label for="node-input-clustersize"><i class="fa fa-tag"></i> Cluster Size</label>
        <select id="node-input-clustersize">
          <option value="free">Free</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
        </select>
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-retrieve-rank-create-cluster', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                servicecreds: {value: '', type: 'watson-retrieve-rank-credentials', required: false},
                clustername: {value: ''},
                clustersize: {value: 'free'}
            },
            color: 'rgb(85, 150, 230)',
            inputs: 1,
            outputs: 1,
            icon: 'RetrieveRank.png',
            paletteLabel: 'retrieve and rank create cluster',
            label: function() {
                return this.name || 'retrieve and rank create cluster';
            },
            labelStyle: function() {
                return this.name ? 'node_label_italic' : '';
            },
            oneditprepare: function() {
                $.getJSON('watson-retrieve-and-rank/vcap/').done(function (service) {
                    $('.servicecreds').toggle(!service);
                }).fail(function () {
                    $('.servicecreds').show();
                }).always(function () {
                    $('#credentials-check').hide();
                })
            }
        });
    })();
</script>

<!-- Cluster settings node -->
<script type="text/x-red" data-template-name="watson-retrieve-rank-cluster-settings">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row servicecreds">
        <label for="node-input-bluemix"><i class="fa fa-user"></i> Service Credentials</label>
        <input type="text" id="node-input-servicecreds">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-question"></i> Mode</label>
        <select type="text" id="node-input-mode" style="display: inline-block; width: 70%;" >
            <option value="list">List Clusters</option>
            <option value="info">Cluster Information</option>
            <option value="delete">Delete Cluster</option>
        </select>
    </div>
    <div class="form-row mode clusterid">
        <label for="node-input-clusterid"><i class="fa fa-tag"></i> Cluster ID</label>
        <input type="text" id="node-input-clusterid" placeholder="Cluster ID">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-retrieve-rank-cluster-settings', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                mode: {value: 'list'},
                servicecreds: {value: '', type: 'watson-retrieve-rank-credentials', required: false},
                clusterid: {value: ''}
            },
            credentials: {
              username: {type:'text'},
              password: {type:'password'}
            },
            color: 'rgb(85, 150, 230)',
            inputs: 1,
            outputs: 1,
            icon: 'RetrieveRank.png',
            paletteLabel: 'retrieve and rank cluster settings',
            label: function() {
                return this.name || 'retrieve and rank cluster settings';
            },
            labelStyle: function() {
                return this.name ? 'node_label_italic' : '';
            },
            oneditprepare: function() {
                $('#node-input-mode').change(function () {
                    var mode = $('#node-input-mode').val();
                    if (mode == 'list') {
                        $('.form-row.mode.clusterid').hide();
                    } else {
                        $('.form-row.mode.clusterid').show();
                    }
                });
                $.getJSON('watson-retrieve-and-rank/vcap/').done(function (service) {
                    $('.servicecreds').toggle(!service);
                }).fail(function () {
                    $('.servicecreds').show();
                }).always(function () {
                    $('#credentials-check').hide();
                })
            }
        });
    })();
</script>

<!-- Upload Solr Configuration node -->
<script type="text/x-red" data-template-name="watson-retrieve-rank-upload-solr-configuration">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row servicecreds">
        <label for="node-input-bluemix"><i class="fa fa-user"></i> Service Credentials</label>
        <input type="text" id="node-input-servicecreds">
    </div>
    <div class="form-row mode clusterid">
        <label for="node-input-clusterid"><i class="fa fa-tag"></i> Cluster ID</label>
        <input type="text" id="node-input-clusterid" placeholder="Cluster ID">
    </div>
    <div class="form-row mode configname">
        <label for="node-input-configname"><i class="fa fa-tag"></i> Configuration Name</label>
        <input type="text" id="node-input-configname" placeholder="Configuration Name">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-retrieve-rank-upload-solr-configuration', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                servicecreds: {value: '', type: 'watson-retrieve-rank-credentials', required: false},
                clusterid: {value: ''},
                configname: {value: ''}
            },
            color: 'rgb(85, 150, 230)',
            inputs: 1,
            outputs: 1,
            icon: 'RetrieveRank.png',
            paletteLabel: 'retrieve and rank upload solr configuration',
            label: function() {
                return this.name || 'retrieve and rank upload solr configuration';
            },
            labelStyle: function() {
                return this.name ? 'node_label_italic' : '';
            },
            oneditprepare: function() {
                $.getJSON('watson-retrieve-and-rank/vcap/').done(function (service) {
                    $('.servicecreds').toggle(!service);
                }).fail(function () {
                    $('.servicecreds').show();
                }).always(function () {
                    $('#credentials-check').hide();
                })
            }
        });
    })();
</script>

<!-- Solr Configuration Settings node -->
<script type="text/x-red" data-template-name="watson-retrieve-rank-solr-configuration-settings">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row servicecreds">
        <label for="node-input-bluemix"><i class="fa fa-user"></i> Service Credentials</label>
        <input type="text" id="node-input-servicecreds">
    </div>
    <div class="form-row clusterid">
        <label for="node-input-clusterid"><i class="fa fa-tag"></i> Cluster ID</label>
        <input type="text" id="node-input-clusterid" placeholder="Cluster ID">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-question"></i> Mode</label>
        <select type="text" id="node-input-mode" style="display: inline-block; width: 70%;" >
            <option value="list">List Solr Configurations</option>
            <option value="info">Solr Configuration Information</option>
            <option value="delete">Delete Solr Configuration</option>
        </select>
    </div>
    <div class="form-row mode configname">
        <label for="node-input-configname"><i class="fa fa-tag"></i> Configuration Name</label>
        <input type="text" id="node-input-configname" placeholder="Configuration Name">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-retrieve-rank-solr-configuration-settings', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                servicecreds: {value: '', type: 'watson-retrieve-rank-credentials', required: false},
                clusterid: {value: ''},
                mode: {value: 'list'},
                configname: {value: ''}

            },
            color: 'rgb(85, 150, 230)',
            inputs: 1,
            outputs: 1,
            icon: 'RetrieveRank.png',
            paletteLabel: 'retrieve and rank solr configuration settings',
            label: function() {
                return this.name || 'retrieve and rank solr configuration settings';
            },
            labelStyle: function() {
                return this.name ? 'node_label_italic' : '';
            },
            oneditprepare: function() {
                $('#node-input-mode').change(function () {
                    var mode = $('#node-input-mode').val();
                    if (mode == 'list') {
                        $('.form-row.mode.configname').hide();
                    } else {
                        $('.form-row.mode.configname').show();
                    }
                });
                $.getJSON('watson-retrieve-and-rank/vcap/').done(function (service) {
                    $('.servicecreds').toggle(!service);
                }).fail(function () {
                    $('.servicecreds').show();
                }).always(function () {
                    $('#credentials-check').hide();
                })
            }
        });
    })();
</script>

<!-- Solr Collection node -->
<script type="text/x-red" data-template-name="watson-retrieve-rank-solr-collection">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row servicecreds">
        <label for="node-input-bluemix"><i class="fa fa-user"></i> Service Credentials</label>
        <input type="text" id="node-input-servicecreds">
    </div>
    <div class="form-row clusterid">
        <label for="node-input-clusterid"><i class="fa fa-tag"></i> Cluster ID</label>
        <input type="text" id="node-input-clusterid" placeholder="Cluster ID">
    </div>
    <div class="form-row collectionname">
        <label for="node-input-collectionname"><i class="fa fa-tag"></i> Collection Name</label>
        <input type="text" id="node-input-collectionname" placeholder="Collection Name">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-question"></i> Mode</label>
        <select type="text" id="node-input-mode" style="display: inline-block; width: 70%;" >
            <option value="create">Create Solr Collection</option>
            <option value="delete">Delete Solr Collection</option>
            <option value="index">Index Documents</option>
            <option value="search">Search</option>
        </select>
    </div>

    <div class="form-row mode configname">
        <label for="node-input-configname"><i class="fa fa-tag"></i> Configuration Name</label>
        <input type="text" id="node-input-configname" placeholder="Configuration Name">
    </div>

</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-retrieve-rank-solr-collection', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                servicecreds: {value: '', type: 'watson-retrieve-rank-credentials', required: false},
                clusterid: {value: ''},
                collectionname: {value: ''},
                mode: {value: 'create'},
                configname: {value: ''}

            },
            color: 'rgb(85, 150, 230)',
            inputs: 1,
            outputs: 1,
            icon: 'RetrieveRank.png',
            paletteLabel: 'retrieve and rank solr collection',
            label: function() {
                return this.name || 'retrieve and rank solr collection';
            },
            labelStyle: function() {
                return this.name ? 'node_label_italic' : '';
            },
            oneditprepare: function() {
                $('#node-input-mode').change(function () {
                    var mode = $('#node-input-mode').val();
                    if (mode == 'create') {
                        $('.form-row.mode.configname').show();
                    } else {
                        $('.form-row.mode.configname').hide();
                    }
                });
                $.getJSON('watson-retrieve-and-rank/vcap/').done(function (service) {
                    $('.servicecreds').toggle(!service);
                }).fail(function () {
                    $('.servicecreds').show();
                }).always(function () {
                    $('#credentials-check').hide();
                })
            }
        });
    })();
</script>

<!-- Create Ranker Node -->
<script type="text/x-red" data-template-name="watson-retrieve-rank-create-ranker">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row servicecreds">
        <label for="node-input-bluemix"><i class="fa fa-user"></i> Service Credentials</label>
        <input type="text" id="node-input-servicecreds">
    </div>
    <div class="form-row rankername">
        <label for="node-input-rankername"><i class="fa fa-tag"></i> Ranker Name</label>
        <input type="text" id="node-input-rankername" placeholder="Ranker Name">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-retrieve-rank-create-ranker', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                servicecreds: {value: '', type: 'watson-retrieve-rank-credentials', required: false},
                rankername: {value: ''}
            },
            color: 'rgb(85, 150, 230)',
            inputs: 1,
            outputs: 1,
            icon: 'RetrieveRank.png',
            paletteLabel: 'retrieve and rank create ranker',
            label: function() {
                return this.name || 'retrieve and rank create ranker';
            },
            labelStyle: function() {
                return this.name ? 'node_label_italic' : '';
            },
            oneditprepare: function() {
                $.getJSON('watson-retrieve-and-rank/vcap/').done(function (service) {
                    $('.servicecreds').toggle(!service);
                }).fail(function () {
                    $('.servicecreds').show();
                }).always(function () {
                    $('#credentials-check').hide();
                })
            }
        });
    })();
</script>

<!-- Ranker settings node -->
<script type="text/x-red" data-template-name="watson-retrieve-rank-ranker-settings">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row servicecreds">
        <label for="node-input-bluemix"><i class="fa fa-user"></i> Service Credentials</label>
        <input type="text" id="node-input-servicecreds">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-question"></i> Mode</label>
        <select type="text" id="node-input-mode" style="display: inline-block; width: 70%;" >
            <option value="list">List Rankers</option>
            <option value="info">Ranker Information</option>
            <option value="delete">Delete Ranker</option>
        </select>
    </div>
    <div class="form-row mode rankerid">
        <label for="node-input-rankerid"><i class="fa fa-tag"></i> Ranker ID</label>
        <input type="text" id="node-input-rankerid" placeholder="Ranker ID">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-retrieve-rank-ranker-settings', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                servicecreds: {value: '', type: 'watson-retrieve-rank-credentials', required: false},
                mode: {value: 'list'},
                rankerid: {value: ''}
            },
            color: 'rgb(85, 150, 230)',
            inputs: 1,
            outputs: 1,
            icon: 'RetrieveRank.png',
            paletteLabel: 'retrieve and rank ranker settings',
            label: function() {
                return this.name || 'retrieve and rank ranker settings';
            },
            labelStyle: function() {
                return this.name ? 'node_label_italic' : '';
            },
            oneditprepare: function() {
                $('#node-input-mode').change(function () {
                    var mode = $('#node-input-mode').val();
                    if (mode == 'list') {
                        $('.form-row.mode.rankerid').hide();
                    } else {
                        $('.form-row.mode.rankerid').show();
                    }
                });
                $.getJSON('watson-retrieve-and-rank/vcap/').done(function (service) {
                    $('.servicecreds').toggle(!service);
                }).fail(function () {
                    $('.servicecreds').show();
                }).always(function () {
                    $('#credentials-check').hide();
                })
            }
        });
    })();
</script>

<!-- Search and Rank node -->
<script type="text/x-red" data-template-name="watson-retrieve-rank-search-and-rank">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row servicecreds">
        <label for="node-input-bluemix"><i class="fa fa-user"></i> Service Credentials</label>
        <input type="text" id="node-input-servicecreds">
    </div>
    <div class="form-row mode clusterid">
        <label for="node-input-clusterid"><i class="fa fa-tag"></i> Cluster ID</label>
        <input type="text" id="node-input-clusterid" placeholder="Cluster ID">
    </div>
    <div class="form-row mode collectionname">
        <label for="node-input-collectionname"><i class="fa fa-tag"></i> Collection Name</label>
        <input type="text" id="node-input-collectionname" placeholder="Collection Name">
    </div>
    <div class="form-row mode searchmode" id="rr-searchmode">
        <label for="node-input-searchmode"><i class="fa fa-tag"></i> Search mode</label>
        <select id="node-input-searchmode">
          <option value="search">Search</option>
          <option value="search-and-rank">Search and Rank</option>
        </select>
    </div>
    <div class="form-row mode rankerid" id="rr-rankerid">
        <label for="node-input-rankerid"><i class="fa fa-tag"></i> Ranker ID</label>
        <input type="text" id="node-input-rankerid" placeholder="Ranker ID">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-retrieve-rank-search-and-rank', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                servicecreds: {value: '', type: 'watson-retrieve-rank-credentials', required: false},
                clusterid: {value: ''},
                collectionname: {value: ''},
                searchmode: {value: 'search-and-rank'},
                rankerid: {value: ''}
            },
            color: 'rgb(85, 150, 230)',
            inputs: 1,
            outputs: 1,
            icon: 'RetrieveRank.png',
            paletteLabel: 'retrieve and rank search and rank',
            label: function() {
                return this.name || 'retrieve and rank search and rank';
            },
            labelStyle: function() {
                return this.name ? 'node_label_italic' : '';
            },
            oneditprepare: function() {
                $.getJSON('watson-retrieve-and-rank/vcap/').done(function (service) {
                    $('.servicecreds').toggle(!service);
                }).fail(function () {
                    $('.servicecreds').show();
                }).always(function () {
                    $('#credentials-check').hide();
                })

                function toggleRankerInput() {
                  if($('#rr-searchmode select').val() === 'search') {
                    $('#rr-rankerid').hide()
                  } else {
                    $('#rr-rankerid').show()
                  }
                }

                $('#rr-searchmode select').change(toggleRankerInput)

                toggleRankerInput()
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-retrieve-rank-create-cluster">
<p>The IBM Watson Retrieve and Rank service combines two information retrieval components in a single service: the power of Apache Solr and a sophisticated machine learning capability. This combination provides users with more relevant results by automatically reranking them by using these machine learning algorithms.</p>
    <p>The create cluster node provisions a Solr cluster. You can specify the <b>size</b> of the cluster in the node configuration panel. For a small free cluster for testing choose the Free option. For more information about cluster sizing, see <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/doc/retrieve-rank/solr_ops.shtml#sizing">Sizing your Retrieve and Rank cluster</a>. A <b>cluster name</b> can be specified in the node configuration panel or passed in on <code>msg.payload</code>. The cluster name specified in the node configuration panel takes priority.</p>
    <p>The cluster will then be created. This takes a short while to complete. When the cluster is available, the status underneath the node will change to <b>Cluster available</b>.</p>
    <p>For more information about the Retrieve and Rank service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/retrieve-rank.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-retrieve-rank-cluster-settings">
<p>The IBM Watson Retrieve and Rank service combines two information retrieval components in a single service: the power of Apache Solr and a sophisticated machine learning capability. This combination provides users with more relevant results by automatically reranking them by using these machine learning algorithms.</p>
    <p>The cluster settings node provides the following functionality configurable in the node configuration panel:</p>
    <ul>
        <li><b>List Clusters </b>Returns a list of all clusters in the service. Note there is a maximum of <b>5</b> clusters.</li>
        <li><b>Cluster Information </b>Returns status and other information about a cluster. The <code>cluster_id</code> can be passed into the node on <code>msg.cluster_id</code> or specified in the node configuration panel. The cluster id specified in the node configuration panel takes priority.</li>
        <li><b>Delete Cluster </b>Delete a cluster from the service. The <code>cluster_id</code> can be passed into the node on <code>msg.cluster_id</code> or specified in the node configuration panel. The cluster id specified in the node configuration panel takes priority.</li>
    </ul>
    <p>The response from each query is returned on <code>msg.payload</code>.</p>
    <p>For more information about the Retrieve and Rank service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/retrieve-rank.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-retrieve-rank-upload-solr-configuration">
<p>The IBM Watson Retrieve and Rank service combines two information retrieval components in a single service: the power of Apache Solr and a sophisticated machine learning capability. This combination provides users with more relevant results by automatically reranking them by using these machine learning algorithms.</p>
    <p>The upload solr configuration node allows a solr configuration .zip file to be uploaded to the Retrieve and Rank service. The .zip file should be passed in on <code>msg.payload</code> as a <b>Buffer</b>.</p>
    The <code>cluster_id</code> can be passed into the node on <code>msg.cluster_id</code> or specified in the node configuration panel. The cluster id specified in the node configuration panel takes priority.</li>
    The <code>configuration_name</code> can be passed into the node on <code>msg.configuration_name</code> or specified in the node configuration panel. The configuration_name specified in the node configuration panel takes priority.</li>
    <p>The response from the service is returned on <code>msg.payload</code>.</p>
    <p>For more information about the Retrieve and Rank service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/retrieve-rank.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-retrieve-rank-solr-configuration-settings">
<p>The IBM Watson Retrieve and Rank service combines two information retrieval components in a single service: the power of Apache Solr and a sophisticated machine learning capability. This combination provides users with more relevant results by automatically reranking them by using these machine learning algorithms.</p>
    <p>The solr configuration settings node provides the following functionality configurable in the node configuration panel:</p>
    <ul>
        <li><b>List Solr Configurations </b>Retrieves all configurations for a cluster.</li>
        <li><b>Solr Configuration Information </b>Retrieves the configuration for a cluster by its name. The <code>cluster_id</code> can be passed into the node on <code>msg.cluster_id</code> or specified in the node configuration panel. The cluster id specified in the node configuration panel takes priority.</li>
    The <code>configuration_name</code> can be passed into the node on <code>msg.configuration_name</code> or specified in the node configuration panel. The configuration_name specified in the node configuration panel takes priority.</li>
        <li><b>Delete Solr Configuration </b>Deletes the configuration for a cluster. Note, <b>before</b> you delete the configuration, you must delete any <b>collections</b> that point to it. The <code>cluster_id</code> can be passed into the node on <code>msg.cluster_id</code> or specified in the node configuration panel. The cluster id specified in the node configuration panel takes priority.</li>
    The <code>configuration_name</code> can be passed into the node on <code>msg.configuration_name</code> or specified in the node configuration panel. The configuration_name specified in the node configuration panel takes priority.</li>
    </ul>
    <p>The response from each query is returned on <code>msg.payload</code>.</p>
    <p>For more information about the Retrieve and Rank service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/retrieve-rank.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-retrieve-rank-solr-collection">
<p>The IBM Watson Retrieve and Rank service combines two information retrieval components in a single service: the power of Apache Solr and a sophisticated machine learning capability. This combination provides users with more relevant results by automatically reranking them by using these machine learning algorithms.</p>
    <p>The solr collection node allows the following queries to be performed on a solr collection:</p>
    <ul>
        <li><b>Create Solr Collection </b>The <code>cluster_id</code>, <code>collection_name</code> and <code>configuration_name</code> can be passed into the node on <code>msg.cluster_id</code>, <code>msg.collection_name</code> and <code>msg.configuration_name</code> respectively, or specified in the node configuration panel. Parameters specified in the node configuration panel take priority.</li>
        <li><b>Delete Solr Collection </b>The <code>cluster_id</code> and <code>collection_name</code> can be passed into the node on <code>msg.cluster_id</code> and <code>msg.collection_name</code> respectively, or specified in the node configuration panel. Parameters specified in the node configuration panel take priority.</li>
        <li><b>Index Documents </b>The <code>cluster_id</code> and <code>collection_name</code> can be passed into the node on <code>msg.cluster_id</code> and <code>msg.collection_name</code> respectively, or specified in the node configuration panel. Parameters specified in the node configuration panel take priority. The array of documents to be indexed should be passed in as a <b>String</b> on <code>msg.payload</code>.</li>
        <li><b>Search </b>Searches the collection based on a given query specified in <b>Solr standard query syntax</b>. This should be passed in as a <b>String</b> on <code>msg.payload</code>. The <code>cluster_id</code> and <code>collection_name</code> can be passed into the node on <code>msg.cluster_id</code> and <code>msg.collection_name</code> respectively, or specified in the node configuration panel. Parameters specified in the node configuration panel take priority.</li>
    </ul>
    <p>The response from each query is returned on <code>msg.payload</code>.</p>
    <p>For more information about the Retrieve and Rank service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/retrieve-rank.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-retrieve-rank-create-ranker">
    <p>The IBM Watson Retrieve and Rank service combines two information retrieval components in a single service: the power of Apache Solr and a sophisticated machine learning capability. This combination provides users with more relevant results by automatically reranking them by using these machine learning algorithms.</p>
    <p>The create ranker node allows a ranker to be trained from <code>.csv</code> training data. The training data should be passed in as a <b>Buffer</b> on <code>msg.payload</code>. </p>
    <p>The <code>ranker_name</code> can be passed into the node on <code>msg.ranker_name</code> or specified in the node configuration panel. The ranker name specified in the node configuration panel takes priority.</p>

    <p>Once triggered, the ranker will then begin training. Once the ranker is available, the status underneath the node will change to <b>Ranker Available</b>.</p>

    <p>The ranker id is returned on <code>msg.payload</code>.</p>
    <p>For more information about the Retrieve and Rank service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/retrieve-rank.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-retrieve-rank-ranker-settings">
    <p>The IBM Watson Retrieve and Rank service combines two information retrieval components in a single service: the power of Apache Solr and a sophisticated machine learning capability. This combination provides users with more relevant results by automatically reranking them by using these machine learning algorithms.</p>
    <p>The ranker settings node provides information regarding the status of rankers within a service. The following queries are available:</p>

    <ul>
        <li><b>List Rankers</b> Retrieves the list of rankers for the service instance.</li>
        <li><b>Ranker Information</b> Returns status and other information about a ranker. The <code>ranker_id</code> can be passed into the node on <code>msg.ranker_id</code> or specified in the node configuration panel. The ranker id specified in the node configuration panel takes priority.</li>
        <li><b>Delete Ranker</b> Deletes a ranker. The <code>ranker_id</code> can be passed into the node on <code>msg.ranker_id</code> or specified in the node configuration panel. The ranker id specified in the node configuration panel takes priority.</li>
    </ul>

    <p>The result is returned on <code>msg.payload</code>.</p>
    <p>For more information about the Retrieve and Rank service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/retrieve-rank.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-retrieve-rank-search-and-rank">
    <p>The IBM Watson Retrieve and Rank service combines two information retrieval components in a single service: the power of Apache Solr and a sophisticated machine learning capability. This combination provides users with more relevant results by automatically reranking them by using these machine learning algorithms.</p>
    <p>The search and rank node returns reranked results for your query, where the query matches the <a href="https://cwiki.apache.org/confluence/display/solr/The+Standard+Query+Parser">Solr Standard Query Parser</a>. The <code>cluster_id</code>, <code>collection_name</code> and <code>ranker_id</code> can be passed into the node on <code>msg.cluster_id</code>, <code>msg.collection_name</code> and <code>msg.ranker_id</code> respectively, or specified in the node configuration panel. Parameters specified in the node configuration panel take priority.</p>
    <p>The search query is passed in on  <code>msg.payload</code> starting with <code>q=</code> to match the Solr Standard Query Parser.</p>
    <p>The result is returned on <code>msg.payload</code>.</p>
    <p>For more information about the Retrieve and Rank service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/retrieve-rank.html">documentation</a>.</p>
</script><!--
  Copyright 2016 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-speech-to-text">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>

    <div>
        <label id="node-label-message"><i class="fa fa-exclamation-triangle"></i></label>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name"></input>
    </div>

    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username"></input>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password"></input>
    </div>

    <div class="form-row">
        <label for="node-input-lang"><i class="fa fa-language"></i> Language</label>
        <select type="text" id="node-input-lang" style="display: inline-block; width: 70%;">
        </select>
    </div>
    <div class="form-row">
        <input type="hidden" id="node-input-langhidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-band"><i class="fa fa-audio-o"></i> Quality</label>
        <select type="text" id="node-input-band" style="display: inline-block; width: 70%;">
        </select>
    </div>
    <div class="form-row">
        <input type="hidden" id="node-input-bandhidden"/>
    </div>

    <div class="form-row">
        <label for="node-input-continuous"><i class="fa fa-audio-o"></i> Continuous</label>
        <input type="checkbox" id="node-input-continuous"></input>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-speakerlabels"><i class="fa fa-audio-o"></i> Speaker Labels</label>
        <input type="checkbox" id="node-input-speakerlabels"></input>
        </select>
    </div>


</script>



<script type="text/javascript">

  // Need to simulate a namespace, as some of the variables had started to leak across nodes
  function STT () {
  }


  // This is the namespace for stt. Currently only contains models, but more vars and functions may need to be
  // moved in if there is a clash with other nodes.
  var stt = new STT();
  stt.models = null;
  stt.languages = null;
  stt.bands = null;
  stt.language_selected = '';
  stt.band_selected = '';

  stt.LANGUAGES = { 'en-US': 'US English',
                    'pt-BR': 'Portuguese Braziilian',
                    'en-UK': 'UK English' ,
                    'fr-FR': 'French',
                    'zh-CN': 'Mandarin',
                    'es-ES': 'Spanish',
                    'ar-AR': 'Arablic',
                    'ja-JP': 'Japanese'
                  };

  // sorting functions
  stt.onlyUnique = function (value, index, self) {
    return self.indexOf(value) === index;
  }

  // Function to be used at the start, as don't want to expose any fields, unless the models are
  // available. The models can only be fetched if the credentials are available.
  stt.hideEverything = function () {
    if (!stt.models) {
      $('#credentials-not-found').show();
      $('label#node-label-message').parent().hide();
      $('input#node-input-continuous').parent().hide();
      $('input#node-input-speakerlabels').parent().hide();
      $('select#node-input-lang').parent().hide();
      $('select#node-input-band').parent().hide();
    }
  }

  // Check if there is a model then can show the fields.
  // available. The models can only be fetched if the credentials are available.
  stt.VisibilityCheck = function () {
    if (stt.models) {
      $('label#node-label-message').parent().hide();
      $('input#node-input-continuous').parent().show();
      $('input#node-input-speakerlabels').parent().show();
      $('select#node-input-lang').parent().show();
      $('select#node-input-band').parent().show();
    } else {
      $('label#node-label-message').parent().hide();
      $('input#node-input-continuous').parent().hide();
      $('input#node-input-speakerlabels').parent().hide();
      $('select#node-input-lang').parent().hide();
      $('select#node-input-band').parent().hide();
    }
  }


  // Simple check that is only invoked if the service is not bound into bluemix. In this case the
  // user has to provide credentials. Once there are credentials, then the stt.models are retrieved.
  stt.checkCredentials = function () {
    var u = $('#node-input-username').val();
    var p = $('#node-input-password').val();

    if (u && u.length && p) {
      if (!stt.models) {
        stt.getModels();
      }
    }
  }

  // Populate the quality select field
  stt.populateBands = function () {
    if (!stt.bands && stt.models) {
      stt.bands = stt.models.map(function(m) {
        return m.name.split('_')[1];
      });
      var unique_bands = stt.bands.filter(stt.onlyUnique);
      stt.bands = unique_bands;
    }

    if (stt.bands) {
      $('select#node-input-band').empty();

      stt.bands.forEach(function(b) {
        var selectedText = '';
        if (stt.band_selected === b) {
          selectedText = 'selected="selected"';
        }
        $('select#node-input-band')
          .append('<option value='
                        + '"' + b + '"'
                        + selectedText
                        + '>'
                        + b
                        + '</option>');
      });
    }
  }

  // Register the handlers for the fields
  stt.handlersUI = function () {
    $('#node-input-username').change(function(val){
      stt.checkCredentials();
    });
    $('#node-input-password').change(function(val){
      stt.checkCredentials();
    });

    $('#node-input-lang').change(function (val) {
      stt.language_selected = $('#node-input-lang').val();
      stt.populateBands();
    });

    $('#node-input-band').change(function (val) {
      stt.band_selected = $('#node-input-band').val();
    });
  }

  // Function called when either when the models have been retrieved, or
  // on dialog load, if the model has already been retrieved
  stt.postModelCheck = function () {
    stt.processModels();
    stt.VisibilityCheck();
  }

  // Retrieve the available models from the server, if data is returned, then
  // can enable the dynamic selection fields.
  stt.getModels = function (haveCredentials) {
    var u = $('#node-input-username').val();
    var p = $('#node-input-password').val();

    $.getJSON('watson-speech-to-text/models/', {un: u, pwd: p}).done(function (data) {
      if (data.error) {
        $('label#node-label-message').parent().show();
        $('label#node-label-message').text(data.error);
      } else if (data.models) {
        console.log('models found');
        console.log(data.models);
        stt.models = data.models;
        //have_credentials = true;
        stt.postModelCheck();
      }
    }).fail(function (err) {
      $('label#node-label-message').parent().show();
      $('label#node-label-message').text('Error trying to determine available service models');

    }).always(function () {});
  }

  // Called to complete the languages selection table
  stt.processSTTLanguages = function () {
    if (!stt.languages && stt.models) {
      stt.languages = stt.models.map(function(m) {
        return m.language;
      });
    }
    if (stt.languages) {
      $('select#node-input-lang').empty();
      var unique_langs = stt.languages.filter(stt.onlyUnique);

      unique_langs.forEach(function(l) {
        var selectedText = '';
        if (stt.language_selected === l) {
          selectedText = 'selected="selected"';
        }
        $('select#node-input-lang')
          .append('<option value='
                        + '"' + l + '"'
                        + selectedText
                        + '>'
                        + (stt.LANGUAGES[l] ? stt.LANGUAGES[l] : l)
                        + '</option>');
      });
    }
  }

  // Called to work through the models, completing the dyanmic selection fields.
  stt.processModels = function () {
    if (stt.models) {
      stt.processSTTLanguages();
      stt.populateBands();
    }
  }

  // The dynamic nature of the selection fields in this node has caused problems.
  // Whenever there is a fetch for the models, on a page refresh or applicaiton
  // restart, the settings for the dynamic fields are lost.
  // So hidden (text) fields are being used to squirrel away the values, so that
  // they can be restored.
  stt.restoreFromHidden = function () {
    stt.language_selected = $('#node-input-langhidden').val();
    $('select#node-input-lang').val(stt.language_selected);

    stt.band_selected = $('#node-input-bandhidden').val();
    $('select#node-input-band').val(stt.band_selected);
  }

  // This is the on edit prepare function, which will be invoked everytime the dialog
  // is shown.
  function sttoneditprepare() {
    stt.hideEverything();
    stt.restoreFromHidden();
    stt.handlersUI();

    $.getJSON('watson-speech-to-text/vcap/')
      // for some reason the getJSON resets the vars so need to restoreFromHidden again
      // so again.
      .done(function (service) {
        stt.restoreFromHidden();
        $('.credentials').toggle(!service);
        if (!stt.models) {stt.getModels(service);}
        else {stt.postModelCheck();}
      })
      .fail(function () {
        $('.credentials').show();
      }).always(function () {
        $('#credentials-check').hide();
     });
  }

  // Save the values in the dyanmic lists to the hidden fields.
  function sttoneditsave(){
    $('#node-input-langhidden').val(stt.language_selected);
    $('#node-input-bandhidden').val(stt.band_selected);
  }

    (function() {
        RED.nodes.registerType('watson-speech-to-text', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ''},
                continuous: {value: true},
                speakerlabels: {value: true},
                lang: {value: ''},
                langhidden: {value: ''},
                band: {value: ''},
                bandhidden: {value: ''},
                password: {value: ''}
            },
            credentials: {
              username: {type:'text'} //,
              // password: {type: 'password'}   - // Taken out because, was not being restored on dialog open.
            },
            color: 'rgb(140, 198, 63)',
            inputs: 1,
            outputs: 1,
            icon: 'speech_to_text.png',
            paletteLabel: 'speech to text',
            label: function() {
                return this.name || 'speech to text';
            },
            labelStyle: function() {
                return this.name ? 'node_label_italic' : '';
            },
            oneditprepare: sttoneditprepare,
            oneditsave: sttoneditsave
        });
    })();

</script>
<script type="text/x-red" data-help-name="watson-speech-to-text">
    <p>The Speech To Text converts the human voice into the written word. This service uses machine intelligence to
    combine information about grammar and language structure with knowledge of the composition of the audio signal to
    generate a more accurate transcription</p>
    <p>The audio file to be analysed should be passed in on <code>msg.payload</code>.</p>
    <p>Supported <code>msg.payload</code> types:</b>.</p>
    <ul>
        <li><b>String</b> URL to audio</li>
        <li><b>Buffer</b> Raw Audio Bytes</li>
    </ul>
    <p>Audio must be a <b>WAV, FLAC or OGG encoded file</b>.</p>
    <p>Speech To Text supports decoding speech from three languages: <b>English, Spanish, Japanese, Brazilian Portuguese
    and Mandarin Chinese</b>. This option can be modified in the configuration panel.</p>
    <p>Along with the language, you can also configure the source audio quality. The service supports two different
    source sampling rates, <b>Narrowband (8KHz) and Broadband (16Khz)</b>. Higher sample rates will be downsampled
    automatically but the is not true in reverse.</p>
    <p>Use the continuous property to choose whether the decoding should stop at the first pause or wait until the end of the file.</p>
    <p>Use the speaker label property to  identify which individuals spoke which words in a multi-participant exchange.
    </p>
    <p>The returned audio transcription will be returned on <code>msg.transcription</code>.</p>
    <p>The full response, including alternative transcriptions can be found on
    <code>msg.fullresult</code>.</p>
    <p>For more information about the Speech To Text service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/speech-to-text.html">documentation</a>.</p>
</script><!--
  Copyright 2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-text-to-speech">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>

    <div>
        <label id="node-label-message"><i class="fa fa-exclamation-triangle"></i></label>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-lang"><i class="fa fa-language"></i> Language</label>
        <select type="text" id="node-input-lang" style="display: inline-block; width: 70%;" >

        </select>
    </div>
    <div class="form-row">
        <input type="hidden" id="node-input-langhidden"/>
    </div>
    <div class="form-row">
        <label for="node-input-voice"><i class="fa fa-comment"></i> Voice</label>
        <select type="text" id="node-input-voice" style="display: inline-block; width: 70%;">
         </select>
    </div>
    <div class="form-row">
        <input type="hidden" id="node-input-voicehidden"/>
    </div>
    <div class="form-row">
        <label for="node-input-format"><i class="fa fa-file-audio-o"></i> Format</label>
        <select type="text" id="node-input-format" style="display: inline-block; width: 70%;" >
            <option value="audio/wav">WAV</option>
            <option value="audio/flac">FLAC</option>
            <option value="audio/ogg; codecs=opus">OGG</option>
        </select>
    </div>
</script>



<script type="text/javascript">

  // Need to simulate a namespace, so that some of the variables don't leak across nodes
  function TTS () {
  }

  // This is the namespace for tts.
  var tts = new TTS();
  //tts.language_selected = '';
  //tts.voice_selected = '';
  tts.LANGUAGES = { 'en-US': 'US English',
                    'en-GB': 'UK English',
                    'pt-BR': 'Portuguese Brazilian',
                    'fr-FR': 'French',
                    'it-IT': 'Italian',
                    'de-DE': 'German',
                    'zh-CN': 'Mandarin',
                    'es-ES': 'Spanish',
                    'es-LA': 'Latin American Spanish',
                    'es-US': 'US Spanish',
                    'ar-AR': 'Arablic',
                    'ja-JP': 'Japanese'
                  };

  // sorting functions
  tts.onlyUnique = function (value, index, self) {
    return self.indexOf(value) === index;
  }

  // Called to complete the languages selection table
  tts.processLanguages = function () {
    if (!tts.languages && tts.voices) {
      tts.languages = tts.voices.map(function(m) {
        return m.language;
      });
    }
    if (tts.languages) {
      $('select#node-input-lang').empty();
      var unique_langs = tts.languages.filter(tts.onlyUnique);

      unique_langs.forEach(function(l) {
        var selectedText = '';
        if (tts.language_selected === l) {
          selectedText = 'selected="selected"';
        }
        $('select#node-input-lang')
          .append('<option value='
                        + '"' + l + '"'
                        + selectedText
                         + '>'
                        + (tts.LANGUAGES[l] ? tts.LANGUAGES[l] : l)
                        + '</option>');
      });

    }
  }

 // Populate the Voices selection field
 tts.populateVoices = function () {
   if (!tts.voicenames && tts.voices) {
     tts.voicenames = tts.voices.map(function(m) {
       //return m.name.split('_')[1];
       return m.name;
     });
     var unique_voices = tts.voicenames.filter(tts.onlyUnique);
     tts.voicenames = unique_voices;
   }
   if (!tts.voicedata && tts.voicenames){
     tts.voicedata = [];
     tts.voicenames.forEach(function(a){
       var element = {};
       var bits = a.split('_');
       element.full = a;
       element.language = bits[0];
       element.person = bits[1].replace('Voice','');;
       tts.voicedata.push(element);
     });
   }

   if (tts.voicedata) {
     $('select#node-input-voice').empty();

     tts.voicedata.forEach(function(b) {
       var selectedText = '';
       if (tts.voice_selected === b.full) {
         selectedText = 'selected="selected"';
       }
       if (tts.language_selected === b.language) {
         $('select#node-input-voice')
           .append('<option value='
                         + '"' + b.full + '"'
                         + selectedText
                         + '>'
                         + b.person
                         + '</option>');
       }
     });
   }
 }


  // Called to work through the voices, completing the dyanmic selection fields.
  tts.processVoices = function () {
    if (tts.voices) {
      tts.processLanguages();
      tts.populateVoices();
    }
  }

  tts.visibilityCheck = function ()
  {
    if (tts.voices) {
      $('label#node-label-message').parent().hide();
      $('select#node-input-lang').parent().show();
      $('select#node-input-voice').parent().show();
    } else {
      $('label#node-label-message').parent().hide();
      $('select#node-input-lang').parent().hide();
      $('select#node-input-voice').parent().hide();
    }

  }

  // Function called when either when the voices have been retrieved, or
  // on dialog load, if the voices has already been retrieved
  tts.postVoiceCheck = function (){
    tts.processVoices();
    tts.visibilityCheck();
  }

  // Retrieve the available voices from the server, if data is returned, then
  // can enable the dynamic selection fields.
  tts.getVoices = function (){
    var u = $('#node-input-username').val();
    var p = $('#node-input-password').val();

    $.getJSON('watson-text-to-speech/voices/', {un: u, pwd: p}).done(function (data) {
      if (data.error) {
        $('label#node-label-message').parent().show();
        $('label#node-label-message').text(data.error);
      } else if (data.voices) {
        tts.voices = data.voices;
        tts.postVoiceCheck();
      }
    }).fail(function (err) {
      $('label#node-label-message').parent().show();
      $('label#node-label-message').text('Error trying to determine available service voices');

    }).always(function () {});
  }


  // The dynamic nature of the selection fields in this node has caused problems.
  // Whenever there is a fetch for the models, on a page refresh or applicaiton
  // restart, the settings for the dynamic fields are lost.
  // So hidden (text) fields are being used to squirrel away the values, so that
  // they can be restored.
  tts.restoreFromHidden = function () {
    tts.language_selected = $('#node-input-langhidden').val();
    $('select#node-input-lang').val(tts.language_selected);

    tts.voice_selected = $('#node-input-voicehidden').val();
    $('select#node-input-voice').val(tts.voice_selected);
  }

  // Simple check that is only invoked if the service is not bound into bluemix. In this case the
  // user has to provide credentials. Once there are credentials, then the tts.voices are retrieved.
  tts.checkCredentials = function () {
    var u = $('#node-input-username').val();
    var p = $('#node-input-password').val();

    if (u && u.length && p) {
      if (!tts.voices) {
        tts.getVoices();
      }
    }
  }

  // Language Setting has changed, modofy voice options appropriately
  tts.checkLanguage = function (){
    //var lang = $('#node-input-lang').val();
    //$('#node-input-voice option.' + lang).show();
    //$('#node-input-voice option:not(.' + lang + ')').hide();
    //var first = $('#node-input-voice option.' + lang + ':first').val();
    //$('#node-input-voice').val(first);

    tts.language_selected = $('#node-input-lang').val();
  }

  // Voice Setting has changed, modofy voice options appropriately
  tts.checkVoice = function (){
    tts.voice_selected = $('#node-input-voice').val();
  }


  // Register the onchange handlers
  tts.registerHandlers = function () {
    $('#node-input-username').change(function(val){
      tts.checkCredentials();
    });
    $('#node-input-password').change(function(val){
      tts.checkCredentials();
    });
    $('#node-input-lang').change(function () {
      tts.checkLanguage();
      tts.populateVoices();
    });
    $('#node-input-voice').change(function () {
      tts.checkVoice();
    });

  }

  // Function to be used at the start, as don't want to expose any fields, unless the models are
  // available. The models can only be fetched if the credentials are available.
  tts.hideEverything = function () {
    if (!stt.models) {
      $('label#node-label-message').parent().hide();
      $('select#node-input-lang').parent().hide();
      $('select#node-input-voice').parent().hide();
    }
  }

  // This is the on edit prepare function, which will be invoked everytime the dialog
  // is shown.
  function ttsoneditprepare() {
    console.log('In on Edit Prepare');
    tts.hideEverything();
    tts.restoreFromHidden();
    tts.registerHandlers();

    $.getJSON('watson-text-to-speech/vcap/')
     .done(function (service) {
       tts.restoreFromHidden();
        $('.credentials').toggle(!service);
        if (!tts.voices) {tts.getVoices();}
        else {tts.postVoiceCheck();}
      })
    .fail(function () {
      $('.credentials').show();
    }).always(function () {
      $('#credentials-check').hide();
    })
  }

  // Save the values in the dyanmic lists to the hidden fields.
  function ttsoneditsave(){
    $('#node-input-langhidden').val(tts.language_selected);
    $('#node-input-voicehidden').val(tts.voice_selected);
  }

    (function() {
        RED.nodes.registerType('watson-text-to-speech', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ""},
                lang: {value: ""},
                langhidden: {value: ""},
                voice: {value: ""},
                voicehidden: {value: ""},
                format: {value: "audio/wav"},
                password: {value: ''}
            },
            credentials: {
              username: {type:"text"},
              // password: {type:"password"}   - // Taken out because, was not being restored on dialog open.
            },
            color: "rgb(140, 198, 63)",
            inputs: 1,
            outputs: 1,
            icon: "text_to_speech.png",
            paletteLabel: "text to speech",
            label: function() {
                return this.name || "text to speech";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditsave: ttsoneditsave,
            oneditprepare: ttsoneditprepare
        });
     })();
</script>
<script type="text/x-red" data-help-name="watson-text-to-speech">
    <p>The Text To Speech service understands text and natural language to generate synthesized audio output complete
    with appropriate cadence and intonation.</p>
    <p>You can choose different voices for a range of languages:</b>.</p>
    <p>The text to be converted should be passed in on <code>msg.payload</code>.</p>
    <p><b>The source text must be in the language which matches the chosen voice, i.e. you cannot choose to a Spanish
    voice with English text.</b>.</p>
    <p>The returned audio transcription will be returned as a raw buffer containing the audio on <code>msg.speech</code>.</p>
    <p>For more information about the Text To Speech service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/text-to-speech.html">documentation</a>.</p>
</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-tone-analyzer-v3">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-tones"><i class="fa fa-comments-o"></i> Tones</label>
        <select type="text" id="node-input-tones" style="display: inline-block; width: 70%;" >
            <option value="all">All</option>
            <option value="emotion">Emotion</option>
            <option value="language">Language</option>
            <option value="social">Social</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-sentences"><i class="fa fa-language"></i> Sentences</label>
        <select type="text" id="node-input-sentences" style="display: inline-block; width: 70%;" >
            <option value="true">True</option>
            <option value="false">False</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-contentType"><i class="fa fa-comments-o"></i> Content type</label>
        <select type="text" id="node-input-contentType" style="display: inline-block; width: 70%;" >
            <option value="false">Text</option>
            <option value="true">HTML</option>
        </select>
    </div>
 
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-tone-analyzer-v3', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ""},
                tones: {value: "all"},
                sentences: {value: "true"},
                contentType: {value: "false"}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(84,149,230)",
            inputs: 1,
            outputs: 1,
            icon: "tone_analyzer.png",
            paletteLabel: "tone analyzer v3",
            label: function() {
                return this.name || "tone analyzer v3";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-tone-analyzer/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-tone-analyzer-v3">
    <p>The Tone Analyzer service uses linguistic analysis to detect emotional tones, social propensities, 
       and writing styles in written communication.</p>
    <p>The text to analyze should be passed in on <b>msg.payload</b>.</p>
    <p>The service response will be returned on <b>msg.response</b>.</p>
    <p>The tone and sentances can be programmaticaly set in <code>msg.tones</code>
    and <code>msg.sentences</code></p>
    <p>Usng the node editor dialog users can filter the results by tone (emotion, language or social) and 
      whether to include sentence-level analysis.</p>
    <p>For more information about the Tone Analyzer service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/tone-analyzer.html">documentation</a>.</p>
</script><!--
  Copyright 2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-tradeoff-analytics">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-tradeoff-analytics', {
            category: 'IBM Watson',
            defaults: {
                name: {value: ""},
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(32, 178, 239)",
            inputs: 1,
            outputs: 1,
            icon: "tradeoff_analytics.png",
            paletteLabel: "tradeoff analytics",
            label: function() {
                return this.name || "tradeoff analytics";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-tradeoff-analytics/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-tradeoff-analytics">
    <p>The Tradeoff Analytics helps people make better choices when faced with multiple, often conflicting goals and
    alternatives. Mathematical filtering techniques to identify the top options based on multiple criteria, helps users
    explore the tradeoffs between options when making complex decisions.</p>
    <p>The decision subject to analyse should be passed in on <code>msg.payload</code>.</p>
    <p>The criteria columns should be passed in on <code>msg.columns</code>.</p>
    <p>The decision options should be passed in on <code>msg.options</code>.</p>
    <p>The resolution results will be returned on <code>msg.resolution</code>.</p>
    <p>For more information about the Tradeoff Analytics service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/tradeoff-analytics.html">documentation</a>.</p>
</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-tone-analyzer">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
    <div class="form-row">
        <label for="node-input-tones"><i class="fa fa-comments-o"></i> Tones</label>
        <select type="text" id="node-input-tones" style="display: inline-block; width: 70%;" >
            <option value="all">All</option>
            <option value="emotion">Emotion</option>
            <option value="social">Social</option>
            <option value="writing">Writing</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-sentences"><i class="fa fa-language"></i> Sentences</label>
        <select type="text" id="node-input-sentences" style="display: inline-block; width: 70%;" >
            <option value="true">True</option>
            <option value="false">False</option>
        </select>
    </div>
 
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-tone-analyzer', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""},
                tones: {value: "all"},
                sentences: {value: "true"}
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(84,149,230)",
            inputs: 1,
            outputs: 1,
            icon: "tone_analyzer.png",
            paletteLabel: "tone analyzer",
            label: function() {
                return this.name || "tone analyzer";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-tone-analyzer/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="watson-tone-analyzer">
    <p><b>NB:</b> This node uses the old beta API and it is only being retained for backward compatibility for anyone that has old credentials. It will no longer work with new credentials.</p>
    <br/>
    <p>The Tone Analyzer service uses linguistic analysis to detect emotional tones, social propensities, and writing styles in written communication.</p>
    <p>The text to analyze should be passed in on <b>msg.payload</b>.</p>
    <p>The service response will be returned on <b>msg.response</b>.</p>
    <p>Usng the node editor dialog users can filter the results by tone (emotion, writing or social) and whether to include sentence-level analysis.</p>
    <p>For more information about the Tone Analyzer service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/tone-analyzer.html">documentation</a>.</p>
    <p><b>NB:</b> This is the old beta version and it is only being retained for backward compatibility for anyone that has old credentials. It will no longer work with new credentials.</p>
</script><!--
  Copyright 2015 IBM Corp. 

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="watson-visual-recognition">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-username" placeholder="Username">
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="Password">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('watson-visual-recognition', {
            category: 'Watson Deprecated',
            defaults: {
                name: {value: ""},
            },
            credentials: {
              username: {type:"text"},
              password: {type:"password"}
            },
            color: "rgb(32, 178, 239)",
            inputs: 1,
            outputs: 1,
            icon: "visual_recognition.png",
            paletteLabel: "visual recognition",
            label: function() {
                return this.name || "visual recognition";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $.getJSON('watson-visual-recognition/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  }).always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>

<script type="text/javascript">

	function classifiersList(node) {
		
		console.log("-> classifiersList");
		
		var last = $('#node-input-classifier').children().last();
		var opts = [];
		$.getJSON('watson-visual-recognition/list/'+node.service,function(data) {
			var classifiers = data.classifiers;
			for (var i=0; i < classifiers.length; i++) {
				console.log("-> classifiersList.data "+classifiers[i].name);
				var selected = node.classifier === classifiers[i].name;
				opts.push(
					'<option value="' + classifiers[i].classifier_id + '"' + (selected ? " selected":"") + '>' +
						classifiers[i].name +
					'</option>'
				);
			}

			console.log("-> node.classifier: "+node.classifier);
			if (opts.length === 0) {
				$('#node-input-classifier').find("option").filter(function() {
					return $(this).val() === node.classifier;
				}).attr('selected', true);
			} else {
				last.before(opts.join(""));
			}
		});
	}

	RED.nodes.registerType('watson-visual-util',{
		category: 'Watson Deprecated',
		color: '#FFFF80',
		defaults: {
			name: {value:""},
			command: {value:"",required:true},
			classifier: {value:"",required:false},
			username: {value:"",required:true},
			password: {value:"",required:true},
			service: {value:"",required:true}
		},		
		inputs:1,
		outputs:1,
		icon: "visual2.png",
		label: function() {
			return this.name||"visual utils";
		},
		
		visuals: [],
		
		oneditprepare: function() {
			var node = this;
			console.log("this: "+JSON.stringify(this));
			
			classifiersList(node);
	
			$.getJSON('watson-visual-recognition/vcap/',function(data) {
				
				node.visuals = data;
				var last = $('#node-input-service').children().last();
				var opts = [];
	
				for (var i=0; i < data.length; i++) {
					var selected = node.service === data[i].name;
					opts.push(
						'<option value="' + data[i].name + '"' + (selected ? " selected":"") + '>' +
							data[i].name +
						'</option>'
					);
				}
	
				if (opts.length === 0) {
					node.service = "_ext_";
					$('#node-input-service').find("option").filter(function() {
						return $(this).val() == node.service;
					}).attr('selected', true);
				} else {
					last.before(opts.join(""));
				}
	
				if (node.service === '_ext_') {
					$("#external_visual_service :input").attr('disabled',false);
				} else {
					for (var i2=0;i2<node.visuals.length;i2++) {
						var ws = node.visuals[i2];
						if (ws.name === node.service) {
							$("#node-input-username").val(ws.username);
							$("#node-input-password").val(ws.password);
							console.log("** Visual: "+JSON.stringify(node.visuals[i2]));
						}
					}
					$("#external_visual_service :input").attr('disabled',true);
				}
				
				if (node.command === 'list') {
					$("#node-input-classifier :input").attr('disabled',true);
				} else {
					$("#node-input-classifier :input").attr('disabled',false);
				}

			});

			$("#node-input-command").on("change",function() {
				if (this.value === 'list') {
					$("#node-input-classifier :input").attr('disabled',true);
				} else {
					$("#node-input-classifier :input").attr('disabled',false);
				}
			});

			$("#node-input-service").on("change",function() {
				$("#node--input-service").val(this.value);
				if (this.value === '_ext_') {
					$("#external_visual_details :input").attr('disabled',false);
				} else {
					if(node.visuals) {
						$("#external_visual_details :input").attr('disabled',true);
						for (var i=0;i<node.visuals.length;i++) {
							var ws = node.visuals[i];
							if (ws.name === this.value) {
								$("#node-input-username").val(ws.username);
								$("#node-input-password").val(ws.password);
							}
						}
					}

				}
			});

			$("#node-input-command").on("change",function() {
				if (this.value === 'list') {
					$("#node-input-classifier :input").attr('disabled',true);
				} else {
					$("#node-input-classifier :input").attr('disabled',false);
				}
			});
		}

	});

	RED.nodes.registerType('watson-visual-training',{
		category: 'Watson Deprecated',
		color: '#FFFF80',
		defaults: {
			name: {value:""},
			classifier: {value:"",required:true},
			username: {value:"",required:true},
			password: {value:"",required:true},
			service: {value:"",required:true}
		},		
		inputs:1,
		outputs:1,
		icon: "visual2.png",
		label: function() {
			return this.name||"visual training";
		},
		
		visuals: [],

		oneditprepare: function() {
			var node = this;
			console.log("this: "+JSON.stringify(this));
	
			$.getJSON('watson-visual-recognition/vcap/',function(data) {
				
				node.visuals = data;
				console.log("Visuals: "+JSON.stringify(data));
				
				var last = $('#node-input-service').children().last();
				var opts = [];
	
				console.log("node.service: "+node.service);
				for (var i=0; i < data.length; i++) {
					console.log("data.name: "+data[i].name);
					
					var selected = node.service === data[i].name;
					console.log("selected: "+selected);
					opts.push(
						'<option value="' + data[i].name + '"' + (selected ? " selected":"") + '>' +
							data[i].name +
						'</option>'
					);
				}
	
				if (opts.length === 0) {
					node.service = "_ext_";
					$('#node-input-service').find("option").filter(function() {
						return $(this).val() == node.service;
					}).attr('selected', true);
				} else {
					last.before(opts.join(""));
				}
	
				if (node.service === '_ext_') {
				} else {
					for (var i2=0;i2<node.visuals.length;i2++) {
						var ws = node.visuals[i2];
						if (ws.name === node.service) {
							$("#node-input-username").val(ws.username);
							$("#node-input-password").val(ws.password);
							util.log("** Visual: "+JSON.stringify(node.visuals[i2]));
						}
					}
					$("#external_visual_details :input").attr('disabled',true);
				}
			});

			$("#node-input-service").on("change",function() {
				$("#node--input-service").val(this.value);
				if (this.value === '_ext_') {
					$("#external_visual_details :input").attr('disabled',false);
				} else {
					if(node.visuals) {
						$("#external_visual_details :input").attr('disabled',true);
						for (var i=0;i<node.visuals.length;i++) {
							var ws = node.visuals[i];
							if (ws.name === this.value) {
								$("#node-input-username").val(ws.username);
								$("#node-input-password").val(ws.password);
							}
						}
					}

				}
			});
		}
	});

</script>

<script type="text/x-red" data-template-name="watson-visual-util">
	<div class="form-row">
		<label for="node-input-name"><i class="icon-tag"></i> Name</label>
		<input type="text" id="node-input-name" placeholder="Name">
	</div>
	<div class="form-row">
		<label for="node-input-command"><i class="icon-tag"></i> Command</label>
		<select id="node-input-command">
			<option value="list">List Classifiers</option>
			<option value="details">Classifier Details</option>
			<option value="delete">Delete Classifier</option>
		</select>
	</div>
	<div class="form-row">
		<label for="node-input-classifier"><i class="icon-tag"></i> Classifier</label>
		<select id="node-input-classifier">
			<option value="" disabled></option>
		</select>
		<!--input type="text" id="node-input-classifier" placeholder="Name"-->
	</div>
	<div class="form-row">
		<label for="node-input-service"><i class="fa fa-globe"></i> Service</label>
		<select id="node-input-service">
			<option value="" disabled></option>
			<option value="_ext_"> External service</option>
		</select>
	</div>
	<div id="external_visual_details">
		<div class="form-row">
			<label for="node-input-username"><i class="fa fa-user"></i> Username</label>
			<input type="text" id="node-input-username">
		</div>
		<div class="form-row">
			<label for="node-input-password"><i class="fa fa-lock"></i> Password</label>
			<input type="text" id="node-input-password">
		</div>
	</div>
</script>



<script type="text/x-red" data-template-name="watson-visual-training">
	<div class="form-row">
		<label for="node-input-name"><i class="icon-tag"></i> Name</label>
		<input type="text" id="node-input-name" placeholder="Name">
	</div>
	<div class="form-row">
		<label for="node-input-classifier"><i class="icon-tag"></i> Classifier</label>
		<input type="text" id="node-input-classifier" placeholder="Name">
	</div>
	<div class="form-row">
		<label for="node-input-service"><i class="fa fa-globe"></i> Service</label>
		<select id="node-input-service">
			<option value="" disabled></option>
			<option value="_ext_"> External service</option>
		</select>
	</div>
	<div id="external_visual_details">
		<div class="form-row">
			<label for="node-input-username"><i class="fa fa-user"></i> Username</label>
			<input type="text" id="node-input-username">
		</div>
		<div class="form-row">
			<label for="node-input-password"><i class="fa fa-lock"></i> Password</label>
			<input type="text" id="node-input-password">
		</div>
	</div>
</script>




<script type="text/x-red" data-help-name="watson-visual-recognition">
    <p><b>NB:</b> This node uses the old beta API and it is only being retained for backward compatibility for 
        anyone that has an Visual Recognition credentials. 
        It will no longer work with new Visual Recognition keys.</p>
    <br/>
    <p>The Visual Recognition service analyses images to understand their contents.</p>
    <p>The image to be analysed should be passed in on <code>msg.payload</code>.</p>
    <p>Supported <code>msg.payload</code> types:</b>.</p>
    <ul>
        <li><b>String</b> URL to image</li>
        <li><b>Buffer</b> Raw Image Bytes</li>
    </ul>
    <p>The identified images labels will be returned on <code>msg.labels</code>.</p>
    <p>For more information about the Visual Recognition service, read the <a href="https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition.html">documentation</a>.</p>
</script><script type="text/x-red" data-help-name="watson-visual-util">
    <p><b>NB:</b> This node uses the old beta API and it is only being retained for backward compatibility for 
        anyone that has an Visual Recognition credentials. 
        It will no longer work with new Visual Recognition keys.</p>
    <br/>
    <p>A node for managing the classifiers in the Visual Recognition service in Watson</p>
	<p>More information about this service can be found in the 
	<a href='https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/doc/visual-recognition/'>Image Recognition API documentation</a></p>.
</script><script type="text/x-red" data-help-name="watson-visual-training">
    <p><b>NB:</b> This node uses the old beta API and it is only being retained for backward compatibility for 
        anyone that has an Visual Recognition credentials. 
        It will no longer work with new Visual Recognition keys.</p>
    <br/>
	<p>A node for training the Visual Recognition service in Watson</p>
	<p>This service requires that two sets of images are provided for the training. These sets of files should be 
	zipped and provided to the node either as binary streams or as URL's. The positive and negative set of images 
	should be pointed by <b>msg.positive</b> and <b>msg.negative</b>.</p>
	<p>More information about this service can be found in the 
	<a href='https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/doc/visual-recognition/'>Image Recognition API documentation</a></p>.
</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="visual-recognition-v3">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-apikey"><i class="fa fa-key"></i> API Key</label>
        <input type="password" id="node-input-apikey" placeholder="API Key">
    </div>
    <div class="form-row">
        <label for="node-input-image-feature"><i class="fa fa-book"></i> Detect: </label>
        <select type="text" id="node-input-image-feature" style="display: inline-block; width: 70%;">
            <option selected="selected" value="classifyImage">Classify an image</option>
            <option value="detectFaces">Detect Faces</option>
            <option value="recognizeText">Recognize Text</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row" id="lang-group">
        <label for="node-input-lang-label"><i class="fa fa-language"></i> Language</label>
        <select type="text" id="node-input-lang" style="display: inline-block; width: 70%;" >
            <option selected="selected" value="en">English</option>
            <option value="es">Spanish</option>
            <option value="ar">Arabic</option>
            <option value="ja">Japanese</option>
        </select>
    </div>
</script>

<script type="text/x-red" data-template-name="visual-recognition-util-v3">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-apikey"><i class="fa fa-key"></i> API Key</label>
        <input type="password" id="node-input-apikey" placeholder="API Key">
    </div>
    <div class="form-row">
        <label for="node-input-image-feature"><i class="fa fa-book"></i> Detect: </label>
        <select type="text" id="node-input-image-feature" style="display: inline-block; width: 70%;">
            <option value="createClassifier">Create a classifier</option>
            <option value="retrieveClassifiersList">Retrieve a list of classifiers</option>
            <option value="retrieveClassifierDetails">Retrieve Classifier Details</option>
            <option value="deleteClassifier">Delete a classifier</option>
            <option value="deleteAllClassifiers">Delete all classifiers</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>






<script type="text/javascript">

// Need to simulate a namespace, as some of the variables had started to leak across nodes
  function VISUALRECOGNITIONV3 () {
  }

  // This is the namespace for visualrecognitionv3. Currently only contains models, but more vars and functions may need to be
  // moved in if there is a clash with other nodes.
  var visualrecognitionv3 = new VISUALRECOGNITIONV3();
  visualrecognitionv3.language_selected = '';

  // Save the values in the dynamic lists to the hidden fields.
  function oneditsave(){
    visualrecognitionv3.language_selected = $('#node-input-lang').val();
  }

    (function() {
        RED.nodes.registerType('visual-recognition-v3', {
            category: 'IBM Watson',
            defaults: {
              name: {value: ""},
              apikey: {value: ""},
              "image-feature": {value: ""},
              "lang": {value: ""},
            },
            credentials: {
              apikey: {type:"password"}
            },
            color: 'rgb(228, 189, 255)',
            inputs: 1,
            outputs: 1,
            icon: "VR-v3-pink.png",
            paletteLabel: "visual recognition",
            label: function() {
                return this.name || "visual recognition";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
              var node = this;
              $.getJSON('watson-visual-recognition/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  })
                  .always(function () {
                    $('#credentials-check').hide();
                  });

              // Default the type of extraction, as its coming up blank,
              // which is confusing our users
              var currfeature = $('#node-input-image-feature').val();
              if (!currfeature) {
                $("#node-input-image-feature option[value='classifyImage']").prop('selected', true);  
              }

              // update list of ruleset for the selected service when the service changes
              // The language is needed for the classifyImage, and if not set causes
              // problems downstream. So if it is not set will default to English.
              // Even though selected='selected' is set in the html for the dialog it
              // doesn't appear.
              $('#node-input-image-feature').change(function() {
                var selectedFeature = $('#node-input-image-feature');
                if (selectedFeature.val() == 'classifyImage') {
                    var currvalue = $('#node-input-lang').val();
                    if (!currvalue) {
                      if (!visualrecognitionv3.language_selected) {
                        visualrecognitionv3.language_selected = 'en';
                        $("#node-input-lang option[value='en']").prop('selected', true);
                      }
                    }
                    $('#lang-group').show();
                }
                else {
                    $('#lang-group').hide();
                }
              });
            },
            oneditsave: oneditsave
        });


        RED.nodes.registerType('visual-recognition-util-v3', {
            category: 'IBM Watson',
            defaults: {
              name: {value: ""},
              apikey: {value: ""},
              "image-feature": {value: ""}
            },
            credentials: {
              apikey: {type:"password"}
            },
            color: 'rgb(228, 189, 255)',
            inputs: 1,
            outputs: 1,
            icon: "VR-v3-pink.png",
            paletteLabel: "visual recognition util",
            label: function() {
                return this.name || "visual recognition util";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
              $.getJSON('watson-visual-recognition/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  })
                  .always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>


<script type="text/x-red" data-help-name="visual-recognition-v3">
	<p>Using the Visual Recognition v3 node, you can use the Watson Visual Recognition service V3 to identify scenes, objects, faces, and text in images you upload to the service. You can create and train a custom classifier to identify subjects that suit your needs.</p>
    <p>The following features are available :</p>
    <ul>
        <li><b>Classify an image</b> Upload images or URLs to identify built-in classifiers by default. To identify custom classifiers, include the classifier_ids or owners parameters. Images must be in .jpeg, .jpg or .png format.</li>
        <li><b>Detect Faces</b> : analyze faces in images and get data about them, such as estimated age and gender. Images must be in .jpeg, .jpg or .png format.</li>
        <li><b>Recognize Text</b> : recognizes text in images. This is a beta function of the Visual Recognition service that supports only English language text identification</li>
    </ul>

    <p>All Results will made available at <code>msg.result</code></p>
    <p>Important : Maximum image size is 2 MB</p>
    <br/>

    <p><b>Classify an image</b></p>
    <p>This feature should be provided in input : </p>
    <ul>
    <li><code>msg.payload</code> : the URL or the Node.js Buffer of an image. Redirects are followed, so you can use shortened URLs. (Required)</li>
    <li><code>msg.params["classifier_ids"]</code> : A comma-separated list of the classifier IDs used to classify the images. "Default" is the classifier_id of the built-in classifier. (string) (Optional)</li>
    <li><code>msg.params["owners"]</code> : A comma-separated list with the value(s) "IBM" and/or "me" to specify which classifiers to run. (string) (Optional)</li>
    <li><code>msg.params["threshold"]</code> : A floating value (in string format) that specifies the minimum score a class must have to be displayed in the response (Optional)</li>
    <li><code>msg.params["accept_language"]</code> : Specifies the language of the output class names. Can be 'en' (English as default), 'es' (Spanish), 'ar' (Arabic) or 'ja' (Japanese). Classes for which no translation is available are omitted. If specified, it overrides the language specified in the node configuration (Optional)</li>
    </ul>
    <p>More information on this <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/?curl#classify_an_image">API documentation</a>.</p>

    <p><b>Detect Faces</b></p>
    <p>This feature should be provided in input : </p>
    <ul>
    <li><code>msg.payload</code> : the URL or the Node.js Buffer of an image. Redirects are followed, so you can use shortened URLs. (Required)</li>
    </ul>
    <p>More information on this <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/?curl#detect_faces">API documentation</a>.</p>

    <p><b>Text Recognition</b></p>
    <p>This feature should be provided in input : </p>
    <ul>
    <li><code>msg.payload</code> : the URL or the Node.js Buffer of an image. Redirects are followed, so you can use shortened URLs. (Required)</li>
    </ul>
    <p>More information on this <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/?curl#recognize_text">API documentation</a>.</p>

    <br/>
    <p>For full details on the feature details and response values, please see the <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/">Watson Visual Recognition (v3) API documentation</a></p>

    <p>Check the sample Flow for this node on  <a href="https://github.com/watson-developer-cloud/node-red-bluemix-starter">Watson Node-RED Starter</a></p>
</script><script type="text/x-red" data-help-name="visual-recognition-util-v3">
	<p> This node enables you to use the training features of the Watson Visual Recognition service V3 that aims to identify scenes, objects, faces, and text in images you upload to the service. Using this node you can create and train a custom classifier to identify subjects that suit your needs.</p>
    <p>The following features are available :</p>
    <ul>
        <li><b>Create a classifier</b> </li>
        <li><b>Retrieve a list of custom classifier</b></li>
        <li><b>Retrieve classifier details</b></li>
        <li><b>Delete a classifier</b></li>
        <li><b>Delete all classifiers</b></li>
    </ul>

    <p>All Results will made available at <code>msg.result</code></p>

    <p><b>Create a Classifier</b></p>
    <p>this feature should be provided in input : </p>
    <ul>
    <li><code>msg.params["name"]</code> : a string name that will be used as prefix for the returned classifier_id (Required)</li>
    <li><code>msg.params["{classname}_positive_examples"]</code> : a Node.js binary Buffer of the ZIP that contains a minimum of 10 images. (Required)</li>
    <li><code>msg.params["negative_examples"]</code> : a Node.js binary Buffer of the ZIP that contains a minimum of 10 images.(Optional)</li>
    </ul>
    <p>More information on this <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/?curl#create_a_classifier">API documentation</a>.</p>

    <p><b>Retrieve classifiers list</b></p>
    <p>this feature does not need input params.</p>

    <p>More information on this <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/?curl#retrieve_a_list_of_classifiers">API documentation</a>.</p>

    <p><b>Retrieve a classifier details</b></p>
    <p>this feature should be provided in input : </p>
    <ul>
    <li><code>msg.params["classifier_id"]</code> : the classifier_id (string) (Required)</li>
    </ul>
    <p>More information on this <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/?curl#retrieve_classifier_details">API documentation</a>.</p>

    <p><b>Delete a classifier </b></p>
    <p>this feature should be provided in input : </p>
    <ul>
    <li><code>msg.params["classifier_id"]</code> : the classifier_id (string) (Required)</li>
    </ul>
    <p>More information on this <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/?curl#delete_a_classifier">API documentation</a>.</p>

    <p>For full details on the feature details and response values, please see the <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/">Watson Visual Recognition (v3) API documentation</a></p>

    <p><b>Delete All Classifiers</b></p>
    <p>This feature simply delete all custom classifiers associated to the service instance. This feature does not need input params.</p>

    <br/>
    <p>For full details on the feature details and response values, please see the <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition/api/v3/">Watson Visual Recognition (v3) API documentation</a></p>

    <p>Check the sample Flow for this node on  <a href="https://github.com/watson-developer-cloud/node-red-bluemix-starter">Watson Node-RED Starter</a></p>

</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="similarity-search-v3">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-apikey"><i class="fa fa-key"></i> API Key</label>
        <input type="password" id="node-input-apikey" placeholder="API Key">
    </div>
    <div class="form-row">
        <label for="node-input-image-feature"><i class="fa fa-book"></i> Detect: </label>
        <select type="text" id="node-input-image-feature" style="display: inline-block; width: 70%;">
            <option value="findSimilar">Find similar images</option>          
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

   <div id="msg-options">
        <div class="node-input-msg-options form-tips" id="watson-ss-findSimilar">
            <p><b>Find similar images</b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
                <li><code>msg.params["image_file"]</code> : The image file to compare to the collection. (Required)</li>
                <li><code>msg.params["limit"]</code> : The number of similar results you want returned, default 10, max 100. (Optional)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#create_a_collection">API documentation</a>.</p>
        </div>
    </div>
</script>

<script type="text/x-red" data-template-name="similarity-search-util-v3">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-apikey"><i class="fa fa-key"></i> API Key</label>
        <input type="password" id="node-input-apikey" placeholder="API Key">
    </div>
    <div class="form-row">
        <label for="node-input-image-feature"><i class="fa fa-book"></i> Detect: </label>
        <select type="text" id="node-input-image-feature" style="display: inline-block; width: 70%;">
            <option value="createCollection">Create a collection</option>
            <option value="getCollection">Retrieve collection details</option>
            <option value="listCollections">List collections</option>
            <option value="deleteCollection">Delete a collection</option>
            <option value="addImage">Add image to collection</option>
            <option value="listImages">List images in collection</option>
            <option value="getImage">Get image details</option>
            <option value="deleteImage">Delete image from collection</option>
            <option value="setImageMetadata">Update image metadata</option>
            <option value="getImageMetadata">Get image metadata</option>
            <option value="deleteImageMetadata">Delete image metadata</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <div id="msg-options">
        <div class="node-input-msg-options form-tips" id="watson-ss-createCollection">
            <p><b>Create a Collection</b></p>
            <p>this feature takes these inputs : </p>
            <ul>
                <li><code>msg.params["name"]</code> : a string name that will be used as prefix for the returned classifier_id (Required)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#create_a_collection">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-getCollection">
            <p><b>Retrieve collection details</b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#list_collections">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-listCollections">
            <p><b>List collections</b></p>
            <p>this feature does not need input params.</p>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#list_collection">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-deleteCollection">
            <p><b> Delete a collection </b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#delete_collection">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-addImage">
            <p><b> Add image to collection </b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
                <li><code>msg.params["image_file"]</code> : The image file to add to the collection. (Required)</li>
                <li><code>msg.params["metadata"]</code> : A JSON object that adds metadata to the image (Optional)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#add_images">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-listImages">
            <p><b> List images in collection </b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#list_images">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-getImage">
            <p><b> Get image details </b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
                <li><code>msg.params["image_id"]</code> : The image file to add to the collection. (Required)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#list_image_details">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-deleteImage">
            <p><b> Delete image from collection </b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
                <li><code>msg.params["image_id"]</code> : The image file to delete from the collection. (Required)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#delete_image">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-setImageMetadata">
            <p><b> Update image metadata </b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
                <li><code>msg.params["image_id"]</code> : The image file whose metadata to set. (Required)</li>
                <li><code>msg.params["metadata"]</code> : JSON object of metadata to add to the image (Required)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#add_metadata">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-getImageMetadata">
            <p><b> Get image metadata </b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
                <li><code>msg.params["image_id"]</code> : The image file whose metadata to fetch. (Required)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#list_metadata">API documentation</a>.</p>
        </div>
        <div class="node-input-msg-options form-tips" id="watson-ss-deleteImageMetadata">
            <p><b> Delete image metadata </b></p>
            <ul>
                <li><code>msg.params["collection_id"]</code> : the ID of your collection (Required)</li>
                <li><code>msg.params["image_id"]</code> : The image file whose metadata to delete. (Required)</li>
            </ul>
            <p>All Results will made available at <code>msg.result</code></p>
            <p>More information in the <a href="https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/?curl#delete_metadata">API documentation</a>.</p>
        </div>
    </div>

</script>







<script type="text/javascript">

// Need to simulate a namespace, as some of the variables had started to leak across nodes
  function SIMILARITYSEARCHV3 () {
  }  

  // This is the namespace for similaritysearchv3. Currently only contains models, but more vars and functions may need to be 
  // moved in if there is a clash with other nodes.
  var similaritysearchv3 = new SIMILARITYSEARCHV3();

  // Save the values in the dynamic lists to the hidden fields.
  function oneditsave(){}

    (function() {
        RED.nodes.registerType('similarity-search-v3', {
            category: 'IBM Watson',
            defaults: {
              name: {value: ""},
              apikey: {value: ""},
              "image-feature": {value:"findSimilar"},
              "lang": {value: ""},
            },
            credentials: {
              apikey: {type:"password"}
            },
            color: 'rgb(228, 189, 255)',
            inputs: 1,
            outputs: 1,
            icon: "VR-v3-pink.png",
            paletteLabel: "similarity search",
            label: function() {
                return this.name || "similarity search";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
              var node = this;
              $.getJSON('watson-similarity-search/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  })
                  .always(function () {
                    $('#credentials-check').hide();
                  });
            },
            oneditsave: oneditsave
        });


        RED.nodes.registerType('similarity-search-util-v3', {
            category: 'IBM Watson',
            defaults: {
              name: {value: ""},
              apikey: {value: ""},
              "image-feature": {value: "createCollection"}
            },
            credentials: {
              apikey: {type:"password"}
            },
            color: 'rgb(228, 189, 255)',
            inputs: 1,
            outputs: 1,
            icon: "VR-v3-pink.png",
            paletteLabel: "similarity search util",
            label: function() {
                return this.name || "similarity search util";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
                $('.node-input-msg-options').hide()
              // update list of ruleset for the selected service when the service changes
              $('#node-input-image-feature').change(function() {
                var feature = $(this).val()
                $('.node-input-msg-options').hide()
                $('#watson-ss-' + feature).show()
              });
                $.getJSON('watson-similarity-search/vcap/')
                    .done(function (service) {
                        $('.credentials').toggle(!service);
                    })
                    .fail(function () {
                        $('.credentials').show();
                    })
                    .always(function () {
                        $('#credentials-check').hide();
                    })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="similarity-search-v3">
    <p><b><i>Warning: this node is still in beta</i></b></p>
	<p>With this node you can use the Similarity Search from the Watson Visual Recognition service to find similar images within your custom collections. To set up and manage your collections use the Similarity Search Util node.</p>

    <p>Important : Maximum image size is 2 MB</p>
    <br/>
    
    <p>Check the sample Flow for this node on  <a href="https://github.com/watson-developer-cloud/node-red-bluemix-starter">Watson Node-RED Starter</a></p>


</script><script type="text/x-red" data-help-name="similarity-search-util-v3">
    <p><b><i>Warning: this node is still in beta</i></b></p>
	<p> This node enables you to use the training features of the Watson Visual Recognition service V3 that aims to identify scenes, objects, faces, and text in images you upload to the service. Using this node you can create and train a custom classifier to identify subjects that suit your needs.</p>
    <p>The following features are available :</p>
    <ul>
	<li><b>Create a collection</b></li>
	<p>Create a collection of images to search. You can create a maximum of 5 collections.</p>
	<li><b>Retrieve collection details</b></li>
	<p>Retrieve information about a specific collection.</p>
	<li><b>List collections</b></li>
	<p>List all custom collections</p>
	<li><b>Delete a collection</b></li>
	<p>Delete a user created collection</p>
	<li><b>Add image to collection</b></li>
	<p>Add images to a collection. Each collection can contain 1000000 images.</p>
	<li><b>List images in collection</b></li>
	<p>List the first 100 images in a collection. Each collection can contain 1000000 images.</p>
	<li><b>Get image details</b></li>
	<p>List details about a specific image in a collection.</p>
	<li><b>Delete image from collection</b></li>
	<p>Delete an image from a collection.</p>
	<li><b>Update image metadata</b></li>
	<p>Add metadata to a specific image in a collection. Use metadata for your own reference to identify images. You cannot filter the find_similar method by metadata.</p>
	<li><b>Get image metadata</b></li>
	<p>View the metadata for a specific image in a collection.</p>
	<li><b>Delete image metadata</b></li>
	<p>Delete all metadata associated with an image.</p>
    </ul>

</script><!--
  Copyright 2013,2015 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="alchemy-image-analysis">
    <div id="credentials-check" class="form-row">
        <div class="form-tips">
            <i class="fa fa-question-circle"></i><b> Please wait: </b> Checking for bound service credentials...
        </div>
    </div>
    <div class="form-row credentials" style="display: none;">
        <label for="node-input-apikey"><i class="fa fa-key"></i> API Key</label>
        <input type="password" id="node-input-apikey" placeholder="API Key">
    </div>
    <div class="form-row">
        <label for="node-input-image-feature"><i class="fa fa-book"></i> Detect: </label>
        <select type="text" id="node-input-image-feature" style="display: inline-block; width: 70%;">
            <option value="imageFaces">Faces</option>
            <option value="imageLink">URLs</option>
            <option value="imageKeywords">Content Tags</option>
            <option value="imageText">Text</option>            
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>



<script type="text/javascript">
    (function() {
        RED.nodes.registerType('alchemy-image-analysis', {
            category: "Watson Deprecated",
            defaults: {
              name: {value: ""},
              apikey: {value: ""},
              "image-feature": {value: ""}
            },
            credentials: {
              apikey: {type:"password"}
            },
            color: '#00A2FF',
            inputs: 1,
            outputs: 1,
            icon: "alchemy.png",
            paletteLabel: "Image Analysis",
            label: function() {
                return this.name || "Image Analysis";
            },
            labelStyle: function() {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function() {
              $.getJSON('alchemy-image-analysis/vcap/')
                  .done(function (service) {
                    $('.credentials').toggle(!service);
                  })
                  .fail(function () {
                    $('.credentials').show();
                  })
                  .always(function () {
                    $('#credentials-check').hide();
                  })
            }
        });
    })();
</script>
<script type="text/x-red" data-help-name="alchemy-image-analysis">
    <p><b>NB:</b> The service behind this node has been merged with Visual Recognition. 
    This node uses the old beta API and it is only being retained for backward compatibility for anyone that has an old AlchemyAPI key. It will no longer work with new AlchemyAPI keys.</p>
    <br/>
    <p>Using the Image Analysis node, you can use the Alchemy APIs to analyse images for face detection, content tags and links.</p>
    <p>The following features are available for analysis:</p>
    <ul>
        <li><b>Faces</b>, discover human faces within the image.</li>
        <li><b>URLs</b>, extract images from a URL webpage.</li>
        <li><b>Content Tags</b>, extract content tags from the image.</li>
        <li><b>Text</b>, extract text from the image.</li>        
    </ul>
    <p>For full details on the feature details and response values, please see the <a href="http://www.alchemyapi.com/api">Alchemy API documentation</a></p>
    <p>The content to be analysed should be passed in on <code>msg.payload</code>.</p>
    <p>Valid <code>msg.payload</code> types: URL or Buffer containing raw image bytes.</p>
    <p>If you need to send custom parameters along with each feature, set those parameters as children of the <code>msg.alchemy_options</code> object.
       eg. <code>msg.alchemy_options = {knowledgeGraph: 1}</code>
    </p>
    <br>
    <p>Results from the Alchemy API service will made available at <code>msg.result</code>.</p>
</script><!--
  Copyright 2014 IBM Corp.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="dashDB">
    <div class="form-row">
        <label for="node-config-input-hostname"><i class="fa fa-bookmark"></i> Hostname</label>
        <input class="input-append-left" type="text" id="node-config-input-hostname">
    </div>
    <div class="form-row">
        <label for="node-config-input-db"><i class="fa fa-user"></i> Database</label>
        <input type="text" id="node-config-input-db">
    </div>
    <div class="form-row">
        <label for="node-config-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-config-input-username">
    </div>
    <div class="form-row">
        <label for="node-config-input-password"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-config-input-password">
    </div>
    <div class="form-row">
        <label for="node-config-input-port"><i class="fa fa-lock"></i> Port</label>
        <input type="text" id="node-config-input-port">
    </div>
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("dashDB",{
        category: "config",
        color: "rgb(114, 199, 231)",
        defaults: {
            hostname: {value:"", required:true},
            db: {value:""},
            port: {value:"50000"},
            name: {value:""}
        },
        credentials: {
            username: {type:"text"},
            password: {type:"password"}
        },
        label: function() {
            return this.name || this.host;
        }
    });
</script>

<script type="text/x-red" data-template-name="dashDB out">

    <div class="form-row">
        <label for="node-input-service"><i class="fa fa-folder-close"></i> Service</label>
        <select id="node-input-service" style="width:68%;">
            <!-- <option value="" disabled></option> -->
            <option value="_ext_"> External dashDB or DB2 instance</option>
        </select>
    </div>

    <div class="form-row hide" id="node-input-external-details">
        <label for="node-input-dashDB"><i class="fa fa-bookmark"></i> Server</label>
        <input type="text" id="node-input-dashDB">
    </div>

    <div class="form-row">
        <label for="node-input-table"><i class="fa fa-briefcase"></i> Table</label>
        <input type="text" id="node-input-table" placeholder="table">
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="name">
    </div>

</script>

<script type="text/javascript">
    RED.nodes.registerType("dashDB out", {
        category: "storage-output",
        color: "rgb(153, 204, 153)",
        defaults: {
            dashDB: { type:"dashDB", validate:validateServer },
            service: { value: "", required: true },
            table: { value: "", required: true },
            name: { value: "" }
        },
        inputs: 1,
        outputs: 0,
        icon: "dashDB.png",
        align: "right",
        label: label,
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: oneditprepare
    });

    function oneditprepare() {
        var node = this;

        var serviceSelect  = $('#node-input-service');

        $.getJSON('dashDB/vcap/',function(data) {
            var last = serviceSelect.children().last();
            var opts = [];

            for (var i=0; i < data.length; i++) {
                var selected = node.service == data[i].name;
                opts.push(
                    '<option value="' + data[i].name + '"' + (selected ? " selected":"") + '>' +
                        data[i].name +
                    '</option>'
                );
            }

            if (opts.length == 0) {
                node.service = "_ext_";
                serviceSelect.find("option").filter(function() {
                    return $(this).val() == node.service;
                }).attr('selected', true);
            } else {
                last.before(opts.join(""));
            }
            serviceSelect.change();
        });

        serviceSelect.change(function() {
            var service = serviceSelect.val();
            if (service == "_ext_") {
                $("#node-input-external-details").show();
            } else {
                $("#node-input-external-details").hide();
            }
        });


    }

    function label() {
        return this.name || this.table || "dashDB";
    }

    function validateServer(v) {
       return this.service != "_ext_" || v != "_ADD_";
    }

</script>



<script type="text/x-red" data-template-name="dashDB in">
   <div class="form-row">
       <label for="node-input-service"><i class="fa fa-folder-close"></i> Service</label>
       <select id="node-input-service" style="width:68%;">
           <!-- <option value="" disabled></option> -->
           <option value="_ext_"> External dashDB or DB2 instance</option>
       </select>
   </div>

   <div class="form-row hide" id="node-input-external-details">
       <label for="node-input-dashDB"><i class="fa fa-bookmark"></i> Server</label>
       <input type="text" id="node-input-dashDB">
   </div>

    <div class="form-row">
        <label for="node-input-query"><i class="fa fa-briefcase"></i> Query</label>
        <textarea style="width:70%; height:75px" id="node-input-query">Type your SQL query here</textarea>
    </div>

    <div class="form-row">
        <label for="node-input-params"><i class="fa fa-briefcase"></i> Parameter Markers (optional)</label>
        <input type="text" id="node-input-params" placeholder="params">
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="name">
    </div>

</script>

<script type="text/javascript">
    RED.nodes.registerType("dashDB in", {
        category: "storage-input",
        color: "rgb(153, 204, 153)",
        defaults: {
            dashDB: { type:"dashDB", validate:validateServer },
            service: { value: "", required: true },
            query: { value: "", required: false },
            params: { value: "", required: false },
            name: { value: "" }
        },
        inputs: 1,
        outputs: 1,
        icon: "dashDB.png",
        label: label,
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: oneditprepare
    });

    function oneditprepare() {
        var node = this;

        var serviceSelect  = $('#node-input-service');

        $.getJSON('dashDB/vcap/',function(data) {
            var last = serviceSelect.children().last();
            var opts = [];

            for (var i=0; i < data.length; i++) {
                var selected = node.service == data[i].name;
                opts.push(
                    '<option value="' + data[i].name + '"' + (selected ? " selected":"") + '>' +
                        data[i].name +
                    '</option>'
                );
            }

            if (opts.length == 0) {
                node.service = "_ext_";
                serviceSelect.find("option").filter(function() {
                    return $(this).val() == node.service;
                }).attr('selected', true);
            } else {
                last.before(opts.join(""));
            }
            serviceSelect.change();
        });

        serviceSelect.change(function() {
            var service = serviceSelect.val();
            if (service == "_ext_") {
                $("#node-input-external-details").show();
            } else {
                $("#node-input-external-details").hide();
            }
        });

    }


    function label() {
        return this.name || "dashDB";
    }

    function validateServer(v) {
       return this.service != "_ext_" || v != "_ADD_";
    }

</script>


<script type="text/x-red" data-help-name="dashDB out">
   <p>
       A simple dashDB output node. Stores elements from the <b>msg.payload</b>
       into your dashDB service.  The msg.payload should include a value for
       each column in your table.  If you put a 'TIMESTAMP' string as one of the
       values, the node will replace it with the current timestamp in DB2 format.
   </p>
   <p>
       So for example, if you have a table with columns (TS, SCREENNAME, TWEET, SENTIMENT, LOCATION),
       then you might create a function node that flows into your sqldb output node
       with code that maps each of those columns to other values in the msg object, like this:
   </p>
       msg.payload =<br>
       {<br>
&nbsp;&nbsp;&nbsp;TS : 'TIMESTAMP',<br>
&nbsp;&nbsp;&nbsp;SCREENNAME : msg.tweet.user.screen_name,<br>
&nbsp;&nbsp;&nbsp;TWEET : msg.payload,<br>
&nbsp;&nbsp;&nbsp;SENTIMENT : msg.sentiment.score,<br>
&nbsp;&nbsp;&nbsp;LOCATION : msg.location<br>
       }<br>
       return msg;<br><br>
   <p>
       <b>Service</b> should point to your dashDB service.
   </p>
   <p>
       <b>Table</b> should point to the table you wish to insert the values into.
       This table needs to exist already in the database and needs to contain the
       same columns and datatypes that you are inserting through this node.
       The data needs to be in the format accepted by DB2 and within the appropriate
       ranges/parameters for that datatype.
   </p>
   <p>
      <b>Name:</b> Optionally give your node a name, otherwise the default will be the table name.
   </p>

</script><script type="text/x-red" data-help-name="dashDB in">
   <p>
       A simple dashDB node for executing queries. It executes a query on your dashDB service database
       and passes along the result set in the <b>msg</b> object, as msg.payload.  If there is an
       error during execution of the query, the msg.payload will be null and the error will be in
       msg.error.
   </p>
   <p>
       <b>Service</b> should point to your dashDB service.
   </p>
   <p>
       <b>Query</b> is the query you wish to execute on your dashDB service database.  If it is empty,
       it will look for the query in the msg.payload.
   </p>
   <p>
       <b>Parameter Markers</b> is a comma delimited set of json paths.  These will replace any question
       marks that you place in your query, in the order that they appear.
   </p>
   <p>
      <b>Name:</b> Optionally give your node a name, otherwise the default will be the table name.
   </p>
</script></body></html>